CREATE DATABASE  IF NOT EXISTS `nmc_control` /*!40100 DEFAULT CHARACTER SET utf8 */;
USE `nmc_control`;
-- MySQL dump 10.13  Distrib 5.7.17, for Win64 (x86_64)
--
-- Host: 127.0.0.1    Database: nmc_control
-- ------------------------------------------------------
-- Server version	5.7.29-log

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Dumping routines for database 'nmc_control'
--
/*!50003 DROP FUNCTION IF EXISTS `extract_json_value_nmc` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `extract_json_value_nmc`(
    json_text text charset utf8,
    xpath text charset utf8
) RETURNS text CHARSET utf8
    MODIFIES SQL DATA
    DETERMINISTIC
    SQL SECURITY INVOKER
    COMMENT 'Extracts JSON value via XPath'
begin
  return concat(ExtractValue(json_to_xml(json_text), xpath),',');	
end ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetAddressJSON` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetAddressJSON`(addressId int) RETURNS text CHARSET utf8
BEGIN
DECLARE ADDRESS TEXT;
	SET  group_concat_max_len = 10000000;

	
	SELECT  GROUP_CONCAT('{',
		CONCAT('"114.115":"',A.tbl_address_id,'"'),
		CONCAT(',"114.179":"',A.tbl_address_nmcId,'"'),
		CONCAT(',"121.45":"',COALESCE(B.tbl_addresstype_id,''),'"'),
		CONCAT(',"300.62":{',
			CONCAT('"122.87":"' ,COALESCE(C.tbl_country_id,''),'"'),
			CONCAT(',"47.18":"' ,COALESCE(C.tbl_country_name,''),'"'),
			CONCAT(',"114.17":"' ,COALESCE(C.tbl_country_code,''),'"}')
		),
		CONCAT(',"300.64":{',
			CONCAT('"120.13":"' ,COALESCE(D.tbl_state_id,''),'"'),
			CONCAT(',"47.16":"' ,COALESCE(D.tbl_state_name,''),'"'),
			CONCAT(',"122.87":"' ,COALESCE(C.tbl_country_id,''),'"}')
		),
		CONCAT(',"300.65":{',
			CONCAT('"114.14":"' ,COALESCE(E.tbl_city_id,''),'"'),
			CONCAT(',"47.15":"' ,COALESCE(E.tbl_city_name,''),'"'),
			CONCAT(',"120.13":"' ,COALESCE(D.tbl_state_id,''),'"}')
		),
		CONCAT(',"300.66":{',
			CONCAT('"122.107":"' ,COALESCE(F.tbl_zipcode_id,''),'"'),
			CONCAT(',"47.17":"' ,COALESCE(F.tbl_zipcode_name,''),'"'),
			CONCAT(',"114.14":"' ,COALESCE(E.tbl_city_id,''),'"}')
		),
		CONCAT(',"114.12":"',COALESCE(A.tbl_address_first,''),'"'),
		CONCAT(',"114.13":"',COALESCE(A.tbl_address_second,''),'"}') )
	AS JSON
	FROM tbl_address AS A,
		 tbl_addresstype AS B,
		 tbl_country AS C,
		 tbl_state AS D,
         tbl_city AS E,
         tbl_zipcode AS F
	WHERE A.tbl_address_id = addressId
		AND A.tbl_addresstype_id = B.tbl_addresstype_id
		AND A.tbl_country_id = C.tbl_country_id
		AND A.tbl_state_id = D.tbl_state_id
		AND A.tbl_city_id = E.tbl_city_id
		AND A.tbl_zipcode_id = F.tbl_zipcode_id
	INTO ADDRESS;

	RETURN ADDRESS;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetBussCategoryJSONLevel1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetBussCategoryJSONLevel1`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(    
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',3,
                  '","122.183":"',C.tbl_category_active,
					'","300.67":{"47.42":"',C.tbl_category_image,
                     '"},"300.80":{"122.18":"',C.tbl_category_parentId,'"},"300.27":[', if ((select count(*) from  dbitems.tbl_category 
														where tbl_category_parentId = C.tbl_category_id) > 0, GetBussCategoryJSONLevel2(C.tbl_category_id, languageId),''),
					']}'))  
	FROM dbitems.tbl_category C, dbitems.tbl_categorydescription D
	where C.tbl_category_id = D.tbl_category_id
    and D.tbl_language_id = languageId
	and C.tbl_category_active=1
	and C.tbl_category_parentId = parentId);

IF( JSON iS NULL ) THEN 
	SET JSON =  "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetBussCategoryJSONLevel2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetBussCategoryJSONLevel2`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = (
SELECT GROUP_CONCAT(     
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',4,
                  '","122.183":"',C.tbl_category_active,
					'","300.67":{"47.42":"',C.tbl_category_image,
                     '"},"300.80":{"122.18":"',C.tbl_category_parentId,'"},"300.27":[', if ((select count(*) from  dbitems.tbl_category 
														where tbl_category_parentId = C.tbl_category_id) > 0, GetBussCategoryJSONLevel3(C.tbl_category, languageId),''),
					']}'))  
	FROM dbitems.tbl_category C, dbitems.tbl_categorydescription D
	where C.tbl_category_id = D.tbl_category_id
	and D.tbl_language_id = languageId
	and C.tbl_category_active=1
	and C.tbl_category_parentId = parentId);

IF( JSON iS NULL ) THEN 
	SET JSON =  "";
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetBussCategoryJSONLevel3` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetBussCategoryJSONLevel3`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(    
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',5,
                  '","122.183":"',C.tbl_category_active,
					'","300.67":{"47.42":"',C.tbl_category_image,
                     '"},"300.80":{"122.18":"',C.tbl_category_parentId,'"},"300.27":[', if ((select count(*) from  dbitems.tbl_category 
														where tbl_category_parentId = C.tbl_category_id) > 0, GetBussCategoryJSONLevel4(C.tbl_category_id, languageId),''),
					']}'))  
	FROM dbitems.tbl_category C, dbitems.tbl_categorydescription D
	where C.tbl_category_id = D.tbl_category_id
	and D.tbl_language_id = languageId
	and C.tbl_category_active=1
	and C.tbl_category_parentId = parentId);

IF( JSON iS NULL ) THEN 
	SET JSON =  "";
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetBussCategoryJSONLevel4` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetBussCategoryJSONLevel4`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',6,
                  '","122.183":"',C.tbl_category_active,
					'","300.67":{"47.42":"',C.tbl_category_image,
                     '"},"300.80":{"122.18":"',C.tbl_category_parentId,'"},"300.27":[', 'No deepest categories supported yet',']}'))  
	FROM dbitems.tbl_category C, dbitems.tbl_categorydescription D
	where C.tbl_category_id = D.tbl_category_id
	and D.tbl_language_id = languageId
	and C.tbl_category_active=1
	and C.tbl_category_parentId = parentId);

IF( JSON iS NULL ) THEN 
	SET JSON =  "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetCardByTransactionFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetCardByTransactionFunction`(TransactionId INT(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(           
					CONCAT('"2":"',C.tbl_card_number,'"'),
					CONCAT(',"122.105":"',C.tbl_card_id,'"'),
					CONCAT(',"48.15":"',COALESCE(C.tbl_card_tocken,''),'"'),			
					CONCAT(',"48.2":"',COALESCE(C.tbl_card_chardholderName,''),'"'),
					CONCAT(',"120.7":"',COALESCE(C.tbl_cardstype_id,''),'"')
					)
from dbcards.tbl_card C,dbtransaction.tbl_transaction as T
where T.tbl_transaction_id = TransactionId
and C.tbl_card_tocken = T.tbl_transaction_cardTocken
);


IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetCardsByInvoiceFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetCardsByInvoiceFunction`(Invoice INT(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 



SELECT GROUP_CONCAT(           
					CONCAT('{"48.30":"', B.tbl_transaction_amount,'"'),
					CONCAT(',"48.6":"', COALESCE(D.tbl_card_nickname,''),'"'),
					CONCAT(',"37":"',SUBSTRING(FLOOR(RAND()*100000) FROM 1 FOR 5),'"'),
					CONCAT(',"38":"',SUBSTRING(FLOOR(RAND()*100000) FROM 1 FOR 5),'"}')
					)
					
from tbl_invoice as A,
tbl_transaction as B, 
dbcards.tbl_carduser as C, 
dbcards.tbl_card as D 
where A.tbl_invoice_id = Invoice
and A.tbl_invoice_id = B.tbl_invoice_id
and A.tbl_consumer_nmcId = C.tbl_user_nmcId
and B.tbl_transaction_cardTocken = D.tbl_card_tocken
and C.tbl_card_tocken = D.tbl_card_tocken
and C.tbl_user_nmcId = D.tbl_user_id
);

IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetCategoryJSONLevel0` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetCategoryJSONLevel0`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000; 
SET JSON = (
SELECT GROUP_CONCAT(    
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',C.tbl_category_level,
                  '","122.183":"',C.tbl_category_active,
					'","300.67":{"47.42":"',C.tbl_category_image,
                     '"},"300.80":{"122.18":"',C.tbl_category_parentid,
					 '"},"300.27":[', if ((select count(*) from  tbl_category 
									where tbl_category_parentid = C.tbl_category_id) > 0, GetCategoryJSONLevel1(C.tbl_category_id,languageId),''),
					']}'))  

FROM tbl_category C,
     tbl_categorydescription D
where C.tbl_category_id = D.tbl_category_id
and C.tbl_category_active = 1
and C.tbl_category_parentid = parentId
and D.tbl_language_id = languageId);

IF JSON is NULL THEN
	SET JSON = "";
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetCategoryJSONLevel1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetCategoryJSONLevel1`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000; 
SET JSON = (
SELECT GROUP_CONCAT(    
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',C.tbl_category_level,
                  '","122.183":"',C.tbl_category_active,
					'","300.67":{"47.42":"',C.tbl_category_image,
                     '"},"300.80":{"122.18":"',C.tbl_category_parentid,
					 '"},"300.27":[', if ((select count(*) from  tbl_category 
									where tbl_category_parentid = C.tbl_category_id) > 0, GetCategoryJSONLevel2(C.tbl_category_id,languageId),''),
					']}'))  

FROM tbl_category C,
     tbl_categorydescription D
where C.tbl_category_id = D.tbl_category_id
and C.tbl_category_active = 1
and C.tbl_category_parentid = parentId
and D.tbl_language_id = languageId);

IF JSON is NULL THEN
	SET JSON = "";
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetCategoryJSONLevel2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetCategoryJSONLevel2`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = (
SELECT GROUP_CONCAT(     
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',C.tbl_category_level,
                  '","122.183":"',C.tbl_category_active,
					'","300.67":{"47.42":"',C.tbl_category_image,
                     '"},"300.80":{"122.18":"',C.tbl_category_parentid,
					'"},"300.27":[', '',if ((select count(*) from  tbl_category 
														where tbl_category_id = C.tbl_category_parentid) > 0,GetCategoryJSONLevel3(C.tbl_category_id,languageId),''),
					']}'))  

FROM tbl_category C,
     tbl_categorydescription D
where C.tbl_category_id = D.tbl_category_id
and C.tbl_category_active = 1
and C.tbl_category_parentid = parentId
and D.tbl_language_id = languageId);

IF JSON is NULL THEN
	SET JSON = "";
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetCategoryJSONLevel3` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetCategoryJSONLevel3`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = (
SELECT GROUP_CONCAT(     
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',C.tbl_category_level,
				  '","300.67":{"47.42":"',C.tbl_category_image,
                  '"},"122.183":"',C.tbl_category_active,
                     '","300.80":{"122.18":"',C.tbl_category_parentid,
					'"},"300.27":[', if ((select count(*) from  tbl_category 
														where tbl_category_id = C.tbl_category_parentid) > 0, GetCategoryJSONLevel4(C.tbl_category_id,languageId),''),
					']}'))  

FROM tbl_category C,
     tbl_categorydescription D
where C.tbl_category_id = D.tbl_category_id
and C.tbl_category_active = 1
and C.tbl_category_parentid = parentId
and D.tbl_language_id = languageId);

IF JSON is NULL THEN
	SET JSON = "";
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetCategoryJSONLevel4` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetCategoryJSONLevel4`(parentId int, languageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(    
			CONCAT('{"122.18":"',C.tbl_category_id,
				  '","120.45":"',D.tbl_categorydescription_name,
                  '","120.44":"',C.tbl_category_level,
				  '","300.67":{"47.42":"',C.tbl_category_image,
                  '"},"122.183":"',C.tbl_category_active,
                     '","300.80":{"122.18":"',C.tbl_category_parentid,'"}}'))  

FROM tbl_category C,
     tbl_categorydescription D
where C.tbl_category_id = D.tbl_category_id
and C.tbl_category_active = 1
and C.tbl_category_parentid = parentId
and D.tbl_language_id = languageId);

IF JSON is NULL THEN
	SET JSON = "";
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetChoicesFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetChoicesFunction`(OptionId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 



SELECT GROUP_CONCAT(           
					CONCAT('{"121.179":"', PA.tbl_productoption_id,'"'),
					CONCAT(',"122.112":"', PV.tbl_productoptionvalue_id,'"'),
					CONCAT(',"127.16":"',PV.tbl_productoptionvalue_name,'"'),			
					CONCAT(',"120.84":"', PA.tbl_productattribute_optionValuePrice,'"'),
					CONCAT(',"300.24":[',GetInventoryFunction(PA.tbl_productattribute_id),
					']}'))
					
from tbl_productoptionvalue PV, tbl_productattribute PA
where PV.tbl_productoptionvalue_id = PA.tbl_productoptionvalue_id
AND   PA.tbl_productoption_id=OptionId);



IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetComponentByLayout` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetComponentByLayout`(LayoutId int) RETURNS mediumtext CHARSET utf8
BEGIN

	DECLARE ENTITYAUX VARCHAR(4);
	DECLARE JSON TEXT;
	SET  group_concat_max_len = 10000000;

	SET JSON = ( 

	SELECT GROUP_CONCAT(
	CONCAT('{"123.18":"',tbl_component_id,'"'),
    CONCAT(',"123.19":"', COALESCE(tbl_component_name,''),'"'),
    CONCAT(',"114.132":"',COALESCE(tbl_component_key,''),'"'),
	CONCAT(',"123.14":"', COALESCE(tbl_component_x,''),'"'),
	CONCAT(',"123.15":"', COALESCE(tbl_component_y,''),'"'),
	CONCAT(',"123.16":"', COALESCE(tbl_component_height,''),'"'),				
	CONCAT(',"123.17":"', COALESCE(tbl_component_width,''),'"'),
    CONCAT(',"114.141":"', COALESCE(tbl_component_interval,''),'"'),
	CONCAT(',"PC":[',dbitems.GetPlaylistProductByComponent(tbl_component_id),']'),
	CONCAT(',"IC":[',dbitems.GetPlaylistImageByComponent(tbl_component_id),']'),
	CONCAT(',"VC":[',dbitems.GetPlaylistVideoByComponent(tbl_component_id),']}')
	)
    from dbitems.tbl_package_layout_component 
	where tbl_layout_id  = LayoutId
	);
	
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetDeliveryByInvoiceFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetDeliveryByInvoiceFunction`(Invoice INT(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 



SELECT GROUP_CONCAT(           
					CONCAT('{"114.12":"', COALESCE((select B.tbl_address_first from dbuser.tbl_address as B where A.tbl_invoice_id = Invoice and A.tbl_address_id = B.tbl_address_id),''),'"'),
					CONCAT(',"122.133":"', COALESCE(B.tbl_delivery_company_option,''),'"'),
					CONCAT(',"122.161":"',COALESCE(A.tbl_deliverycompany_price,0.0),'"') ,
					CONCAT(',"121.27":"', COALESCE(D.tbl_shippingstatus_name,''),'"'),
					CONCAT(',"122.188":""'),
					CONCAT(',"121.140":""}')
					)
					
from tbl_invoiceshippingaddress as A, 
dbuser.tbl_user_delivery_options AS B,
tbl_shippingstatus as D
where A.tbl_invoice_id = Invoice
and A.tbl_deliverycompany_id = B.tbl_delivery_id


and A.tbl_shipping_status = D.tbl_shippingstatus_id 
);

IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getHelpTicketLastDate` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getHelpTicketLastDate`(HelpTicketId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT COALESCE(tbl_help_ticket_date,'')
from tbl_help_ticket
where tbl_parent_id = HelpTicketId
order by id desc
limit 1
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetInventoryFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetInventoryFunction`(AtributeId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 



SELECT GROUP_CONCAT(           
					CONCAT('{"122.110":"', I.tbl_inventoryId,'"'),			
					CONCAT(',"114.132":"', I.tbl_inventory_quantity,'"}'))			
				
from tbl_inventoryproductattribute PIA, tbl_inventory I
where PIA.tbl_inventoryproductattribute_inventoryId = I.tbl_inventoryId
AND   PIA.tbl_inventoryproductattribute_productAttributeId=AtributeId);



IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetLastActivityByCard` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetLastActivityByCard`(carduserId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE USERTYPE_AUX INT(11) DEFAULT 0;
DECLARE CARD_TOCKEN VARCHAR(45) DEFAULT NULL;
DECLARE LAST_ACTIVITY VARCHAR(45) DEFAULT NULL;

SET  group_concat_max_len = 10000000;


set USERTYPE_AUX = (select substring(B.tbl_user_entity,1,1) from dbcards.tbl_carduser as A, dbuser.tbl_user as B where A.tbl_carduser_id = carduserId and A.tbl_user_nmcId = B.tbl_user_id);
set CARD_TOCKEN = (select tbl_card_tocken from tbl_carduser where tbl_carduser_id = carduserId);

	if USERTYPE_AUX = 1 then
			
			set LAST_ACTIVITY = (select tbl_transaction_creationDate from dbtransaction.tbl_transaction where tbl_transaction_cardTocken = CARD_TOCKEN order by tbl_transaction_id desc limit 1);

			SET JSON = (select CONCAT('"',COALESCE(LAST_ACTIVITY,''),'"')

						);
	 else
			
			set LAST_ACTIVITY = (select tbl_billtransaction_date from dbtransaction.tbl_billtransaction where tbl_cardTocken = CARD_TOCKEN order by tbl_billtransaction_id desc limit 1);
			
			SET JSON = (select CONCAT('"',COALESCE(LAST_ACTIVITY,''),'"')

						);
	end if;

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getMailRecordByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getMailRecordByUser`(mailCampaignId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 
		
        CONCAT('{"117.11":"',COALESCE(B.id,''),'"'),
		CONCAT(',"114.7":"',COALESCE(B.email,''),'"'),
        CONCAT(',"120.14":"',COALESCE(B.state,''),'"'),
        CONCAT(',"121.140":"',COALESCE(B.date_state,''),'"}'))    

		from dbuser.tbl_mailcampaign as A, 
        dbuser.tbl_mailrecord as B, 
        tbl_campaign_record as C
        
		where A.id = mailCampaignId
        and A.id = C.idcampaign
        and B.id = C.idrecord

);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetMainUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetMainUser`(UserId int) RETURNS varchar(20) CHARSET utf8
BEGIN
DECLARE ENTITY_ID VARCHAR(2) DEFAULT NULL;
DECLARE CLASS_ID VARCHAR(3) DEFAULT NULL;
DECLARE CLASS_LEVEL VARCHAR(1) DEFAULT NULL;
DECLARE PARENT_ID INT DEFAULT NULL;

SET  group_concat_max_len = 10000000;

SET ENTITY_ID = (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =UserId );
SET CLASS_ID =  (SELECT tbl_user_class FROM dbuser.tbl_user WHERE tbl_user_id =UserId );
SET CLASS_LEVEL  = (select substring(CLASS_ID,3,1));

IF (CLASS_LEVEL = 0) THEN
   RETURN (SELECT dbuser.getNMCID(UserId));
ELSE 
    SET PARENT_ID = (SELECT tbl_user_parentId From dbuser.tbl_user WHERE tbl_user_id=UserId);
	IF (CLASS_LEVEL = 1) THEN
		RETURN (SELECT dbuser.getNMCID(PARENT_ID));
	ELSE 
		RETURN (SELECT dbuser.getNMCID((SELECT tbl_user_parentId From dbuser.tbl_user WHERE tbl_user_id=PARENT_ID)));
	END IF;
END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getMaxDate` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getMaxDate`(DATE1 DATETIME,DATE2 DATETIME) RETURNS datetime
BEGIN
DECLARE DATE_RETURN DATETIME;
IF ISNULL(DATE2) THEN
 SET DATE_RETURN = DATE1;
ELSE
 IF DATE1>DATE2 THEN
   SET DATE_RETURN = DATE1;
 ELSE
   SET DATE_RETURN = DATE2;
 END IF;
END IF;
RETURN DATE_RETURN;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAddress` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAddress`(addressId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 


SELECT  GROUP_CONCAT(

	   CONCAT('"114.115":"',COALESCE(A.tbl_address_id,''),'"') , 
	   CONCAT(',"53":"',COALESCE(dbuser.GetNMCID((select right(A.tbl_address_nmcId,11))),''),'"'),
       CONCAT(',"121.45":"',COALESCE(A.tbl_addresstype_id,''),'"') ,
	   CONCAT(',"114.53":"',COALESCE(A.tbl_address_name,''),'"') ,
	   CONCAT(',"114.9":"',COALESCE(A.tbl_address_flag,0),'"') ,
	   CONCAT(',"120.39":"',COALESCE(A.tbl_address_longitude,''),'"'),
	   CONCAT(',"120.38":"',COALESCE(A.tbl_address_latitude,''),'"'),
	   CONCAT(',"CI":{',dbuser.getNMCCity(A.tbl_city_id),'}')  ,
	   CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_country_id),'}') ,
	   CONCAT(',"ST":{',dbuser.getNMCStates(A.tbl_state_id),'}')  ,
	   CONCAT(',"ZP":{',dbuser.getNMCZipCode(A.tbl_zipcode_id),'}')  ,
	   -- CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(A.tbl_address_phoneNumber),'}')  ,
	   CONCAT(',"114.12":"',COALESCE(A.tbl_address_first,''),'"') ,
	   CONCAT(',"114.13":"',COALESCE(A.tbl_address_second,''),'"'))
			
		from tbl_address AS A
		where A.tbl_address_id = addressId
);


	
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAddressByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAddressByUser`(userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT 

GROUP_CONCAT(distinct

	   CONCAT('{"114.115":"',COALESCE(A.tbl_address_id,''),'"') , 
	   CONCAT(',"53":"',COALESCE(dbuser.GetNMCID((select right(A.tbl_address_nmcId,11))),''),'"'),
	   CONCAT(',"114.53":"',COALESCE(A.tbl_address_name,''),'"') , 
       CONCAT(',"121.45":"',COALESCE(A.tbl_addresstype_id,''),'"') ,
	   CONCAT(',"CI":{',dbuser.getNMCCity(A.tbl_city_id),'}')  ,
	   CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_country_id),'}') ,
	   CONCAT(',"ST":{',dbuser.getNMCStates(A.tbl_state_id),'}')  ,
	   CONCAT(',"ZP":{',dbuser.getNMCZipCode(A.tbl_zipcode_id),'}')  ,
	   CONCAT(',"114.9":"',COALESCE(tbl_address_flag,0),'"') ,
       CONCAT(',"120.8":"',COALESCE(if(A.tbl_address_primary_f=1,'true','false'),''),'"'),
       CONCAT(',"114.18":"',COALESCE(tbl_address_phoneNumber,''),'"') ,
	   CONCAT(',"120.39":"',COALESCE(A.tbl_address_longitude,''),'"'),
	   CONCAT(',"120.38":"',COALESCE(A.tbl_address_latitude,''),'"'),
	   CONCAT(',"120.27":"',COALESCE(tbl_address_pushedpreference,0),'"') ,
	   CONCAT(',"114.12":"',COALESCE(A.tbl_address_first,''),'"'),
	   CONCAT(',"114.13":"',COALESCE(A.tbl_address_second,''),'"}'))


			
		from tbl_address AS A
		where A.tbl_address_nmcId = userId
		and A.tbl_address_active = 1
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertiser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertiser`(AdvertiserId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE ENTITY_AUX INTEGER(11) default  0;
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
 
SET ENTITY_AUX = (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id = AdvertiserId);



IF (select LEFT(ENTITY_AUX,1)) = '8' then


		SET JSON = ( 

		SELECT GROUP_CONCAT(
 
				CONCAT('"53":"',COALESCE(dbuser.GetNMCID((select right(tbl_usernmcid,11))),''),'"'),
				CONCAT(',"114.70":"',COALESCE((SELECT tbl_user_companyName FROM dbuser.tbl_user where tbl_user_id = AdvertiserId LIMIT 1),''),'"'),
				CONCAT(',"114.53":"',COALESCE(tbl_advertiser_contactname,''),'"'),
				CONCAT(',"114.7":"',COALESCE((SELECT tbl_user_email FROM dbuser.tbl_user where tbl_user_id = AdvertiserId LIMIT 1),''),'"'),
				CONCAT(',"121.77":"',COALESCE(tbl_advertiser_logo,''),'"'),
				CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(tbl_usernmcid),''),']') )
			   from  dbuser.tbl_advertiser
					
				where tbl_usernmcid  = AdvertiserId
				);
ELSE
		SET JSON = '';



END IF;


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingById`(AdvertisingId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		SET JSON = ( 

		SELECT GROUP_CONCAT(
  
				CONCAT('{"121.18":"',W.advertising_id,'"'),
				CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(W.usernmcid),''),'"'),
				CONCAT(',"127.10":"',COALESCE(W.ownerid,''),'"'),
				CONCAT(',"120.83":"',COALESCE(W.title,''),'"') ,
				CONCAT(',"120.157":"',COALESCE(hex(W.description),''),'"') ,
				CONCAT(',"114.143":"',COALESCE(W.status,''),'"') ,
				CONCAT(',"121.170":"',COALESCE(W.image,''),'"') ,
				CONCAT(',"121.15":"',COALESCE(W.file_originalname,''),'"') ,
				CONCAT(',"47.42":"',COALESCE(W.file_thumbnail,''),'"') ,
				CONCAT(',"114.144":"',COALESCE(W.productid,''),'"') ,
				CONCAT(',"114.112":"',COALESCE(W.producttype,''),'"') ,
				CONCAT(',"114.104":"',COALESCE(W.qrcode,''),'"') ,
				CONCAT(',"114.98":"',COALESCE(W.regularprice,0.0),'"') ,
				CONCAT(',"122.158":"',COALESCE(W.saleprice,0.0),'"}'))
			   from

				  (select A.advertising_id, A.usernmcid, A.ownerid, A.title, A.description, A.status, A.image, A.file_originalname, A.file_thumbnail, A.productid, A.producttype, A.qrcode, A.regularprice, A.saleprice
				   from vw_advertising as A
				   where A.advertising_id = AdvertisingId
				   ) as W
				);

	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingByPackage` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingByPackage`(PackageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		SET JSON = ( 

		SELECT GROUP_CONCAT(
 
				CONCAT('{"121.18":"',A.tbl_advertising_id,'"'),
				CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(A.tbl_advertising_usernmcid),''),'"'),
				CONCAT(',"127.10":"',COALESCE(A.tbl_advertising_ownerid,''),'"'),
				CONCAT(',"127.102":"',COALESCE(A.tbl_advertising_advertiserid,''),'"'),				
				CONCAT(',"120.83":"',COALESCE(A.tbl_advertising_title,''),'"') ,
				CONCAT(',"120.157":"',COALESCE(hex(A.tbl_advertising_description),''),'"'),
				CONCAT(',"121.170":"',COALESCE(B.tbl_advertisingimage_name ,''),'"') ,
				CONCAT(',"121.15":"',COALESCE(C.tbl_file_originalname,''),'"') ,
				CONCAT(',"47.42":"',COALESCE(C.tbl_file_thumbnail,''),'"') ,
				CONCAT(',"114.143":"',COALESCE(A.tbl_advertising_status,''),'"'),
				CONCAT(',"127.54":"',COALESCE(LPAD(A.tbl_advertising_order,11,0),''),'"}'))
 
			   from tbl_advertising as A 
					left join tbl_advertisingimage as B on A.tbl_advertisingimage_id = B.tbl_advertisingimage_id 
					left join tbl_file as C on A.tbl_file_id = C.tbl_file_id
					left join tbl_packageadvertising as D on A.tbl_advertising_id = D.tbl_advertising_id

					where D.tbl_package_id  = PackageId
				);
	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingByShuffle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingByShuffle`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

		SET JSON = ( 

		SELECT GROUP_CONCAT(
  
				CONCAT('{"121.18":"',W.advertising_id,'"'),
				CONCAT(',"127.107":"',COALESCE(ShuffleId,''),'"'),
				CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(W.usernmcid),''),'"'),
				CONCAT(',"127.10":"',COALESCE(W.ownerid,''),'"'),
				CONCAT(',"120.83":"',COALESCE(hex(W.title),''),'"') ,
				CONCAT(',"120.157":"',COALESCE(hex(W.description),''),'"') ,
				CONCAT(',"114.143":"',COALESCE(W.status,''),'"') ,
				CONCAT(',"121.170":"',COALESCE(W.image,''),'"') ,
				CONCAT(',"121.15":"',COALESCE(W.file_originalname,''),'"') ,
				CONCAT(',"47.42":"',COALESCE(W.file_thumbnail,''),'"') ,
				CONCAT(',"114.144":"',COALESCE(W.productid,''),'"') ,
				CONCAT(',"114.112":"',COALESCE(W.producttype,''),'"') ,
				CONCAT(',"114.104":"',COALESCE(W.qrcode,''),'"') ,
				CONCAT(',"114.98":"',COALESCE(W.regularprice,0.0),'"') ,
				CONCAT(',"122.158":"',COALESCE(W.saleprice,0.0),'"') ,
				CONCAT(',"127.106":"',COALESCE(W.tbl_sequence,0),'"') ,
				CONCAT(dbitems.getNMCScheduleshuffle(ShuffleId)),
				CONCAT(',"127.108":"',COALESCE(W.tbl_advertising_banner_type_id,68001),'"') ,
				CONCAT(',"127.109":"',COALESCE(W.tbl_advertising_time,10),'"') ,
				CONCAT(',"127.110":"',COALESCE(hex(W.tbl_banner_text),''),'"') ,
				CONCAT(',"127.111":"',COALESCE(hex(W.tbl_advertising_pitch),''),'"') ,
				CONCAT(',"121.140":"',COALESCE(W.datemodified,W.tbl_advertising_lastModified,''),'"') ,
				CONCAT(',"127.54":"',COALESCE(LPAD(W.tbl_order,11,0),''),'"}'))

			   from

				  (select A.advertising_id, 
						A.usernmcid, 
						A.ownerid, 
						A.title, 
						A.description, 
						A.status, 
						A.image, 
						A.file_originalname, 
						A.file_thumbnail, 
						A.productid, 
						A.producttype, 
						A.qrcode, 
						A.regularprice, 
						A.saleprice, 
                        A.datemodified,
						B.tbl_order,
						B.tbl_sequence,
						B.tbl_advertising_banner_type_id,
						B.tbl_advertising_time,
						B.tbl_banner_text,
						B.tbl_advertising_pitch,
						(select C.tbl_advertising_lastModified from tbl_advertising_republished as C where C.tbl_shuffle_id = ShuffleId limit 1) as tbl_advertising_lastModified
				   from vw_advertising as A
				   left join tbl_shuffle_advertising as B on A.advertising_id = B.tbl_advertising_id
				   where B.tbl_shuffle_id = ShuffleId
				   order by B.tbl_order asc) as W
				);




IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingByShufflePortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingByShufflePortal`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

		SET JSON = ( 

		SELECT GROUP_CONCAT(
  
				CONCAT('{"121.18":"',W.advertising_id,'"'),
				CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(W.usernmcid),''),'"'),
				CONCAT(',"127.10":"',COALESCE(W.ownerid,''),'"'),
				CONCAT(',"120.83":"',COALESCE(hex(W.title),''),'"') ,
				CONCAT(',"120.157":"',COALESCE(hex(W.description),''),'"') ,
				CONCAT(',"114.143":"',COALESCE((SELECT tbl_productstatus_id FROM dbitems.tbl_product where tbl_product.tbl_product_id = W.productid),''),'"') ,
				CONCAT(',"127.113":"',COALESCE(W.status,''),'"') ,
				CONCAT(',"121.170":"',COALESCE(W.image,W.file_thumbnail,''),'"') ,
				CONCAT(',"121.15":"',COALESCE(W.file_originalname,''),'"') ,
				CONCAT(',"47.42":"',COALESCE(W.file_thumbnail,''),'"') ,
				CONCAT(',"114.144":"',COALESCE(W.productid,''),'"') ,
				CONCAT(',"114.112":"',COALESCE(W.producttype,''),'"') ,
				CONCAT(',"114.104":"',COALESCE(W.qrcode,''),'"') ,
                CONCAT(',"122.131":"',COALESCE(W.model,''),'"') ,
                CONCAT(',"121.102":"',COALESCE(W.sku,''),'"') ,
                CONCAT(',"120.31":"',COALESCE(W.dateCreate,''),'"') ,
				CONCAT(',"114.98":"',COALESCE(W.regularprice,0.0),'"') ,
				CONCAT(',"122.158":"',COALESCE(W.saleprice,0.0),'"') ,
                CONCAT(',"114.9":"',COALESCE(ValidateNMCProductSchedule(W.productid),''),'"') ,
				CONCAT(',"IR":[',COALESCE(dbitems.getNMCAdvertisingItemRecommended(W.advertising_id),''),']') ,
                CONCAT(',"CA":{',dbitems.getNMCCategory(W.tbl_category_id),'}'),
                CONCAT(dbitems.getNMCScheduleProduct(W.productid)),
                CONCAT(',"127.106":"',COALESCE(W.tbl_sequence,0),'"') ,
				CONCAT(',"127.108":"',COALESCE(W.tbl_advertising_banner_type_id,68001),'"') ,
				CONCAT(',"127.109":"',COALESCE(W.tbl_advertising_time,10),'"') ,
				CONCAT(',"127.110":"',COALESCE(hex(W.tbl_banner_text),''),'"') ,
				CONCAT(',"127.111":"',COALESCE(hex(W.tbl_advertising_pitch),''),'"') ,
				CONCAT(',"127.54":"',COALESCE(LPAD(W.tbl_order,11,0),''),'"'),
				CONCAT(',"114.121":"',COALESCE(W.tbl_likes,'0'),'"'),
				CONCAT(',"114.132":"',COALESCE(W.tbl_dislikes,'0'),'"}'))
			   
               from

				  (select A.advertising_id, A.usernmcid, A.ownerid, A.title, A.description, A.status, A.image, A.file_originalname, A.file_thumbnail, 
                   A.productid, A.producttype, A.qrcode,  A.model, A.sku, A.dateCreate, A.regularprice, A.saleprice, D.tbl_category_id,
                   B.tbl_order,B.tbl_sequence,B.tbl_advertising_banner_type_id,B.tbl_advertising_time,B.tbl_banner_text,B.tbl_advertising_pitch,
				   C.tbl_likes, C.tbl_dislikes 
				   from vw_advertising_portal as A
				   left join tbl_shuffle_advertising as B on A.advertising_id = B.tbl_advertising_id
				   left join vw_advertising_favorite as C on A.advertising_id = C.tbl_advertising_id
                   left join tbl_productcategory as D on D.tbl_product_id = A.productid 
				   where B.tbl_shuffle_id = ShuffleId
				   order by B.tbl_order asc) as W
				);

	

 
IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingByShufflePortal2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingByShufflePortal2`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		SET JSON = ( 

		SELECT GROUP_CONCAT(
  
				CONCAT('"121.18":"',W.advertising_id,'"'),
				CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(W.usernmcid),''),'"'),
				CONCAT(',"127.10":"',COALESCE(W.ownerid,''),'"'),
				CONCAT(',"120.83":"',COALESCE(hex(W.title),''),'"') ,
				CONCAT(',"120.157":"',COALESCE(hex(W.description),''),'"') ,
				CONCAT(',"114.143":"',COALESCE((SELECT tbl_productstatus_id FROM dbitems.tbl_product where tbl_product.tbl_product_id = W.productid),''),'"') ,
				CONCAT(',"127.113":"',COALESCE(W.status,''),'"') ,
				CONCAT(',"121.170":"',COALESCE(W.image,W.file_thumbnail,''),'"') ,
				CONCAT(',"121.15":"',COALESCE(W.file_originalname,''),'"') ,
				CONCAT(',"47.42":"',COALESCE(W.file_thumbnail,''),'"') ,
				CONCAT(',"114.144":"',COALESCE(W.productid,''),'"') ,
				CONCAT(',"114.112":"',COALESCE(W.producttype,''),'"') ,
				CONCAT(',"114.104":"',COALESCE(W.qrcode,''),'"') ,
				CONCAT(',"114.98":"',COALESCE(W.regularprice,0.0),'"') ,
				CONCAT(',"122.158":"',COALESCE(W.saleprice,0.0),'"') ,
				CONCAT(',"127.106":"',COALESCE(W.tbl_sequence,0),'"') ,
				CONCAT(',"127.108":"',COALESCE(W.tbl_advertising_banner_type_id,68001),'"') ,
				CONCAT(',"127.109":"',COALESCE(W.tbl_advertising_time,10),'"') ,
				CONCAT(',"127.110":"',COALESCE(hex(W.tbl_banner_text),''),'"') ,
				CONCAT(',"127.111":"',COALESCE(hex(W.tbl_advertising_pitch),''),'"') ,
				CONCAT(',"127.54":"',COALESCE(LPAD(W.tbl_order,11,0),''),'"'),
				CONCAT(',"114.121":"',COALESCE(W.tbl_likes,'0'),'"'),
				CONCAT(',"114.132":"',COALESCE(W.tbl_dislikes,'0'),'"'))
			   from

				  (select A.advertising_id, A.usernmcid, A.ownerid, A.title, A.description, A.status, A.image, A.file_originalname, A.file_thumbnail, A.productid, A.producttype, A.qrcode, A.regularprice, A.saleprice, B.tbl_order,B.tbl_sequence,B.tbl_advertising_banner_type_id,B.tbl_advertising_time,B.tbl_banner_text,B.tbl_advertising_pitch,
				   C.tbl_likes, C.tbl_dislikes
				   from vw_advertising_portal as A
				   left join tbl_shuffle_advertising as B on A.advertising_id = B.tbl_advertising_id
				   left join vw_advertising_favorite as C on A.advertising_id = C.tbl_advertising_id
				   where B.tbl_shuffle_id = ShuffleId
				   order by B.tbl_order asc) as W
				);

	

 
IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingByShufflePortrait` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingByShufflePortrait`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

		SET JSON = ( 

		SELECT GROUP_CONCAT(
  
				CONCAT('{"121.18":"',W.advertising_id,'"'),
				CONCAT(',"127.107":"',COALESCE(ShuffleId,''),'"'),
				CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(W.usernmcid),''),'"'),
				CONCAT(',"127.10":"',COALESCE(W.ownerid,''),'"'),
				CONCAT(',"120.83":"',COALESCE(hex(W.title),''),'"') ,
				CONCAT(',"120.157":"',COALESCE(hex(W.description),''),'"') ,
				CONCAT(',"114.143":"',COALESCE(W.status,''),'"') ,
				CONCAT(',"121.170":"',COALESCE(W.image,''),'"') ,
				CONCAT(',"121.15":"',COALESCE(W.file_originalname,''),'"') ,
				CONCAT(',"47.42":"',COALESCE(W.file_thumbnail,''),'"') ,
				CONCAT(',"114.144":"',COALESCE(W.productid,''),'"') ,
				CONCAT(',"114.112":"',COALESCE(W.producttype,''),'"') ,
				CONCAT(',"114.104":"',COALESCE(W.qrcode,''),'"') ,
				CONCAT(',"114.98":"',COALESCE(W.regularprice,0.0),'"') ,
				CONCAT(',"122.158":"',COALESCE(W.saleprice,0.0),'"') ,
				CONCAT(',"127.106":"',COALESCE(W.tbl_sequence,0),'"') ,
				CONCAT(dbitems.getNMCScheduleshuffle(ShuffleId)),
				CONCAT(',"127.108":"',COALESCE(W.tbl_advertising_banner_type_id,68001),'"') ,
				CONCAT(',"127.109":"',COALESCE(W.tbl_advertising_time,10),'"') ,
				CONCAT(',"127.110":"',COALESCE(hex(W.tbl_banner_text),''),'"') ,
				CONCAT(',"127.111":"',COALESCE(hex(W.tbl_advertising_pitch),''),'"') ,
				CONCAT(',"121.140":"',COALESCE(W.datemodified,W.tbl_advertising_lastModified,''),'"') ,
				CONCAT(',"127.54":"',COALESCE(LPAD(W.tbl_order,11,0),''),'"}'))

			   from

				  (select A.advertising_id, 
						A.usernmcid, 
						A.ownerid, 
						A.title, 
						A.description, 
						A.status, 
						A.image, 
						A.file_originalname, 
						A.file_thumbnail, 
						A.productid, 
						A.producttype, 
						A.qrcode, 
						A.regularprice, 
						A.saleprice, 
                        A.datemodified,
						B.tbl_order,
						B.tbl_sequence,
						B.tbl_advertising_banner_type_id,
						B.tbl_advertising_time,
						B.tbl_banner_text,
						B.tbl_advertising_pitch,
						(select C.tbl_advertising_lastModified from tbl_advertising_republished as C where C.tbl_shuffle_id = ShuffleId limit 1) as tbl_advertising_lastModified
				   from vw_advertising as A
				   left join tbl_shuffle_advertising as B on A.advertising_id = B.tbl_advertising_id
				   where B.tbl_shuffle_id = ShuffleId
                   and A.productid != 0
				   order by B.tbl_order asc) as W
				);




IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingDisikesByUserCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingDisikesByUserCount`(advertiserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;
SET  group_concat_max_len = 10000000;
		SET JSON = ( 
					
				(select count(tbl_advertisingfavorite_id) 
					from dbitems.tbl_advertisingfavorite_user 
						
					where 
						
					tbl_advertising_id = advertiserId
					and  tbl_advertisingfavorite_like = 0
					)
			
				);
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingItemList` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingItemList`(mainuserId varchar(20)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
				CONCAT('{"114.144":"',COALESCE(A.tbl_product_id,''),'"'),
				CONCAT(',"114.112":"',COALESCE(A.tbl_producttype_id,''),'"'),
				CONCAT(',"53":"',COALESCE(A.tbl_product_usernmcid,''),'"'),
				CONCAT(',"114.143":"',COALESCE(A.tbl_productstatus_id,''),'"'),
				CONCAT(',"121.170":"',COALESCE(A.tbl_product_image,''),'"'),
				CONCAT(',"114.104":"',COALESCE(A.tbl_product_qrCode,''),'"'),
				CONCAT(',"120.83":"',COALESCE(A.tbl_product_name,''),'"'),
				CONCAT(',"120.157":"',COALESCE(hex(A.tbl_product_description),''),'"'),
				CONCAT(',"114.98":"',COALESCE(A.tbl_product_regularprice,0.0),'"'),
				CONCAT(',"122.158":"',COALESCE(A.tbl_product_saleprice,0.0),'"}')				
	  )
		from vw_product_by_merchant as A,	
		tbl_advertisingmerchantitems as B 
		where B.tbl_advertising_usernmcid = mainuserId
		and A.tbl_productstatus_id = 1001
		and A.tbl_main_user_id = B.tbl_advertising_usernmcid
		and A.tbl_product_id = B.tbl_advertising_product_id  
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingItemRecommended` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingItemRecommended`(advertisingId int(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
				CONCAT('{"114.144":"',COALESCE(A.tbl_product_id,''),'"'),
                CONCAT(',"120.83":"',COALESCE(A.tbl_product_name,''),'"'),
				CONCAT(',"120.157":"',COALESCE(hex(A.tbl_product_description),''),'"'),
				CONCAT(',"114.112":"',COALESCE(A.tbl_producttype_id,''),'"'),
				CONCAT(',"IM":[',COALESCE(dbitems.getNMCImage(A.tbl_product_id,99),''),']'),
				CONCAT(',"114.104":"',COALESCE(A.tbl_product_qrCode,''),'"'),
				CONCAT(',"114.98":"',COALESCE(A.tbl_product_regularprice,0.0),'"'),
				CONCAT(',"122.158":"',COALESCE(A.tbl_product_saleprice,0.0),'"}')				
	  )
		from vw_product_by_merchant as A,	
		tbl_advertisingrecommended as B 
		where B.tbl_advertising_id = advertisingId
		and A.tbl_productstatus_id = 1001
		and A.tbl_product_id = B.tbl_product_id  
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAdvertisingLikesByUserCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAdvertisingLikesByUserCount`(advertiserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;
SET  group_concat_max_len = 10000000;
		SET JSON = ( 
					
				(select count(tbl_advertisingfavorite_id) 
					from dbitems.tbl_advertisingfavorite_user 
						
					where 
						
					tbl_advertising_id = advertiserId
					and  tbl_advertisingfavorite_like = 1
					)
			
				);
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAssignedUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAssignedUser`(userId int) RETURNS text CHARSET utf8
BEGIN

DECLARE USER_CLASS VARCHAR(3) DEFAULT NULL;
DECLARE JSON MEDIUMTEXT;



SET  group_concat_max_len = 10000000;

SET USER_CLASS = (select tbl_user_class from tbl_user where tbl_user_id = userId);

case USER_CLASS  
    
when '2C0' then

	SET JSON = ( 
		SELECT GROUP_CONCAT( 
		CONCAT('"53":"',COALESCE(dbuser.GetNMCID(A.tbl_user_id),''),'"'),
		CONCAT(',"55":"',COALESCE(A.tbl_user_entity,''),'"'),
		CONCAT(',"114.9":"',COALESCE(A.tbl_user_userTemp_f,''),'"'),
		CONCAT(',"114.70":"',COALESCE(hex(A.tbl_user_companyName),''),'"'),
		CONCAT(',"114.91":"',COALESCE(A.tbl_user_title,''),'"'),
		CONCAT(',"114.3":"',COALESCE(A.tbl_user_first,''),'"'),
		CONCAT(',"114.5":"',COALESCE(A.tbl_user_last,''),'"'),
		CONCAT(',"114.7":"',COALESCE(A.tbl_user_email,''),'"'),
		CONCAT(',"127.10":"',COALESCE(A.tbl_owner_id,''),'"'),
		CONCAT(',"122.92":"',COALESCE(A.tbl_user_department,''),'"'),
        CONCAT(',"123.32":"',COALESCE(getNMCUserName(B.tbl_user_reseller_id),''),'"'),
        CONCAT(',"123.33":""'),
		CONCAT(',"AD":',COALESCE(dbuser.getNMCMainAddressByUser(A.tbl_user_id),'{}'),''),
		CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']') )

		from tbl_user as A
        left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
        where A.tbl_user_id = userId
	);


when '2C1' then

	SET JSON = ( 
		SELECT GROUP_CONCAT( 
		CONCAT('"53":"',COALESCE(dbuser.GetNMCID(A.tbl_user_id),''),'"'),
		CONCAT(',"55":"',COALESCE(A.tbl_user_entity,''),'"'),
		CONCAT(',"114.9":"',COALESCE(A.tbl_user_userTemp_f,''),'"'),
		CONCAT(',"114.70":"',COALESCE(hex(A.tbl_user_companyName),''),'"'),
		CONCAT(',"114.91":"',COALESCE(A.tbl_user_title,''),'"'),
		CONCAT(',"114.3":"',COALESCE(A.tbl_user_first,''),'"'),
		CONCAT(',"114.5":"',COALESCE(A.tbl_user_last,''),'"'),
		CONCAT(',"114.7":"',COALESCE(A.tbl_user_email,''),'"'),
		CONCAT(',"127.10":"',COALESCE(A.tbl_owner_id,''),'"'),
		CONCAT(',"122.92":"',COALESCE(A.tbl_user_department,''),'"'),
        CONCAT(',"123.32":"',COALESCE(getNMCUserName(B.tbl_user_reseller_id),''),'"'),
        CONCAT(',"123.33":"',COALESCE(getNMCUserName(A.tbl_user_parentId),''),'"'),
		CONCAT(',"AD":',COALESCE(dbuser.getNMCMainAddressByUser(A.tbl_user_id),'{}'),''),
		CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']') )

		from tbl_user as A
        left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
        where A.tbl_user_id = userId
	);	
	

when '2A1' then

	SET JSON = ( 
		SELECT GROUP_CONCAT( 
		CONCAT('"53":"',COALESCE(dbuser.GetNMCID(A.tbl_user_id),''),'"'),
		CONCAT(',"55":"',COALESCE(A.tbl_user_entity,''),'"'),
		CONCAT(',"114.9":"',COALESCE(A.tbl_user_userTemp_f,''),'"'),
		CONCAT(',"114.70":"',COALESCE(hex(A.tbl_user_companyName),''),'"'),
		CONCAT(',"114.91":"',COALESCE(A.tbl_user_title,''),'"'),
		CONCAT(',"114.3":"',COALESCE(A.tbl_user_first,''),'"'),
		CONCAT(',"114.5":"',COALESCE(A.tbl_user_last,''),'"'),
		CONCAT(',"114.7":"',COALESCE(A.tbl_user_email,''),'"'),
		CONCAT(',"127.10":"',COALESCE(A.tbl_owner_id,''),'"'),
		CONCAT(',"122.92":"',COALESCE(A.tbl_user_department,''),'"'),
        CONCAT(',"123.32":""'),
        CONCAT(',"123.33":"',COALESCE(getNMCUserName(A.tbl_user_parentId),''),'"'),
		CONCAT(',"AD":',COALESCE(dbuser.getNMCMainAddressByUser(A.tbl_user_id),'{}'),''),
		CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']') )

		from tbl_user as A
        left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
        where A.tbl_user_id = userId
	);		
	
    
when '3A1' then

	SET JSON = ( 
		SELECT GROUP_CONCAT( 
		CONCAT('"53":"',COALESCE(dbuser.GetNMCID(A.tbl_user_id),''),'"'),
		CONCAT(',"55":"',COALESCE(A.tbl_user_entity,''),'"'),
		CONCAT(',"114.9":"',COALESCE(A.tbl_user_userTemp_f,''),'"'),
		CONCAT(',"114.70":"',COALESCE(hex(A.tbl_user_companyName),''),'"'),
		CONCAT(',"114.91":"',COALESCE(A.tbl_user_title,''),'"'),
		CONCAT(',"114.3":"',COALESCE(A.tbl_user_first,''),'"'),
		CONCAT(',"114.5":"',COALESCE(A.tbl_user_last,''),'"'),
		CONCAT(',"114.7":"',COALESCE(A.tbl_user_email,''),'"'),
		CONCAT(',"127.10":"',COALESCE(A.tbl_owner_id,''),'"'),
		CONCAT(',"122.92":"',COALESCE(A.tbl_user_department,''),'"'),
        CONCAT(',"123.32":""'),
        CONCAT(',"123.33":"',COALESCE(getNMCUserName(A.tbl_user_parentId),''),'"'),
		CONCAT(',"AD":',COALESCE(dbuser.getNMCMainAddressByUser(A.tbl_user_id),'{}'),''),
		CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']') )

		from tbl_user as A
        where A.tbl_user_id = userId
	);	
    
ELSE

	SET JSON = ( 
		SELECT GROUP_CONCAT( 
		CONCAT('"53":"',COALESCE(dbuser.GetNMCID(tbl_user_id),''),'"'),
		CONCAT(',"55":"',COALESCE(tbl_user_entity,''),'"'),
		CONCAT(',"114.9":"',COALESCE(tbl_user_userTemp_f,''),'"'),
		CONCAT(',"114.70":"',COALESCE(hex(tbl_user_companyName),''),'"'),
		CONCAT(',"114.91":"',COALESCE(tbl_user_title,''),'"'),
		CONCAT(',"114.3":"',COALESCE(tbl_user_first,''),'"'),
		CONCAT(',"114.5":"',COALESCE(tbl_user_last,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_user_email,''),'"'),
		CONCAT(',"127.10":"',COALESCE(tbl_owner_id,''),'"'),
		CONCAT(',"122.92":"',COALESCE(tbl_user_department,''),'"'),
        CONCAT(',"123.32":""'),
        CONCAT(',"123.33":""'),
		CONCAT(',"AD":',COALESCE(dbuser.getNMCMainAddressByUser(tbl_user_id),'{}'),''),
		CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(tbl_user_id),''),']') )

		from tbl_user
		where tbl_user_id = userId
	);

END CASE;

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCAssignedUserLeads` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCAssignedUserLeads`(userId int) RETURNS text CHARSET utf8
BEGIN

DECLARE USER_CLASS VARCHAR(3) DEFAULT NULL;
DECLARE JSON MEDIUMTEXT;



SET  group_concat_max_len = 10000000;


	SET JSON = ( 
		SELECT GROUP_CONCAT( 
		CONCAT('"53":"',COALESCE(dbuser.GetNMCID(A.tbl_user_id),''),'"'),
		CONCAT(',"55":"',COALESCE(A.tbl_user_entity,''),'"'),
		CONCAT(',"114.9":"',COALESCE(A.tbl_user_userTemp_f,''),'"'),
		CONCAT(',"114.70":"',COALESCE(hex(A.tbl_user_companyName),''),'"'),
		CONCAT(',"114.91":"',COALESCE(A.tbl_user_title,''),'"'),
		CONCAT(',"114.3":"',COALESCE(A.tbl_user_first,''),'"'),
		CONCAT(',"114.5":"',COALESCE(A.tbl_user_last,''),'"'),
		CONCAT(',"114.7":"',COALESCE(A.tbl_user_email,''),'"'),
		CONCAT(',"127.10":"',COALESCE(A.tbl_owner_id,''),'"'),
		CONCAT(',"122.92":"',COALESCE(A.tbl_user_department,''),'"'),
        CONCAT(',"123.32":"',COALESCE(A.tbl_user_first,' ', A.tbl_user_last),'"'),
        CONCAT(',"123.33":""'),
		CONCAT(',"AD":',COALESCE(dbuser.getNMCMainAddressByUser(A.tbl_user_id),'{}'),''),
		CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']') )

		from tbl_user as A
        where A.tbl_user_id = userId
	);




IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCatalogCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCatalogCategory`(catalogID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 
SELECT GROUP_CONCAT(
	   CONCAT('{"114.93":"',COALESCE(W.tbl_category_id,''),'"'), 
	   CONCAT(',"120.45":"',COALESCE(W.tbl_categorydescription_name,''),'"}'))
		from 
		(select A.tbl_category_id, A.tbl_categorydescription_name from 
		tbl_categorydescription as A, 
		tbl_productcategory as B, 
		tbl_catalogproduct as C 

		where C.tbl_catalog_id = catalogID
		AND C.tbl_product_id=B.tbl_product_id
		and B.tbl_category_id=A.tbl_category_id

		group by  A.tbl_categorydescription_name) as W
	   
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;
 
RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCardByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCardByUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 


SELECT GROUP_CONCAT(
		CONCAT('"122.34":"',COALESCE(W.tbl_carduser_id,''),'"'),
		CONCAT(',"120.7":"',COALESCE(W.tbl_cardstype_id,''),'"'),
        CONCAT(',"2":"',COALESCE(W.tbl_card_number,''),'"'),
        CONCAT(',"48.6":"',COALESCE(W.tbl_card_nickname,''),'"'),
        CONCAT(',"48.2":"',COALESCE(W.tbl_card_chardholderName,''),'"'),
		CONCAT(',"118.5":"',COALESCE(W.tbl_card_dateExpire,''),'"'),
        CONCAT(',"48.4":"',COALESCE(W.tbl_card_swift_iban_code,''),'"'),
		CONCAT(',"47.17":"',COALESCE(W.tbl_zipcode,''),'"')
		)

		
		from 
        (   
			select 
				A.tbl_carduser_id,
				B.tbl_cardstype_id,
				B.tbl_card_number,
				B.tbl_card_nickname,
				B.tbl_card_chardholderName,
				B.tbl_card_dateExpire,
                B.tbl_card_swift_iban_code,
                B.tbl_zipcode
			from tbl_carduser as A
            left join tbl_card as B on B.tbl_user_id = A.tbl_user_nmcId
			where A.tbl_user_nmcId = UserId
            and A.tbl_card_tocken = B.tbl_card_tocken
			limit 1) as W
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategory`(categoryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

       CONCAT('"114.93":"',COALESCE(C.tbl_category_id,''),'",'), 
       CONCAT('"120.45":"',COALESCE(D.tbl_categorydescription_name,''),'",'), 
       CONCAT('"120.44":"',COALESCE(C.tbl_category_level,''),'",'),
	   CONCAT('"122.21":"',COALESCE(C.tbl_category_parentid,''),'",'), 
	   CONCAT('"127.10":"',COALESCE(C.tbl_category_owner,''),'",'), 
       CONCAT('"122.183":"',COALESCE(C.tbl_category_active,''),'",'),
       CONCAT('"47.42":"',COALESCE(C.tbl_category_image,''),'"'))

	   from tbl_category C, tbl_categorydescription D
	   where C.tbl_category_id = D.tbl_category_id 
	 
	  
       and C.tbl_category_id = categoryId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryByModule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryByModule`(moduleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 
SELECT GROUP_CONCAT(
   CONCAT('{"114.93":"',COALESCE(B.tbl_category_id,''),'"'),
   CONCAT(',"120.45":"',COALESCE(if (E.tbl_categorydescription_name='root',C.tbl_categorydescription_name,CONCAT(E.tbl_categorydescription_name,' - ',C.tbl_categorydescription_name)),''),'"'),
   CONCAT(',"120.44":"', COALESCE(B.tbl_category_level,''),'"'), 
   CONCAT(',"122.21":"', COALESCE(B.tbl_category_parentId,''),'"}'))
   from dbitems.tbl_module_filter as A
   left join dbitems.tbl_category as B on A.tbl_module_filter_value1 = B.tbl_category_id
   left join dbitems.tbl_categorydescription as C on B.tbl_category_id = C.tbl_category_id
   
   left join dbitems.tbl_category as D on B.tbl_category_parentId = D.tbl_category_id 
   left join dbitems.tbl_categorydescription as E on D.tbl_category_id = E.tbl_category_id 
	
   where A.tbl_module_id = moduleId	  
   and A.tbl_filter_id = 2
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryByPackage` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryByPackage`(PackageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		SET JSON = ( 

		SELECT GROUP_CONCAT(

			   CONCAT('{"114.93":"',COALESCE(C.tbl_category_id,''),'",'), 
			   CONCAT('"120.45":"',COALESCE(D.tbl_categorydescription_name,''),'",'), 
			   CONCAT('"120.44":"',COALESCE(C.tbl_category_level,''),'",'),
			   CONCAT('"122.21":"',COALESCE(C.tbl_category_parentid,''),'",'), 
			   CONCAT('"127.10":"',COALESCE(C.tbl_category_owner,''),'",'), 
			   CONCAT('"122.183":"',COALESCE(C.tbl_category_active,''),'",'),
			   CONCAT('"47.42":"',COALESCE(C.tbl_category_image,''),'"}'))
 
			   from tbl_category C, tbl_categorydescription D, tbl_packagecategory as A
			   where C.tbl_category_id = D.tbl_category_id 
			   and C.tbl_category_active = 1 
			   and C.tbl_category_deleted = 0 
			   and C.tbl_category_id = A.tbl_category_id
			   and  A.tbl_package_id = PackageId);
	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryByshuffle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryByshuffle`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		SET JSON = ( 

		SELECT GROUP_CONCAT(

			   CONCAT('{"114.93":"',COALESCE(C.tbl_category_id,''),'",'), 
			   CONCAT('"120.45":"',COALESCE(D.tbl_categorydescription_name,''),'",'), 
			   CONCAT('"120.44":"',COALESCE(C.tbl_category_level,''),'",'),
			   CONCAT('"122.21":"',COALESCE(C.tbl_category_parentid,''),'",'), 
			   CONCAT('"127.10":"',COALESCE(C.tbl_category_owner,''),'",'), 
			   CONCAT('"122.183":"',COALESCE(C.tbl_category_active,''),'",'),
			   CONCAT('"47.42":"',COALESCE(C.tbl_category_image,''),'"}'))
 
			   from tbl_category C, tbl_categorydescription D, tbl_shufflecategory as A
			   where C.tbl_category_id = D.tbl_category_id 
			   and C.tbl_category_active = 1 
			   and C.tbl_category_deleted = 0 
			   and C.tbl_category_id = A.tbl_category_id
			   and  A.tbl_shuffle_id = shuffleId);
	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCCategoryGroupByCategoryId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCCategoryGroupByCategoryId`(categoryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE PARENTID INT; 
DECLARE CATEGORYGROUP INT DEFAULT 0;
DECLARE LVL INT; 
SET  group_concat_max_len = 10000000;



SET LVL = (select tbl_category_level from tbl_category where tbl_category_id = categoryId);
SET PARENTID = (select tbl_category_parentid from tbl_category where tbl_category_id = categoryId);

if lvl < 2 then

	set CATEGORYGROUP = NULL;
else

	IF  LVL = 2 THEN
		SET CATEGORYGROUP= (select tbl_category_id from tbl_category where tbl_category_id = categoryId);

	ELSE

		WHILE LVL >2 DO

			 
			SET CATEGORYGROUP= (select tbl_category_id from tbl_category where tbl_category_id = PARENTID);
			SET PARENTID = (select tbl_category_parentid from tbl_category where tbl_category_id = CATEGORYGROUP);
			SET LVL = (select tbl_category_level from tbl_category where tbl_category_id = CATEGORYGROUP);
		END WHILE;
	END IF;

end if;

SET JSON =CATEGORYGROUP;


IF JSON is NULL THEN
	SET JSON = "";
END IF;
 
RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryhasItem` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryhasItem`(CategoryId int,UserId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		If(select distinct E.tbl_category_id from 
								dbitems.vw_product_by_merchant as B,
								dbitems.tbl_productcategory as C, 
								dbitems.vw_categories_with_categgroup as D,
								dbitems.tbl_category as E

								where B.tbl_main_user_id = dbuser.GetMainUser(UserId)  
								AND B.tbl_product_id = C.tbl_product_id  
								and D.tbl_category_id = C.tbl_category_id
								and C.tbl_category_id=E.tbl_category_id 
								and D.category_group=CategoryId
							
								limit 1) is not null then

			SET JSON = 'true';
		else
			SET JSON = 'false';
			
		end if;
	



RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCCategoryTree` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCCategoryTree`(CategoryId int(11)) RETURNS text CHARSET utf8
BEGIN

	DECLARE JSON TEXT;

	set  group_concat_max_len = 10000000;

	set JSON = (

		CONCAT(CategoryId,',',COALESCE((		
			select 
			GROUP_CONCAT(
				CONCAT('',tbl_category_id,',',
				   if((select count(*) from tbl_category as A, tbl_category as B where A.tbl_category_parentid = B.tbl_category_id) > 0,COALESCE(getNMCCategoryTreeX1(tbl_category_id),''),'')
				)
			) 
			from tbl_category 
			where tbl_category_parentid = CategoryId

		),''))
	);


	set JSON = REPLACE(JSON,',,',',');
	SET JSON = (SELECT SUBSTR(JSON,1,LENGTH(JSON)-1));

	IF JSON is NULL THEN
		SET JSON = '';
	END IF;

	RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryTreeX1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryTreeX1`(CategoryId int(11)) RETURNS text CHARSET utf8
BEGIN



DECLARE JSON TEXT;


set  group_concat_max_len = 10000000;




	set JSON = (
		select 
		GROUP_CONCAT(
			CONCAT('',tbl_category_id,',',
			   if((select count(*) from tbl_category as A, tbl_category as B where A.tbl_category_parentid = B.tbl_category_id) > 0,COALESCE(getNMCCategoryTreeX2(tbl_category_id),''),'')
			)
		) 
		from tbl_category 
		where tbl_category_parentid = CategoryId
	);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryTreeX2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryTreeX2`(CategoryId int(11)) RETURNS text CHARSET utf8
BEGIN



DECLARE JSON TEXT;

set  group_concat_max_len = 10000000;



	set JSON = (
		select 
		GROUP_CONCAT(tbl_category_id)
		from tbl_category 
		where tbl_category_parentid = CategoryId
	);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET ENTITYAUX = (SELECT tbl_user_entity from dbuser.tbl_user where tbl_user_id=UserId  );


 case substring(ENTITYAUX,1,1)

	when 2 then

		SET JSON = ( 

		SELECT GROUP_CONCAT(

			   CONCAT('{"114.93":"',COALESCE(C.tbl_category_id,''),'",'), 
			   CONCAT('"120.45":"',COALESCE(D.tbl_categorydescription_name,''),'",'), 
			   CONCAT('"120.44":"',COALESCE(C.tbl_category_level,''),'",'),
			   CONCAT('"122.21":"',COALESCE(C.tbl_category_parentid,''),'",'), 
			   CONCAT('"127.10":"',COALESCE(C.tbl_category_owner,''),'",'), 
			   CONCAT('"122.183":"',COALESCE(C.tbl_category_active,''),'",'),
			  CONCAT('"127.86":"',dbitems.getNMCCategoryhasItem(C.tbl_category_id,UserId),'",'),
			   CONCAT('"47.42":"',COALESCE(C.tbl_category_image,''),'"}'))
 
			   from tbl_category C, tbl_categorydescription D, dbuser.tbl_merchantbusinesscategory as A
			   where C.tbl_category_id = D.tbl_category_id 
			   and C.tbl_category_active = 1 
			   and C.tbl_category_deleted = 0 
			   and C.tbl_category_id = A.tbl_businesscategory_id
			   and  A.tbl_merchant_nmcId = UserId);
	when 3 then
			SET JSON = ( 

		SELECT GROUP_CONCAT(

			   CONCAT('{"114.93":"',COALESCE(C.tbl_category_id,''),'",'), 
			   CONCAT('"120.45":"',COALESCE(D.tbl_categorydescription_name,''),'",'), 
			   CONCAT('"120.44":"',COALESCE(C.tbl_category_level,''),'",'),
			   CONCAT('"122.21":"',COALESCE(C.tbl_category_parentid,''),'",'), 
			   CONCAT('"127.10":"',COALESCE(C.tbl_category_owner,''),'",'), 
			   CONCAT('"122.183":"',COALESCE(C.tbl_category_active,''),'",'),
			   CONCAT('"47.42":"',COALESCE(C.tbl_category_image,''),'"}'))

			   from tbl_category C, tbl_categorydescription D, dbuser.tbl_resellerbusinesscategory as A
			   where C.tbl_category_id = D.tbl_category_id 
			   and C.tbl_category_active = 1 
			   and C.tbl_category_deleted = 0 
			   and C.tbl_category_id = A.tbl_businesscategory_id
			   and  A.tbl_reseller_nmcId = UserId);
	else 
			SET JSON = '';
	end case;


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCategoryUserMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCategoryUserMobile`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET ENTITYAUX = (SELECT tbl_user_entity from dbuser.tbl_user where tbl_user_id=UserId  );


 case substring(ENTITYAUX,1,1)

	when 2 then

		SET JSON = ( 

		SELECT GROUP_CONCAT(
 
			   CONCAT('{"114.93":"',COALESCE(C.tbl_category_id,''),'",'), 
			   CONCAT('"120.45":"',COALESCE(D.tbl_categorydescription_name,''),'",'), 
			   CONCAT('"120.44":"',COALESCE(C.tbl_category_level,''),'",'),
			   CONCAT('"122.21":"',COALESCE(C.tbl_category_parentid,''),'",'), 
			   CONCAT('"127.10":"',COALESCE(C.tbl_category_owner,''),'",'), 
			   CONCAT('"122.183":"',COALESCE(C.tbl_category_active,''),'",'),
			   CONCAT('"127.86":"','true','",'),
			   CONCAT('"47.42":"',COALESCE(C.tbl_category_image,''),'"}'))
 
			   from tbl_category C, tbl_categorydescription D, dbuser.tbl_merchantbusinesscategory as A
			   where C.tbl_category_id = D.tbl_category_id 
			   and C.tbl_category_active = 1 
			   and C.tbl_category_deleted = 0 
			   and C.tbl_category_id = A.tbl_businesscategory_id
			   and  A.tbl_merchant_nmcId = UserId);
	when 3 then
			SET JSON = ( 

		SELECT GROUP_CONCAT(

			   CONCAT('{"114.93":"',COALESCE(C.tbl_category_id,''),'",'), 
			   CONCAT('"120.45":"',COALESCE(D.tbl_categorydescription_name,''),'",'), 
			   CONCAT('"120.44":"',COALESCE(C.tbl_category_level,''),'",'),
			   CONCAT('"122.21":"',COALESCE(C.tbl_category_parentid,''),'",'), 
			   CONCAT('"127.10":"',COALESCE(C.tbl_category_owner,''),'",'), 
			   CONCAT('"122.183":"',COALESCE(C.tbl_category_active,''),'",'),
			   CONCAT('"47.42":"',COALESCE(C.tbl_category_image,''),'"}'))

			   from tbl_category C, tbl_categorydescription D, dbuser.tbl_resellerbusinesscategory as A
			   where C.tbl_category_id = D.tbl_category_id 
			   and C.tbl_category_active = 1 
			   and C.tbl_category_deleted = 0 
			   and C.tbl_category_id = A.tbl_businesscategory_id
			   and  A.tbl_reseller_nmcId = UserId);
	else 
			SET JSON = '';
	end case;


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCChoice` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCChoice`(OptionId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

 

SELECT GROUP_CONCAT(

	   CONCAT('{"121.179":"',COALESCE(B.tbl_productoption_id,''),'"'),
	   CONCAT(',"122.112":"',COALESCE(A.tbl_productoptionvalue_id,''),'"'),
	   CONCAT(',"127.16":"',COALESCE(A.tbl_productoptionvalue_name,''),'"'),	
	   CONCAT(',"120.84":"',COALESCE(B.tbl_productattribute_optionValuePrice,''),'"}'))



	   from tbl_productoptionvalue AS A, tbl_productattribute AS B
	   where A.tbl_productoptionvalue_id = B.tbl_productoptionvalue_id
	   and B.tbl_productoption_id=OptionId



);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCity` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCity`(cityId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('"114.14":"',COALESCE(tbl_city_id,''),'",'), 
       CONCAT('"47.15":"',COALESCE(tbl_city_name,''),'",'), 
       CONCAT('"120.13":"',COALESCE(tbl_state_id,''),'"'))
	 
	   from tbl_city 
	   where tbl_city_id = cityId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCityByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCityByUser`(userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE JSON2 MEDIUMTEXT;

SET  group_concat_max_len = 10000000;
SET JSON = ( 

select I.tbl_city_name 
from tbl_address AS H 
left join tbl_city as I on H.tbl_city_id = I.tbl_city_id 
where H.tbl_address_nmcId = userId 
and H.tbl_address_flag = 1
and H.tbl_address_active = 1
limit 1

);

SET JSON2 = ( 

select I.tbl_city_name 
from tbl_address AS H 
left join tbl_city as I on H.tbl_city_id = I.tbl_city_id 
where H.tbl_address_nmcId = userId 
limit 1

);



IF JSON2 is NULL THEN
	SET JSON2 = '';
END IF;


IF JSON is NULL THEN
	SET JSON = JSON2;
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCityList` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCityList`(stateId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"114.14":"',COALESCE(tbl_city_id,''),'",'), 
       CONCAT('"47.15":"',COALESCE(tbl_city_name,''),'",'), 
       CONCAT('"120.13":"',COALESCE(tbl_state_id,''),'"}'))
	 
	   from tbl_city 
	   where tbl_state_id = stateId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCCompanyId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCCompanyId`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;

SET JSON = (select tbl_company_id from tbl_user where tbl_user_id = UserId);

IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCCompanyName` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCCompanyName`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;

SET  group_concat_max_len = 10000000;

SET JSON = hex((SELECT tbl_user_companyName from dbuser.tbl_user where tbl_user_id = UserId));

IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCountry` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCountry`(countryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('"122.87":"',COALESCE(tbl_country_id,''),'",') , 
       CONCAT('"47.18":"',COALESCE(tbl_country_name,''),'",'),
	   CONCAT('"120.129":"',COALESCE(tbl_country_indicative,''),'",'),
       CONCAT('"114.17":"',COALESCE(tbl_country_code,''),'"'))

	   from tbl_country
	   where tbl_country_id = countryId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCountryByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCountryByUser`(userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE JSON2 MEDIUMTEXT;

SET  group_concat_max_len = 10000000;
SET JSON = ( 

select B.tbl_country_name 
from tbl_address AS A
left join tbl_country as B on A.tbl_country_id = B.tbl_country_id 
where A.tbl_address_nmcId = userId
and A.tbl_address_flag = 1
and A.tbl_address_active = 1
limit 1

);

SET JSON2 = ( 

select B.tbl_country_name 
from tbl_address AS A
left join tbl_country as B on A.tbl_country_id = B.tbl_country_id 
where A.tbl_address_nmcId = userId
limit 1

);

IF JSON2 is NULL THEN
	SET JSON2 = '';
END IF;


IF JSON is NULL THEN
	SET JSON = JSON2;
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCCountryList` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCCountryList`() RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"122.87":"',COALESCE(tbl_country_id,''),'"') , 
       CONCAT(',"47.18":"',COALESCE(tbl_country_name,''),'"'), 
       CONCAT(',"120.129":"',COALESCE(tbl_country_indicative,''),'"'),
       CONCAT(',"114.17":"',COALESCE(tbl_country_code,''),'"}'))

	   from tbl_country
	   
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCDelivery` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCDelivery`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(

	   CONCAT('{"122.109":"',COALESCE(A.tbl_delivery_id,''),'",'),  
       CONCAT('"122.133":"',COALESCE(A.tbl_delivery_company_option,''),'",') ,
	   CONCAT('"122.39":"',COALESCE(A.tbl_delivery_company_service,''),'",') ,
	   CONCAT('"120.157":"',COALESCE(A.tbl_user_delivery_options_tier,''),'",') ,
	   CONCAT('"123.60":"',COALESCE(A.tbl_delivery_company_tracking_code,''),'",') ,
	   CONCAT('"122.161":"',COALESCE(B.tbl_productdelivery_ajustedPrice,0.00),'"}') 
	   )
	  
		from dbuser.tbl_user_delivery_options AS A, tbl_productdelivery AS B
		where  A.tbl_delivery_id = B.tbl_deliverycompany_id
	    and B.tbl_product_id = productId
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCDesignatedLocationsByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCDesignatedLocationsByUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
 
	    CONCAT('{"114.47":"',COALESCE(A.tbl_location_id,''),'"}')
		)
		
		from dbuser.tbl_location_user as A
		left join dbuser.tbl_location as B on B.tbl_location_id = A.tbl_location_id
		
		where A.tbl_user_id = UserId 
        and B.tbl_location_statusId = 7001
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCEcomerce` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCEcomerce`(userId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 

		CONCAT('{"127.8":"',COALESCE(tbl_merchantwebsite_id,''),'"'),
		CONCAT(',"114.75":"',COALESCE(tbl_merchantwebsite_website,''),'"'),
		CONCAT(',"121.150":"',COALESCE(tbl_merchantwebsite_ecommerceProvider,''),'"'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneEcommerce(tbl_merchantwebsite_ecommercePhone),'}'),
		CONCAT(',"122.181":"',COALESCE(tbl_merchantwebsite_ecommerceName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_merchantwebsite_ecommerceMail,''),'"}'))
		FROM tbl_merchantwebsite
		WHERE tbl_merchant_nmcId = userId

);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCEmail` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCEmail`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;

SET  group_concat_max_len = 10000000;



SET JSON = (
SELECT tbl_user_email from dbuser.tbl_user where tbl_user_id = UserId);




IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCFilterByModule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCFilterByModule`(moduleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 
SELECT GROUP_CONCAT(
   CONCAT('{"123.47":"', COALESCE(A.tbl_module_filter_id,''),'"'),
   CONCAT(',"123.40":"', COALESCE(A.tbl_filter_id,''),'"'),
   CONCAT(',"123.41":"', COALESCE(B.tbl_filter_name,''),'"'), 
   CONCAT(',"123.42":"', COALESCE(A.tbl_subfilter_id,''),'"'), 
   CONCAT(',"123.44":"', COALESCE(C.tbl_subfilter_name,''),'"'), 
   CONCAT(',"123.45":"', COALESCE(A.tbl_module_filter_value1,''),'"'), 
   CONCAT(',"123.46":"', COALESCE(A.tbl_module_filter_value2,''),'"}'))
   
   from dbitems.tbl_module_filter as A
   left join dbitems.tbl_filter as B on A.tbl_filter_id = B.tbl_filter_id
   left join dbitems.tbl_filter_related as C on A.tbl_subfilter_id = C.tbl_subfilter_id
   
   where A.tbl_module_id = moduleId	   
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCFrecuencyByShuffle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCFrecuencyByShuffle`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

	SET JSON = ( 

		SELECT GROUP_CONCAT(
 
				CONCAT('{"NMC":"',COALESCE((select tbl_frecuency from tbl_advertising_frecuency where tbl_shuffle_id = ShuffleId and tbl_user_entity = 44 limit 1),'1'),'"'),
				CONCAT(',"OWN":"',COALESCE((select tbl_frecuency from tbl_advertising_frecuency where tbl_shuffle_id = ShuffleId and tbl_user_entity = 60 limit 1),'1'),'"'),
				CONCAT(',"MER":"',COALESCE((select tbl_frecuency from tbl_advertising_frecuency where tbl_shuffle_id = ShuffleId and tbl_user_entity = 20 limit 1),'1'),'"}')

				)
	);
	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCHardwarebyCart` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCHardwarebyCart`(HardwareCartId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE HARDWARE_QUANTITY INT ;
DECLARE TERMINAL_QUANTITY INT ;
SET  group_concat_max_len = 10000000;
SET JSON = ( 


SELECT GROUP_CONCAT(
 
	    CONCAT('"127.88":"',COALESCE(tbl_hardware_type_id,''),'"'),
		CONCAT(',"114.132":"',COALESCE(tbl_hardware_cart_quantity,''),'"')
		)

		from dbuser.tbl_hardware_cart 		
		where tbl_hardware_cart_id = HardwareCartId 

);

		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCHardwareByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCHardwareByUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE USER_ID VARCHAR(20);
SET  group_concat_max_len = 10000000;
set USER_ID = (if((select tbl_user_class from tbl_user where tbl_user_id = UserId) in ('2A0','2B0','2C0'),UserId,(select tbl_user_id from tbl_user where tbl_user_parentId = UserId)));
SET JSON = ( 

SELECT 

GROUP_CONCAT(

		CONCAT('{"127.88":"',A.tbl_hardware_type_id,'"') , 	   
		CONCAT(',"121.22":"',COALESCE(W.quantity,0),'"'),
        CONCAT(',"114.132":"',COALESCE(X.quantity_2,0),'"'),
        CONCAT(',"114.9":"',if(A.tbl_hardware_type_status_f = 1, 'true','false'),'"}'))

		from dbuser.tbl_hardware_type as A
        
        left join
        (select C.tbl_hardware_type_id, sum(C.tbl_billsubscription_quantity) as quantity
        from dbtransaction.tbl_bill as B
        left join dbtransaction.tbl_billsubscription as C on B.tbl_bill_id = C.tbl_bill_id
        where B.tbl_bill_merchant_nmcId = USER_ID
        group by C.tbl_hardware_type_id
        ) as W on A.tbl_hardware_type_id = W.tbl_hardware_type_id
        
        left join 
        (select D.tbl_hardware_type_id, sum(D.tbl_location_hardware_qty) as quantity_2
        from tbl_location_hardware as D
        where D.tbl_user_id = USER_ID   
        group by D.tbl_hardware_type_id
        ) as X on A.tbl_hardware_type_id = X.tbl_hardware_type_id

);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCHardwareLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCHardwareLocation`(locationID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT 

GROUP_CONCAT(distinct

		CONCAT('{"121.21":"',A.tbl_location_hardware_id,'"') , 
		CONCAT(',"127.88":"',A.tbl_hardware_type_id,'"') , 	   
		CONCAT(',"121.22":"',A.tbl_location_hardware_qty,'"') ,
		CONCAT(',"120.84":"',B.tbl_hardware_type_price,'"') ,
		CONCAT(',"114.9":"',if(B.tbl_hardware_type_status_f = 1, 'true','false'),'"}'))

		from tbl_location_hardware as A 
		left join tbl_hardware_type as B on A.tbl_hardware_type_id = B.tbl_hardware_type_id 
		where tbl_location_id = locationID
	
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCID` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCID`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE OWNER_TYPE_ID VARCHAR(1) DEFAULT NULL;
DECLARE OWNER_ID VARCHAR(3) DEFAULT NULL;
DECLARE ENTITY_ID VARCHAR(2) DEFAULT NULL;
DECLARE CLASS_ID VARCHAR(3) DEFAULT NULL;
DECLARE USER_ID VARCHAR(11) DEFAULT NULL;
SET  group_concat_max_len = 10000000;

SET OWNER_ID =  (SELECT tbl_owner_id FROM dbuser.tbl_user WHERE tbl_user_id =UserId );
SET OWNER_TYPE_ID = (SELECT tbl_owner_type FROM dbuser.tbl_owner WHERE tbl_owner_id =OWNER_ID );
SET ENTITY_ID = (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =UserId );
SET CLASS_ID =  (SELECT tbl_user_class FROM dbuser.tbl_user WHERE tbl_user_id =UserId );
SET USER_ID =   (select LPAD(UserId, 11, '0'));




SET JSON = ( 

 

SELECT concat(OWNER_TYPE_ID,OWNER_ID,ENTITY_ID,CLASS_ID,USER_ID));




IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCImage` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCImage`(productId int,FIN int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 
SELECT GROUP_CONCAT(
	   CONCAT('{"120.86":"',COALESCE(W.tbl_productimages_id,''),'",'), 
       CONCAT('"47.42":"',COALESCE(W.tbl_productimage_image,''),'",') , 
	   CONCAT('"120.33":"',COALESCE(W.tbl_imagetype_id,''),'"}'))
	

	   from 
(SELECT tbl_productimages_id,
		tbl_productimage_image,
		tbl_imagetype_id FROM tbl_productimage
		where tbl_product_id = productId LIMIT FIN) AS W
	   
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCInventory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCInventory`(ProductId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

 

SELECT GROUP_CONCAT(           
					CONCAT('{"122.110":"',coalesce(I.tbl_productinventory_id,''),'"'),
					CONCAT(',"127.62":"',coalesce(I.tbl_productinventory_choices,''),'"'),
					CONCAT(',"114.132":"',coalesce(I.tbl_productinventory_quantity,''),'"}'))			
				
from dbitems.tbl_productinventory as I
where I.tbl_product_id=ProductId);




IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItem` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItem`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE CANNOTBEREDEEM_AUX VARCHAR(10) DEFAULT 0; 				
DECLARE BACKORDER_AUX VARCHAR(10) DEFAULT 0; 
DECLARE STOPSELLINGSOLD_AUX VARCHAR(10) DEFAULT 0; 
DECLARE SPECIAL_CONDIT_AUX VARCHAR(10) DEFAULT 0; 

SET  group_concat_max_len = 10000000;
SET SPECIAL_CONDIT_AUX = (SELECT tbl_condition_code FROM dbitems.tbl_condition where tbl_product_id = productId);
	
	if SUBSTR(SPECIAL_CONDIT_AUX,1,1) = '1' then
		SET CANNOTBEREDEEM_AUX = 'true';
	else 
		SET CANNOTBEREDEEM_AUX = 'false';
	end if;

	if SUBSTR(SPECIAL_CONDIT_AUX,2,1) = '1' then
		SET BACKORDER_AUX = 'true';
	else 
		SET BACKORDER_AUX = 'false';
	end if;

	if SUBSTR(SPECIAL_CONDIT_AUX,3,1) = '1' then
		SET STOPSELLINGSOLD_AUX = 'true';
	else 
		SET STOPSELLINGSOLD_AUX = 'false';
	end if;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
		CONCAT('"114.144":"',COALESCE(tbl_product.tbl_product_id,''),'"'),
				CONCAT(',"114.112":"',COALESCE(tbl_product.tbl_producttype_id,''),'"'),
				CONCAT(',"53":"',COALESCE(tbl_product.tbl_product_usernmcid,''),'"'),
				CONCAT(',"114.143":"',COALESCE(tbl_product.tbl_productstatus_id,''),'"'),
				CONCAT(',"CA":{',dbitems.getNMCCategory(tbl_category.tbl_category_id),'}'),
				CONCAT(',"IM":[',dbitems.getNMCImage(tbl_productimage.tbl_product_id,99),']'),
				CONCAT(',"121.102":"',COALESCE(tbl_product.tbl_product_sku,''),'"'),
				CONCAT(',"114.104":"',COALESCE(tbl_product.tbl_product_qrCode,''),'"'),
				CONCAT(',"122.131":"',COALESCE(tbl_product.tbl_product_model,''),'"'),
				CONCAT(',"120.103":"',COALESCE(tbl_product.tbl_barcodetype_id,''),'"'),
				CONCAT(',"121.108":"',COALESCE(tbl_product.tbl_product_barcode,''),'"'),
				CONCAT(',"120.83":"',COALESCE(tbl_product.tbl_product_name,''),'"'),
				CONCAT(',"114.149":"',COALESCE(tbl_product.tbl_product_brand,''),'"'),
				CONCAT(',"114.98":"',COALESCE(tbl_product.tbl_product_regularprice,0.0),'"'),
				CONCAT(',"122.158":"',COALESCE(tbl_product.tbl_product_saleprice,0.0),'"'),
				CONCAT(',"122.159":"',COALESCE(tbl_product.tbl_product_rewardprice,0.0),'"'),
				CONCAT(',"122.160":"',COALESCE(tbl_product.tbl_product_salediscount,0.0),'"'),
				CONCAT(',"127.15":"',COALESCE(tbl_product.tbl_product_amount_type_id,34001),'"'),
				CONCAT(',"120.157":"',COALESCE(hex(tbl_product.tbl_product_description),''),'"'),
				CONCAT(',"122.147":"',CANNOTBEREDEEM_AUX,'"'),
				CONCAT(',"122.145":"',BACKORDER_AUX,'"'),
				CONCAT(',"122.146":"',STOPSELLINGSOLD_AUX,'"'),
				CONCAT(',"120.31:"',COALESCE(tbl_product.tbl_product_dateadded,''),'"'),
				
				CONCAT(',"122.144":"',if(tbl_product.tbl_product_quantity > 0,'true','false'),'"'), 
				CONCAT(',"122.148":"',COALESCE(tbl_product.tbl_product_quantity,''),'"'), 
				CONCAT(',"120.40":"',COALESCE(tbl_condition.tbl_conditiontype_id,''),'"'), 
				
				CONCAT(',"DE":[',dbitems.getNMCDelivery(tbl_productdelivery.tbl_product_id),']'),
				CONCAT(',"SH":{',dbitems.getNMCSchedule(tbl_productschedule.tbl_schedule_id),'}'),
				CONCAT(',"LO":[',dbuser.getNMCLocation(tbl_productlocation.tbl_location_id),']'),

				CONCAT(',"121.172":"',COALESCE(hex(tbl_condition.tbl_condition_termsandConditions),''),'"')
	  )
		from dbitems.tbl_product 
		left join dbitems.tbl_productcategory on tbl_productcategory.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_category on  tbl_category.tbl_category_id = tbl_productcategory.tbl_category_id
		left join dbitems.tbl_productimage on  tbl_productimage.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_productlocation on tbl_productlocation.tbl_product_id = tbl_product.tbl_product_id
		left join dbuser.tbl_location on tbl_location.tbl_location_id = tbl_productlocation.tbl_location_id
		left join dbitems.tbl_productschedule on tbl_productschedule.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_schedule on tbl_schedule.tbl_schedule_id = tbl_productschedule.tbl_schedule_id
		left join dbitems.tbl_productdelivery on tbl_productdelivery.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_deliverycompany on tbl_deliverycompany.tbl_deliverycompany_id = tbl_productdelivery.tbl_deliverycompany_id
		left join dbitems.tbl_condition on tbl_condition.tbl_product_id = tbl_product.tbl_product_id 
		
		where tbl_product.tbl_product_id = productId
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemByCategory`(CategoryId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"120.157":"',COALESCE(hex(W.tbl_product_description),''),'"'),
            CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
            CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
            CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_description,
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
        A.tbl_product_dateadded
		from tbl_product as A, tbl_productcategory as B
		where B.tbl_category_id = CategoryId
		and A.tbl_product_id = B.tbl_product_id
        and A.tbl_product_offer_f = 0
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCItemByLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCItemByLocation`(LocationId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
            CONCAT(',"120.157":"',COALESCE(hex(W.tbl_product_description),''),'"'),
			CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
            CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
            CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_description,
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
        A.tbl_product_dateadded
		from tbl_product as A, tbl_productlocation as B
		where B.tbl_location_id = LocationId
		and A.tbl_product_id = B.tbl_product_id
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemByMerchant` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemByMerchant`(MerchantId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(dbitems.getNMCScheduleProduct(W.tbl_product_id)),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image
		from vw_product_by_merchant as A
		where A.tbl_main_user_id = dbuser.GetNMCId(MerchantId)
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001	
        and ValidateNMCProductSchedule(A.tbl_product_id) = 'true'
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemByModule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemByModule`(ModuleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

DECLARE merchant_f VARCHAR(5);
DECLARE category_f VARCHAR(5);

DECLARE type_f VARCHAR(5);
DECLARE name_f VARCHAR(5);
DECLARE brand_f VARCHAR(5);
DECLARE priceMax_f VARCHAR(5);
DECLARE priceMin_f VARCHAR(5);
DECLARE dateMax_f VARCHAR(5);
DECLARE dateMin_f VARCHAR(5);

DECLARE type_aux INT(11);
DECLARE name_aux VARCHAR(99);
DECLARE brand_aux VARCHAR(99);
DECLARE priceMax_aux VARCHAR(45);
DECLARE priceMin_aux VARCHAR(45);
DECLARE dateMax1_aux INT(11);
DECLARE dateMax2_aux VARCHAR(45);
DECLARE dateMin1_aux INT(11);
DECLARE dateMin2_aux VARCHAR(45);
DECLARE limit_aux INT(11);



set category_f = (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 2 limit 1) is not null,'true','false')));
set merchant_f = (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 3 limit 1) is not null,'true','false')));

set type_f =  (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 1 limit 1) is not null,'true','false')));
set name_f =  (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 2 limit 1) is not null,'true','false')));
set brand_f = (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 3 limit 1) is not null,'true','false')));
set priceMax_f = (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 5 limit 1) is not null,'true','false')));
set priceMin_f = (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 6 limit 1) is not null,'true','false')));
set dateMax_f =  (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 7 limit 1) is not null,'true','false')));
set dateMin_f =  (select(if((select tbl_module_id from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 8 limit 1) is not null,'true','false')));


set type_aux  = (select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 1 limit 1);
set name_aux  = (select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 2 limit 1);
set brand_aux = (select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 3 limit 1);
set priceMax_aux = (select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 5 limit 1);
set priceMin_aux = (select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 6 limit 1);
set dateMax1_aux = (select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 7 limit 1);
set dateMax2_aux = (select tbl_module_filter_value2 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 7 limit 1);
set dateMin1_aux = (select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 8 limit 1);
set dateMin2_aux = (select tbl_module_filter_value2 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 1 and tbl_subfilter_id = 8 limit 1);
set limit_aux = COALESCE((select tbl_module_item_limit from dbitems.tbl_module where tbl_module_id = ModuleId), 20);



SET  group_concat_max_len = 10000000;



-- if ((select tbl_module_type_id from dbitems.tbl_module where tbl_module_id = ModuleId limit 1))=1 then

	SET JSON = ( 

		SELECT  GROUP_CONCAT(distinct
				CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
				CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
				CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
				CONCAT(',"122.131":"',COALESCE(W.tbl_product_model,''),'"'),
				CONCAT(',"121.102":"',COALESCE(W.tbl_product_sku,''),'"'),
				CONCAT(',"IM":[',dbitems.getNMCImage(W.tbl_product_id,99),']'),
				CONCAT(',"CA":{',dbitems.getNMCCategory(W.tbl_category_id),'}'),
				CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
				CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
				CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
				CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
                CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
                CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
				CONCAT(',"114.9":"false"}'))

		from 
		
			(select A.tbl_product_id, 
			A.tbl_producttype_id, 
			A.tbl_product_name, 
			A.tbl_product_model,
			A.tbl_product_sku,
			A.tbl_product_dateadded,
			A.tbl_product_regularprice, 
			A.tbl_product_saleprice,
			A.tbl_product_image,
			B.tbl_category_id
			from tbl_product as A, tbl_productcategory as B
			where A.tbl_product_id = B.tbl_product_id
            
            and if(category_f='true', B.tbl_category_id in ((select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 2)), A.tbl_product_id)
			and if(merchant_f='true', A.tbl_product_usernmcId in ((select tbl_module_filter_value1 from dbitems.tbl_module_filter where tbl_module_id = ModuleId and tbl_filter_id = 3)), A.tbl_product_id)
			
            and if(type_f='true', A.tbl_producttype_id = type_aux, A.tbl_product_id)
            and if(name_f='true', UPPER(A.tbl_product_name) like CONCAT("%",UPPER(name_aux),"%"), A.tbl_product_id)
            and if(brand_f='true', UPPER(A.tbl_product_brand) like CONCAT("%",UPPER(brand_aux),"%"), A.tbl_product_id)
			
            and 
				if(dateMax_f='true', 
					if(dateMax2_aux in ('DAY','DAYS'),A.tbl_product_lastModified <= (select date_sub(NOW(), INTERVAL dateMax1_aux DAY)),
						if(dateMax2_aux in ('MONTH','MONTHS'),A.tbl_product_lastModified <= (select date_sub(NOW(), INTERVAL dateMax1_aux MONTH)),
							if(dateMax2_aux in ('YEAR','YEARS'),A.tbl_product_lastModified <= (select date_sub(NOW(), INTERVAL dateMax1_aux YEAR)),A.tbl_product_id
							)
						)
					), A.tbl_product_id
				)
			
            and 
				if(dateMin_f='true', 
					if(dateMin2_aux in ('DAY','DAYS'),A.tbl_product_lastModified >= (select date_sub(NOW(), INTERVAL dateMin1_aux DAY)),
						if(dateMin2_aux in ('MONTH','MONTHS'),A.tbl_product_lastModified >= (select date_sub(NOW(), INTERVAL dateMin1_aux MONTH)),
							if(dateMin2_aux in ('YEAR','YEARS'),A.tbl_product_lastModified >= (select date_sub(NOW(), INTERVAL dateMin1_aux YEAR)),A.tbl_product_id
							)
						)
					), A.tbl_product_id
				)
			
            and if(priceMax_f='true', A.tbl_product_saleprice <= priceMax_aux, A.tbl_product_id)
			and if(priceMin_f='true', A.tbl_product_saleprice >= priceMin_aux, A.tbl_product_id)
			and A.tbl_productstatus_id = 1001	
			order by A.tbl_product_id DESC
			limit limit_aux) as W
		);

-- end if;
		
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemCounterByCategory`(CategoryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from tbl_product as A, tbl_productcategory as B
	where B.tbl_category_id = CategoryId
	and A.tbl_product_id = B.tbl_product_id
    and A.tbl_product_offer_f = 0
    and A.tbl_producttype_id = 21
	and A.tbl_productstatus_id = 1001	
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemCounterByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemCounterByUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from vw_product_by_merchant
	where (select right(tbl_main_user_id,11)) = UserId
	and tbl_productstatus_id = 1001	
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemDiscountApply` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemDiscountApply`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(

	   CONCAT('{"114.144":"',COALESCE(A.tbl_product_id,''),'"'),  
       CONCAT(',"114.112":"',COALESCE(A.tbl_producttype_id,''),'"'), 
       CONCAT(',"114.143":"',COALESCE(A.tbl_productstatus_id,''),'"'),
       CONCAT(',"120.83":"',COALESCE(A.tbl_product_name,''),'"'),
	   CONCAT(',"IM":[',dbitems.getNMCImage(A.tbl_product_id,3),']}')
	   )
	 
		from tbl_product AS A, tbl_discount_item_applied AS B
		where  A.tbl_product_id = B.tbl_product_id
	    and B.tbl_product_discount_id = productId
);
  
IF JSON is NULL THEN
	SET JSON = '';
END IF; 

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemDiscountRequired` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemDiscountRequired`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(

	   CONCAT('{"114.144":"',COALESCE(A.tbl_product_id,''),'"'),  
       CONCAT(',"114.112":"',COALESCE(A.tbl_producttype_id,''),'"'),
	   CONCAT(',"114.143":"',COALESCE(A.tbl_productstatus_id,''),'"'),
       CONCAT(',"120.83":"',COALESCE(A.tbl_product_name,''),'"'),
	   CONCAT(',"IM":[',dbitems.getNMCImage(A.tbl_product_id,3),']}')
	   )
	 
		from tbl_product AS A, tbl_discount_item_required AS B
		where  A.tbl_product_id = B.tbl_product_id
	    and B.tbl_product_discount_id = productId
);
  
IF JSON is NULL THEN
	SET JSON = '';
END IF; 

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemList` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemList`(mainuserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE CANNOTBEREDEEM_AUX VARCHAR(10) DEFAULT 0; 				
DECLARE BACKORDER_AUX VARCHAR(10) DEFAULT 0; 
DECLARE STOPSELLINGSOLD_AUX VARCHAR(10) DEFAULT 0; 
DECLARE SPECIAL_CONDIT_AUX VARCHAR(10) DEFAULT 0; 

SET  group_concat_max_len = 10000000;
SET SPECIAL_CONDIT_AUX = (SELECT tbl_condition_code FROM dbitems.tbl_condition where tbl_product_id = productId);
	
	if SUBSTR(SPECIAL_CONDIT_AUX,1,1) = '1' then
		SET CANNOTBEREDEEM_AUX = 'true';
	else 
		SET CANNOTBEREDEEM_AUX = 'false';
	end if;

	if SUBSTR(SPECIAL_CONDIT_AUX,2,1) = '1' then
		SET BACKORDER_AUX = 'true';
	else 
		SET BACKORDER_AUX = 'false';
	end if;

	if SUBSTR(SPECIAL_CONDIT_AUX,3,1) = '1' then
		SET STOPSELLINGSOLD_AUX = 'true';
	else 
		SET STOPSELLINGSOLD_AUX = 'false';
	end if;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
		CONCAT('{"114.144":"',COALESCE(tbl_product.tbl_product_id,''),'"'),
				CONCAT(',"114.112":"',COALESCE(tbl_product.tbl_producttype_id,''),'"'),
				CONCAT(',"53":"',COALESCE(tbl_product.tbl_product_usernmcid,''),'"'),
				CONCAT(',"114.143":"',COALESCE(tbl_product.tbl_productstatus_id,''),'"'),
				CONCAT(',"CA":{',dbitems.getNMCCategory(tbl_category.tbl_category_id),'}'),
				CONCAT(',"IM":[',dbitems.getNMCImage(tbl_productimage.tbl_product_id,99),']'),
				CONCAT(',"121.102":"',COALESCE(tbl_product.tbl_product_sku,''),'"'),
				CONCAT(',"114.104":"',COALESCE(tbl_product.tbl_product_qrCode,''),'"'),
				CONCAT(',"122.131":"',COALESCE(tbl_product.tbl_product_model,''),'"'),
				CONCAT(',"120.103":"',COALESCE(tbl_product.tbl_barcodetype_id,''),'"'),
				CONCAT(',"121.108":"',COALESCE(tbl_product.tbl_product_barcode,''),'"'),
				CONCAT(',"120.83":"',COALESCE(tbl_product.tbl_product_name,''),'"'),
				CONCAT(',"114.149":"',COALESCE(tbl_product.tbl_product_brand,''),'"'),
				CONCAT(',"114.98":"',COALESCE(tbl_product.tbl_product_regularprice,0.0),'"'),
				CONCAT(',"122.158":"',COALESCE(tbl_product.tbl_product_saleprice,0.0),'"'),
				CONCAT(',"122.159":"',COALESCE(tbl_product.tbl_product_rewardprice,0.0),'"'),
				CONCAT(',"122.160":"',COALESCE(tbl_product.tbl_product_salediscount,0.0),'"'),
				CONCAT(',"127.15":"',COALESCE(tbl_product.tbl_product_amount_type_id,34001),'"'),
				CONCAT(',"120.157":"',COALESCE(hex(tbl_product.tbl_product_description),''),'"'),
				CONCAT(',"122.147":"',CANNOTBEREDEEM_AUX,'"'),
				CONCAT(',"122.145":"',BACKORDER_AUX,'"'),
				CONCAT(',"122.146":"',STOPSELLINGSOLD_AUX,'"'),
				CONCAT(',"120.31:"',COALESCE(tbl_product.tbl_product_dateadded,''),'"'),
				
				CONCAT(',"122.144":"',if(tbl_product.tbl_product_quantity > 0,'true','false'),'"'), 
				CONCAT(',"122.148":"',COALESCE(tbl_product.tbl_product_quantity,''),'"'), 
				CONCAT(',"120.40":"',COALESCE(tbl_condition.tbl_conditiontype_id,''),'"'), 
				
				CONCAT(',"DE":[',dbitems.getNMCDelivery(tbl_productdelivery.tbl_product_id),']'),
				CONCAT(',"SH":{',dbitems.getNMCSchedule(tbl_productschedule.tbl_schedule_id),'}'),
				CONCAT(',"LO":[',dbuser.getNMCLocation(tbl_productlocation.tbl_location_id),']'),

				CONCAT(',"121.172":"',COALESCE(hex(tbl_condition.tbl_condition_termsandConditions),''),'"}')
	  )
		from dbitems.vw_product_by_merchant as tbl_product
		left join dbitems.tbl_productcategory on tbl_productcategory.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_category on  tbl_category.tbl_category_id = tbl_productcategory.tbl_category_id
		left join dbitems.tbl_productimage on  tbl_productimage.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_productlocation on tbl_productlocation.tbl_product_id = tbl_product.tbl_product_id
		left join dbuser.tbl_location on tbl_location.tbl_location_id = tbl_productlocation.tbl_location_id
		left join dbitems.tbl_productschedule on tbl_productschedule.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_schedule on tbl_schedule.tbl_schedule_id = tbl_productschedule.tbl_schedule_id
		left join dbitems.tbl_productdelivery on tbl_productdelivery.tbl_product_id = tbl_product.tbl_product_id
		left join dbitems.tbl_deliverycompany on tbl_deliverycompany.tbl_deliverycompany_id = tbl_productdelivery.tbl_deliverycompany_id
		left join dbitems.tbl_condition on tbl_condition.tbl_product_id = tbl_product.tbl_product_id 
		
		where tbl_product.tbl_main_user_id = mainuserId
		and tbl_product.tbl_productstatus_id = 1001
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemMembership` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemMembership`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(

	   CONCAT('{"114.144":"',COALESCE(A.tbl_product_id,''),'",'),  
       CONCAT('"114.112":"',COALESCE(A.tbl_producttype_id,''),'",'), 
	   CONCAT('"IM":[',dbitems.getNMCImage(A.tbl_product_id,3),'],'),
	   CONCAT('"120.83":"',COALESCE(A.tbl_product_name,''),'"}'))
	 
		from tbl_product AS A, tbl_productmembership AS B
		where  A.tbl_product_id = B.tbl_productmembership_membershipId
	    and B.tbl_productmembershipId = productId
);
  
IF JSON is NULL THEN
	SET JSON = '';
END IF; 

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCItemRatingAverage` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCItemRatingAverage`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select avg(tbl_review_rating - 2100) 
    from dbitems.tbl_review 
    where tbl_product_id = productId
    
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCItemReviewCounter` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCItemReviewCounter`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(tbl_review_rating) 
    from dbitems.tbl_review 
    where tbl_product_id = productId
    
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemSpecialByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemSpecialByCategory`(CategoryId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"120.157":"',COALESCE(hex(W.tbl_product_description),''),'"'),
            CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
            CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
            CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_description,
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
        A.tbl_product_dateadded
		from tbl_product as A, tbl_productcategory as B
		where B.tbl_category_id = CategoryId
		and A.tbl_product_id = B.tbl_product_id
        and A.tbl_product_offer_f = 1
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCItemSpecialCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCItemSpecialCounterByCategory`(CategoryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from tbl_product as A, tbl_productcategory as B
	where B.tbl_category_id = CategoryId
	and A.tbl_product_id = B.tbl_product_id
    and A.tbl_product_offer_f = 1
    and A.tbl_producttype_id = 21
	and A.tbl_productstatus_id = 1001	
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocalizationPackageByPackageId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocalizationPackageByPackageId`(PackageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT 
 
GROUP_CONCAT(distinct
	   CONCAT('{"CI":{',dbuser.getNMCCity(A.tbl_city_id),'}') ,
	   CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_country_id),'}') ,
	   CONCAT(',"ST":{',dbuser.getNMCStates(A.tbl_state_id),'}')  ,
	   CONCAT(',"ZP":{',dbuser.getNMCZipCode(A.tbl_zipcode_id),'}')  ,
	   CONCAT(',"127.103":"',COALESCE(A.tbl_packagelocalization_id,''),'"}'))


			
		from tbl_packagelocalization AS A
		where A.tbl_package_id = PackageId
		
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocalizationShuffleByshuffleId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocalizationShuffleByshuffleId`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT 
 
GROUP_CONCAT(distinct
	   CONCAT('{"CI":{',dbuser.getNMCCity(A.tbl_city_id),'}') ,
	   CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_country_id),'}') ,
	   CONCAT(',"ST":{',dbuser.getNMCStates(A.tbl_state_id),'}')  ,
	   CONCAT(',"ZP":{',dbuser.getNMCZipCode(A.tbl_zipcode_id),'}')  ,
	   CONCAT(',"127.103":"',COALESCE(A.tbl_shufflelocalization_id,''),'"}'))


			
		from tbl_shufflelocalization AS A
		where A.tbl_shuffle_id = shuffleId
		
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocation`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
 
	    CONCAT('{"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"}')
		)
		
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocation2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocation2`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
 
	    CONCAT('{"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"}')
		)
		
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
);
		
IF JSON is NULL THEN
	SET JSON = '{}';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocation3` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocation3`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"SB":{',dbitems.getNMCSubscriptionByLocation(tbl_location.tbl_location_id),'}'),
        CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"')
		)
		
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationByCatalogId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationByCatalogId`(CatalogId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
 
	    CONCAT('{"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"}')
		)
		
		from dbitems.tbl_cataloglocation 
		left join dbuser.tbl_location on tbl_location.tbl_location_id = tbl_cataloglocation.tbl_location_id
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_cataloglocation.tbl_catalog_id = CatalogId 
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationByPackageId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationByPackageId`(PackgeId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
  
	    CONCAT('{"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"}')
		)
		
		from dbitems.tbl_packagelocation 
		left join dbuser.tbl_location on tbl_location.tbl_location_id = tbl_packagelocation.tbl_location_id
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_packagelocation.tbl_package_id = PackgeId 
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationByshuffleId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationByshuffleId`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
  
	    CONCAT('{"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"127.119":"',COALESCE((select count(A.tbl_terminal_id) from dbuser.tbl_terminal AS A where A.tbl_location_id = tbl_location.tbl_location_id),0),'"'),
		CONCAT(',"127.104":"',if(SUBSTR(tbl_shufflelocation.tbl_shufflelocation_allterminal_f,1,1) = 1,'true','false'),'"'),
		CONCAT(',"SB":{',dbitems.getNMCSubscriptionByLocation(tbl_location.tbl_location_id),'}'),
        CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"}')
		)
		
		from dbitems.tbl_shufflelocation 
		left join dbuser.tbl_location on tbl_location.tbl_location_id = tbl_shufflelocation.tbl_location_id
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_shufflelocation.tbl_shuffle_id = shuffleId 
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationByUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
 
	    CONCAT('{"114.47":"',COALESCE(A.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(A.tbl_location_storeName,''),'"'),
        CONCAT(',"AD":{',dbuser.getNMCAddress(C.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(E.tbl_phone_id),'}'),
		CONCAT(',"114.143":"',COALESCE(A.tbl_location_statusId,''),'"}')
		)
		
		from dbuser.tbl_location as A
		left join dbuser.tbl_locationaddress as B on B.tbl_location_id = A.tbl_location_id
		left join dbuser.tbl_address as C on C.tbl_address_id = B.tbl_address_id
		left join dbuser.tbl_locationphone as D on D.tbl_location_id = A.tbl_location_id
		left join dbuser.tbl_phone as E on E.tbl_phone_id = D.tbl_phone_id
		where A.tbl_location_userId = UserId 
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationQtyByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationQtyByUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;

DECLARE LOC_1 INT;
DECLARE LOC_2 INT;

SET  group_concat_max_len = 10000000;

SET LOC_1 = ( 
	select count(A.tbl_location_id) 
	from dbuser.tbl_location as A
	left join dbuser.tbl_locationaddress as B on B.tbl_location_id = A.tbl_location_id
	left join dbuser.tbl_address as C on C.tbl_address_id = B.tbl_address_id
	where A.tbl_location_userId = UserId
	and C.tbl_addresstype_id = 11
    and (UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
	and UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
	and UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
    
);



SET LOC_2 = ( 
	select count(A.tbl_location_id) 
	from dbuser.tbl_location as A
	left join dbuser.tbl_locationaddress as B on B.tbl_location_id = A.tbl_location_id
	left join dbuser.tbl_address as C on C.tbl_address_id = B.tbl_address_id
	where A.tbl_location_userId in (select tbl_user_id from tbl_user where tbl_user_parentId = UserId)
	and C.tbl_addresstype_id = 11
    and (UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
	and UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
	and UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
);


SET JSON = (LOC_1 + LOC_2);
		
IF JSON is NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationRoot` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationRoot`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE HARDWARE_QUANTITY INT ;
DECLARE TERMINAL_QUANTITY INT ;
SET  group_concat_max_len = 10000000;
SET HARDWARE_QUANTITY = (SELECT SUM(tbl_location_hardware_qty) from dbuser.tbl_location_hardware where tbl_location_id= locationId );
SET TERMINAL_QUANTITY = (SELECT COUNT(tbl_terminal_id) from dbuser.tbl_terminal where tbl_location_id= locationId );
SET JSON = ( 


SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"'),
		CONCAT(',"127.119":"',COALESCE(HARDWARE_QUANTITY,0),'"'),
        CONCAT(',"121.22":"',COALESCE(TERMINAL_QUANTITY,0),'"'),
        CONCAT(',"TE":[',dbitems.getNMCTerminalByLocation(tbl_location.tbl_location_id),']'),
        CONCAT(',"SB":{',dbitems.getNMCSubscriptionByLocation(tbl_location.tbl_location_id),'}'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
        CONCAT(',"HL":[',dbuser.getNMCHardwareLocation(tbl_location.tbl_location_id),']'),
		CONCAT(',"SL":[',dbuser.getNMCScheduleLocation(tbl_location.tbl_location_id),']'))
		
       
        
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
        and tbl_address.tbl_addresstype_id = 11
        and (UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
);

		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationRootCampaign` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationRootCampaign`(locationId int, packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE HARDWARE_QUANTITY INT ;
DECLARE TERMINAL_QUANTITY INT ;
SET  group_concat_max_len = 10000000;
SET HARDWARE_QUANTITY = (SELECT SUM(tbl_location_hardware_qty) from dbuser.tbl_location_hardware where tbl_location_id= locationId );
SET TERMINAL_QUANTITY = (SELECT COUNT(tbl_terminal_id) from dbuser.tbl_terminal where tbl_location_id= locationId );
SET JSON = ( 


SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"'),
		CONCAT(',"127.119":"',COALESCE(HARDWARE_QUANTITY,0),'"'),
        CONCAT(',"121.22":"',COALESCE(TERMINAL_QUANTITY,0),'"'),
        CONCAT(',"TE":[',dbitems.getNMCTerminalByLocationAndCampaign(tbl_location.tbl_location_id, packageId),']'),
        CONCAT(',"SB":{',dbitems.getNMCSubscriptionByLocation(tbl_location.tbl_location_id),'}'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
        CONCAT(',"HL":[',dbuser.getNMCHardwareLocation(tbl_location.tbl_location_id),']'),
		CONCAT(',"SL":[',dbuser.getNMCScheduleLocation(tbl_location.tbl_location_id),']'))
		
       
        
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
        and tbl_address.tbl_addresstype_id = 11
        and (UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
);

		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationRootDongle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationRootDongle`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
        CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
        CONCAT(',"SL":[',dbuser.getNMCScheduleLocation(tbl_location.tbl_location_id),']'))
		
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
        and tbl_address.tbl_addresstype_id = 11
        and (UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
        and dbitems.ValidateSubscriptionActiveByLocation(tbl_location.tbl_location_id) = 'true'
);


	
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationRootDongleGPS` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationRootDongleGPS`(userId INT, latitude VARCHAR(20), longitude VARCHAR(20)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT GROUP_CONCAT(
 
	    CONCAT('{"114.47":"',COALESCE(W.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(W.tbl_location_storeName,''),'"'),
		CONCAT(',"47.8":"',COALESCE(W.distance,''),'"'),
        CONCAT(',"AD":{',dbuser.getNMCAddress(W.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(W.tbl_phone_id),'}'),
        CONCAT(',"SL":[',dbuser.getNMCScheduleLocation(W.tbl_location_id),']}'))
		
		from 
		
		(select
		A.tbl_location_id,
		A.tbl_location_storeName,
		G.distance,
		C.tbl_address_id,
		E.tbl_phone_id
		
		from tbl_location as A 
		left join dbuser.tbl_locationaddress as B on B.tbl_location_id = A.tbl_location_id 
		left join dbuser.tbl_address as C on  C.tbl_address_id = B.tbl_address_id 
		left join dbuser.tbl_locationphone as D on D.tbl_location_id = A.tbl_location_id 
		left join dbuser.tbl_phone as E on E.tbl_phone_id = D.tbl_phone_id
		left join (
				select E.tbl_location_id as LocationAUX,
				(0.621371192 * (6371 * acos( cos( radians(latitude) ) * cos( radians(E.tbl_location_latitude) ) * cos( radians(E.tbl_location_longitude) - radians(longitude) ) + sin( radians(latitude) ) * sin( radians(E.tbl_location_latitude) ) ))) distance
				from dbuser.tbl_location as E
				where E.tbl_location_userId in (dbuser.getNMCUserByClass(userId)) 
				) as G on A.tbl_location_id = G.LocationAUX 
				
		where A.tbl_location_userId in (dbuser.getNMCUserByClass(userId)) 
        and C.tbl_addresstype_id = 11
        and (UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
		and UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
		and UPPER(A.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
        and dbitems.ValidateSubscriptionActiveByLocation(A.tbl_location_id) = 'true'
		order by G.distance ASC) as W
);


	
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationRootMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationRootMobile`(locationId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
        CONCAT(',"PC":[', COALESCE(dbitems.GetNMCItemByLocation(tbl_location.tbl_location_id, userId),''),']'))
		
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
        and tbl_address.tbl_addresstype_id = 11
        and (UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
        and dbitems.ValidateSubscriptionActiveByLocation(tbl_location.tbl_location_id) = 'true'
        and length(dbitems.GetNMCItemByLocation(tbl_location.tbl_location_id, userId))>0
);


	
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationRootPackage` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationRootPackage`(locationId int, packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE HARDWARE_QUANTITY INT ;
DECLARE TERMINAL_QUANTITY INT ;
SET  group_concat_max_len = 10000000;
SET HARDWARE_QUANTITY = (SELECT SUM(tbl_location_hardware_qty) from dbuser.tbl_location_hardware where tbl_location_id= locationId );
SET TERMINAL_QUANTITY = (SELECT COUNT(tbl_terminal_id) from dbuser.tbl_terminal where tbl_location_id= locationId );
SET JSON = ( 


SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"'),
		CONCAT(',"127.119":"',COALESCE(HARDWARE_QUANTITY,0),'"'),
        CONCAT(',"121.22":"',COALESCE(TERMINAL_QUANTITY,0),'"'),
        CONCAT(',"TE":[',dbitems.getNMCTerminalByLocationAndCampaign(tbl_location.tbl_location_id, packageId),']'),
        CONCAT(',"SB":{',dbitems.getNMCSubscriptionByLocation(tbl_location.tbl_location_id),'}'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
        CONCAT(',"HL":[',dbuser.getNMCHardwareLocation(tbl_location.tbl_location_id),']'),
		CONCAT(',"SL":[',dbuser.getNMCScheduleLocation(tbl_location.tbl_location_id),']'))
		
       
        
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
        and tbl_address.tbl_addresstype_id = 11
        and (UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
);

		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationShipping` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationShipping`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE TERMINAL_QUANTITY INT ;
SET  group_concat_max_len = 10000000;
SET TERMINAL_QUANTITY = (SELECT COUNT(tbl_terminal_id) from dbuser.tbl_terminal where tbl_location_id= locationId );
SET JSON = ( 


SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"'),
		CONCAT(',"127.119":"',TERMINAL_QUANTITY,'"'),
        CONCAT(',"117.18":"',COALESCE((select tbl_location_hardware_qty from tbl_location_hardware where tbl_hardware_type_id = 75001 and tbl_location_id = tbl_location.tbl_location_id),''),'"'),
        CONCAT(',"117.12":"',COALESCE((select sum(tbl_location_hardware_qty) from tbl_location_hardware where tbl_hardware_type_id in(75002,75003) and tbl_location_id = tbl_location.tbl_location_id),''),'"'),
        CONCAT(',"117.19":"',COALESCE((select sum(tbl_location_hardware_qty) from tbl_location_hardware where tbl_hardware_type_id in(75004,75005,75006) and tbl_location_id = tbl_location.tbl_location_id),''),'"'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"SL":[',dbuser.getNMCScheduleLocation(tbl_location.tbl_location_id),']'))
		
       
        
		from dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		where tbl_location.tbl_location_id = locationId 
);

		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLocationShort` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLocationShort`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE HARDWARE_QUANTITY INT ;
DECLARE TERMINAL_QUANTITY INT ;
SET  group_concat_max_len = 10000000;
SET JSON = ( 


SELECT GROUP_CONCAT(
 
	    CONCAT('"114.47":"',COALESCE(tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location_storeName,''),'"')
		)

		from dbuser.tbl_location 		
		where tbl_location_id = locationId 

);

		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCLogoImageByMerchant` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCLogoImageByMerchant`(userId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
	-- User
SELECT CONCAT('',COALESCE(tbl_merchant_logoimage,''),'')

		from dbuser.tbl_merchant
		where tbl_merchant.tbl_user_id = userId
);
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMainAddressByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMainAddressByUser`(userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE JSON2 MEDIUMTEXT;
DECLARE _114_115 VARCHAR(60);
DECLARE _53 VARCHAR(60);
DECLARE _114_53 VARCHAR(60);
DECLARE _121_45 VARCHAR(60);
DECLARE CI VARCHAR(100);
DECLARE CO VARCHAR(100);
DECLARE ST VARCHAR(100);
DECLARE ZP VARCHAR(100);
DECLARE _114_9 VARCHAR(60);
DECLARE _120_39 VARCHAR(60);
DECLARE _120_38 VARCHAR(60);
DECLARE _120_27 VARCHAR(60);
DECLARE _114_12 VARCHAR(60);
DECLARE _114_13 VARCHAR(60);

SET  group_concat_max_len = 10000000;

SELECT
	   COALESCE(A.tbl_address_id,''), 
	   COALESCE(dbuser.GetNMCID((select right(A.tbl_address_nmcId,11)))),
	   COALESCE(A.tbl_address_name,''),
       COALESCE(A.tbl_addresstype_id,''),
	   dbuser.getNMCCity(A.tbl_city_id),
	   dbuser.getNMCCountry(A.tbl_country_id),
	   dbuser.getNMCStates(A.tbl_state_id),
	   dbuser.getNMCZipCode(A.tbl_zipcode_id),
	   COALESCE(tbl_address_flag,0),
	   COALESCE(A.tbl_address_longitude,''),
	   COALESCE(A.tbl_address_latitude,''),
	   COALESCE(tbl_address_pushedpreference,0),
	   COALESCE(A.tbl_address_first,''),
	   COALESCE(A.tbl_address_second,'')
		from tbl_address AS A
		where A.tbl_address_nmcId = userId
		and A.tbl_address_flag = 1
		and A.tbl_address_active = 1
        LIMIT 1
        INTO _114_115,
			 _53,
			 _114_53,
			 _121_45,
             CI,
             CO,
			 ST,
			 ZP,
			 _114_9,
             _120_39,
             _120_38,
             _120_27,
             _114_12,
             _114_13;

SET JSON = ( 

SELECT 

GROUP_CONCAT(

	   CONCAT('{"114.115":"',_114_115,'"') , 
	   CONCAT(',"53":"',53,'"'),
	   CONCAT(',"114.53":"',_114_53,'"') , 
       CONCAT(',"121.45":"',_121_45,'"') ,
	   CONCAT(',"CI":{',CI,'}')  ,
	   CONCAT(',"CO":{',CO,'}') ,
	   CONCAT(',"ST":{',ST,'}')  ,
	   CONCAT(',"ZP":{',ZP,'}')  ,
	   CONCAT(',"114.9":"',_114_9,'"') ,
	   CONCAT(',"120.39":"',_120_39,'"'),
	   CONCAT(',"120.38":"',_120_38,'"'),
	   CONCAT(',"120.27":"',_120_27,'"') ,
	   CONCAT(',"114.12":"',_114_12,'"'),
	   CONCAT(',"114.13":"',_114_13,'"}'))	
);


SELECT
	   COALESCE(A.tbl_address_id,''), 
	   COALESCE(dbuser.GetNMCID((select right(A.tbl_address_nmcId,11)))),
	   COALESCE(A.tbl_address_name,''),
       COALESCE(A.tbl_addresstype_id,''),
	   dbuser.getNMCCity(A.tbl_city_id),
	   dbuser.getNMCCountry(A.tbl_country_id),
	   dbuser.getNMCStates(A.tbl_state_id),
	   dbuser.getNMCZipCode(A.tbl_zipcode_id),
	   COALESCE(tbl_address_flag,0),
	   COALESCE(A.tbl_address_longitude,''),
	   COALESCE(A.tbl_address_latitude,''),
	   COALESCE(tbl_address_pushedpreference,0),
	   COALESCE(A.tbl_address_first,''),
	   COALESCE(A.tbl_address_second,'')
		from tbl_address AS A
		where A.tbl_address_nmcId = userId
	
        LIMIT 1
        INTO _114_115,
			 _53,
			 _114_53,
			 _121_45,
             CI,
             CO,
			 ST,
			 ZP,
			 _114_9,
             _120_39,
             _120_38,
             _120_27,
             _114_12,
             _114_13;

SET JSON2 = ( 

SELECT 

GROUP_CONCAT(

	   CONCAT('{"114.115":"',_114_115,'"') , 
	   CONCAT(',"53":"',53,'"'),
	   CONCAT(',"114.53":"',_114_53,'"') , 
       CONCAT(',"121.45":"',_121_45,'"') ,
	   CONCAT(',"CI":{',CI,'}')  ,
	   CONCAT(',"CO":{',CO,'}') ,
	   CONCAT(',"ST":{',ST,'}')  ,
	   CONCAT(',"ZP":{',ZP,'}')  ,
	   CONCAT(',"114.9":"',_114_9,'"') ,
	   CONCAT(',"120.39":"',_120_39,'"'),
	   CONCAT(',"120.38":"',_120_38,'"'),
	   CONCAT(',"120.27":"',_120_27,'"') ,
	   CONCAT(',"114.12":"',_114_12,'"'),
	   CONCAT(',"114.13":"',_114_13,'"}'))	
);



IF JSON2 is NULL THEN
	SET JSON2 = '{}';
END IF;


IF JSON is NULL THEN
	SET JSON = JSON2;
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMerchantAccountLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMerchantAccountLocation`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	    CONCAT('{"114.73":"',COALESCE(tbl_merchantaccount.tbl_merchantaccount_id ,''),'"'),
		CONCAT(',"122.120":"',COALESCE(tbl_merchantaccount.tbl_merchantaccount_contactName ,''),'"'),
		CONCAT(',"122.121":"',COALESCE(tbl_merchantaccount.tbl_merchantaccount_contacProvider,''),'"'),
		CONCAT(',"114.47":"',COALESCE(tbl_locationmerchantaccount.tbl_location_id,''),'"'),
		CONCAT(',"PH":[',dbuser.getNMCPhone(tbl_phone.tbl_phone_id),']'),
		CONCAT(',"114.7":"',COALESCE(tbl_merchantaccount.tbl_merchantaccount_contactMail,''),'"}'))
		
		from tbl_locationmerchantaccount
			left join tbl_merchantaccount ON tbl_merchantaccount.tbl_merchantaccount_id = tbl_locationmerchantaccount.tbl_merchantaccount_id
			left join tbl_merchantaccountphone on tbl_merchantaccountphone.tbl_merchantaccount_id=tbl_merchantaccount.tbl_merchantaccount_id
			left join tbl_phone ON tbl_phone.tbl_phone_id = tbl_merchantaccountphone.tbl_phone_id
		where tbl_locationmerchantaccount.tbl_location_id = locationId
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMerchantAdvertisingCounterFormobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMerchantAdvertisingCounterFormobile`(MerchantId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		SET JSON = ( 

		SELECT (count(W.advertising_id) 
				)
					from
					(select distinct A.advertising_id
					from vw_advertising as A 
					left join tbl_shuffle_advertising as B on A.advertising_id = B.tbl_advertising_id 
					left join tbl_package_shuffle as C on B.tbl_shuffle_id = C.tbl_shuffle_id
					where C.tbl_shuffle_broadcast_mobile = 1 
					and ValidateNMCShuffleSchedule(C.tbl_shuffle_id) = 'true' 
					and A.status = 60001 and A.productid = 0
					and A.usernmcid=(select right(dbuser.GetMainUser((select right(MerchantId,11))),11))
				   ) as W			);

	


IF JSON is NULL THEN
	SET JSON = 0;
END IF;

 
RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMerchantByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMerchantByCategory`(CategoryId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
		CONCAT('{"114.1":"',COALESCE(W.tbl_company_id,''),'"'),
		CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(W.tbl_user_id),''),'"'),
        CONCAT(',"114.70":"',COALESCE(hex(W.tbl_user_companyName),''),'"'),
        CONCAT(',"121.170":"',COALESCE(W.tbl_merchant_logoimage,''),'"'),
        CONCAT(',"114.9":"',COALESCE(dbuser.ValidateFavoriteMerchant(W.tbl_user_id,userId),''),'"}'))

	from 
    
		(select 
		A.tbl_company_id,
		A.tbl_user_id,
		A.tbl_user_companyName,
		B.tbl_merchant_logoimage
		from dbuser.tbl_merchantbusinesscategory as C
		left join dbuser.tbl_user as A on C.tbl_merchant_nmcId = A.tbl_user_id
		left join dbuser.tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
		where tbl_businesscategory_id = CategoryId
		and length(A.tbl_user_companyName)>0 
		and length(B.tbl_merchant_logoimage)>0 
		and A.tbl_user_entity = 20 
		and A.tbl_user_class in ('2A0','2B0','2C0') 
		and A.tbl_userstatus_id = 33 
		order by A.tbl_user_companyName asc) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMerchantByModule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMerchantByModule`(moduleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 
SELECT GROUP_CONCAT(
   CONCAT('{"53":"',COALESCE(dbuser.GetNMCId(A.tbl_module_filter_value1),''),'"'),
   CONCAT(',"114.70":"',COALESCE(B.tbl_user_companyName,''),'"}'))
   from dbitems.tbl_module_filter as A
   left join dbuser.tbl_user as B on A.tbl_module_filter_value1 = B.tbl_user_id
   where tbl_module_id = moduleId	
   and tbl_filter_id = 3
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMerchantCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMerchantCounterByCategory`(CategoryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from dbuser.tbl_merchantbusinesscategory as C
	left join dbuser.tbl_user as A on C.tbl_merchant_nmcId = A.tbl_user_id
	left join dbuser.tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
	where tbl_businesscategory_id = CategoryId
	and length(A.tbl_user_companyName)>0 
	and length(B.tbl_merchant_logoimage)>0 
	and A.tbl_user_entity = 20 
	and A.tbl_user_class in ('2A0','2B0','2C0') 
	and A.tbl_userstatus_id = 33
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCMerchantRatingAverage` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCMerchantRatingAverage`(merchantId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select avg(tbl_rating_rating - 2100) 
    from dbuser.tbl_rating_user 
    where tbl_rating_user_id_rated = merchantId
    
);

IF JSON is NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCMerchantReviewCounter` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCMerchantReviewCounter`(merchantId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(tbl_rating_rating) 
    from dbuser.tbl_rating_user 
    where tbl_rating_user_id_rated = merchantId
    
);

IF JSON is NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMessagesByInvoice` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMessagesByInvoice`(invoiceId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
 
		CONCAT('{"122.114":"',id,'"') ,
		CONCAT(',"53":"', coalesce((select dbuser.getnmcid(tbl_help_ticket_sender)),''),'"') ,
		CONCAT(',"114.179":"', coalesce((select dbuser.getnmcid(tbl_help_ticket_receiver)),''),'"') ,
		CONCAT(',"122.128":"',COALESCE(tbl_help_ticket_subject,''),'"') ,
		CONCAT(',"120.157":"',COALESCE(hex(tbl_help_ticket_content),''),'"') ,
		CONCAT(',"114.138":"',coalesce(tbl_help_ticket_date,''),'"}')
        )
		from dbuser.tbl_help_ticket 
		where tbl_invoice_id = invoiceId
        and id = tbl_parent_id
        and tbl_help_ticket_type = 92

);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMobilePhoneByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMobilePhoneByUser`(userId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT 
		tbl_phone_phoneNumber		 
		from tbl_phone 
		where tbl_phone_nmcId = userId
		and tbl_phonetype_id = 4003 limit 1
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCMobilePhoneCountryIDByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCMobilePhoneCountryIDByUser`(userId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT 
		tbl_phone_country_id		 
		from tbl_phone 
		where tbl_phone_nmcId = userId
		and tbl_phonetype_id = 4003 limit 1
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCOfferappliedToItem` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCOfferappliedToItem`(ProductId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

DECLARE OFFER_ID INT(11) DEFAULT 0;
DECLARE OFFER_ID_PERCETAGE INT(11) DEFAULT 0;
DECLARE DISCOUNT_TYPE INT(11) DEFAULT 0;
DECLARE DISCOUNT_QUANTITY DOUBLE DEFAULT 0;
DECLARE SALEPRICEAUX DOUBLE DEFAULT 0;


SET  group_concat_max_len = 10000000;

SET OFFER_ID = (select tbl_product_discount_id from tbl_discount_item_applied WHERE tbl_product_id = ProductId LIMIT 1);
SET DISCOUNT_TYPE = (SELECT tbl_discount_type_id FROM dbitems.tbl_product_discount WHERE  tbl_product_discount_id =OFFER_ID LIMIT 1);
SET DISCOUNT_QUANTITY = (SELECT tbl_discount_type_number FROM dbitems.tbl_product_discount WHERE  tbl_product_discount_id =OFFER_ID  LIMIT 1);
SET SALEPRICEAUX = (SELECT tbl_product_saleprice FROM dbitems.tbl_product WHERE tbl_product_id = ProductId LIMIT 1 );


	case DISCOUNT_TYPE

		when 38001 then 

			if  DISCOUNT_QUANTITY IS NOT NULL OR DISCOUNT_QUANTITY !='' THEN
				SET OFFER_ID_PERCETAGE = (SELECT (SALEPRICEAUX * DISCOUNT_QUANTITY )/100 );
				SET JSON = (SELECT (SALEPRICEAUX - OFFER_ID_PERCETAGE ));
			else
				SET JSON = SALEPRICEAUX;
			END IF;

		ELSE
			
			if  DISCOUNT_QUANTITY IS NOT NULL OR DISCOUNT_QUANTITY !='' THEN
				SET JSON = (SELECT (SALEPRICEAUX - DISCOUNT_QUANTITY ));
			else
				SET JSON = SALEPRICEAUX;
			END IF;
	end CASE ;


IF JSON IS NULL OR JSON <= 0 THEN
	SET JSON = SALEPRICEAUX;
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCOption` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCOption`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(distinct
	   CONCAT('{"121.179":"',COALESCE(B.tbl_productoption_id,''),'"'),
	   CONCAT(',"CH":[',dbitems.getNMCChoice(A.tbl_productoption_id),']'),
	   CONCAT(',"122.134":"',COALESCE(A.tbl_productoption_name,''),'"}'))			
			
		from tbl_productoption AS A,
			 tbl_productattribute AS B
		where B.tbl_productoption_id = A.tbl_productoption_id
		and   B.tbl_product_id = productId 
		
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCOWNER` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCOWNER`(OwnerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE OWNER_TYPE_ID VARCHAR(1) DEFAULT NULL;
DECLARE OWNER_ID VARCHAR(3) DEFAULT NULL;
SET  group_concat_max_len = 10000000;

SET OWNER_ID =  (select LPAD(OwnerId, 3, '0') );
SET OWNER_TYPE_ID = (SELECT tbl_owner_type FROM dbuser.tbl_owner WHERE tbl_owner_id =OWNER_ID );

SET JSON = ( 

SELECT concat(OWNER_TYPE_ID,OWNER_ID));

IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCPackageByLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCPackageByLocation`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
 
	SET JSON = ( 


		SELECT GROUP_CONCAT(distinct
		CONCAT('{"114.101":"',C.tbl_package_id,'"'),
		CONCAT(',"114.156":"',C.tbl_package_name,'"'),
		CONCAT(',"114.143":"',C.tbl_packagestatus_id,'"'),
        CONCAT(',"127.94":"', if(B.tbl_shuffle_published = 1,'true','false'),'"}')

		)

		from dbitems.tbl_shufflelocation as A 
        left join dbitems.tbl_package_shuffle as B on A.tbl_shuffle_id = B.tbl_shuffle_id
        left join dbitems.tbl_package as C on B.tbl_package_id = C.tbl_package_id

		where A.tbl_location_id  = locationId
        and C.tbl_packagestatus_id = 66001
        and B.tbl_shuffle_published = 1
        and dbitems.ValidateNMCShuffleSchedule(A.tbl_shuffle_id) = 'true'
        );

IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCPackageByTerminal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCPackageByTerminal`(terminalId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
 
	SET JSON = ( 

		SELECT GROUP_CONCAT(distinct
		CONCAT('{"114.101":"',C.tbl_package_id,'"'),
		CONCAT(',"114.156":"',C.tbl_package_name,'"'),
		CONCAT(',"114.143":"',C.tbl_packagestatus_id,'"'),
        CONCAT(',"127.94":"', if(B.tbl_shuffle_published = 1,'true','false'),'"}')

		)

		from dbitems.tbl_shuffleterminal as A 
        left join dbitems.tbl_package_shuffle as B on A.tbl_shuffle_id = B.tbl_shuffle_id
        left join dbitems.tbl_package as C on B.tbl_package_id = C.tbl_package_id

		where A.tbl_terminal_id  = terminalId
        and C.tbl_packagestatus_id = 66001
        and B.tbl_shuffle_published = 1
        and dbitems.ValidateNMCShuffleSchedule(A.tbl_shuffle_id) = 'true'
        );

IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminDislikesCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminDislikesCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;

SET  group_concat_max_len = 10000000;


		SET JSON = ( 
					
				(select count(A.tbl_advertising_id) 
					from dbitems.tbl_advertisingfavorite as A
					-- , tbl_shuffle_advertising as B
					where A.tbl_advertising_id 
						-- = B.tbl_advertising_id
					and A.tbl_shuffle_id = shuffleId
					and A.tbl_advertisingfavorite_like = 0
					)
			
				);

			
				
	
	
	
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminEndDate` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminEndDate`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	(select tbl_shuffle_schedule_endDate 
	from dbitems.tbl_shuffle_schedule as A
	where A.tbl_shuffle_id =  shuffleId
	limit 1)
); 
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminImagesCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminImagesCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;


SET JSON = ( 



	(select count(A.tbl_advertising_id) 
		from tbl_advertising as A, tbl_shuffle_advertising as B
		where A.tbl_advertising_id = B.tbl_advertising_id
		and B.tbl_shuffle_id = shuffleId
		and  A.tbl_product_id is null
		and A.tbl_advertisingimage_id is not null
		)
); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminItemsCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminItemsCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;


SET JSON = ( 



	(select count(A.tbl_advertising_id) 
		from tbl_advertising as A, tbl_shuffle_advertising as B
		where A.tbl_advertising_id = B.tbl_advertising_id
		and B.tbl_shuffle_id = shuffleId
		and  A.tbl_product_id is not null
		)
); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminLikesCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminLikesCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;




			
		SET JSON = ( 
					
				(select count(A.tbl_advertising_id) 
					from dbitems.tbl_advertisingfavorite as A
					-- , tbl_shuffle_advertising as B
					where A.tbl_advertising_id 
					-- = B.tbl_advertising_id
					and A.tbl_shuffle_id = shuffleId
					and  A.tbl_advertisingfavorite_like = 1
					)
			
				);
	
	
	
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminLocationsCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminLocationsCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;


SET JSON = ( 



	(select count(A.tbl_shuffle_id) 
		from tbl_shufflelocation as A
		where A.tbl_shuffle_id = shuffleId
		
		)
); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminTerminalCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminTerminalCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;

SET  group_concat_max_len = 10000000;


		SET JSON = ( 

			SELECT count(distinct Q.tbl_terminal_id)
			from (

			SELECT distinct

			tbl_terminal.tbl_terminal_id
			FROM dbuser.tbl_terminal LEFT JOIN dbitems.tbl_shuffleterminal on tbl_terminal.tbl_terminal_id = tbl_shuffleterminal.tbl_terminal_id
			where tbl_shuffleterminal.tbl_shuffle_id  = shuffleId

			union

			SELECT distinct
			tbl_terminal.tbl_terminal_id			
			FROM dbuser.tbl_terminal LEFT JOIN dbitems.tbl_shufflelocation on tbl_terminal.tbl_location_id = tbl_shufflelocation.tbl_location_id
			where tbl_shufflelocation.tbl_shuffle_id  = shuffleId
			and  tbl_shufflelocation_allterminal_f = 1



			) AS Q
				);
	
	
	
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardAdminVideosCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardAdminVideosCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;


SET JSON = ( 



	(select count(A.tbl_advertising_id) 
		from tbl_advertising as A, tbl_shuffle_advertising as B
		where A.tbl_advertising_id = B.tbl_advertising_id
		and B.tbl_shuffle_id = shuffleId
		and  A.tbl_product_id is null
		and A.tbl_file_id is not null
		)
); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantDislikesCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantDislikesCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;


DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;


SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);





		SET JSON = ( 
					
				(select count(A.tbl_advertising_id) 
					from dbitems.tbl_advertisingfavorite as A
					-- , tbl_shuffle_advertising as B
					where A.tbl_advertising_id
						-- = B.tbl_advertising_id
					and A.tbl_shuffle_id = SHUFFLE_ID
					and  A.tbl_advertisingfavorite_like = 0
					)
			
				);

			
				
	
	
	
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantEndDate` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantEndDate`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	(select tbl_shuffle_schedule_endDate 
	from dbitems.tbl_shuffle_schedule as A, 
	dbitems.tbl_package_shuffle as B 

	where A.tbl_shuffle_id =  B.tbl_shuffle_id
	and B.tbl_package_id = packageId


	limit 1)
); 
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantImagesCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantImagesCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;


SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);

SET JSON = ( 



	(select count(D.tbl_image_id) 
	from dbitems.tbl_package as A 
    left join dbitems.tbl_package_layout as B on A.tbl_package_id = B.tbl_package_id
    left join dbitems.tbl_package_layout_component as C on B.tbl_layout_id = C.tbl_layout_id
    left join dbitems.tbl_package_layout_component_playlist as D on C.tbl_component_id = D.tbl_component_id

	where A.tbl_package_id = packageId
    and D.tbl_broadcast_f = 1
		)
); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantItemsCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantItemsCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;


SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);

SET JSON = ( 



	(select count(D.tbl_product_id) 
	from dbitems.tbl_package as A 
    left join dbitems.tbl_package_layout as B on A.tbl_package_id = B.tbl_package_id
    left join dbitems.tbl_package_layout_component as C on B.tbl_layout_id = C.tbl_layout_id
    left join dbitems.tbl_package_layout_component_playlist as D on C.tbl_component_id = D.tbl_component_id

	where A.tbl_package_id = packageId
    and D.tbl_broadcast_f = 1
		)
); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantLikesCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantLikesCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;


DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;


SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);

			
		SET JSON = ( 
					
				(select count(A.tbl_advertising_id) 
					from dbitems.tbl_advertisingfavorite as A
						-- , tbl_shuffle_advertising as B
					where A.tbl_advertising_id 
						-- = B.tbl_advertising_id
					and A.tbl_shuffle_id = SHUFFLE_ID
					and  tbl_advertisingfavorite_like = 1
					)
			
				);
	
	
	
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantLocationsCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantLocationsCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;


SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);

SET JSON = ( 



	(select count(A.tbl_shuffle_id) 
		from tbl_shufflelocation as A
		where A.tbl_shuffle_id = SHUFFLE_ID
		
		)
); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantRepublishedCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantRepublishedCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;
DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;
SET  group_concat_max_len = 10000000;
SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);

		SET JSON = ( 
					
				(select A.tbl_shuffle_republished_count
					from dbitems.tbl_package_shuffle as A
					where  A.tbl_shuffle_id = SHUFFLE_ID
					
					)
			
				);

IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantStartDate` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantStartDate`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	(select tbl_shuffle_schedule_startDate 
	from dbitems.tbl_shuffle_schedule as A, 
	dbitems.tbl_package_shuffle as B 

	where A.tbl_shuffle_id =  B.tbl_shuffle_id
	and B.tbl_package_id = packageId


	limit 1)
); 
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantTerminalCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantTerminalCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;


DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;


SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);





		SET JSON = ( 

			SELECT count(distinct Q.tbl_terminal_id)
			from (

			SELECT distinct

			tbl_terminal.tbl_terminal_id
			FROM dbuser.tbl_terminal LEFT JOIN dbitems.tbl_shuffleterminal on tbl_terminal.tbl_terminal_id = tbl_shuffleterminal.tbl_terminal_id
			where tbl_shuffleterminal.tbl_shuffle_id  = SHUFFLE_ID

			union

			SELECT distinct
			tbl_terminal.tbl_terminal_id			
			FROM dbuser.tbl_terminal LEFT JOIN dbitems.tbl_shufflelocation on tbl_terminal.tbl_location_id = tbl_shufflelocation.tbl_location_id
			where tbl_shufflelocation.tbl_shuffle_id  = SHUFFLE_ID
			and  tbl_shufflelocation_allterminal_f = 1



			) AS Q
				);
	
	
	
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPackageDashboardMerchantVideosCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPackageDashboardMerchantVideosCount`(packageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;


SET  group_concat_max_len = 10000000;


SET  SHUFFLE_ID = (SELECT  tbl_shuffle_id FROM tbl_package_shuffle WHERE tbl_package_id = packageId limit 1);

SET JSON = ( 

	(select count(D.tbl_file_id) 
	from dbitems.tbl_package as A 
    left join dbitems.tbl_package_layout as B on A.tbl_package_id = B.tbl_package_id
    left join dbitems.tbl_package_layout_component as C on B.tbl_layout_id = C.tbl_layout_id
    left join dbitems.tbl_package_layout_component_playlist as D on C.tbl_component_id = D.tbl_component_id

	where A.tbl_package_id = packageId
    and D.tbl_broadcast_f = 1
    
		)

); 
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCPackageSize` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCPackageSize`(PackageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

DECLARE IMAGE_SIZE INT(11);
DECLARE FILE_SIZE INT(11);

SET IMAGE_SIZE = COALESCE((SELECT sum(D.tbl_advertisingimage_size) from tbl_package_layout as A, tbl_package_layout_component as B, tbl_package_layout_component_playlist as C, tbl_advertisingimage as D where A.tbl_package_id = PackageId and A.tbl_layout_id = B.tbl_layout_id and B.tbl_component_id = C.tbl_component_id and C.tbl_image_id = D.tbl_advertisingimage_id),0);

SET FILE_SIZE = COALESCE((SELECT sum(D.tbl_file_size) from tbl_package_layout as A, tbl_package_layout_component as B, tbl_package_layout_component_playlist as C, tbl_file as D where A.tbl_package_id = PackageId and A.tbl_layout_id = B.tbl_layout_id and B.tbl_component_id = C.tbl_component_id and C.tbl_file_id = D.tbl_file_id),0);


SET  group_concat_max_len = 10000000;

SET JSON = (IMAGE_SIZE + FILE_SIZE);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPaymentServiceProvider` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPaymentServiceProvider`(paymentServiceProviderId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 


SELECT GROUP_CONCAT(
		CONCAT('"114.73":"',COALESCE(A.tbl_paymentserviceprovider_id,''),'"'),
	    CONCAT(',"121.72":"',COALESCE(A.tbl_paymentserviceprovider_name,''),'"'),
		CONCAT(',"123.64":"',COALESCE(A.tbl_paymentserviceprovidertype_id,''),'"')
		)
		
		from tbl_paymentserviceprovider as A

		where A.tbl_paymentserviceprovider_id = paymentServiceProviderId 
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPaymentServiceProviderUnsupported` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPaymentServiceProviderUnsupported`(unsupportedId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 


SELECT GROUP_CONCAT(
		CONCAT('"122.4":"',COALESCE(A.tbl_paymentserviceprovider_unsupported_id,''),'"'),
	    CONCAT(',"122.121":"',COALESCE(A.tbl_paymentserviceprovider_unsupported_providername,''),'"'),
		CONCAT(',"122.120":"',COALESCE(A.tbl_paymentserviceprovider_unsupported_contactname,''),'"'),
		CONCAT(',"114.156":"',COALESCE(A.tbl_paymentserviceprovider_unsupported_fileName,''),'"'),
		CONCAT(',"121.140":"',COALESCE(A.tbl_paymentserviceprovider_unsupported_dateCreated,''),'"'),
		CONCAT(',"123.64":"',COALESCE(A.tbl_paymentserviceprovidertype_id,''),'"'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(A.tbl_phone_id),'}')
		)
		
		from tbl_paymentserviceprovider_unsupported as A
		left join dbuser.tbl_phone as B on A.tbl_phone_id = B.tbl_phone_id

		where A.tbl_paymentserviceprovider_unsupported_id = unsupportedId 
);
		

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPermissionByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPermissionByUser`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
 
SELECT	GROUP_CONCAT( 

	   CONCAT('{"122.35":"',COALESCE(W.tbl_permission_id,''),'"') , 
       CONCAT(',"122.36":"',COALESCE(W.tbl_permission_name,''),'"'),
       CONCAT(',"CP":[',COALESCE(dbuser.getNMCSubPermissionByUser(W.tbl_user_id, W.tbl_permission_id),''),']}'))
	 
from (

select 
A.tbl_user_id,
B.tbl_permission_id,
B.tbl_permission_name
from tbl_permission_user as A 
left join tbl_permission as B on A.tbl_permission_id = B.tbl_permission_id
where A.tbl_user_id = UserId
and B.tbl_permission_status_f = 1
group by A.tbl_permission_id) as W

);
 

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPhone` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPhone`(phoneId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 

		CONCAT('{"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
		CONCAT( COALESCE( CONCAT(',"53":"',A.tbl_phone_nmcId,'"'),'')),
		CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
		CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
	    CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_phone_country_id),'}') ,
		CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"}'))  

		from tbl_phone AS A
		where A.tbl_phone_id = phoneId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPhoneByAdvertiser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPhoneByAdvertiser`(userId int) RETURNS text CHARSET utf8
BEGIN 
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 

		CONCAT('"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
		CONCAT( COALESCE( CONCAT(',"53":"',A.tbl_phone_nmcId,'"'),'')),
		CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
		CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
	    CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_phone_country_id),'}') ,
		CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"'))  

		from tbl_phone AS A
		where A.tbl_phone_nmcId = userId limit 1
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPhoneByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPhoneByUser`(userId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 

		CONCAT('{"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
		CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(A.tbl_phone_nmcId),''),'"'),
		CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
		CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
	    CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_phone_country_id),'}') ,
		CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"}'))  

		from tbl_phone AS A
		where A.tbl_phone_nmcId = userId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPhoneEcommerce` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPhoneEcommerce`(phoneId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 

		CONCAT('"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
		CONCAT( COALESCE( CONCAT(',"53":"',A.tbl_phone_nmcId,'"'),'')),
		CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
		CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
	    CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_phone_country_id),'}') ,
		CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"'))  

		from tbl_phone AS A
		where A.tbl_phone_id = phoneId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPhoneRoot` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPhoneRoot`(phoneId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 
 
		CONCAT('"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
		CONCAT( COALESCE( CONCAT(',"53":"',A.tbl_phone_nmcId,'"'),'')),
		CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
		CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
	    CONCAT(',"CO":{',dbuser.getNMCCountry(A.tbl_phone_country_id),'}') ,
		CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"'))  

		from tbl_phone AS A
		where A.tbl_phone_id = phoneId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCPOSLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCPOSLocation`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	    CONCAT('{"120.97":"',COALESCE(tbl_merchantpos.tbl_merchantpos_id ,''),'"'),
		CONCAT(',"121.184":"',COALESCE(tbl_merchantpos.tbl_merchantpos_contacProvider,''),'"'),
		CONCAT(',"121.186":"',COALESCE(tbl_merchantpos.tbl_merchantpos_contacName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_merchantpos.tbl_merchantpos_contacMail,''),'"'),
		CONCAT(',"114.47":"',COALESCE(tbl_locationpos.tbl_location_id,''),'"'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"114.179":"',COALESCE(tbl_locationpos.tbl_merchantpos_id,''),'"}'))
		
		from tbl_locationpos
			left join tbl_merchantpos on tbl_merchantpos.tbl_merchantpos_id = tbl_locationpos.tbl_merchantpos_id
			left join tbl_merchantposphone on tbl_merchantposphone.tbl_merchantpos_id=tbl_merchantpos.tbl_merchantpos_id
			left join tbl_phone on tbl_phone.tbl_phone_id = tbl_merchantposphone.tbl_phone_id
		where tbl_locationpos.tbl_location_id = locationId
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCProductLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCProductLocation`(productId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
  
	    CONCAT('{"114.47":"',COALESCE(tbl_location.tbl_location_id,''),'"'),
		CONCAT(',"114.70":"',COALESCE(tbl_location.tbl_location_storeName,''),'"'),
		CONCAT(',"122.119":"',COALESCE(tbl_location.tbl_location_storeNumber,''),'"'),
		CONCAT(',"114.143":"',COALESCE(tbl_location.tbl_location_statusId,''),'"'),
		CONCAT(',"114.53":"',COALESCE(tbl_location.tbl_location_contactName,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_location.tbl_location_contactEmail,''),'"'),
		CONCAT(',"120.39":"',COALESCE(tbl_location.tbl_location_longitude,''),'"'),
		CONCAT(',"120.38":"',COALESCE(tbl_location.tbl_location_latitude,''),'"'),
		CONCAT(',"AD":{',dbuser.getNMCAddress(tbl_address.tbl_address_id),'}'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone.tbl_phone_id),'}'),
		CONCAT(',"US":{',dbuser.getNMCUser(tbl_user.tbl_user_id),'}}'))
		
		from dbitems.tbl_productlocation,dbuser.tbl_location 
		left join dbuser.tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_address on  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
		left join dbuser.tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
		left join dbuser.tbl_phone on tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
		left join dbuser.tbl_user on tbl_user.tbl_user_id = tbl_location.tbl_location_userId
		where tbl_location.tbl_location_id = tbl_productlocation.tbl_location_id
		and tbl_productlocation.tbl_product_id = productId
        
        and tbl_address.tbl_addresstype_id != 13
        and (UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('https'),"%") 
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('http'),"%")
		and UPPER(tbl_location.tbl_location_storeName) not like CONCAT("%",UPPER('www'),"%"))
);
		
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCQRCodeLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCQRCodeLocation`(locationID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT 

GROUP_CONCAT(

	CONCAT('{"114.106":"',COALESCE(tbl_location_qrcode_id,''),'"'),
	CONCAT(',"114.102":"',COALESCE(tbl_location_qrcode_name,''),'"') ,
	CONCAT(',"114.103":"',COALESCE(tbl_location_qrcode_code,''),'"}'))

	from tbl_location_qrcode 
	where tbl_location_id = locationID
		
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerBreakdownTypesAccounts` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerBreakdownTypesAccounts`(ResellerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"127.73":"',COALESCE(tbl_breakdown_types_accounts_id,''),'"') , 
       CONCAT(',"127.74":"',COALESCE(tbl_reseller_breakdown_types_accounts_other,''),'"'),
	   CONCAT(',"127.75":"',COALESCE(tbl_number_of_merchants,''),'"}'))

	   from tbl_reseller_breakdown_types_accounts
	   where tbl_reseller_user_id = ResellerId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerCompaniesProvider` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerCompaniesProvider`(userId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT( 

		CONCAT('{"114.70":"',COALESCE(tbl_resellercompaniesprovider_companyName,''),'"'),
		CONCAT(',"122.140":"',COALESCE(tbl_resellercompaniesprovider_type,''),'"'),
		CONCAT(',"114.73":"',COALESCE(tbl_resellercompaniesprovider_id,''),'"'),
		CONCAT(',"114.3":"',COALESCE(tbl_resellercompaniesprovider_contactName,''),'"'),
		CONCAT(',"PH":{',dbuser.getNMCPhoneRoot(tbl_phone_id),'}') ,
		CONCAT(',"114.7":"',COALESCE(tbl_resellercompaniesprovider_contactEmail,''),'"}'))
		FROM tbl_resellercompaniesprovider
		WHERE tbl_reseller_nmcId = userId
 
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerFrontEndProcessors` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerFrontEndProcessors`(ResellerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"127.76":"',COALESCE(tbl_reseller_front_end_processor,''),'"') , 
       CONCAT(',"127.75":"',COALESCE(tbl_reseller_front_end_processor_number_of_merchants,''),'"}'))

	   from tbl_reseller_front_end_processor
	   where tbl_reseller_user_id = ResellerId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerFullTimeEmployees` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerFullTimeEmployees`(ResellerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"127.77":"',COALESCE(tbl_full_time_employees_id,''),'"') , 
       CONCAT(',"127.75":"',COALESCE(tbl_number_of_full_time_employees,''),'"}'))

	   from tbl_reseller_full_time_employees
	   where tbl_reseller_user_id = ResellerId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerMarketVerticals` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerMarketVerticals`(ResellerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"127.79":"',COALESCE(tbl_market_verticals_type_id,''),'"') , 
       CONCAT(',"127.80":"',COALESCE(tbl_market_verticals_type_other,''),'"'),
	   CONCAT(',"127.75":"',COALESCE(tbl_number_of_merchants,''),'"}'))

	   from tbl_reseller_market_verticals
	   where tbl_reseller_user_id = ResellerId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerMerchantEquipment` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerMerchantEquipment`(ResellerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"127.81":"',COALESCE(tbl_merchant_equipment_for_physical_location_id,''),'"') , 
       CONCAT(',"127.82":"',COALESCE(tbl_merchant_equipment_for_physical_location_other,''),'"'),
	   CONCAT(',"114.149":"',COALESCE(tbl_brand,''),'"'),
	   CONCAT(',"127.75":"',COALESCE(tbl_number_of_merchants,''),'"}'))

	   from tbl_reseller_merchant_equipment
	   where tbl_reseller_user_id = ResellerId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerMerchantsPerCountry` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerMerchantsPerCountry`(ResellerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"122.87":"',COALESCE(tbl_country_id,''),'"') , 
       CONCAT(',"127.75":"',COALESCE(tbl_merchants_per_country,''),'"}'))

	   from tbl_reseller_merchants_per_country
	   where tbl_reseller_user_id = ResellerId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCResellerWorkingWith` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCResellerWorkingWith`(ResellerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"127.78":"',COALESCE(tbl_working_resellers_id,''),'"') , 
       CONCAT(',"127.75":"',COALESCE(tbl_working_resellers_number,''),'"}'))

	   from tbl_resellers_working_with
	   where tbl_reseller_user_id = ResellerId 
);
 
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSavedItemByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSavedItemByCategory`(CategoryId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"120.157":"',COALESCE(hex(W.tbl_product_description),''),'"'),
            CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
            CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
            CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_description,
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
        A.tbl_product_dateadded
		from tbl_productfav as C, tbl_product as A, tbl_productcategory as B
		where C.tbl_productfav_nmcid = userId
		and B.tbl_category_id = CategoryId
		and C.tbl_product_id = A.tbl_product_id
		and A.tbl_product_id = B.tbl_product_id
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSavedItemCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSavedItemCounterByCategory`(CategoryId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from tbl_productfav as C, tbl_product as A, tbl_productcategory as B
	where C.tbl_productfav_nmcid = userId
	and B.tbl_category_id = CategoryId
	and C.tbl_product_id = A.tbl_product_id
	and A.tbl_product_id = B.tbl_product_id
    and A.tbl_producttype_id = 21
	and A.tbl_productstatus_id = 1001	
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSchedule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSchedule`(scheduleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
SELECT GROUP_CONCAT(

	   CONCAT('"127.63":"',COALESCE(A.tbl_schedule_id,''),'"'), 
	   CONCAT(',"114.138":"',COALESCE(A.tbl_schedule_startdate,''),'"'), 
       CONCAT(',"114.139":"',COALESCE(A.tbl_schedule_enddate,''),'"') , 
	   CONCAT(',"122.127":"',COALESCE(CONCAT(tbl_schedule_monday,tbl_schedule_tuesday,tbl_schedule_wendsday,tbl_schedule_thursday,tbl_schedule_friday,tbl_schedule_saturday,tbl_schedule_sunday),''),'"'),
	   CONCAT(',"127.64":"',COALESCE(A.tbl_schedule_starttime,''),'"'), 
	   CONCAT(',"127.65":"',COALESCE(A.tbl_schedule_endtime,''),'"'))

		from tbl_schedule AS A 
		where A.tbl_schedule_id = scheduleId 
		
);	

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCScheduleCatalog` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCScheduleCatalog`(catalogID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE JSON2 MEDIUMTEXT;
DECLARE JSONFINAL MEDIUMTEXT;


DECLARE DATESTART VARCHAR(20) DEFAULT NULL; 
DECLARE DATEEND VARCHAR(20) DEFAULT NULL; 		

SET  group_concat_max_len = 10000000;

set DATESTART = (select tbl_catalog_schedule_startDate from tbl_catalog_schedule where tbl_catalog_id =  catalogID limit 1);

	
set DATEEND = (select tbl_catalog_schedule_endDate from tbl_catalog_schedule where tbl_catalog_id =  catalogID limit 1);


SET JSON = ( 

SELECT 
 
GROUP_CONCAT(distinct
 
		CONCAT('{"127.89":"',COALESCE(tbl_week_day_id,''),'"') , 
		CONCAT(',"127.90":"',if(SUBSTR(tbl_24_hour,1,1) = 0,'false','true'),'"') , 	   
		CONCAT(',"127.91":"',if(SUBSTR(tbl_closed_flag,1,1) = 1,'true','false'),'"') ,
		CONCAT(',"127.64":"',COALESCE(tbl_hour_open,'00:00:00'),'"') ,
		CONCAT(',"127.65":"',COALESCE(tbl_hour_close,'00:00:00'),'"}'))

		from tbl_week_day left Join tbl_catalog_schedule on tbl_day_of_the_week = tbl_week_day_id
		and tbl_catalog_id = catalogID
	
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

IF DATESTART is NULL THEN
	SET DATESTART = UTC_DATE();
END IF;

IF DATEEND is NULL THEN
	SET DATEEND = '';
END IF;

SET JSONFINAL = (select GROUP_CONCAT(
				CONCAT(',"SP":{"114.138":"',coalesce(DATESTART),'"'),
				CONCAT(',"114.139":"',DATEEND,'"'),
				CONCAT(',"SL":[',JSON,']}'))
);

RETURN JSONFINAL;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCScheduleLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCScheduleLocation`(locationID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT 

GROUP_CONCAT(distinct
 
		CONCAT('{"127.89":"',COALESCE(tbl_day_of_the_week,''),'"') , 
		CONCAT(',"127.90":"',if(SUBSTR(tbl_24_hour,1,1) = 1,'true','false'),'"') , 	   
		CONCAT(',"127.91":"',if(SUBSTR(tbl_closed_flag,1,1) = 1,'true','false'),'"') ,
		CONCAT(',"127.64":"',COALESCE(tbl_hour_open,'00:00:00'),'"') ,
		CONCAT(',"127.65":"',COALESCE(tbl_hour_close,'00:00:00'),'"}'))

		from tbl_location_schedule 
		where tbl_location_id = locationID
		order by tbl_day_of_the_week asc
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCScheduleLocationTerminal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCScheduleLocationTerminal`(locationID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 
SELECT 


GROUP_CONCAT(distinct
 
		CONCAT('{"127.89":"',COALESCE(tbl_day_of_the_week,''),'"') , 
		CONCAT(',"127.90":"',if(SUBSTR(tbl_24_hour,1,1) = 1,'true','false'),'"') , 	   
		CONCAT(',"127.91":"',if(SUBSTR(tbl_closed_flag,1,1) = 1,'true','false'),'"') ,
        CONCAT(',"120.12":"',COALESCE(tbl_timezone,'+0000000000'),'"') ,
        CONCAT(',"127.64":"',COALESCE(tbl_hour_open,'00:00:00'),'"') ,
		CONCAT(',"127.65":"',COALESCE(tbl_hour_close,'00:00:00'),'"}'))

		-- CONCAT(',"127.64":"',COALESCE((select if ((select hour(tbl_hour_open))>16,SUBTIME((select addtime(tbl_hour_open,'08:00:00')),'24:00:00'),(select addtime(tbl_hour_open,'08:00:00')))),'00:00:00'),'"') ,
		-- CONCAT(',"127.65":"',COALESCE((select if ((select hour(tbl_hour_close))>16,SUBTIME((select addtime(tbl_hour_close,'08:00:00')),'24:00:00'),(select addtime(tbl_hour_close,'08:00:00')))),'00:00:00'),'"}'))

		from tbl_location_schedule 
		where tbl_location_id = locationID
	
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSchedulePackage` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSchedulePackage`(PackageID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE JSON2 MEDIUMTEXT;
DECLARE JSONFINAL MEDIUMTEXT;
 

DECLARE DATESTART VARCHAR(20) DEFAULT NULL; 
DECLARE DATEEND VARCHAR(20) DEFAULT NULL; 		

SET  group_concat_max_len = 10000000;

set DATESTART = (select tbl_package_schedule_startDate from tbl_package_schedule where tbl_package_id =  packageID limit 1);
set DATEEND = (select tbl_package_schedule_endDate from tbl_package_schedule where tbl_package_id =  packageID limit 1);


SET JSON = ( 

SELECT 
 
GROUP_CONCAT(distinct
 
		CONCAT('{"127.89":"',COALESCE(tbl_week_day_id,''),'"') , 
		CONCAT(',"127.90":"',if(SUBSTR(tbl_24_hour,1,1) = 1,'true','false'),'"') , 	   
		CONCAT(',"127.91":"',if(SUBSTR(tbl_closed_flag,1,1) = 1,'true','false'),'"') ,
		CONCAT(',"127.64":"',COALESCE(tbl_hour_open,'00:00:00'),'"') ,
		CONCAT(',"127.65":"',COALESCE(tbl_hour_close,'00:00:00'),'"}'))

		from tbl_week_day left Join tbl_package_schedule on tbl_day_of_the_week = tbl_week_day_id
		and tbl_package_id = PackageID
	
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

IF DATESTART is NULL THEN
	SET DATESTART = '';
END IF;

IF DATEEND is NULL THEN
	SET DATEEND = '';
END IF;

SET JSONFINAL = (select GROUP_CONCAT(
				CONCAT(',"SP":{"114.138":"',DATESTART,'"'),
				CONCAT(',"114.139":"',DATEEND,'"'),
				CONCAT(',"SL":[',JSON,']}'))
);

RETURN JSONFINAL;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCScheduleProduct` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCScheduleProduct`(productID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE JSON2 MEDIUMTEXT;
DECLARE JSONFINAL MEDIUMTEXT;


DECLARE DATESTART VARCHAR(20) DEFAULT NULL; 
DECLARE DATEEND VARCHAR(20) DEFAULT NULL; 		

SET  group_concat_max_len = 10000000;

set DATESTART = (select tbl_product_schedule_startDate from tbl_product_schedule where tbl_product_id =  productID limit 1);
set DATEEND = (select tbl_product_schedule_endDate from tbl_product_schedule where tbl_product_id =  productID limit 1);


SET JSON = ( 

SELECT 
 
GROUP_CONCAT(distinct
 
		CONCAT('{"127.89":"',COALESCE(tbl_week_day_id,''),'"') , 
		CONCAT(',"127.90":"',if(SUBSTR(tbl_24_hour,1,1) = 0,'false','true'),'"') , 	   
		CONCAT(',"127.91":"',if(SUBSTR(tbl_closed_flag,1,1) = 1,'true','false'),'"') ,
		CONCAT(',"120.12":"',COALESCE(tbl_timezone,'+0000000000'),'"') ,
        CONCAT(',"127.64":"',COALESCE(tbl_hour_open,'00:00:00'),'"') ,
		CONCAT(',"127.65":"',COALESCE(tbl_hour_close,'00:00:00'),'"}'))

		
		
		from tbl_week_day left Join tbl_product_schedule on tbl_day_of_the_week = tbl_week_day_id	
		and  tbl_product_id = productID
	
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;


IF DATESTART is NULL THEN
	SET DATESTART = UTC_DATE();
END IF;

IF DATEEND is NULL THEN
	SET DATEEND = '';
END IF;

SET JSONFINAL = (select GROUP_CONCAT(
				CONCAT(',"SP":{"114.138":"',DATESTART,'"'),
				CONCAT(',"114.139":"',DATEEND,'"'),
				CONCAT(',"SL":[',JSON,']}'))
);

RETURN JSONFINAL;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCScheduleProductOffer` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCScheduleProductOffer`(productID int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE JSON2 MEDIUMTEXT;
DECLARE JSONFINAL MEDIUMTEXT;


DECLARE DATESTART VARCHAR(20) DEFAULT NULL; 
DECLARE DATEEND VARCHAR(20) DEFAULT NULL; 		

SET  group_concat_max_len = 10000000;

set DATESTART = (select tbl_start_date from tbl_productoffer_schedule where tbl_product_id =  productID limit 1);
set DATEEND = (select tbl_end_date from tbl_productoffer_schedule where tbl_product_id =  productID limit 1);


SET JSON = ( 

SELECT 
 
GROUP_CONCAT(distinct
 
		CONCAT('{"127.89":"',COALESCE(tbl_week_day_id,''),'"') , 
		CONCAT(',"127.90":"',if(SUBSTR(tbl_24_hour,1,1) = 0,'false','true'),'"') , 	   
		CONCAT(',"127.91":"',if(SUBSTR(tbl_closed_flag,1,1) = 1,'true','false'),'"') ,
        CONCAT(',"120.12":"',COALESCE(tbl_timezone,'+0000000000'),'"') ,
		CONCAT(',"127.64":"',COALESCE(tbl_hour_open,'00:00:00'),'"') ,
		CONCAT(',"127.65":"',COALESCE(tbl_hour_close,'00:00:00'),'"}'))

		
		
		from tbl_week_day left Join tbl_productoffer_schedule on tbl_day_of_the_week = tbl_week_day_id	
		and  tbl_product_id = productID
	
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;


IF DATESTART is NULL THEN
	SET DATESTART = UTC_DATE();
END IF;

IF DATEEND is NULL THEN
	SET DATEEND = '';
END IF;

SET JSONFINAL = (select GROUP_CONCAT(
				CONCAT(',"SO":{"114.138":"',DATESTART,'"'),
				CONCAT(',"114.139":"',DATEEND,'"'),
				CONCAT(',"SL":[',JSON,']}'))
);

RETURN JSONFINAL;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCScheduleShuffle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCScheduleShuffle`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE JSON2 MEDIUMTEXT;
DECLARE JSONFINAL MEDIUMTEXT;
 

DECLARE DATESTART VARCHAR(20) DEFAULT NULL; 
DECLARE DATEEND VARCHAR(20) DEFAULT NULL; 		

SET  group_concat_max_len = 10000000;

set DATESTART = (select tbl_shuffle_schedule_startDate from tbl_shuffle_schedule where tbl_shuffle_id =  shuffleID limit 1);
set DATEEND = (select tbl_shuffle_schedule_endDate from tbl_shuffle_schedule where tbl_shuffle_id =  shuffleID limit 1);


SET JSON = ( 

SELECT 
 
GROUP_CONCAT(distinct
 
		CONCAT('{"127.89":"',COALESCE(tbl_week_day_id,''),'"') , 
		CONCAT(',"127.90":"',COALESCE(tbl_24_hour,'false'),'"') , 	   
		CONCAT(',"127.91":"',COALESCE(tbl_closed_flag,'true'),'"') ,
		CONCAT(',"120.12":"',COALESCE(tbl_timezone,'+0000000000'),'"') ,
		CONCAT(',"127.64":"',COALESCE(tbl_hour_open,'09:00:00'),'"') ,
		CONCAT(',"127.65":"',COALESCE(tbl_hour_close,'21:00:00'),'"}'))
        
		from tbl_week_day left Join tbl_shuffle_schedule on tbl_day_of_the_week = tbl_week_day_id
		and tbl_shuffle_id = ShuffleId
	
	
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

IF DATESTART is NULL THEN
	SET DATESTART = '';
END IF;

IF DATEEND is NULL THEN
	SET DATEEND = '';
END IF;

SET JSONFINAL = (select GROUP_CONCAT(
				CONCAT(',"SP":{"114.138":"',DATESTART,'"'),
				CONCAT(',"114.139":"',DATEEND,'"'),
				CONCAT(',"SL":[',JSON,']}'))
);

RETURN JSONFINAL;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetNMCShoppingCartTotalAmount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetNMCShoppingCartTotalAmount`(shoppingCartId int) RETURNS mediumtext CHARSET utf8
BEGIN


DECLARE JSON TEXT DEFAULT NULL;

DECLARE de_ITEM TEXT DEFAULT NULL;
DECLARE de_ITEMPRICE TEXT DEFAULT NULL;
DECLARE de_QUANTITY TEXT DEFAULT NULL;
DECLARE de_CHOICES TEXT DEFAULT NULL;

DECLARE ITEM_ID INT(11) DEFAULT NULL;
DECLARE ITEM_PRICE DECIMAL(15,2) DEFAULT 0.00;
DECLARE ITEM_QTY INT(11) DEFAULT NULL;
DECLARE CADENACHOICES TEXT DEFAULT NULL;
DECLARE CHOICE_ID INT(11) DEFAULT NULL;
DECLARE CHOICEPRICE DECIMAL(15,2) DEFAULT 0.00;
DECLARE CHOICEAMOUNT DECIMAL(15,2) DEFAULT 0.00;

DECLARE ITEMAMOUNT DECIMAL(15,2) DEFAULT 0.00;
DECLARE TOTALAMOUNT DECIMAL(15,2) DEFAULT 0.00;


SET  group_concat_max_len = 10000000;


set de_ITEM = (select GROUP_CONCAT(CONCAT('',tbl_product_id,'|'))
				from dbitems.tbl_shoppingcartdetail 
				where tbl_shoppingcart_id = shoppingCartId
				);
                
set de_QUANTITY = (select GROUP_CONCAT(CONCAT('',tbl_shoppingcartdetail_quantity,'|'))
				from dbitems.tbl_shoppingcartdetail 
				where tbl_shoppingcart_id = shoppingCartId
				);
                
set de_CHOICES = (select GROUP_CONCAT(CONCAT('',tbl_shoppingcartdetail_choice,'|'))
				from dbitems.tbl_shoppingcartdetail 
				where tbl_shoppingcart_id = shoppingCartId
				);


set de_ITEMPRICE = (select GROUP_CONCAT(CONCAT('',B.tbl_product_salePrice,'|'))
				from dbitems.tbl_shoppingcartdetail as A 
                left join dbitems.tbl_product as B on A.tbl_product_id = B.tbl_product_id
				where A.tbl_shoppingcart_id = shoppingCartId
				);

set de_ITEM = REPLACE(de_ITEM,'|,','|');
set de_ITEMPRICE = REPLACE(de_ITEMPRICE,'|,','|');
set de_QUANTITY = REPLACE(de_QUANTITY,'|,','|');
set de_CHOICES = REPLACE(de_CHOICES,'|,','|');

/*
SET JSON = (select GROUP_CONCAT(
				CONCAT('---ITEM:',de_ITEM,''),
                CONCAT('---PRICE:',de_ITEMPRICE,''),
                CONCAT('---QUANTITY:',de_QUANTITY,''),
                CONCAT('---CHOICES:',de_CHOICES,'')
			));
*/

WHILE (LENGTH(de_ITEM)>0) DO
		
	SET ITEM_ID = TRIM((SELECT SUBSTR(de_ITEM,1,LOCATE('|',de_ITEM)-1)));
	SET de_ITEM = (SELECT SUBSTR(de_ITEM,LOCATE('|',de_ITEM)+1));

	SET ITEM_PRICE = TRIM((SELECT SUBSTR(de_ITEMPRICE,1,LOCATE('|',de_ITEMPRICE)-1)));
	SET de_ITEMPRICE = (SELECT SUBSTR(de_ITEMPRICE,LOCATE('|',de_ITEMPRICE)+1));

	SET ITEM_QTY = TRIM((SELECT SUBSTR(de_QUANTITY,1,LOCATE('|',de_QUANTITY)-1)));
	SET de_QUANTITY = (SELECT SUBSTR(de_QUANTITY,LOCATE('|',de_QUANTITY)+1));

	SET CADENACHOICES = TRIM((SELECT SUBSTR(de_CHOICES,1,LOCATE('|',de_CHOICES)-1)));
	SET de_CHOICES = (SELECT SUBSTR(de_CHOICES,LOCATE('|',de_CHOICES)+1));

	set CADENACHOICES = REPLACE(CADENACHOICES,',','|');
    set CADENACHOICES = CONCAT(CADENACHOICES,'|');
	SET CHOICEAMOUNT = 0.00;
    
	WHILE (LENGTH(CADENACHOICES)>0) DO
		
        SET CHOICE_ID = 0;
        SET CHOICEPRICE = 0.00;
        
		SET CHOICE_ID = COALESCE(TRIM((SELECT SUBSTR(CADENACHOICES,1,LOCATE('|',CADENACHOICES)-1))),0);
		SET CADENACHOICES = (SELECT SUBSTR(CADENACHOICES,LOCATE('|',CADENACHOICES)+1));
		
		if CHOICE_ID = 0 then
			SET CHOICEPRICE = 0.00;
        else
			SET CHOICEPRICE = COALESCE((select tbl_productattribute_optionValuePrice from dbitems.tbl_productattribute where tbl_productoptionvalue_id = CHOICE_ID),0.00);
		end if;
		
		SET CHOICEAMOUNT = CHOICEAMOUNT + CHOICEPRICE;
		
    END WHILE;
    
	SET ITEMAMOUNT = (ITEM_PRICE + CHOICEAMOUNT) * ITEM_QTY;
    SET TOTALAMOUNT = TOTALAMOUNT + ITEMAMOUNT;

END WHILE;

SET JSON = TOTALAMOUNT;

IF JSON IS NULL THEN
	SET JSON = '0.00';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCShuffleByPackageID` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCShuffleByPackageID`(PackageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;


		SET JSON = ( 

		SELECT GROUP_CONCAT(distinct

			   CONCAT('{"127.107":"',COALESCE(B.tbl_shuffle_id,''),'"'), 
			   CONCAT(',"127.112":"',if ((B.tbl_shuffle_broadcast_mobile= 1),'true','false'),'"'),
			   CONCAT(',"127.94":"',if ((B.tbl_shuffle_published= 1),'true','false'),'"'),
               CONCAT(',"127.117":"',COALESCE(B.tbl_shuffle_republished_count,''),'"'), 
			   CONCAT(dbitems.getNMCScheduleshuffle(B.tbl_shuffle_id )),
			   CONCAT(',"CA":[',dbitems.getNMCCategoryByshuffle(B.tbl_shuffle_id ),']'),
			   CONCAT(',"AR":{',dbitems.getNMCAdvertiser(A.tbl_package_usernmcid),'}'),
			   CONCAT(',"LO":[',dbuser.getNMCLocationByShuffleId(B.tbl_shuffle_id ),']'),
			   CONCAT(',"LZ":[',dbitems.getNMCLocalizationShuffleByshuffleId(B.tbl_shuffle_id ),']'),
			   CONCAT(',"PA":[',dbitems.getNMCAdvertisingByShufflePortal(B.tbl_shuffle_id ),']'),
			   CONCAT(',"TE":[',dbitems.getNMCTerminalByshuffle(B.tbl_shuffle_id),']'),
			   CONCAT(',"48.6":"',COALESCE(B.tbl_shuffle_name,''),'"}'))
 
			   from tbl_package as A, tbl_package_shuffle as B
			   where A.tbl_package_id = B.tbl_package_id
			   and B.tbl_package_id = PackageId
			   
			   
			   );
	
 

IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCShuffleTerminalCount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCShuffleTerminalCount`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON INTEGER(11) DEFAULT 0;

SET  group_concat_max_len = 10000000;


		SET JSON = ( 

			SELECT count(distinct Q.tbl_terminal_id)
			from (

			SELECT distinct

			tbl_advertisingfavorite.tbl_terminal_id
			FROM dbitems.tbl_advertisingfavorite
			LEFT JOIN dbitems.tbl_shuffleterminal on tbl_advertisingfavorite.tbl_terminal_id = tbl_shuffleterminal.tbl_terminal_id
			where tbl_shuffleterminal.tbl_shuffle_id  = shuffleId

			union

			SELECT distinct
			tbl_advertisingfavorite.tbl_terminal_id			
			FROM dbitems.tbl_advertisingfavorite 
			LEFT JOIN dbitems.tbl_shufflelocation on tbl_advertisingfavorite.tbl_location_id = tbl_shufflelocation.tbl_location_id
			where tbl_shufflelocation.tbl_shuffle_id  = shuffleId
			and  tbl_shufflelocation.tbl_shufflelocation_allterminal_f = 1



			) AS Q
				);
	
	
	
	
IF JSON IS NULL THEN
	SET JSON = '0';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCStateByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCStateByUser`(userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE JSON2 MEDIUMTEXT;

SET  group_concat_max_len = 10000000;
SET JSON = ( 

select G.tbl_state_name 
from tbl_address AS F 
left join tbl_state as G on F.tbl_state_id = G.tbl_state_id 
where F.tbl_address_nmcId = userId
and F.tbl_address_flag = 1
and F.tbl_address_active = 1
limit 1

);

SET JSON2 = ( 

select G.tbl_state_name 
from tbl_address AS F 
left join tbl_state as G on F.tbl_state_id = G.tbl_state_id 
where F.tbl_address_nmcId = userId
limit 1

);

IF JSON2 is NULL THEN
	SET JSON2 = '';
END IF;


IF JSON is NULL THEN
	SET JSON = JSON2;
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCStateList` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCStateList`(countryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('{"120.13":"',COALESCE(tbl_state_id,''),'"') , 
       CONCAT(',"47.16":"',COALESCE(tbl_state_name,''),'"'), 
       CONCAT(',"122.87":"',COALESCE(tbl_country_id,''),'"}'))
	 
	   from tbl_state
	   where tbl_country_id = countryId 
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCStates` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCStates`(statesId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(

	   CONCAT('"120.13":"',COALESCE(tbl_state_id,''),'",') , 
       CONCAT('"123.4":"',COALESCE(tbl_state_code,''),'",'), 
       CONCAT('"47.16":"',COALESCE(tbl_state_name,''),'",'), 
       CONCAT('"122.87":"',COALESCE(tbl_country_id,''),'"'))
	 
	   from tbl_state
	   where tbl_state_id = statesId 
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSubcategoryCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSubcategoryCounterByCategory`(CategoryId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(E.tbl_category_id) 
    from tbl_category as E 
    where E.tbl_category_parentid = CategoryId 
    and E.tbl_category_active = 1
	
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSubcategoryFavCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSubcategoryFavCounterByCategory`(CategoryId int, UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(B.tbl_category_parentId) 
    from tbl_favorite_category as A, tbl_category as B 
    where A.tbl_favorite_category_user_id = UserId  
    and B.tbl_category_parentId = CategoryId
    and B.tbl_category_id = A.tbl_favorite_category_category_id 
    
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSubPermissionByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` FUNCTION `getNMCSubPermissionByUser`(UserId int, PermissionId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
 
SELECT	GROUP_CONCAT( 

	   CONCAT('{"122.37":"',COALESCE(W.tbl_subpermission_id,''),'"') , 
	   CONCAT(',"122.3":"',COALESCE(W.tbl_subpermission_portal_id,''),'"') , 
	   CONCAT(',"122.38":"',COALESCE(W.tbl_subpermission_name,''),'"') , 
       CONCAT(',"114.9":"',COALESCE(if(W.tbl_permission_user_status_f=1,'true','false'),'false'),'"}'))
	 
from 
(select B.tbl_subpermission_id, 
B.tbl_subpermission_portal_id, 
B.tbl_subpermission_name, 
A.tbl_permission_user_status_f
from tbl_permission_user as A 
left join tbl_subpermission as B on A.tbl_subpermission_id = B.tbl_subpermission_id
where A.tbl_user_id = UserId
and A.tbl_permission_id = PermissionId
and B.tbl_subpermission_status_f = 1
order by B.tbl_subpermission_order ASC
) as W

);
 

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSubscription` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSubscription`(subscriptionId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
             CONCAT('"122.116":"',COALESCE(B.tbl_subscription_id,''),'"'),
			 CONCAT(',"122.151":"',COALESCE(B.tbl_subscriptiontype_id,''), '"'),
			 CONCAT(',"114.123":"',COALESCE(B.tbl_subscriptionaccounttype_id,''),'"'), 
             CONCAT(',"121.43":"',COALESCE(B.tbl_subscription_payment_due,''),'"'),
             CONCAT(',"121.73":"',COALESCE(B.tbl_subscriptionrate_id,''),'"'),
             CONCAT(',"120.70":"',COALESCE(B.tbl_subscriptionid_required,''),'"'),
             CONCAT(',"120.83":"',COALESCE(B.tbl_subscription_item_title,''),'"'),
             CONCAT(',"120.157":"',COALESCE(hex(B.tbl_subscription_item_description),''),'"'),
             CONCAT(',"122.163":"',COALESCE(B.tbl_subscription_minimum_price,''),'"'),
             CONCAT(',"122.164":"',COALESCE(B.tbl_subscription_maximum_price,''),'"'),
             CONCAT(',"120.84":"',COALESCE(B.tbl_subscription_recommended_price,''),'"'),
             CONCAT(',"122.154":"',COALESCE(B.tbl_subscription_flat_commission,''),'"'),
             CONCAT(',"122.165":"',COALESCE(B.tbl_subscription_flat_commission_quantity,''),'"'),
             CONCAT(',"122.155":"',COALESCE(B.tbl_subscription_residual_reseller,''),'"'),
             CONCAT(',"122.166":"',COALESCE(B.tbl_subscription_residual_reseller_quantity,''),'"'),
             CONCAT(',"122.156":"',COALESCE(B.tbl_subscription_iso_residual,''),'"'),
			 CONCAT(',"122.167":"',COALESCE(B.tbl_subscription_iso_residual_quantity,''),'"'),
			 CONCAT(',"122.157":"',COALESCE(B.tbl_subscription_pos_residual,''),'"'),
			 CONCAT(',"122.168":"',COALESCE(B.tbl_subscription_pos_residual_quantity,''),'"'),
             CONCAT(',"122.90":"',COALESCE(B.tbl_subscription_transaction_fee,''),'"'), 
             CONCAT(',"122.161":"',COALESCE(B.tbl_subscription_transaction_fee_quantity,''),'"'),
             CONCAT(',"122.139":"',COALESCE(hex(B.tbl_subscription_item_functions),''),'"'),
			 CONCAT(',"114.143":"',COALESCE(B.tbl_subscription_status,''),'"'))

			 from tbl_subscription as B
			 where B.tbl_subscription_id = subscriptionId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSubscriptionByLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSubscriptionByLocation`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
			 CONCAT('"121.141":"',COALESCE(W.tbl_usersubscription_date_expiration,''),'"'),
             CONCAT(',"122.116":"',COALESCE(W.tbl_subscription_id,''),'"'),
			 CONCAT(',"122.151":"',COALESCE(W.tbl_subscriptiontype_id,''), '"'),
			 CONCAT(',"114.123":"',COALESCE(W.tbl_subscriptionaccounttype_id,''),'"'), 
             CONCAT(',"121.43":"',COALESCE(W.tbl_subscription_payment_due,''),'"'),
             CONCAT(',"121.73":"',COALESCE(W.tbl_subscriptionrate_id,''),'"'),
             CONCAT(',"120.70":"',COALESCE(W.tbl_subscriptionid_required,''),'"'),
             CONCAT(',"120.83":"',COALESCE(W.tbl_subscription_item_title,''),'"'),
             CONCAT(',"120.157":"',COALESCE(hex(W.tbl_subscription_item_description),''),'"'),
             CONCAT(',"122.163":"',COALESCE(W.tbl_subscription_minimum_price,''),'"'),
             CONCAT(',"122.164":"',COALESCE(W.tbl_subscription_maximum_price,''),'"'),
             CONCAT(',"120.84":"',COALESCE(W.tbl_subscription_recommended_price,''),'"'),
             CONCAT(',"122.154":"',COALESCE(W.tbl_subscription_flat_commission,''),'"'),
             CONCAT(',"122.165":"',COALESCE(W.tbl_subscription_flat_commission_quantity,''),'"'),
             CONCAT(',"122.155":"',COALESCE(W.tbl_subscription_residual_reseller,''),'"'),
             CONCAT(',"122.166":"',COALESCE(W.tbl_subscription_residual_reseller_quantity,''),'"'),
             CONCAT(',"122.156":"',COALESCE(W.tbl_subscription_iso_residual,''),'"'),
			 CONCAT(',"122.167":"',COALESCE(W.tbl_subscription_iso_residual_quantity,''),'"'),
			 CONCAT(',"122.157":"',COALESCE(W.tbl_subscription_pos_residual,''),'"'),
			 CONCAT(',"122.168":"',COALESCE(W.tbl_subscription_pos_residual_quantity,''),'"'),
             CONCAT(',"122.90":"',COALESCE(W.tbl_subscription_transaction_fee,''),'"'), 
             CONCAT(',"122.161":"',COALESCE(W.tbl_subscription_transaction_fee_quantity,''),'"'),
             CONCAT(',"122.139":"',COALESCE(hex(W.tbl_subscription_item_functions),''),'"'),
			 CONCAT(',"114.143":"',COALESCE(W.tbl_subscription_status,''),'"')
			 )

			 from 
             
				(select A.tbl_usersubscription_date_expiration,
				B.tbl_subscription_id,
				B.tbl_subscriptiontype_id,
				B.tbl_subscriptionaccounttype_id,
				B.tbl_subscription_payment_due,
				B.tbl_subscriptionrate_id,
				B.tbl_subscriptionid_required,
				B.tbl_subscription_item_title,
				B.tbl_subscription_item_description,
				B.tbl_subscription_minimum_price,
				B.tbl_subscription_maximum_price,
				B.tbl_subscription_recommended_price,
				B.tbl_subscription_flat_commission,
				B.tbl_subscription_flat_commission_quantity,
				B.tbl_subscription_residual_reseller,
				B.tbl_subscription_residual_reseller_quantity,
				B.tbl_subscription_iso_residual,
				B.tbl_subscription_iso_residual_quantity,
				B.tbl_subscription_pos_residual,
				B.tbl_subscription_pos_residual_quantity,
				B.tbl_subscription_transaction_fee,
				B.tbl_subscription_transaction_fee_quantity,
				B.tbl_subscription_item_functions,
				B.tbl_subscription_status
				from tbl_usersubscription as A 
				left join tbl_subscription as B on A.tbl_subscription_id = B.tbl_subscription_id
				where A.tbl_location_id = locationId
				order by A.tbl_usersubscription_date_expiration DESC
				limit 1) as W
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCSubscriptionHardware` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCSubscriptionHardware`(subscriptionId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(
             CONCAT('"122.116":""'),
			 CONCAT(',"122.151":""'),
			 CONCAT(',"114.123":""'), 
             CONCAT(',"121.43":""'),
             CONCAT(',"121.73":""'),
             CONCAT(',"120.70":""'),
             CONCAT(',"120.83":"',COALESCE(B.tbl_hardware_type_name,''),'"'),
             CONCAT(',"120.157":""'),
             CONCAT(',"122.163":""'),
             CONCAT(',"122.164":""'),
             CONCAT(',"120.84":"',COALESCE(B.tbl_hardware_type_price,''),'"'),
             CONCAT(',"122.154":""'),
             CONCAT(',"122.165":""'),
             CONCAT(',"122.155":""'),
             CONCAT(',"122.166":""'),
             CONCAT(',"122.156":""'),
			 CONCAT(',"122.167":""'),
			 CONCAT(',"122.157":""'),
			 CONCAT(',"122.168":""'),
             CONCAT(',"122.90":""'), 
             CONCAT(',"122.161":""'),
             CONCAT(',"122.139":""'),
			 CONCAT(',"114.143":""'))

			 from dbuser.tbl_hardware_type as B
			 where B.tbl_hardware_type_id = subscriptionId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCTerminal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCTerminal`(TerminalId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
 

		SET JSON = ( 

			SELECT GROUP_CONCAT(distinct
				CONCAT('{"120.69":"',COALESCE(tbl_terminal_id,''),'"') ,
				CONCAT(',"122.170":"',COALESCE(tbl_terminaltype_id,''),'"') ,
				CONCAT(',"122.123":"',COALESCE(tbl_terminal_manofacturer,''),'"') ,
				CONCAT(',"121.183":"',COALESCE(tbl_terminal_posTerminalId,''),'"') ,
				CONCAT(',"122.124":"',COALESCE(tbl_terminal_provider,''),'"') ,
				CONCAT(',"122.125":"',COALESCE(tbl_terminal_posInternalId,''),'"') ,
				CONCAT(',"122.126":"',COALESCE(tbl_terminal_reference,''),'"'),
				CONCAT(',"114.104":"',COALESCE(tbl_terminal_qrCode,''),'"'),
				CONCAT(',"121.141":"',COALESCE(tbl_terminal_lastDateActive,''),'"}') )


			from dbuser.tbl_terminal 
			where tbl_terminal_id  = TerminalId

				);
	



IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCTerminal3` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCTerminal3`(TerminalId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
 

		SET JSON = ( 

			SELECT GROUP_CONCAT(distinct
				CONCAT('"120.69":"',COALESCE(tbl_terminal_id,''),'"') ,
				CONCAT(',"122.170":"',COALESCE(tbl_terminaltype_id,''),'"') ,
				CONCAT(',"122.123":"',COALESCE(tbl_terminal_manofacturer,''),'"') ,
				CONCAT(',"121.183":"',COALESCE(tbl_terminal_posTerminalId,''),'"') ,
				CONCAT(',"122.124":"',COALESCE(tbl_terminal_provider,''),'"') ,
				CONCAT(',"122.125":"',COALESCE(tbl_terminal_posInternalId,''),'"') ,
				CONCAT(',"122.126":"',COALESCE(tbl_terminal_reference,''),'"'),
				CONCAT(',"114.104":"',COALESCE(tbl_terminal_qrCode,''),'"') ,
				CONCAT(',"121.141":"',COALESCE(tbl_terminal_lastDateActive,''),'"') )

			from dbuser.tbl_terminal 
			where tbl_terminal_id  = TerminalId

				);
	

IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCTerminalById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCTerminalById`(TerminalId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
 

		SET JSON = ( 

			SELECT GROUP_CONCAT(distinct
				CONCAT('{"120.69":"',COALESCE(tbl_terminal_id,''),'"') ,
				CONCAT(',"122.170":"',COALESCE(tbl_terminaltype_id,''),'"') ,
				CONCAT(',"122.123":"',COALESCE(tbl_terminal_manofacturer,''),'"') ,
				CONCAT(',"121.183":"',COALESCE(tbl_terminal_posTerminalId,''),'"') ,
				CONCAT(',"122.124":"',COALESCE(tbl_terminal_provider,''),'"') ,
				CONCAT(',"122.125":"',COALESCE(tbl_terminal_posInternalId,''),'"') ,
				CONCAT(',"122.126":"',COALESCE(tbl_terminal_reference,''),'"'),
				CONCAT(',"114.104":"',COALESCE(tbl_terminal_qrCode,''),'"}') )

			from dbuser.tbl_terminal 
			where tbl_terminal_id  = TerminalId

				);
	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCTerminalByShuffle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCTerminalByShuffle`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
 
		SET JSON = ( 

			SELECT GROUP_CONCAT(distinct
			CONCAT('{"114.47":"',COALESCE(Q.tbl_location_id ,''),'"'), 
			CONCAT(',"120.69":"',COALESCE(Q.tbl_terminal_id,''),'"') ,
			CONCAT(',"122.170":"',COALESCE(Q.tbl_terminaltype_id,''),'"') ,
			CONCAT(',"122.123":"',COALESCE(Q.tbl_terminal_manofacturer,''),'"') ,
			CONCAT(',"123.67":"',COALESCE(Q.tbl_terminalposition_id,''),'"') ,
			CONCAT(',"121.183":"',COALESCE(Q.tbl_terminal_posTerminalId,''),'"') ,
			CONCAT(',"122.124":"',COALESCE(Q.tbl_terminal_provider,''),'"') ,
			CONCAT(',"122.125":"',COALESCE(Q.tbl_terminal_posInternalId,''),'"') ,
			CONCAT(',"122.126":"',COALESCE(Q.tbl_terminal_reference,''),'"'),
            CONCAT(',"121.141":"',COALESCE(Q.tbl_terminal_lastDateActive,''),'"'),
			CONCAT(',"114.9":"',COALESCE(if(Q.tbl_terminal_update_f=1,'true','false'),''),'"'),
			CONCAT(',"114.104":"',COALESCE(Q.tbl_terminal_qrCode,''),'"}') )


			from (

			SELECT distinct

			tbl_terminal.tbl_location_id,
			tbl_terminal.tbl_terminal_id,
			tbl_terminal.tbl_terminaltype_id,
			tbl_terminal.tbl_terminal_manofacturer,
			tbl_terminal.tbl_terminal_posTerminalId,
			tbl_terminal.tbl_terminal_provider,
			tbl_terminal.tbl_terminal_posInternalId,
			tbl_terminal.tbl_terminal_reference,
            tbl_terminal.tbl_terminal_lastDateActive,
			tbl_terminal.tbl_terminal_update_f,
			tbl_terminal.tbl_terminal_qrCode,
			tbl_terminal.tbl_terminalposition_id

			FROM dbuser.tbl_terminal LEFT JOIN dbitems.tbl_shuffleterminal on tbl_terminal.tbl_terminal_id = tbl_shuffleterminal.tbl_terminal_id

			where tbl_shuffleterminal.tbl_shuffle_id  = shuffleId

			union

			SELECT distinct

			tbl_terminal.tbl_location_id,
			tbl_terminal.tbl_terminal_id,
			tbl_terminal.tbl_terminaltype_id,
			tbl_terminal.tbl_terminal_manofacturer,
			tbl_terminal.tbl_terminal_posTerminalId,
			tbl_terminal.tbl_terminal_provider,
			tbl_terminal.tbl_terminal_posInternalId,
			tbl_terminal.tbl_terminal_reference,
            tbl_terminal.tbl_terminal_lastDateActive,
			tbl_terminal.tbl_terminal_update_f,
			tbl_terminal.tbl_terminal_qrCode,
			tbl_terminal.tbl_terminalposition_id

			FROM dbuser.tbl_terminal LEFT JOIN dbitems.tbl_shufflelocation on tbl_terminal.tbl_location_id = tbl_shufflelocation.tbl_location_id

			where tbl_shufflelocation.tbl_shuffle_id  = shuffleId
			and  tbl_shufflelocation_allterminal_f = 1



			) AS Q
				);
	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCTerminalGCMByShuffle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCTerminalGCMByShuffle`(shuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE ENTITYAUX VARCHAR(4);
DECLARE PACKAGE_ID INTEGER(11);
DECLARE PACKAGE_POS INTEGER(11);
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
  
    set PACKAGE_ID = (select tbl_package_id from dbitems.tbl_package_shuffle where tbl_shuffle_id = shuffleId limit 1);
	set PACKAGE_POS = (select tbl_layout_position from dbitems.tbl_package_layout where tbl_package_id = PACKAGE_ID limit 1);
  
	SET JSON = ( 

		SELECT GROUP_CONCAT(distinct
		CONCAT('{"120.69":"',COALESCE(Q.tbl_terminal_id ,''),'"'), 
		CONCAT(',"122.12":"',COALESCE(Q.tbl_terminal_gcm,''),'"}') )

		from (

			SELECT distinct
			tbl_terminal.tbl_terminal_id,			
			tbl_terminal_gcm
			FROM dbuser.tbl_terminal 
            LEFT JOIN dbitems.tbl_shuffleterminal on tbl_terminal.tbl_terminal_id = tbl_shuffleterminal.tbl_terminal_id
			where tbl_shuffleterminal.tbl_shuffle_id  = shuffleId
            and tbl_terminal_gcm is not null
			and tbl_terminalposition_id = PACKAGE_POS

			union

			SELECT distinct
			tbl_terminal.tbl_terminal_id,
			tbl_terminal_gcm
			FROM dbuser.tbl_terminal 
			LEFT JOIN dbitems.tbl_shufflelocation on tbl_terminal.tbl_location_id = tbl_shufflelocation.tbl_location_id
			where tbl_shufflelocation.tbl_shuffle_id  = shuffleId
			and  tbl_shufflelocation_allterminal_f = 1
			and tbl_terminal_gcm is not null
			and tbl_terminalposition_id = PACKAGE_POS
			
			) AS Q
				);
	


IF JSON is NULL THEN
	SET JSON = '';
END IF;


RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCUser`(userId int) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
	-- User
SELECT GROUP_CONCAT( 

		CONCAT('"53":"',COALESCE(dbuser.GetNMCID((select right(tbl_user_id,11))),''),'"'),
		CONCAT(',"55":"',COALESCE(tbl_user_entity,''),'"'),
		CONCAT(',"114.9":"',COALESCE(tbl_user_userTemp_f,''),'"'),
		CONCAT(',"114.70":"',COALESCE(hex(tbl_user_companyName),''),'"'),
		CONCAT(',"114.91":"',COALESCE(tbl_user_title,''),'"'),
		CONCAT(',"114.3":"',COALESCE(tbl_user_first,''),'"'),
		CONCAT(',"114.5":"',COALESCE(tbl_user_last,''),'"'),
		CONCAT(',"114.7":"',COALESCE(tbl_user_email,''),'"'),
		CONCAT(',"127.10":"',COALESCE(tbl_owner_id,''),'"'),
		CONCAT(',"122.92":"',COALESCE(tbl_user_department,''),'"'),
        CONCAT(',"AD":',COALESCE(dbuser.getNMCMainAddressByUser(tbl_user_id),'{}'),''),
		CONCAT(',"PH":[',COALESCE(dbuser.getNMCPhoneByUser(tbl_user_id),''),']') )

		from tbl_user
		where tbl_user_id = (select right (userId,11))
);
IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCUserByClass` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCUserByClass`(UserId varchar(45)) RETURNS text CHARSET utf8
BEGIN



DECLARE JSON MEDIUMTEXT;
DECLARE CLASS_ID VARCHAR(3) DEFAULT NULL;
DECLARE PARENT_ID VARCHAR(7) DEFAULT NULL;
DECLARE PARENT_ID2 VARCHAR(7) DEFAULT NULL;


set UserId = (select CAST(UserId AS UNSIGNED));
set  group_concat_max_len = 10000000;
set CLASS_ID = (SELECT tbl_user_class FROM dbuser.tbl_user WHERE tbl_user_id = UserId);
set PARENT_ID = (SELECT tbl_user_parentId FROM dbuser.tbl_user WHERE tbl_user_id = UserId);
set PARENT_ID2 = (SELECT tbl_user_parentId FROM dbuser.tbl_user WHERE tbl_user_id = PARENT_ID);



if (select right(CLASS_ID,1)) = '0' then

	set JSON = (

		CONCAT(UserId,',',COALESCE((		
			select 
			GROUP_CONCAT(
				CONCAT('',tbl_user_id,',',
				   if((select count(*) from tbl_user as A, tbl_user as B where A.tbl_user_parentId = B.tbl_user_id) > 0,COALESCE(getNMCUserByClassX1(tbl_user_id),''),'')
				)
			) 
			from tbl_user 
			where tbl_user_parentId = UserId

		),''))
	);

elseif (select right(CLASS_ID,1)) = '1' then

	set JSON = (

		CONCAT(PARENT_ID,',',COALESCE((		
			select 
			GROUP_CONCAT(
				CONCAT('',tbl_user_id,',',
				   if((select count(*) from tbl_user as A, tbl_user as B where A.tbl_user_parentId = B.tbl_user_id) > 0,COALESCE(getNMCUserByClassX1(tbl_user_id),''),'')
				)
			) 
			from tbl_user 
			where tbl_user_parentId = PARENT_ID

		),''))
	);

elseif (select right(CLASS_ID,1)) = '2' then

	set JSON = (

		CONCAT(PARENT_ID2,',',COALESCE((		
			select 
			GROUP_CONCAT(
				CONCAT('',tbl_user_id,',',
				   if((select count(*) from tbl_user as A, tbl_user as B where A.tbl_user_parentId = B.tbl_user_id) > 0,COALESCE(getNMCUserByClassX1(tbl_user_id),''),'')
				)
			) 
			from tbl_user 
			where tbl_user_parentId = PARENT_ID2

		),''))
	);

end if;

set JSON = REPLACE(JSON,',,',',');
SET JSON = (SELECT SUBSTR(JSON,1,LENGTH(JSON)-1));

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCUserByClassX1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCUserByClassX1`(UserId varchar(45)) RETURNS text CHARSET utf8
BEGIN



DECLARE JSON MEDIUMTEXT;



set  group_concat_max_len = 10000000;




	set JSON = (
		select 
		GROUP_CONCAT(tbl_user_id)
		from tbl_user 
		where tbl_user_parentId = UserId
	);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCUserName` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCUserName`(userId varchar(20)) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT CONCAT(COALESCE(tbl_user_first,''),' ',COALESCE(tbl_user_last,''))
from tbl_user
where tbl_user_id = userId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCUserNameByUserNMCId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCUserNameByUserNMCId`(userId varchar(20)) RETURNS text CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT CONCAT(COALESCE(tbl_user_first,''),' ',COALESCE(tbl_user_last,''))
from tbl_user
where tbl_user_id = userId
);

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON; 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCZipCode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCZipCode`(ZipCodeId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
 
SELECT	GROUP_CONCAT( 

	   CONCAT('"122.107":"',COALESCE(tbl_zipcode_id,''),'"') , 
       CONCAT(',"47.17":"',COALESCE(tbl_zipcode_name,''),'"') , 
       CONCAT(',"114.14":"',COALESCE(tbl_city_id,''),'"') ,
       CONCAT(',"120.38":"',COALESCE(latitude ,''),'"') ,
       CONCAT(',"120.39":"',COALESCE(longitude ,''),'"')
       )
	 
from tbl_zipcode
where 
	tbl_zipcode_id = ZipCodeId 
	
);
 

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCZipcodeByUser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCZipcodeByUser`(userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
DECLARE JSON2 MEDIUMTEXT;

SET  group_concat_max_len = 10000000;
SET JSON = ( 

select D.tbl_zipcode_name 
from tbl_address AS C
left join tbl_zipcode as D on C.tbl_zipcode_id = D.tbl_zipcode_id 
where C.tbl_address_nmcId = userId
and C.tbl_address_flag = 1
and C.tbl_address_active = 1
limit 1

);

SET JSON2 = ( 

select D.tbl_zipcode_name 
from tbl_address AS C
left join tbl_zipcode as D on C.tbl_zipcode_id = D.tbl_zipcode_id 
where C.tbl_address_nmcId = userId
limit 1

);

IF JSON2 is NULL THEN
	SET JSON2 = '';
END IF;


IF JSON is NULL THEN
	SET JSON = JSON2;
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCZipCodeList` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCZipCodeList`(CityId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
 
SELECT	GROUP_CONCAT( 

	   CONCAT('{"122.107":"',COALESCE(tbl_zipcode_id,''),'"') , 
       CONCAT(',"47.17":"',COALESCE(tbl_zipcode_name,''),'"') , 
       CONCAT(',"114.14":"',COALESCE(tbl_city_id,''),'"}'))
	 
from tbl_zipcode
where 
	tbl_city_id = CityId 
	
);
 

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `getNMCZipCodesByCountry` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `getNMCZipCodesByCountry`(Country int, Search varchar(45)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
 
SELECT	GROUP_CONCAT( 

	   CONCAT('{"122.107":"',COALESCE(A.tbl_zipcode_id,''),'"') , 
       CONCAT(',"47.17":"',COALESCE(A.tbl_zipcode_name,''),'"') , 
       CONCAT(',"114.14":"',COALESCE(A.tbl_city_id,''),'"}'))
	 
from tbl_zipcode as A, tbl_city as B, tbl_state as C, tbl_country as D
where D.tbl_country_id = Country
and D.tbl_country_id = C.tbl_country_id
and C.tbl_state_id = B.tbl_state_id
and B.tbl_city_id = A.tbl_city_id
and UPPER(A.tbl_zipcode_name) like CONCAT(UPPER(Search),"%")
);
 

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetOptionsFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetOptionsFunction`(ProductId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000; 
SET JSON = (





SELECT  GROUP_CONCAT(  DISTINCT        
					CONCAT('{"121.179":"', PO.tbl_productoption_id,'"'),
					CONCAT(',"122.134":"', PO.tbl_productoption_name,'"'),			
					CONCAT(',"300.25":[',GetChoicesFunction(PO.tbl_productoption_id),
					']}'))
from tbl_productoption PO,
	 tbl_productattribute PA
where PA.tbl_productoption_id = PO.tbl_productoption_id
AND   PA.tbl_product_id=ProductId);


IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetPhoneJSON` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetPhoneJSON`(phoneId int) RETURNS text CHARSET utf8
BEGIN
DECLARE PHONE TEXT;
	SET  group_concat_max_len = 10000000;

if (select tbl_phone_id from tbl_phone where tbl_phone_id = phoneId ) is null then
	SELECT  concat('{}') as JSON

	 INTO PHONE;


else
	
	SELECT  CONCAT( 
		CONCAT('{"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
		CONCAT( COALESCE( CONCAT( ',"114.179":"',A.tbl_phone_nmcId,'"'),'' ) ),
		CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
		CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
		CONCAT(',"122.87":"',COALESCE(A.tbl_phone_country_id,''),'"'), 
		CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"}') ) 

	AS JSON 
	FROM tbl_phone AS A
	WHERE A.tbl_phone_id = phoneId INTO PHONE;
end if;
	RETURN PHONE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetPlaylistImageByComponent` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetPlaylistImageByComponent`(ComponentId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"123.21":"',COALESCE(W.tbl_playlist_id,''),'"'),
			CONCAT(',"120.86":"',COALESCE(W.tbl_advertisingimage_id,''),'"'),
			CONCAT(',"121.170":"',COALESCE(W.tbl_advertisingimage_name,''),'"'),
            CONCAT(',"121.46":"',COALESCE(W.tbl_advertisingimage_size,''),'"'),
            CONCAT(',"121.141":"',COALESCE(W.tbl_advertisingimage_date,''),'"'),
            CONCAT(',"114.9":"',COALESCE(if(W.tbl_broadcast_f=1,'true','false'),''),'"'),
			CONCAT(',"IR":[',COALESCE(dbitems.GetPlaylistRelatedItems(W.tbl_playlist_id),''),']'),
			CONCAT(',"127.54":"',COALESCE(W.tbl_playlist_order,''),'"}')
            )

	from 
    
		(select 
        B.tbl_playlist_id,
        A.tbl_advertisingimage_id, 
        A.tbl_advertisingimage_name,
        A.tbl_advertisingimage_size,
		A.tbl_advertisingimage_date,
		B.tbl_playlist_order,
        B.tbl_broadcast_f
		from tbl_advertisingimage as A, tbl_package_layout_component_playlist as B
		where B.tbl_component_id = ComponentId
		and A.tbl_advertisingimage_id = B.tbl_image_id	
		order by A.tbl_advertisingimage_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetPlaylistProductByComponent` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetPlaylistProductByComponent`(ComponentId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"123.21":"',COALESCE(W.tbl_playlist_id,''),'"'),
			CONCAT(',"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
			CONCAT(',"IR":[',COALESCE(dbitems.GetPlaylistRelatedItems(W.tbl_playlist_id),''),']'),
			CONCAT(',"127.54":"',COALESCE(W.tbl_playlist_order,''),'"}')
            )

	from 
    
		(select 
		B.tbl_playlist_id,
        A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
		B.tbl_playlist_order
		from tbl_product as A, tbl_package_layout_component_playlist as B
		where B.tbl_component_id = ComponentId
		and A.tbl_product_id = B.tbl_product_id
		and A.tbl_productstatus_id = 1001	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetPlaylistRelatedItems` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetPlaylistRelatedItems`(PlaylistId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"}')
            )

	from 
    
		(select 
        A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image
		from tbl_product as A, tbl_package_layout_related_items as B
		where B.tbl_playlist_id = PlaylistId
		and A.tbl_product_id = B.tbl_product_id
		and A.tbl_productstatus_id = 1001	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetPlaylistVideoByComponent` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetPlaylistVideoByComponent`(ComponentId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"123.21":"',COALESCE(W.tbl_playlist_id,''),'"'),
			CONCAT(',"127.50":"',COALESCE(W.tbl_file_id,''),'"'),
			CONCAT(',"121.15":"',COALESCE(W.tbl_file_originalname,''),'"'),
			CONCAT(',"121.170":"',COALESCE(W.tbl_file_thumbnail,''),'"'),
            CONCAT(',"121.47":"',COALESCE(W.tbl_file_size,''),'"'),
            CONCAT(',"121.141":"',COALESCE(W.tbl_file_date,''),'"'),
			CONCAT(',"114.9":"',COALESCE(if(W.tbl_broadcast_f=1,'true','false'),''),'"'),
            CONCAT(',"IR":[',COALESCE(dbitems.GetPlaylistRelatedItems(W.tbl_playlist_id),''),']'),
			CONCAT(',"127.54":"',COALESCE(W.tbl_playlist_order,''),'"}')
            )

	from 
    
		(select 
        B.tbl_playlist_id,
        A.tbl_file_id, 
		A.tbl_file_originalname,
        A.tbl_file_thumbnail,
        A.tbl_file_size,
		A.tbl_file_date,
		B.tbl_playlist_order,
        B.tbl_broadcast_f
		from tbl_file as A, tbl_package_layout_component_playlist as B
		where B.tbl_component_id = ComponentId
		and A.tbl_file_id = B.tbl_file_id	
		order by A.tbl_file_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetProductByInvoiceFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetProductByInvoiceFunction`(Invoice INT(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(           
					CONCAT('{"114.144":"',IP.tbl_product_id,'"'),
					CONCAT(',"122.158":"', COALESCE(IP.tbl_invoiceproduct_salePrice,''),'"'),
					CONCAT(',"122.148":"', COALESCE(IP.tbl_invoiceproduct_quantity,''),'"'),
					CONCAT(',"120.83":"',COALESCE(P.tbl_product_name,''),'"') ,
                    CONCAT(',"114.112":"',COALESCE(P.tbl_producttype_id,''),'"') ,
					CONCAT(',"IM":[',dbitems.getNMCImage(P.tbl_product_id,1),']'),
					CONCAT(',"CH":[',dbtransaction.GetProductChoicesByInvoicePortalFunction(Invoice, P.tbl_product_id),']'),
					CONCAT(',"120.157":"',COALESCE(hex(P.tbl_product_description),''),'"}')
					)
from dbtransaction.tbl_invoiceproduct IP ,dbtransaction.tbl_invoice as I , dbitems.tbl_product as P
where I.tbl_invoice_id = Invoice
and IP.tbl_invoice_id = I.tbl_invoice_id
and IP.tbl_product_id = P.tbl_product_id

);


IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetProductChoicesByInvoiceFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetProductChoicesByInvoiceFunction`(Invoice INT(11), Product INT(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(           
					CONCAT('{"122.134":"',C.tbl_productoption_name,'"'),
					CONCAT(',"122.135":"', D.tbl_productoptionvalue_name,'"'),
					CONCAT(',"120.84":"', A.tbl_invoiceproductchoice_choiceprice,'"}')					
					)
from tbl_invoiceproductchoice as A, 
dbitems.tbl_productattribute as B, 
dbitems.tbl_productoption as C, 
dbitems.tbl_productoptionvalue as D
where A.tbl_invoiceproductchoice_invoiceid = Invoice
and A.tbl_invoiceproductchoice_productid = Product
and A.tbl_invoiceproductchoice_choiceid = B.tbl_productoptionvalue_id
and B.tbl_productoption_id = C.tbl_productoption_id
and B.tbl_productoptionvalue_id = D.tbl_productoptionvalue_id


);


IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetProductChoicesByInvoicePortalFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetProductChoicesByInvoicePortalFunction`(Invoice INT(11), Product INT(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(           
					CONCAT('{"122.134":"',C.tbl_productoption_name,'"'),
					CONCAT(',"127.16":"', D.tbl_productoptionvalue_name,'"'),
					CONCAT(',"120.84":"', A.tbl_invoiceproductchoice_choiceprice,'"}')					
					)
from tbl_invoiceproductchoice as A, 
dbitems.tbl_productattribute as B, 
dbitems.tbl_productoption as C, 
dbitems.tbl_productoptionvalue as D
where A.tbl_invoiceproductchoice_invoiceid = Invoice
and A.tbl_invoiceproductchoice_productid = Product
and A.tbl_invoiceproductchoice_choiceid = B.tbl_productoptionvalue_id
and B.tbl_productoption_id = C.tbl_productoption_id
and B.tbl_productoptionvalue_id = D.tbl_productoptionvalue_id


);


IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetRandomAnswersFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetRandomAnswersFunction`(QuestionId int, UserNMCId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000; 
SET JSON = (


SELECT GROUP_CONCAT( DISTINCT        
					CONCAT('', COALESCE(W.tbl_securityquestionsanswer_answer,''))
					)
from 
	(select tbl_securityquestionsanswer_answer 
	from tbl_securityquestionsanswer 
	where tbl_securityquestions_id = QuestionId
	and tbl_cardsconsumer_nmcId != UserNMCId
	order by rand()
	limit 2) as W

);

SET JSON = REPLACE(JSON,',','~');

IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetShoppingCartChoicesFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetShoppingCartChoicesFunction`(Choices varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

DECLARE CADENA_CHOICE VARCHAR(5000) DEFAULT NULL;
DECLARE CHOICE_AUX VARCHAR(11) DEFAULT NULL;

SET  group_concat_max_len = 10000000;

set CADENA_CHOICE = Choices;
set CADENA_CHOICE = (concat(CADENA_CHOICE,','));

SET JSON = "";


WHILE (LENGTH(CADENA_CHOICE)>0) DO

	SET CHOICE_AUX = (SELECT SUBSTR(CADENA_CHOICE,1,LOCATE(',',CADENA_CHOICE)-1));
	SET CADENA_CHOICE = (SELECT SUBSTR(CADENA_CHOICE,LOCATE(',',CADENA_CHOICE)+1));

	SET JSON = concat( JSON, 

		(SELECT GROUP_CONCAT(
				CONCAT('', W.tbl_productoption_id,''),						
				CONCAT(':', W.tbl_productoptionvalue_id,''),			
				CONCAT(':', W.tbl_productattribute_optionValuePrice,''))
							
		from 
			(select tbl_productoption_id, 
					tbl_productoptionvalue_id, 
					tbl_productattribute_optionValuePrice
			from tbl_productattribute as A
			where tbl_productoptionvalue_id = CHOICE_AUX
			group by tbl_productoption_id) as W));

	SET JSON = concat( JSON, ',');

END WHILE;



IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetShoppingCartChoicesFunctionWebsite` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetShoppingCartChoicesFunctionWebsite`(Choices varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

DECLARE CADENA_CHOICE VARCHAR(5000) DEFAULT NULL;
DECLARE CHOICE_AUX VARCHAR(11) DEFAULT NULL;

SET  group_concat_max_len = 10000000;

set CADENA_CHOICE = Choices;
set CADENA_CHOICE = (concat(CADENA_CHOICE,','));

SET JSON = "";


WHILE (LENGTH(CADENA_CHOICE)>0) DO

	SET CHOICE_AUX = (SELECT SUBSTR(CADENA_CHOICE,1,LOCATE(',',CADENA_CHOICE)-1));
	SET CADENA_CHOICE = (SELECT SUBSTR(CADENA_CHOICE,LOCATE(',',CADENA_CHOICE)+1));

	SET JSON = concat( JSON, 

		(SELECT GROUP_CONCAT(
				CONCAT('{"121.179":"', W.tbl_productoption_id,'"'),		
				CONCAT(',"122.134":"', W.tbl_productoption_name,'"'),
				CONCAT(',"122.112":"', W.tbl_productoptionvalue_id,'"'),	
                CONCAT(',"127.16":"', W.tbl_productoptionvalue_name,'"'),
				CONCAT(',"120.84":"', W.tbl_productattribute_optionValuePrice,'"}'))
							
		from 
			(select A.tbl_productoption_id, 
					C.tbl_productoption_name,
					A.tbl_productoptionvalue_id, 
                    B.tbl_productoptionvalue_name,
					A.tbl_productattribute_optionValuePrice
			from tbl_productattribute as A 
			left join tbl_productoptionvalue as B on A.tbl_productoptionvalue_id = B.tbl_productoptionvalue_id
			left join tbl_productoption as C on A.tbl_productoption_id = C.tbl_productoption_id
			where A.tbl_productoptionvalue_id = CHOICE_AUX
			group by A.tbl_productoption_id) as W));

	SET JSON = concat( JSON, ',');

END WHILE;


SET JSON = SUBSTR(JSON,1,CHAR_LENGTH(JSON)-1);

IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetShoppingCartDeliveryFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetShoppingCartDeliveryFunction`(ShoppingCartDetail int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 

SELECT GROUP_CONCAT(     
					CONCAT('', W.tbl_shoppingcartdelivery_id,''),
					CONCAT(':', W.tbl_shoppingcartdelivery_quantity,''),									
					CONCAT(':', W.tbl_address_id,''))
					
from 
	(select tbl_shoppingcartdelivery_id, tbl_shoppingcartdelivery_quantity, tbl_address_id
	from tbl_shoppingcartdelivery 
	where tbl_shoppingcartdetail_id = ShoppingCartDetail) as W);


IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetSubPermissions` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetSubPermissions`(PermissionId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 
 
SELECT	GROUP_CONCAT( 

	   CONCAT('{"122.37":"',COALESCE(tbl_subpermission_id,''),'"') , 
	   CONCAT(',"122.3":"',COALESCE(tbl_subpermission_portal_id,''),'"') , 
       CONCAT(',"122.38":"',COALESCE(tbl_subpermission_name,''),'"}'))
	 
from tbl_subpermission
where tbl_permission_id = PermissionId
and tbl_subpermission_status_f = 1

);
 

IF JSON is NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetTerminalErrorCounter` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetTerminalErrorCounter`(TerminalId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from dbuser.tbl_terminal_error
	where tbl_terminal_id = TerminalId

);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `GetTransactionByInvoiceFunction` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `GetTransactionByInvoiceFunction`(Invoice INT(11)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;
SET JSON = ( 



SELECT GROUP_CONCAT(           
					CONCAT('{"114.145":"', T.tbl_transaction_id,'"'),
					CONCAT(',"120.31":"', COALESCE(T.tbl_transaction_creationDate,''),'"'),			
					CONCAT(',"48.29":"', COALESCE(T.tbl_transactiontype_id,''),'"'),
					CONCAT(',"KT":{',dbtransaction.GetCardByTransactionFunction(T.tbl_transaction_id),'}'),
					CONCAT(',"114.143":"', COALESCE(T.tbl_invoicestatus_id,''),'"'),
					CONCAT(',"121.110":"',COALESCE(T.tbl_transaction_amount,''),'"'),
					CONCAT(',"121.72":"',COALESCE(T.tbl_transaction_processor,''),'"'),
					CONCAT(',"37":"',COALESCE(T.tbl_transaction_number,''),'"}')
					)
from dbtransaction.tbl_transaction as T
where T.tbl_invoice_id = Invoice
);


IF JSON is NULL THEN
	SET JSON = "";
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCItemByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCItemByCategory`(CategoryId int, userId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"120.157":"',COALESCE(hex(W.tbl_product_description),''),'"'),
            CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
            CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
            CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_description,
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
        A.tbl_product_dateadded
		from tbl_product as A, tbl_productcategory as B
		where B.tbl_category_id = CategoryId
		and A.tbl_product_id = B.tbl_product_id
        and A.tbl_product_offer_f = 0
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001
        and
		(		UPPER(A.tbl_product_name) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_description) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_regularprice) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_saleprice) like CONCAT("%",UPPER(Search),"%")
		) 	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCItemByMerchant` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCItemByMerchant`(MerchantId int, userId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(dbitems.getNMCScheduleProduct(W.tbl_product_id)),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image
		from vw_product_by_merchant as A
		where A.tbl_main_user_id = dbuser.GetNMCId(MerchantId)
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001	
        and ValidateNMCProductSchedule(A.tbl_product_id) = 'true'
        and
		(		UPPER(A.tbl_product_name) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_description) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_regularprice) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_saleprice) like CONCAT("%",UPPER(Search),"%")
		)
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCItemCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCItemCounterByCategory`(CategoryId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from tbl_product as A, tbl_productcategory as B
	where B.tbl_category_id = CategoryId
	and A.tbl_product_id = B.tbl_product_id
    and A.tbl_product_offer_f = 0
    and A.tbl_producttype_id = 21
	and A.tbl_productstatus_id = 1001
	and
	(		UPPER(A.tbl_product_name) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_description) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_regularprice) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_saleprice) like CONCAT("%",UPPER(Search),"%")
	)
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCItemSpecialByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCItemSpecialByCategory`(CategoryId int, userId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"120.157":"',COALESCE(hex(W.tbl_product_description),''),'"'),
            CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
            CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
            CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_description,
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
        A.tbl_product_dateadded
		from tbl_product as A, tbl_productcategory as B
		where B.tbl_category_id = CategoryId
		and A.tbl_product_id = B.tbl_product_id
        and A.tbl_product_offer_f = 1
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001	
        and
		(		UPPER(A.tbl_product_name) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_description) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_regularprice) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_saleprice) like CONCAT("%",UPPER(Search),"%")
		)
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCItemSpecialCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCItemSpecialCounterByCategory`(CategoryId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from tbl_product as A, tbl_productcategory as B
	where B.tbl_category_id = CategoryId
	and A.tbl_product_id = B.tbl_product_id
    and A.tbl_product_offer_f = 1
    and A.tbl_producttype_id = 21
	and A.tbl_productstatus_id = 1001	
    and
	(		UPPER(A.tbl_product_name) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_description) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_regularprice) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_saleprice) like CONCAT("%",UPPER(Search),"%")
	)
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCMerchantByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCMerchantByCategory`(CategoryId int, userId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
		CONCAT('{"114.1":"',COALESCE(W.tbl_company_id,''),'"'),
		CONCAT(',"53":"',COALESCE(dbuser.GetNMCId(W.tbl_user_id),''),'"'),
        CONCAT(',"114.70":"',COALESCE(hex(W.tbl_user_companyName),''),'"'),
        CONCAT(',"121.170":"',COALESCE(W.tbl_merchant_logoimage,''),'"'),
        CONCAT(',"114.9":"',COALESCE(dbuser.ValidateFavoriteMerchant(W.tbl_user_id,userId),''),'"}'))

	from 
    
		(select 
		A.tbl_company_id,
		A.tbl_user_id,
		A.tbl_user_companyName,
		B.tbl_merchant_logoimage
		from dbuser.tbl_merchantbusinesscategory as C
		left join dbuser.tbl_user as A on C.tbl_merchant_nmcId = A.tbl_user_id
		left join dbuser.tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
		where tbl_businesscategory_id = CategoryId
		and length(A.tbl_user_companyName)>0 
		and length(B.tbl_merchant_logoimage)>0 
		and A.tbl_user_entity = 20 
		and A.tbl_user_class in ('2A0','2B0','2C0') 
		and A.tbl_userstatus_id = 33 
        and
		(		
			UPPER(A.tbl_user_companyName) like CONCAT("%",UPPER(Search),"%")
		) 	
		order by A.tbl_user_companyName asc) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCMerchantCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCMerchantCounterByCategory`(CategoryId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from dbuser.tbl_merchantbusinesscategory as C
	left join dbuser.tbl_user as A on C.tbl_merchant_nmcId = A.tbl_user_id
	left join dbuser.tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
	where tbl_businesscategory_id = CategoryId
	and length(A.tbl_user_companyName)>0 
	and length(B.tbl_merchant_logoimage)>0 
	and A.tbl_user_entity = 20 
	and A.tbl_user_class in ('2A0','2B0','2C0') 
	and A.tbl_userstatus_id = 33
	and
		(		
			UPPER(A.tbl_user_companyName) like CONCAT("%",UPPER(Search),"%")
		) 
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCSavedItemByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCSavedItemByCategory`(CategoryId int, userId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT  GROUP_CONCAT(distinct
			CONCAT('{"114.144":"',COALESCE(W.tbl_product_id,''),'"'),
			CONCAT(',"114.112":"',COALESCE(W.tbl_producttype_id,''),'"'),
            CONCAT(',"120.83":"',COALESCE(W.tbl_product_name,''),'"'),
			CONCAT(',"120.157":"',COALESCE(hex(W.tbl_product_description),''),'"'),
            CONCAT(',"114.98":"',COALESCE(W.tbl_product_regularprice,0.0),'"'),
			CONCAT(',"122.158":"',COALESCE(W.tbl_product_saleprice,0.0),'"'),
            CONCAT(',"121.170":"',COALESCE(W.tbl_product_image,''),'"'),
            CONCAT(',"120.31":"',COALESCE(W.tbl_product_dateadded,''),'"'),
            CONCAT(',"122.19":"',COALESCE(dbitems.GetNMCItemRatingAverage(W.tbl_product_id),''),'"'),
            CONCAT(',"121.80":"',COALESCE(dbitems.GetNMCItemReviewCounter(W.tbl_product_id),''),'"'),
            CONCAT(',"114.9":"',COALESCE(ValidateNMCProductWatched(W.tbl_product_id,userId),''),'"}'))

	from 
    
		(select A.tbl_product_id, 
        A.tbl_producttype_id, 
        A.tbl_product_name, 
        A.tbl_product_description,
        A.tbl_product_regularprice, 
        A.tbl_product_saleprice,
        A.tbl_product_image,
        A.tbl_product_dateadded
		from tbl_productfav as C, tbl_product as A, tbl_productcategory as B
		where C.tbl_productfav_nmcid = userId
        and B.tbl_category_id = CategoryId
        and C.tbl_product_id = A.tbl_product_id
		and A.tbl_product_id = B.tbl_product_id
        and A.tbl_producttype_id = 21
		and A.tbl_productstatus_id = 1001
        and
		(		UPPER(A.tbl_product_name) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_description) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_regularprice) like CONCAT("%",UPPER(Search),"%")
			or  UPPER(A.tbl_product_saleprice) like CONCAT("%",UPPER(Search),"%")
		) 	
		order by A.tbl_product_id DESC) as W
	);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `searchNMCSavedItemCounterByCategory` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `searchNMCSavedItemCounterByCategory`(CategoryId int, userId int, Search varchar(255)) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

SET JSON = ( 

	select count(*) 
	from tbl_productfav as C, tbl_product as A, tbl_productcategory as B
	where C.tbl_productfav_nmcid = userId
	and B.tbl_category_id = CategoryId
	and C.tbl_product_id = A.tbl_product_id
	and A.tbl_product_id = B.tbl_product_id
    and A.tbl_producttype_id = 21
	and A.tbl_productstatus_id = 1001
	and
	(		UPPER(A.tbl_product_name) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_description) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_regularprice) like CONCAT("%",UPPER(Search),"%")
		or  UPPER(A.tbl_product_saleprice) like CONCAT("%",UPPER(Search),"%")
	)
);
	
IF JSON IS NULL THEN
	SET JSON = '';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `SPLIT_STR` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` FUNCTION `SPLIT_STR`(
  x VARCHAR(255),
  delim VARCHAR(12),
  pos INT
) RETURNS varchar(255) CHARSET utf8
RETURN REPLACE(SUBSTRING(SUBSTRING_INDEX(x, delim, pos),
       LENGTH(SUBSTRING_INDEX(x, delim, pos -1)) + 1),
       delim, '') ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateCampaignLayout` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateCampaignLayout`(PackageId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;



if (
	select tbl_package_id 
	from tbl_package_layout
	where tbl_package_id = PackageId
	limit 1
	) is not null then

	if dbitems.GetNMCPackageSize(PackageId) > 0 then
		SET JSON = 'true';
	else
		SET JSON = 'false';
    end if;

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateFavoriteMerchant` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateFavoriteMerchant`(merchantId int, consumerId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;


if (
	select tbl_merchant_nmcId 
	from tbl_merchantfav 
	where tbl_merchant_nmcId = merchantId
	and tbl_consumer_nmcId = consumerId
	limit 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCAdvertisingStatusByShuffle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCAdvertisingStatusByShuffle`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;



if (
	select A.advertising_id 
	from vw_advertising as A
	left join tbl_shuffle_advertising as B on A.advertising_id = B.tbl_advertising_id
	where B.tbl_shuffle_id = ShuffleId 
    and A.status = 60002
	limit 1) is null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCcatalogHasItem` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCcatalogHasItem`(catalogId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

 

if (
	select tbl_catalog_id 
	from tbl_catalogproduct limit 1

	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;
 
RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCcatalogSchedule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCcatalogSchedule`(catalogId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;



if (
	select tbl_catalog_id 
	from tbl_catalog_schedule 
	where tbl_catalog_id = catalogId
	and tbl_day_of_the_week = (select weekday(NOW()))
	and tbl_closed_flag = 0
	and (select curdate() between tbl_catalog_schedule_startDate and tbl_catalog_schedule_endDate) = 1
	and (select curtime() between tbl_hour_open  and tbl_hour_close ) = 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;
 
RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCLocationSchedule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCLocationSchedule`(LocationId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;



if (
	select tbl_location_id 
	from tbl_location_schedule 
	where tbl_location_id = LocationId
	and tbl_day_of_the_week = (select weekday(NOW()))
	and tbl_closed_flag = 0
	and (select curtime() between tbl_hour_open  and tbl_hour_close ) = 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCProductOfferApplied` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCProductOfferApplied`(ProductId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
DECLARE OFFER_ID INT(11) DEFAULT 0;
SET  group_concat_max_len = 10000000;


set OFFER_ID = (select tbl_product_discount_id from tbl_discount_item_applied where tbl_product_id = ProductId limit 1);

if (
	select tbl_product_id 
	from tbl_product_schedule 
	where tbl_product_id = OFFER_ID
	and tbl_day_of_the_week = (select weekday(NOW()))
	and tbl_closed_flag = 0
	and (select curdate() between tbl_product_schedule_startDate and tbl_product_schedule_endDate) = 1
	and (select curtime() between tbl_hour_open  and tbl_hour_close ) = 1
	) is not null then

	SET JSON = 'true';

else 

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCProductOfferSchedule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCProductOfferSchedule`(ProductId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;

if (
	select tbl_product_id 
	from tbl_productoffer_schedule 
	where tbl_product_id = ProductId
	and tbl_day_of_the_week = (select weekday(NOW()))
	and tbl_closed_flag = 0
	and (select curdate() between tbl_start_date and tbl_end_date) = 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCProductSchedule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCProductSchedule`(ProductId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;


if (
	select tbl_product_id 
	from tbl_product_schedule 
	where tbl_product_id = ProductId
	and tbl_day_of_the_week = (select weekday(NOW()))
	and tbl_closed_flag = 0
	and (select curdate() between tbl_product_schedule_startDate and tbl_product_schedule_endDate) = 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCProductWatched` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCProductWatched`(productId int, userId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

 

if (
	select tbl_product_id 
    from tbl_product_watched 
    where tbl_product_id = productId 
    and tbl_user_id = userId
    limit 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;
 
RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCShuffleSchedule` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCShuffleSchedule`(ShuffleId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;



if (
	select tbl_shuffle_id 
	from tbl_shuffle_schedule 
	where tbl_shuffle_id = ShuffleId
	and tbl_day_of_the_week = (select weekday(NOW()))
	and tbl_closed_flag = 0
	and (select curdate() between tbl_shuffle_schedule_startDate and tbl_shuffle_schedule_endDate) = 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCShuffleScheduleDongle` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCShuffleScheduleDongle`(ShuffleId int, Day_week int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON TEXT;

SET  group_concat_max_len = 10000000;



if (
	select tbl_shuffle_id 
	from tbl_shuffle_schedule 
	where tbl_shuffle_id = ShuffleId
	and tbl_day_of_the_week = Day_week
	and tbl_closed_flag = 0
	and (select curdate() between tbl_shuffle_schedule_startDate and tbl_shuffle_schedule_endDate) = 1
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateNMCUserAge` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateNMCUserAge`(UserId int) RETURNS mediumtext CHARSET utf8
BEGIN
DECLARE JSON MEDIUMTEXT;
SET  group_concat_max_len = 10000000;



if (
	select tbl_user_id 
	from tbl_user
	where tbl_user_id = UserId
	and tbl_user_ageConfirm_f = 1
	-- and tbl_user_ageReceiveItems_f = 1
	and date_add(tbl_user_birthDate,INTERVAL 21 YEAR) < CURRENT_DATE
	) is not null then

	SET JSON = 'true';

else

	SET JSON = 'false';

end if;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `ValidateSubscriptionActiveByLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` FUNCTION `ValidateSubscriptionActiveByLocation`(locationId int) RETURNS mediumtext CHARSET utf8
BEGIN

DECLARE JSON TEXT;
SET  group_concat_max_len = 10000000;

SET JSON = ( 

	SELECT B.tbl_subscription_id
	from tbl_usersubscription as A, tbl_subscription as B
	where A.tbl_location_id = locationId
	and A.tbl_subscription_id = B.tbl_subscription_id
    and A.tbl_usersubscription_date_expiration > NOW()
    limit 1
);

IF JSON is NULL THEN
	SET JSON = 'false';
else
	SET JSON = 'true';
END IF;

RETURN JSON;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AboutMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AboutMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_053      INT(18)       DEFAULT 0;  

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	select
		GROUP_CONCAT(
			CONCAT('"126":"',tbl_help_about_content,'"') ) as JSON
	from tbl_help_about
	LIMIT INI,FIN;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ActivateConsumer020400701` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `ActivateConsumer020400701`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  	   
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	
    
	update tbl_user set
    tbl_userstatus_id = 33,
	tbl_user_userTemp_f = 0,
    tbl_user_firstlogin_f = 0,
	tbl_user_dateModified = NOW()
	where tbl_user_id = de_053;
		
	

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
        
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
    SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',dbuser.GetNMCId(de_053),'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddAIODevice030400424` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddAIODevice030400424`(IN MSG_IN VARCHAR(20000))
BEGIN

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_123_053 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_075 DECIMAL(15,2) DEFAULT NULL; 
	
-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
-- ---------------
-- Validations  --
-- ---------------
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables  --
-- -----------------

	SET de_123_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.53');		
	SET de_122_075 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.75');
		
-- ---------------		
-- Query of DB  --
-- ---------------	

	insert into dbuser.tbl_aio_device set
	tbl_aio_device_name = de_123_053,
	tbl_aio_device_price = de_122_075;
	
	
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddDeliveryOptionsToUser030400316` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddDeliveryOptionsToUser030400316`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL;       		

	DECLARE de_122_109 INTEGER(15) DEFAULT NULL;		
	DECLARE de_122_161 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_122_133 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_122_039 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_120_157 TEXT DEFAULT NULL;				
	DECLARE de_123_060 VARCHAR(50) DEFAULT NULL;		
	DECLARE DS_DE TEXT DEFAULT 0;  						
	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_109 VARCHAR(45) DEFAULT NULL;

		
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
     
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	
	set de_122_161 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.161');
	set de_122_133 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.133');
		
	set de_122_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.39');
	set de_120_157 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.157');

	set de_123_060 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.60');

	set COMPANY_ID = (select tbl_company_id from dbuser.tbl_user where tbl_user_id = de_053);


	IF (SELECT tbl_delivery_id 
		FROM tbl_user_delivery_options 
		WHERE tbl_user_id = de_053 
		AND tbl_delivery_company_option = TRIM(de_122_133) 
		AND tbl_delivery_company_price = TRIM(de_122_161)
		AND tbl_delivery_company_service = TRIM(de_122_039)
		LIMIT 1) IS  NULL THEN
	
		INSERT INTO tbl_user_delivery_options set
		tbl_company_id = COMPANY_ID,
		tbl_user_id = de_053,
		tbl_delivery_company_price = TRIM(de_122_161),
		tbl_delivery_company_service = TRIM(de_122_039),
		tbl_user_delivery_options_tier = TRIM(de_120_157),
		tbl_delivery_company_tracking_code = de_123_060,
		tbl_delivery_company_option = TRIM(de_122_133);
	
	end if;
	

	set RESULT_122_109	= (select last_insert_id() from tbl_user_delivery_options limit 1);
	
	
	
	SELECT GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"122.109":"',RESULT_122_109,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEcommerce030400134` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddEcommerce030400134`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE _053 VARCHAR(20) DEFAULT NULL;  
	DECLARE _US_WS TEXT DEFAULT NULL;
	DECLARE _114_75ec VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_75eca VARCHAR(300) DEFAULT NULL;       
	DECLARE _121_150 VARCHAR(300) DEFAULT NULL;       	
	DECLARE _121_150a VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181 VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181a VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7 VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7a VARCHAR(300) DEFAULT NULL;       	
	DECLARE _US_PL VARCHAR(300) DEFAULT NULL;       	
	DECLARE _US_PLa VARCHAR(300) DEFAULT NULL;       	
	DECLARE PHONEID_AUX	VARCHAR(20) DEFAULT NULL;       	
	DECLARE INDICATIVE_AUX VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL;     		



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	


	SET _053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set _053 = (select right(_053,11));
	
	
	
	SELECT DATA INTO _US_WS FROM TBL_MESSAGE1 WHERE CODE = 'EC';


	SELECT DATA INTO _US_PL FROM TBL_MESSAGE1 WHERE CODE = '127.60';
	
	SET _US_WS = (SELECT CONVERT(unhex(_US_WS) USING utf8 ));
	
	
	SET _US_WS = REPLACE(_US_WS,'{"1','{"_1');
	SET _US_WS = REPLACE(_US_WS,',"1',',"_1');
	SET _US_WS = REPLACE(_US_WS,',"48',',"_48');
	
	SET _114_75ec = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_WS":',_US_WS,'}'),'//_114.75'));
	SET _121_150 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_WS":',_US_WS,'}'),'//_121.150'));
	SET _122_181 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_WS":',_US_WS,'}'),'//_122.181'));
	SET _114_7 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_WS":',_US_WS,'}'),'//_114.7'));
	




	delete from tbl_merchantwebsite 
	 where tbl_merchant_nmcId = _053;

	update tbl_merchant set tbl_merchant_haveWebsite_f=0  where tbl_merchant_nmcId=_053;
		WHILE (LENGTH(_114_75ec)>0) DO
		
			SET _114_75eca = (SELECT SUBSTR(_114_75ec,1,LOCATE('|',_114_75ec)-1));
			SET _114_75ec = (SELECT SUBSTR(_114_75ec,LOCATE('|',_114_75ec)+1));
			
			SET _121_150a = (SELECT SUBSTR(_121_150,1,LOCATE('|',_121_150)-1));
			SET _121_150 = (SELECT SUBSTR(_121_150,LOCATE('|',_121_150)+1));
			
			SET _122_181a = (SELECT SUBSTR(_122_181,1,LOCATE('|',_122_181)-1));
			SET _122_181 = (SELECT SUBSTR(_122_181,LOCATE('|',_122_181)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7 = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
			
			SET _US_PLa = (SELECT SUBSTR(_US_PL,1,LOCATE('|',_US_PL)-1)); 
			SET _US_PL = (SELECT SUBSTR(_US_PL,LOCATE('|',_US_PL)+1));

			SET INDICATIVE_AUX = (SELECT SUBSTRING_INDEX(_US_PLa,';',1) );
			SET PHONE_NUMBER_AUX = (SELECT SUBSTR(_US_PLa,LOCATE(';',_US_PLa)+1));

		
			IF (LENGTH(PHONE_NUMBER_AUX) >0) THEN
				INSERT dbuser.tbl_phone SET
					tbl_phone_phoneNumber = TRIM(PHONE_NUMBER_AUX),
					tbl_phone_extension = '',
					tbl_phone_country_id = TRIM(INDICATIVE_AUX),
					tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX=  LAST_INSERT_ID();
			END IF;
			insert into dbuser.tbl_merchantwebsite
			set tbl_merchantwebsite_website = TRIM(_114_75eca),
			tbl_merchantwebsite_ecommerceProvider= TRIM(_121_150a),
			tbl_merchantwebsite_ecommerceName= TRIM(_122_181a),
			tbl_merchantwebsite_ecommerceMail= TRIM(_114_7a),
			tbl_merchantwebsite_ecommercePhone= PHONEID_AUX,
			tbl_merchant_nmcId= _053;
			
			update tbl_merchant set tbl_merchant_haveWebsite_f=1  where tbl_merchant_nmcId=_053;
			
		end while;



	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditDesignatedLocationsByUser020400594` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddEditDesignatedLocationsByUser020400594`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53  VARCHAR(20) DEFAULT NULL;    	

    DECLARE de_LO TEXT DEFAULT NULL;               	  -- LO Location Struct
	DECLARE de_114_047_CADENA TEXT DEFAULT NULL;      -- 114.47 Location Id
	DECLARE de_114_047 INT(11) DEFAULT NULL;      
    
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
    
	SELECT DATA INTO de_LO FROM TBL_MESSAGE WHERE CODE = "LO";
	SET de_LO = (SELECT CONVERT(unhex(de_LO) USING utf8 ));
	SET de_LO = REPLACE(de_LO,'{"1','{"_1');
	SET de_LO = REPLACE(de_LO,',"1',',"_1');
	SET de_114_047_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_LO":',de_LO,'}'),'//_114.47'));

	
	delete from tbl_location_user where tbl_user_id = de_53;
	
	if LENGTH(de_114_047_CADENA) >0 then

		while (LENGTH(de_114_047_CADENA)>0) DO

			SET de_114_047 = TRIM((SELECT SUBSTR(de_114_047_CADENA,1,LOCATE('|',de_114_047_CADENA)-1)));
			SET de_114_047_CADENA = (SELECT SUBSTR(de_114_047_CADENA,LOCATE('|',de_114_047_CADENA)+1));

			insert into tbl_location_user set
			tbl_user_id = de_53,
			tbl_location_id = de_114_047;
	
		end while ; 
		
	end if;

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
			

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditHardwareCart020400463` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddEditHardwareCart020400463`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53  VARCHAR(20) DEFAULT NULL;    	
	DECLARE de_127_088 INT(11) DEFAULT NULL; 	
    DECLARE de_121_022 INT(11) DEFAULT NULL; 
	-- DECLARE de_114_047 INT(11) DEFAULT NULL;        
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL;    
    
	DECLARE HARDWARECART_AUX INTEGER(11) DEFAULT 0;
	DECLARE COMPANY_ID INTEGER(11) DEFAULT 0;
    
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
	SET de_127_088 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.88');
	SET de_121_022 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.22');
    -- SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
	SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.9');

	SET COMPANY_ID = (select tbl_company_id from dbuser.tbl_user where tbl_user_id = de_53);


	if (select tbl_hardware_cart_id from tbl_hardware_cart where tbl_user_id = de_53 and tbl_hardware_type_id = de_127_088 and tbl_hardware_cart_delete = 0) is null then 

		insert into tbl_hardware_cart set 
		tbl_user_id = de_53,
        tbl_company_id = COMPANY_ID,
		tbl_location_id = NULL,
		tbl_hardware_type_id = de_127_088,
        tbl_hardware_cart_quantity = de_121_022,
        tbl_hardware_cart_delete = 0,
        tbl_hardware_cart_insurance_f = if(de_114_009 = 'true',1,0);
				
	else
		
		update tbl_hardware_cart set
        tbl_company_id = COMPANY_ID,
        tbl_hardware_cart_quantity = COALESCE(de_121_022, tbl_hardware_cart_quantity),
        tbl_hardware_cart_insurance_f = COALESCE(if(de_114_009 = 'true',1,0), tbl_hardware_cart_insurance_f)
		where tbl_user_id = de_53
        and tbl_hardware_type_id = de_127_088
        and tbl_hardware_cart_delete = 0;
	
	end if;


	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
			

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	-- SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.197":"',SUBSCRIPTIONCART_AUX,'"}')) AS JSON;
	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditISOQuestionaire020400282` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `AddEditISOQuestionaire020400282`(IN MSG_IN VARCHAR(20000))
BEGIN

-- -------------------------------------------------------
-- Autor: Luis g Porras
-- Procedure: AddEditISOQuestionaire020400282
-- Method: 020400282
-- Version: 1.0
-- Last modified: 2014-05-28
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------


	DECLARE de_053 VARCHAR(20) DEFAULT NULL;		  -- User Id
	
	DECLARE de_117_023 INT(11) DEFAULT 0; 		 	  -- 117.23 ISO type
	DECLARE de_121_148 VARCHAR(40) DEFAULT 0; 		  -- 121.148 years of business
    DECLARE de_123_071 VARCHAR(99) DEFAULT 0; 		  -- 123.71 Tax Id Number
	DECLARE de_114_009 VARCHAR(5) DEFAULT 0; 		  -- 114.9 Flag (true=desde admin)
	
	DECLARE DS_BT TEXT DEFAULT NULL;  				  -- Breakdown of type of accounts Structure
	DECLARE de_127_073 INT(11) DEFAULT 0; 		 	  -- Breakdown of type of accounts ID
	DECLARE de_127_073_CADENA TEXT DEFAULT NULL; 
	DECLARE de_127_074 VARCHAR(99) DEFAULT ''; 	 	  -- Breakdown of type of accounts other
	DECLARE de_127_074_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_075BR INT(11) DEFAULT 0; 		  -- Breakdown of type of accounts number of merchants
	DECLARE de_127_075BR_CADENA TEXT DEFAULT NULL;
	
	
	DECLARE DS_FEP TEXT DEFAULT NULL;  				  -- Front end processors Structure
	DECLARE de_127_076 VARCHAR(99) DEFAULT 0; 		  -- Front end processor
	DECLARE de_127_076_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_075FEP INT(11) DEFAULT 0; 		  -- Front end processor number of merchants
	DECLARE de_127_075FEP_CADENA TEXT DEFAULT NULL;

	
	DECLARE DS_MPC TEXT DEFAULT NULL;  				  -- Merchant Per Country Structure
	DECLARE de_122_087 INT(11) DEFAULT 0; 		 	  -- country ID
	DECLARE de_122_087_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_075MPC INT(11) DEFAULT 0; 		  -- Merchant Per Country Structure number of merchants
	DECLARE de_127_075MPC_CADENA TEXT DEFAULT NULL;
	
	
	DECLARE DS_FTE TEXT DEFAULT NULL;  				  -- Full Time Employees Structure
	DECLARE de_127_077 INT(11) DEFAULT 0; 		 	  -- Full Time Employees ID
	DECLARE de_127_077_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_075FTE INT(11) DEFAULT 0; 		  -- Full Time Employees number of user
	DECLARE de_127_075FTE_CADENA TEXT DEFAULT NULL;
	
	
	DECLARE DS_RWY TEXT DEFAULT NULL;  				  -- Resellers Working with you Structure
	DECLARE de_127_078 INT(11) DEFAULT 0; 		 	  -- Resellers Working with you ID
	DECLARE de_127_078_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_075RWY INT(11) DEFAULT 0; 		  -- Resellers Working with you number of user
	DECLARE de_127_075RWY_CADENA TEXT DEFAULT NULL;
	
	
	DECLARE DS_MV TEXT DEFAULT NULL;  				  -- Market verticals Structure
	DECLARE de_127_079 INT(11) DEFAULT 0; 		 	  -- Market verticals ID
	DECLARE de_127_079_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_080 VARCHAR(99) DEFAULT ''; 	 	  -- Market verticals other
	DECLARE de_127_080_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_075MV INT(11) DEFAULT 0; 		  -- Market verticals number of users
	DECLARE de_127_075MV_CADENA TEXT DEFAULT NULL;
	
	
	DECLARE DS_RME TEXT DEFAULT NULL;  				  -- merchant equipment Structure
	DECLARE de_127_081 INT(11) DEFAULT 0; 		 	  -- merchant equipment ID
	DECLARE de_127_081_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_082 VARCHAR(99) DEFAULT ''; 	      -- merchant equipment other
	DECLARE de_127_082_CADENA TEXT DEFAULT NULL;
	DECLARE de_114_149 VARCHAR(99) DEFAULT 0; 		  -- brand
	DECLARE de_114_149_CADENA TEXT DEFAULT NULL;
	DECLARE de_127_075RME INT(11) DEFAULT 0; 		  -- merchant equipment number of users
	DECLARE de_127_075RME_CADENA TEXT DEFAULT NULL;

	
	DECLARE de_127_083 INT(11) DEFAULT 0;				-- flag account merchant management
	DECLARE de_127_084 INT(11) DEFAULT 0;				-- account merchant management id
	DECLARE de_127_085 VARCHAR(99) DEFAULT NULL;		-- account merchant management other
	DECLARE de_127_072 VARCHAR(5) DEFAULT 0;			-- Reseller services provider flag (for profile )
	DECLARE de_127_072f VARCHAR(5) DEFAULT 0;			-- Reseller services provider flag (for profile ) after bool

	
	
-- --------------------
-- Declare auxiliary --
-- --------------------	
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


-- ---------------
-- Validations  --
-- ---------------

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables  --
-- -----------------
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	
    SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
	SET de_117_023 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.23');
	SET de_121_148 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.148');
	
	-- Breakdown of type of accounts Structure
	SELECT DATA INTO DS_BT FROM TBL_MESSAGE1 WHERE CODE = "BT";
	SET DS_BT = (SELECT CONVERT(unhex(DS_BT) USING utf8 ));
	SET DS_BT = REPLACE(DS_BT,'{"1','{"_1');
	SET DS_BT = REPLACE(DS_BT,',"1',',"_1');
	SET DS_BT = REPLACE(DS_BT,'{"5','{"_5');
	SET DS_BT = REPLACE(DS_BT,',"5',',"_5');

	SET de_127_073_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_BT":',DS_BT,'}'),'//_127.73'));
	SET de_127_074_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_BT":',DS_BT,'}'),'//_127.74'));
	SET de_127_075BR_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_BT":',DS_BT,'}'),'//_127.75'));
	
	-- Front end processors Structure
	SELECT DATA INTO DS_FEP FROM TBL_MESSAGE1 WHERE CODE = "FE";
	SET DS_FEP = (SELECT CONVERT(unhex(DS_FEP) USING utf8 ));
	SET DS_FEP = REPLACE(DS_FEP,'{"1','{"_1');
	SET DS_FEP = REPLACE(DS_FEP,',"1',',"_1');
	SET DS_FEP = REPLACE(DS_FEP,'{"5','{"_5');
	SET DS_FEP = REPLACE(DS_FEP,',"5',',"_5');
		
	SET de_127_076_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_FE":',DS_FEP,'}'),'//_127.76'));
	SET de_127_075FEP_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_FE":',DS_FEP,'}'),'//_127.75'));
	
	-- Merchant Per Country Structure
	SELECT DATA INTO DS_MPC FROM TBL_MESSAGE1 WHERE CODE = "MC";
	SET DS_MPC = (SELECT CONVERT(unhex(DS_MPC) USING utf8 ));
	SET DS_MPC = REPLACE(DS_MPC,'{"1','{"_1');
	SET DS_MPC = REPLACE(DS_MPC,',"1',',"_1');
	SET DS_MPC = REPLACE(DS_MPC,'{"5','{"_5');
	SET DS_MPC = REPLACE(DS_MPC,',"5',',"_5');
	
	SET de_122_087_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_MC":',DS_MPC,'}'),'//_122.87'));
	SET de_127_075MPC_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_MC":',DS_MPC,'}'),'//_127.75'));
	
	
	-- Full Time Employees Structure
	SELECT DATA INTO DS_FTE FROM TBL_MESSAGE1 WHERE CODE = "FT";
	SET DS_FTE = (SELECT CONVERT(unhex(DS_FTE) USING utf8 ));
	SET DS_FTE = REPLACE(DS_FTE,'{"1','{"_1');
	SET DS_FTE = REPLACE(DS_FTE,',"1',',"_1');
	SET DS_FTE = REPLACE(DS_FTE,'{"5','{"_5');
	SET DS_FTE = REPLACE(DS_FTE,',"5',',"_5');
	
	SET de_127_077_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_FT":',DS_FTE,'}'),'//_127.77'));
	SET de_127_075FTE_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_FT":',DS_FTE,'}'),'//_127.75'));

	
	-- Resellers Working with you
	SELECT DATA INTO DS_RWY FROM TBL_MESSAGE1 WHERE CODE = "RY";
	SET DS_RWY = (SELECT CONVERT(unhex(DS_RWY) USING utf8 ));
	SET DS_RWY = REPLACE(DS_RWY,'{"1','{"_1');
	SET DS_RWY = REPLACE(DS_RWY,',"1',',"_1');
	SET DS_RWY = REPLACE(DS_RWY,'{"5','{"_5');
	SET DS_RWY = REPLACE(DS_RWY,',"5',',"_5');
	
	SET de_127_078_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_RY":',DS_RWY,'}'),'//_127.78'));
	SET de_127_075RWY_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_RY":',DS_RWY,'}'),'//_127.75'));
	
	
	-- Market verticals
	SELECT DATA INTO DS_MV FROM TBL_MESSAGE1 WHERE CODE = "MV";
	SET DS_MV = (SELECT CONVERT(unhex(DS_MV) USING utf8 ));
	SET DS_MV = REPLACE(DS_MV,'{"1','{"_1');
	SET DS_MV = REPLACE(DS_MV,',"1',',"_1');
	SET DS_MV = REPLACE(DS_MV,'{"5','{"_5');
	SET DS_MV = REPLACE(DS_MV,',"5',',"_5');
	
	SET de_127_079_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_MV":',DS_MV,'}'),'//_127.79'));
	SET de_127_080_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_MV":',DS_MV,'}'),'//_127.80'));
	SET de_127_075MV_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_MV":',DS_MV,'}'),'//_127.75'));
	
	
	-- merchant equipment
	SELECT DATA INTO DS_RME FROM TBL_MESSAGE1 WHERE CODE = "ME";
	SET DS_RME = (SELECT CONVERT(unhex(DS_RME) USING utf8 ));
	SET DS_RME = REPLACE(DS_RME,'{"1','{"_1');
	SET DS_RME = REPLACE(DS_RME,',"1',',"_1');
	SET DS_RME = REPLACE(DS_RME,'{"5','{"_5');
	SET DS_RME = REPLACE(DS_RME,',"5',',"_5');
	
	SET de_127_081_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_ME":',DS_RME,'}'),'//_127.81'));
	SET de_127_082_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_ME":',DS_RME,'}'),'//_127.82'));
	SET de_114_149_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_ME":',DS_RME,'}'),'//_114.149'));
	SET de_127_075RME_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_ME":',DS_RME,'}'),'//_127.75'));
	
	SET de_127_083 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.83');
	SET de_127_084 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.84');
	SET de_127_085 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.85');
	SET de_127_072 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.72');
	
    SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');
    
    
	IF de_127_072 = 'true' THEN
		set de_127_072f= 1;
	else
		set de_127_072f= 0;
	END IF;
	
	
	
-- ---------------		
-- Query of DB  --
-- ---------------

		UPDATE tbl_reseller set 
		tbl_reseller_iso_type= COALESCE(de_117_023,tbl_reseller_iso_type),
		tbl_reseller_years_in_business= COALESCE(de_121_148,tbl_reseller_years_in_business),
		tbl_reseller_flag_account_merchant_management= COALESCE(de_127_083,tbl_reseller_flag_account_merchant_management),
		tbl_reseller_account_merchant_management_id = COALESCE(de_127_084,tbl_reseller_account_merchant_management_id),
		tbl_reseller_account_merchant_management_other=COALESCE(de_127_085,tbl_reseller_account_merchant_management_other),
		tbl_reseller_servicesProvider_f= COALESCE(de_127_072f,tbl_reseller_servicesProvider_f),
        tbl_reseller_taxNumber = COALESCE(de_123_071, tbl_reseller_taxNumber)
		WHERE tbl_user_id = de_053;

		
		if de_117_023 = '5434' then
        
			update tbl_user set
            tbl_agent_type_id = 74004
            where tbl_user_id = de_053;

		end if;
        
        
        if de_114_009 = 'false' then
        
			update tbl_user set
            tbl_user_userTemp_f = 0
            where tbl_user_id = de_053
            and tbl_user_userTemp_f = 1;

		end if;

			update tbl_user set
            tbl_userstatus_id = 33
			where tbl_user_id = de_053;

		-- Breakdown of type of accounts Structure	
		IF LENGTH(de_127_073_CADENA)>0 THEN
		
			DELETE FROM tbl_reseller_breakdown_types_accounts WHERE tbl_reseller_user_id=de_053;
			
			while (LENGTH(de_127_073_CADENA)>0) DO
			
				SET de_127_073 = (SELECT SUBSTR(de_127_073_CADENA,1,LOCATE('|',de_127_073_CADENA)-1));
				SET de_127_073_CADENA = (SELECT SUBSTR(de_127_073_CADENA,LOCATE('|',de_127_073_CADENA)+1));
				
				if de_127_073 = '5333' then
					SET de_127_074 = (SELECT SUBSTR(de_127_074_CADENA,1,LOCATE('|',de_127_074_CADENA)-1));
					SET de_127_074_CADENA = (SELECT SUBSTR(de_127_074_CADENA,LOCATE('|',de_127_074_CADENA)+1));
				end if;
				
				SET de_127_075BR = (SELECT SUBSTR(de_127_075BR_CADENA,1,LOCATE('|',de_127_075BR_CADENA)-1));
				SET de_127_075BR_CADENA = (SELECT SUBSTR(de_127_075BR_CADENA,LOCATE('|',de_127_075BR_CADENA)+1));

			  
				insert into tbl_reseller_breakdown_types_accounts set
				tbl_reseller_user_id  = de_053,
				tbl_breakdown_types_accounts_id 			= COALESCE(TRIM(de_127_073),tbl_breakdown_types_accounts_id),
				tbl_reseller_breakdown_types_accounts_other = COALESCE(TRIM(de_127_074),tbl_reseller_breakdown_types_accounts_other),
				tbl_number_of_merchants  					= COALESCE(TRIM(de_127_075BR),tbl_number_of_merchants);

			end while ; 
				
		END IF;	


		-- Front end processors Structure
		IF LENGTH(de_127_076_CADENA)>0 THEN
		
			DELETE FROM tbl_reseller_front_end_processor WHERE tbl_reseller_user_id=de_053;
			
			while (LENGTH(de_127_076_CADENA)>0) DO
			
				SET de_127_076 = (SELECT SUBSTR(de_127_076_CADENA,1,LOCATE('|',de_127_076_CADENA)-1));
				SET de_127_076_CADENA = (SELECT SUBSTR(de_127_076_CADENA,LOCATE('|',de_127_076_CADENA)+1));

				SET de_127_075FEP = (SELECT SUBSTR(de_127_075FEP_CADENA,1,LOCATE('|',de_127_075FEP_CADENA)-1));
				SET de_127_075FEP_CADENA = (SELECT SUBSTR(de_127_075FEP_CADENA,LOCATE('|',de_127_075FEP_CADENA)+1));
				

				insert into tbl_reseller_front_end_processor set
				tbl_reseller_user_id       = de_053,
				tbl_reseller_front_end_processor 					= COALESCE(TRIM(de_127_076),tbl_reseller_front_end_processor),
				tbl_reseller_front_end_processor_number_of_merchants= COALESCE(TRIM(de_127_075FEP),tbl_reseller_front_end_processor_number_of_merchants);
			end while ; 
				
		END IF;	
		
		
		-- Merchant Per Country Structure
		
		IF LENGTH(de_122_087_CADENA)>0 THEN
		
			DELETE FROM tbl_reseller_merchants_per_country WHERE tbl_reseller_user_id=de_053;
			
			while (LENGTH(de_122_087_CADENA)>0) DO
			
				SET de_122_087 = (SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1));
				SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));

				SET de_127_075MPC = (SELECT SUBSTR(de_127_075MPC_CADENA,1,LOCATE('|',de_127_075MPC_CADENA)-1));
				SET de_127_075MPC_CADENA = (SELECT SUBSTR(de_127_075MPC_CADENA,LOCATE('|',de_127_075MPC_CADENA)+1));
				

				insert into tbl_reseller_merchants_per_country set
				tbl_reseller_user_id = de_053,
				tbl_country_id  = COALESCE(TRIM(de_122_087),tbl_country_id),
				tbl_merchants_per_country= COALESCE(TRIM(de_127_075MPC),tbl_merchants_per_country);
			end while ; 
				
		END IF;	
		
		
		-- Full Time Employees Structure
		
		IF LENGTH(de_127_077_CADENA)>0 THEN
		
			DELETE FROM tbl_reseller_full_time_employees WHERE tbl_reseller_user_id=de_053;
		
			while (LENGTH(de_127_077_CADENA)>0) DO
		
				SET de_127_077 = (SELECT SUBSTR(de_127_077_CADENA,1,LOCATE('|',de_127_077_CADENA)-1));
				SET de_127_077_CADENA = (SELECT SUBSTR(de_127_077_CADENA,LOCATE('|',de_127_077_CADENA)+1));
				
				SET de_127_075FTE = (SELECT SUBSTR(de_127_075FTE_CADENA,1,LOCATE('|',de_127_075FTE_CADENA)-1));
				SET de_127_075FTE_CADENA = (SELECT SUBSTR(de_127_075FTE_CADENA,LOCATE('|',de_127_075FTE_CADENA)+1));
		
				insert into tbl_reseller_full_time_employees set
				tbl_reseller_user_id = de_053,
				tbl_full_time_employees_id  = COALESCE(TRIM(de_127_077),tbl_full_time_employees_id),
				tbl_number_of_full_time_employees= COALESCE(TRIM(de_127_075FTE),tbl_number_of_full_time_employees);
			end while ; 
		
		
		END IF;
		
		
		-- Resellers Working with you
		
		IF LENGTH(de_127_078_CADENA)>0 THEN
			DELETE FROM tbl_resellers_working_with WHERE tbl_reseller_user_id=de_053;
		
			while (LENGTH(de_127_078_CADENA)>0) DO
				
				SET de_127_078 = (SELECT SUBSTR(de_127_078_CADENA,1,LOCATE('|',de_127_078_CADENA)-1));
				SET de_127_078_CADENA = (SELECT SUBSTR(de_127_078_CADENA,LOCATE('|',de_127_078_CADENA)+1));
				
				SET de_127_075RWY = (SELECT SUBSTR(de_127_075RWY_CADENA,1,LOCATE('|',de_127_075RWY_CADENA)-1));
				SET de_127_075RWY_CADENA = (SELECT SUBSTR(de_127_075RWY_CADENA,LOCATE('|',de_127_075RWY_CADENA)+1));
				
		
		
				insert into tbl_resellers_working_with set
				tbl_reseller_user_id = de_053,
				tbl_working_resellers_id = COALESCE(TRIM(de_127_078),tbl_working_resellers_id),
				tbl_working_resellers_number = COALESCE(TRIM(de_127_075RWY),tbl_working_resellers_number);
			end while ; 
		END IF;
		
		
		-- Market verticals
		
		IF LENGTH(de_127_079_CADENA)>0 THEN
			DELETE FROM tbl_reseller_market_verticals WHERE tbl_reseller_user_id=de_053;
		
			while (LENGTH(de_127_079_CADENA)>0) DO
				
				SET de_127_079 = (SELECT SUBSTR(de_127_079_CADENA,1,LOCATE('|',de_127_079_CADENA)-1));
				SET de_127_079_CADENA = (SELECT SUBSTR(de_127_079_CADENA,LOCATE('|',de_127_079_CADENA)+1));
				
				IF de_127_079 = '5838' THEN
                
					SET de_127_080 = (SELECT SUBSTR(de_127_080_CADENA,1,LOCATE('|',de_127_080_CADENA)-1));
					SET de_127_080_CADENA = (SELECT SUBSTR(de_127_080_CADENA,LOCATE('|',de_127_080_CADENA)+1));
				
                ELSEIF de_127_079 = '5831' THEN

                    INSERT INTO dbuser.tbl_resellerbusinesscategory (
					tbl_reseller_nmcId,
					tbl_businesscategory_id) 
					values (de_053,730),
						   (de_053,731),
						   (de_053,732),
						   (de_053,733),
						   (de_053,734),
						   (de_053,735),
                           (de_053,736),
                           (de_053,737),
                           (de_053,738),
                           (de_053,739);

                ELSEIF de_127_079 = '5832' THEN

                    INSERT INTO dbuser.tbl_resellerbusinesscategory (
					tbl_reseller_nmcId,
					tbl_businesscategory_id) 
					values (de_053,1094),
						   (de_053,1095),
						   (de_053,1096),
						   (de_053,1097),
						   (de_053,1098),
						   (de_053,1099);
                    
				ELSEIF de_127_079 = '5833' THEN
                
					INSERT INTO dbuser.tbl_resellerbusinesscategory (
					tbl_reseller_nmcId,
					tbl_businesscategory_id) 
					values (de_053,1088),
						   (de_053,1089),
						   (de_053,1090),
						   (de_053,1091),
						   (de_053,1092),
						   (de_053,1093);
                           
				ELSEIF de_127_079 = '5834' THEN
                
					INSERT INTO dbuser.tbl_resellerbusinesscategory (
					tbl_reseller_nmcId,
					tbl_businesscategory_id) 
					values (de_053,1100),
						   (de_053,1101),
						   (de_053,1102),
						   (de_053,1103),
						   (de_053,1104),
						   (de_053,1105);
                           
				ELSEIF de_127_079 = '5835' THEN
                
					INSERT INTO dbuser.tbl_resellerbusinesscategory (
					tbl_reseller_nmcId,
					tbl_businesscategory_id) 
					values (de_053,1710),
						   (de_053,1711),
						   (de_053,1712),
						   (de_053,1713),
						   (de_053,1714),
						   (de_053,1715);
                           
                END IF;
				
				SET de_127_075MV = (SELECT SUBSTR(de_127_075MV_CADENA,1,LOCATE('|',de_127_075MV_CADENA)-1));
				SET de_127_075MV_CADENA = (SELECT SUBSTR(de_127_075MV_CADENA,LOCATE('|',de_127_075MV_CADENA)+1));
				
						
				insert into tbl_reseller_market_verticals set
				tbl_reseller_user_id = de_053,
				tbl_market_verticals_type_id = COALESCE(TRIM(de_127_079),tbl_market_verticals_type_id),
				tbl_market_verticals_type_other = COALESCE(TRIM(de_127_080),tbl_market_verticals_type_other),
				tbl_number_of_merchants = COALESCE(TRIM(de_127_075MV),tbl_number_of_merchants);
			end while ; 
            
		END IF;
		
		
		
		-- merchant equipment
		
		IF LENGTH(de_127_081_CADENA)>0 THEN
			DELETE FROM tbl_reseller_merchant_equipment WHERE tbl_reseller_user_id=de_053;
			
			while (LENGTH(de_127_081_CADENA)>0) DO
		
				SET de_127_081 = (SELECT SUBSTR(de_127_081_CADENA,1,LOCATE('|',de_127_081_CADENA)-1));
				SET de_127_081_CADENA = (SELECT SUBSTR(de_127_081_CADENA,LOCATE('|',de_127_081_CADENA)+1));
				
				
				IF de_127_081 = '5735' THEN
					SET de_127_082 = (SELECT SUBSTR(de_127_082_CADENA,1,LOCATE('|',de_127_082_CADENA)-1));
					SET de_127_082_CADENA = (SELECT SUBSTR(de_127_082_CADENA,LOCATE('|',de_127_082_CADENA)+1));
				END IF;
				
				SET de_114_149 = (SELECT SUBSTR(de_114_149_CADENA,1,LOCATE('|',de_114_149_CADENA)-1));
				SET de_114_149_CADENA = (SELECT SUBSTR(de_114_149_CADENA,LOCATE('|',de_114_149_CADENA)+1));
				
				SET de_127_075RME = (SELECT SUBSTR(de_127_075RME_CADENA,1,LOCATE('|',de_127_075RME_CADENA)-1));
				SET de_127_075RME_CADENA = (SELECT SUBSTR(de_127_075RME_CADENA,LOCATE('|',de_127_075RME_CADENA)+1));
				
				insert into tbl_reseller_merchant_equipment set
				tbl_reseller_user_id = de_053,
				tbl_merchant_equipment_for_physical_location_id = COALESCE(TRIM(de_127_081),tbl_merchant_equipment_for_physical_location_id),
				tbl_merchant_equipment_for_physical_location_other = COALESCE(TRIM(de_127_082),tbl_merchant_equipment_for_physical_location_other),
				tbl_brand = COALESCE(TRIM(de_114_149),tbl_brand),
				tbl_number_of_merchants = COALESCE(TRIM(de_127_075RME),tbl_number_of_merchants);
		
		
			end while ;
		END IF;
		
		
		-- Commissions
		
		if (select tbl_user_id from dbcommission.tbl_commission_rates where tbl_user_id = de_053 limit 1) is null then
		
			insert into dbcommission.tbl_commission_rates set
			tbl_user_id = de_053,
			tbl_commission_rates_payPeriod_start = '2015-01-01',
			tbl_commission_rates_payPeriod_end = '2015-12-31',
			tbl_commission_rates_payPeriod_accountsGoal = 10,
			tbl_commission_rates_payPeriod_bonusGoal = 8,
			tbl_commission_rates_subs = 15.00,
			tbl_commission_rates_devices = 15.00,
			tbl_commission_rates_signing = 40.00,
			tbl_commission_rates_overGoalBonus = 20.00,
			tbl_commission_rates_goalMet = 100.00,
			tbl_commission_rates_tier1 = 25.00,
			tbl_commission_rates_tier2 = 50.00,
			tbl_commission_rates_tier3 = 75.00;
			
		end if;
		

	select GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}')) as JSON;
		
	DROP TABLE TBL_MESSAGE1;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditMerchantInfoApitap020400588` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddEditMerchantInfoApitap020400588`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53  VARCHAR(20) DEFAULT NULL;    	-- 53 User Id	
	DECLARE de_114_001 VARCHAR(99) DEFAULT NULL; 	-- 114.1 Company Id
    DECLARE de_121_077 VARCHAR(70) DEFAULT NULL; 	-- 121.77 Logo
	DECLARE de_114_149 VARCHAR(99) DEFAULT NULL; 	-- 114.149 Brand
    DECLARE de_121_078 VARCHAR(70) DEFAULT NULL; 	-- 121-78 Skin
	DECLARE de_048_028 VARCHAR(20) DEFAULT NULL; 	-- 48.28 Phone
    DECLARE de_114_007 VARCHAR(99) DEFAULT NULL; 	-- 114.7 Email

	DECLARE COMPANY_ID INT(11) DEFAULT NULL; 	

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
	SET de_114_001 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.1');
	SET de_121_077 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.77');
	SET de_114_149 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.149');
    SET de_121_078 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.78');
	SET de_048_028 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '48.28');
    SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
 

	if length(de_53)>0 then
 
		if (select tbl_merchant_info_id from dbuser.tbl_merchant_info where tbl_user_id = de_53) is null then 

			if length(de_114_001)>0 then
				set COMPANY_ID = de_114_001;
			else
				set COMPANY_ID = (select tbl_company_id from tbl_user where tbl_user_id = de_53);
			end if;
		
			insert into dbuser.tbl_merchant_info set 
			tbl_company_id = COMPANY_ID,
			tbl_user_id = de_53,
			tbl_merchant_logo = de_121_077,
			tbl_merchant_brand = de_114_149,
			tbl_merchant_skin = de_121_078,
			tbl_merchant_phone = de_048_028,
			tbl_merchant_email = de_114_007;
			
		else
			
			update dbuser.tbl_merchant_info set
			tbl_merchant_logo = COALESCE(de_121_077, tbl_merchant_logo),
			tbl_merchant_brand = COALESCE(de_114_149, tbl_merchant_brand),
			tbl_merchant_skin = COALESCE(de_121_078, tbl_merchant_skin),
			tbl_merchant_phone = COALESCE(de_048_028, tbl_merchant_phone),
			tbl_merchant_email = COALESCE(de_114_007, tbl_merchant_email)
			where tbl_user_id = de_53;
		
		end if;
		
	else
	
		update dbuser.tbl_merchant_info set
		tbl_merchant_logo = COALESCE(de_121_077, tbl_merchant_logo),
		tbl_merchant_brand = COALESCE(de_114_149, tbl_merchant_brand),
		tbl_merchant_skin = COALESCE(de_121_078, tbl_merchant_skin),
		tbl_merchant_phone = COALESCE(de_048_028, tbl_merchant_phone),
		tbl_merchant_email = COALESCE(de_114_007, tbl_merchant_email)
		where tbl_user_id is NULL;
	
	end if;


	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
	

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;


	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditNoteByLead030400670` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddEditNoteByLead030400670`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_127_057 VARCHAR(20) DEFAULT NULL; 
    
	DECLARE de_124_130 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_131 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_132 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_133 TEXT DEFAULT NULL; 	
	DECLARE de_124_134 VARCHAR(5) DEFAULT NULL; 	
	DECLARE de_124_135 VARCHAR(5) DEFAULT NULL; 	
	DECLARE de_124_136 VARCHAR(5) DEFAULT NULL; 
	DECLARE de_124_137 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_138 VARCHAR(99) DEFAULT NULL; 
	
    DECLARE de_114_009 VARCHAR(5) DEFAULT NULL; 
    DECLARE de_114_007 VARCHAR(255) DEFAULT NULL; 	
    DECLARE de_114_012 VARCHAR(255) DEFAULT NULL; 
    DECLARE de_121_140 DATETIME DEFAULT NULL; 
    DECLARE de_121_141 DATETIME DEFAULT NULL; 
	DECLARE de_120_103 VARCHAR(255) DEFAULT NULL; 
    
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	
    SET de_127_057 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.57');
	SET de_127_057 = (select right(de_127_057,11));
    
    SET de_124_130 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.130');
    SET de_124_131 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.131');
    SET de_124_132 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.132');
    SET de_124_133 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.133');
    SET de_124_134 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.134');
    SET de_124_135 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.135');
    SET de_124_136 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.136');
    SET de_124_137 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.137');
    SET de_124_138 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '124.138');
    
    SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
    SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
    SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.12');
    SET de_121_140 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.140');
    SET de_121_141 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.141');
    SET de_120_103 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.103');
    
	case de_124_131 
		when 'G'  then set de_124_131 = 'General';
		when 'FU' then set de_124_131 = 'Follow Up';
		when 'RE' then set de_124_131 = 'Refusal';
		when 'SH' then set de_124_131 = 'Share';
		else set de_124_131 = 'General';
	end case;
	
    if length(de_124_130) > 0 then
    
		if de_114_009 = 'true' then
        
			insert into dbuser.tbl_crm_activity set
			tbl_editor_id = de_127_057,
			tbl_user_id = de_053,
			tbl_activity_field = 'Calendar event',
			tbl_activity_value_old = (select tbl_crm_note_comments from tbl_crm_note where tbl_crm_note_id = de_124_130),
			tbl_activity_value_new = CONVERT(unhex(de_124_133) USING UTF8),
			tbl_activity_date = NOW();
        
        else
        
			insert into dbuser.tbl_crm_activity set
			tbl_editor_id = de_127_057,
			tbl_user_id = de_053,
			tbl_activity_field = 'Note',
			tbl_activity_value_old = (select tbl_crm_note_comments from tbl_crm_note where tbl_crm_note_id = de_124_130),
			tbl_activity_value_new = CONVERT(unhex(de_124_133) USING UTF8),
			tbl_activity_date = NOW();
        
        end if;
    
		update dbuser.tbl_crm_note set
		tbl_crm_note_type = de_124_131,
		tbl_crm_note_date = COALESCE(de_124_132,NOW()),
		tbl_crm_note_comments = CONVERT(unhex(de_124_133) USING UTF8),
        tbl_crm_note_calendar_f = if(de_114_009 = 'true',1,0),
		tbl_crm_note_priority_f = if(de_124_134 = 'true',1,0),
		tbl_crm_note_reminder_f = if(de_124_135 = 'true',1,0),
		tbl_crm_note_share_f = if(de_124_136 = 'true',1,0),
		tbl_crm_note_reminder_date = COALESCE(de_124_137, tbl_crm_note_reminder_date),
		tbl_crm_note_username = COALESCE(de_124_138, tbl_crm_note_username),
        tbl_crm_note_email = COALESCE(de_114_007, tbl_crm_note_email),
		tbl_crm_note_location = COALESCE(de_114_012, tbl_crm_note_location),
		tbl_crm_note_startDate = COALESCE(de_121_140, tbl_crm_note_startDate),
		tbl_crm_note_endDate = COALESCE(de_121_141, tbl_crm_note_endDate),
        tbl_crm_note_googleEvent_id = COALESCE(de_120_103, tbl_crm_note_googleEvent_id),
        tbl_user_modifiedBy = COALESCE(de_127_057, tbl_user_modifiedBy)
        where tbl_crm_note_id = de_124_130
        and tbl_user_id = de_053;



    else



		if de_114_009 = 'true' then
        
			insert into dbuser.tbl_crm_activity set
			tbl_editor_id = de_127_057,
			tbl_user_id = de_053,
			tbl_activity_field = 'Calendar event',
			tbl_activity_value_new = CONVERT(unhex(de_124_133) USING UTF8),
			tbl_activity_date = NOW();
        
        else
        
			insert into dbuser.tbl_crm_activity set
			tbl_editor_id = de_127_057,
			tbl_user_id = de_053,
			tbl_activity_field = 'Note',
			tbl_activity_value_new = CONVERT(unhex(de_124_133) USING UTF8),
			tbl_activity_date = NOW();
        
        end if;
    
		insert into dbuser.tbl_crm_note set
		tbl_user_id = de_053,
		tbl_crm_note_type = de_124_131,
		tbl_crm_note_date = COALESCE(de_124_132,NOW()),
		tbl_crm_note_comments = CONVERT(unhex(de_124_133) USING UTF8),
        tbl_crm_note_calendar_f = if(de_114_009 = 'true',1,0),
		tbl_crm_note_priority_f = if(de_124_134='true',1,0),
		tbl_crm_note_reminder_f = if(de_124_135='true',1,0),
		tbl_crm_note_share_f = if(de_124_136='true',1,0),
		tbl_crm_note_reminder_date = de_124_137,
		tbl_crm_note_username = de_124_138,
        tbl_crm_note_email = de_114_007, 
		tbl_crm_note_location = de_114_012, 
		tbl_crm_note_startDate = de_121_140,
		tbl_crm_note_endDate = de_121_141,
        tbl_crm_note_googleEvent_id = de_120_103,
        tbl_user_modifiedBy = de_127_057;
	
    end if;
	
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
        
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
    GROUP_CONCAT(CONCAT('{"39":"', RESULT_39, '"'), CONCAT(',"44":"', RESULT_44, '"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditPermissionsAdversitingByUser020400593` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `AddEditPermissionsAdversitingByUser020400593`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53  VARCHAR(20) DEFAULT NULL;    	

	DECLARE de_122_046 VARCHAR(5) DEFAULT NULL;
    DECLARE de_122_047 VARCHAR(5) DEFAULT NULL;
    DECLARE de_122_048 VARCHAR(5) DEFAULT NULL;
    
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
    
	SET de_122_046 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.46');
    SET de_122_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.47');
	SET de_122_048 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.48');
	
    
	if (select tbl_permission_ad_id from tbl_permission_ad where tbl_user_id = de_53) is null then
	
		insert into tbl_permission_ad set
        tbl_user_id = de_53,
        tbl_permission_ad_create_f = if(de_122_046 = 'true',1,0),
		tbl_permission_ad_publish_f = if(de_122_047 = 'true',1,0),
        tbl_permission_item_viewOnly_f = if(de_122_048 = 'true',1,0);
        
	else
		
        update tbl_permission_ad set
        tbl_permission_ad_create_f = if(de_122_046 = 'true',1,0),
		tbl_permission_ad_publish_f = if(de_122_047 = 'true',1,0),
		tbl_permission_item_viewOnly_f = if(de_122_048 = 'true',1,0)
        where tbl_user_id = de_53;
        
	end if;

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
			

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditPermissionsByUser020400592` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `AddEditPermissionsByUser020400592`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53  VARCHAR(20) DEFAULT NULL;    	

    DECLARE de_CP TEXT DEFAULT NULL;               	  -- CP SubPermission Struct
	DECLARE de_122_037_CADENA TEXT DEFAULT NULL;      -- 122.37 SubPermission Id
	DECLARE de_114_009_CADENA TEXT DEFAULT NULL;      -- 114.9 Flag
	DECLARE de_122_037 INT(11) DEFAULT NULL;
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL;    
   
    DECLARE PERMISSION_ID INT(11) DEFAULT NULL;
   
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
    
	SELECT DATA INTO de_CP FROM TBL_MESSAGE WHERE CODE = "CP";
	SET de_CP = (SELECT CONVERT(unhex(de_CP) USING utf8 ));
	SET de_CP = REPLACE(de_CP,'{"1','{"_1');
	SET de_CP = REPLACE(de_CP,',"1',',"_1');
	SET de_122_037_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_CP":',de_CP,'}'),'//_122.37'));
	SET de_114_009_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_CP":',de_CP,'}'),'//_114.9'));

	
	if LENGTH(de_122_037_CADENA) >0 then
	
		while (LENGTH(de_122_037_CADENA)>0) DO

			SET de_122_037 = TRIM((SELECT SUBSTR(de_122_037_CADENA,1,LOCATE('|',de_122_037_CADENA)-1)));
			SET de_122_037_CADENA = (SELECT SUBSTR(de_122_037_CADENA,LOCATE('|',de_122_037_CADENA)+1));

			SET de_114_009 = TRIM((SELECT SUBSTR(de_114_009_CADENA,1,LOCATE('|',de_114_009_CADENA)-1)));
			SET de_114_009_CADENA = (SELECT SUBSTR(de_114_009_CADENA,LOCATE('|',de_114_009_CADENA)+1));
			
			SET PERMISSION_ID = (select tbl_permission_id from tbl_subpermission where tbl_subpermission_id = de_122_037);
			
            if length(PERMISSION_ID) > 0 then
            
				if (select tbl_user_id from tbl_permission_user where tbl_user_id = de_53 and tbl_permission_id = PERMISSION_ID and tbl_subpermission_id = de_122_037 limit 1) is null then 
				
					insert into tbl_permission_user set
					tbl_user_id = de_53,
					tbl_permission_id = PERMISSION_ID,
					tbl_subpermission_id = de_122_037,
					tbl_permission_user_status_f = if(de_114_009='true',1,0);
					
				else
				
					update tbl_permission_user set
					tbl_permission_user_status_f = if(de_114_009='true',1,0)
					where tbl_user_id = de_53
					and tbl_permission_id = PERMISSION_ID
					and tbl_subpermission_id = de_122_037;
					
				end if;
                
			end if;
            
		end while ; 
		
	
		if (select tbl_permission_user_status_f from dbuser.tbl_permission_user  where tbl_user_id = de_53 and tbl_subpermission_id = 3 limit 1) = 0 then
			
            if (select tbl_user_id from tbl_permission_ad where tbl_user_id = de_53 limit 1) is null then
				insert into tbl_permission_ad set
				tbl_user_id = de_53,
				tbl_permission_ad_create_f = 0,
				tbl_permission_ad_publish_f = 0,
				tbl_permission_item_viewOnly_f = 1;
            else
				update tbl_permission_ad set
				tbl_permission_item_viewOnly_f = 1
				where tbl_user_id = de_53;
			end if;
		end if;
        
	end if;

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
			

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditPhoneUser030400131` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddEditPhoneUser030400131`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  		
	DECLARE de_122_88 INT(11) DEFAULT NULL; 		
	DECLARE de_48_28 VARCHAR(20) DEFAULT NULL; 		
	DECLARE de_122_87 INT(11) DEFAULT NULL; 		
	DECLARE de_121_167 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_121_62 VARCHAR(45) DEFAULT NULL; 	
	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_88 VARCHAR(45) DEFAULT 0;




	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	SET  de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET  de_053 = (select right(de_053,11));
	SET  de_122_88 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.88');
	SET  de_48_28 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '48.28');
	SET  de_122_87 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.87');
	SET  de_121_167 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.167');
	SET  de_121_62 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.62');





	 IF (length(de_122_88) > 0) then


		update dbuser.tbl_phone
		   set tbl_phone_phoneNumber = COALESCE(de_48_28,tbl_phone_phoneNumber),
			   tbl_phone_extension 	= COALESCE(de_121_167,tbl_phone_extension),
			   tbl_phone_country_id = COALESCE(de_122_87,tbl_phone_country_id),
			   tbl_phonetype_id = COALESCE(de_121_62,tbl_phonetype_id)
		where tbl_phone_id = de_122_88
		and tbl_phone_nmcId = de_053;
		
		 insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		
	ELSE

		insert into dbuser.tbl_phone set
		tbl_phone_nmcId       = de_053,
		tbl_phone_phoneNumber = de_48_28,
		tbl_phone_extension   = de_121_167,
		tbl_phone_country_id  = de_122_87,
		tbl_phonetype_id      = de_121_62 ;

		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('122.88',LPAD((SELECT tbl_phone_id FROM tbl_phone ORDER BY tbl_phone_id DESC LIMIT 1),11,'0'));

	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	SET RESULT_122_88 = (select DATA from TBL_MESSAGE1 where CODE = 122.88);
		
	SELECT 
    GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.88":"',RESULT_122_88,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddEditRatingUser030400103` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddEditRatingUser030400103`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	

	DECLARE de_053 		    VARCHAR(20)		 DEFAULT 0;  
	DECLARE de_127_057 		VARCHAR(20) 		 DEFAULT 0; 
	DECLARE de_120_083 		VARCHAR(255) 	 DEFAULT NULL; 
	DECLARE de_120_157 		VARCHAR(255)  	 DEFAULT NULL; 
	DECLARE de_122_129  	INT(11)  		 DEFAULT NULL ; 
	DECLARE de_121_080 		INT(11) 		 DEFAULT 0; 
	



	DECLARE RATER_USER_TYPE INT(11) DEFAULT NULL;
	DECLARE RATED_USER_TYPE INT(11) DEFAULT NULL;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_121_80 VARCHAR(45) DEFAULT NULL;



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
        SET de_127_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.57');
		set de_127_057 = (select right(de_127_057,11));
		SET de_120_083 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.83');
		SET de_120_157 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.157');
		SET de_122_129 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.129'); 



		if (select tbl_rating_id from tbl_rating_user where tbl_rating_user_id_rated = de_127_057 and tbl_rating_user_id_rater = de_053 limit 1) is not null then
		
			set de_121_080 = (select tbl_rating_id from tbl_rating_user where tbl_rating_user_id_rated = de_127_057 and tbl_rating_user_id_rater = de_053 limit 1);

			UPDATE tbl_rating_user set 
			tbl_rating_rating =  COALESCE(de_122_129,tbl_rating_rating),
			tbl_rating_date_last_modified = now(),
			tbl_rating_status = 1,
			tbl_rating_read = 0,
			tbl_rating_description =  COALESCE(de_120_157,tbl_rating_description),
			tbl_rating_subject =   COALESCE(de_120_083,tbl_rating_subject)
			WHERE tbl_rating_id =de_121_080 ;
 
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('121.80',LPAD(de_121_080,11,'0'));

		else
			
			SET RATER_USER_TYPE = (SELECT tbl_user_entity from dbuser.tbl_user where tbl_user_id = de_053);
			SET RATED_USER_TYPE = (SELECT tbl_user_entity from dbuser.tbl_user where tbl_user_id = de_127_057);
			
			
			insert into tbl_rating_user set 
			tbl_rating_user_id_rated = de_127_057,
			tbl_rating_user_type_rated = RATED_USER_TYPE,
			tbl_rating_user_id_rater = de_053,
			tbl_rating_user_type_rater = RATER_USER_TYPE,
			tbl_rating_rating = de_122_129,
			tbl_rating_date_added = now(),
			tbl_rating_date_last_modified = now(),
			tbl_rating_status = 1,
			tbl_rating_read = 0,
			tbl_rating_description = de_120_157,
			tbl_rating_subject = de_120_083;
 
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('121.80',LPAD((SELECT tbl_rating_id FROM tbl_rating_user ORDER BY tbl_rating_id DESC LIMIT 1),11,'0'));

		end if;


	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	SET RESULT_121_80 = (select DATA from TBL_MESSAGE where CODE = 121.80);
		
	
	
	 SELECT 
    GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"121.80":"',RESULT_121_80,'"}')) AS JSON;
	
		
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddFavoriteLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddFavoriteLocation`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DECLARE de_114_47 INT(11) DEFAULT NULL; 
	DECLARE de_53     INT(18) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
		SET de_114_47 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');		
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		IF (SELECT tbl_favorite_location_user_id from tbl_favorite_location where tbl_favorite_location_user_id = de_53 and tbl_favorite_location_location_id = de_114_47 LIMIT 1) IS NOT NULL THEN
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2043'),('44','Duplicated Location');
		ELSE
			insert into tbl_favorite_location set
			tbl_favorite_location_user_id = de_53,
			tbl_favorite_location_location_id = de_114_47;
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
		END IF;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddFavoriteLocation030400087` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddFavoriteLocation030400087`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_114_47 INT(11) DEFAULT NULL; 
	DECLARE de_53      VARCHAR(20) DEFAULT NULL; 
	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		SET de_114_47 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');		
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_53 = (select right(de_53,11));
		



		IF (SELECT tbl_favorite_location_user_id from tbl_favorite_location where tbl_favorite_location_user_id = de_53 and tbl_favorite_location_location_id = de_114_47 LIMIT 1) IS NOT NULL THEN
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2043'),('44','Duplicated Location');
		ELSE
			insert into tbl_favorite_location set
			tbl_favorite_location_user_id = de_53,
			tbl_favorite_location_location_id = de_114_47;
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
		END IF;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddFavoriteMerchant` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddFavoriteMerchant`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DECLARE de_127_56 INT(11) DEFAULT NULL; 
	DECLARE de_53     INT(18) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
		SET de_127_56 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.56');		
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		IF (SELECT tbl_consumer_nmcid from tbl_merchantfav where tbl_consumer_nmcid = de_53 and tbl_merchant_nmcid = de_127_56 LIMIT 1) IS NOT NULL THEN
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2045'),('44','Duplicated Merchant');
		ELSE
			insert into tbl_merchantfav set
			tbl_consumer_nmcid = de_53,
			tbl_merchant_nmcid = de_127_56;
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
		END IF;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddFavoriteMerchant030400095` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddFavoriteMerchant030400095`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DECLARE de_127_56 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_53     VARCHAR(20) DEFAULT NULL; 



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	SET de_127_56 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.56');	
	set de_127_56 = (select right(de_127_56,11));
	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));





	IF (SELECT tbl_consumer_nmcid from tbl_merchantfav where tbl_consumer_nmcid = de_53 and tbl_merchant_nmcid = de_127_56 LIMIT 1) IS NOT NULL THEN

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','2045'),('44','Duplicated Merchant');

	ELSE

		insert into tbl_merchantfav set
		tbl_consumer_nmcid = de_53,
		tbl_merchant_nmcid = de_127_56,
		tbl_merchantfav_date = NOW();

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');

	END IF;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddLocationQRCodes030400469` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddLocationQRCodes030400469`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	

	
	DECLARE de_53 VARCHAR(20) DEFAULT 0;  		   		
	DECLARE de_114_047 INTEGER(11) DEFAULT NULL; 		
	
	DECLARE DE_QR TEXT DEFAULT NULL;					

	DECLARE de_114_102_C TEXT DEFAULT NULL;			
	DECLARE de_114_103_C TEXT DEFAULT NULL;			
	DECLARE de_114_104_C TEXT DEFAULT NULL;			
		
	DECLARE de_114_102 VARCHAR(255) DEFAULT 0;  	
	DECLARE de_114_103 VARCHAR(255) DEFAULT 0;  
	DECLARE de_114_104 VARCHAR(255) DEFAULT 0;  
    
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;


	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
		
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
        
	SET DE_QR = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'QR');	
	SET DE_QR = (SELECT CONVERT(unhex(DE_QR) USING utf8 ));
	
	SET DE_QR = REPLACE(DE_QR,'{"1','{"_1');
	SET DE_QR = REPLACE(DE_QR,',"1',',"_1');
	
	set de_114_102_C = (select common_schema.extract_json_value_nmc(concat('{"QR":', DE_QR ,'}'),'//_114.102'));	
	set de_114_103_C = (select common_schema.extract_json_value_nmc(concat('{"QR":', DE_QR ,'}'),'//_114.103'));			
	set de_114_104_C = (select common_schema.extract_json_value_nmc(concat('{"QR":', DE_QR ,'}'),'//_114.104'));	
	

	if (SELECT tbl_location_id FROM tbl_location where tbl_location_id = de_114_047) is null then
		
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2033'),('44','Invalid Location');
		
	else	

		IF (SELECT tbl_location_qrcode_id FROM tbl_location_qrcode WHERE tbl_location_id = de_114_047 LIMIT 1) IS NOT NULL THEN
			
			DELETE FROM tbl_location_qrcode WHERE tbl_location_id = de_114_047;
			
		END IF;

		WHILE (LENGTH(de_114_102_C)>0) DO

			SET de_114_102 = (SELECT SUBSTR(de_114_102_C,1,LOCATE('|',de_114_102_C)-1));
			SET de_114_102_C = (SELECT SUBSTR(de_114_102_C,LOCATE('|',de_114_102_C)+1));
			
			SET de_114_103 = (SELECT SUBSTR(de_114_103_C,1,LOCATE('|',de_114_103_C)-1));
			SET de_114_103_C = (SELECT SUBSTR(de_114_103_C,LOCATE('|',de_114_103_C)+1));
			
			SET de_114_104 = (SELECT SUBSTR(de_114_104_C,1,LOCATE('|',de_114_104_C)-1));
			SET de_114_104_C = (SELECT SUBSTR(de_114_104_C,LOCATE('|',de_114_104_C)+1));

			INSERT INTO tbl_location_qrcode set 
            tbl_user_id = de_53,
			tbl_location_id = de_114_047, 
			tbl_location_qrcode_name = COALESCE(TRIM(de_114_102),''),
			tbl_location_qrcode_code = COALESCE(TRIM(de_114_103),''),
			tbl_location_qrcode_image = COALESCE(TRIM(de_114_104),'');
	
		END WHILE;
				
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
	
	END IF;

	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
    
	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
		
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddLocationSchedule030400305` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddLocationSchedule030400305`(IN MSG_IN VARCHAR(20000))
BEGIN
     
    DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
     
     
    DECLARE de_53 VARCHAR(20) DEFAULT 0;                
    DECLARE de_114_047 INTEGER(11) DEFAULT NULL;        
    DECLARE de_120_012 VARCHAR(11) DEFAULT NULL;
     
    DECLARE DS_SL TEXT DEFAULT NULL;                    
 
    DECLARE de_127_089 VARCHAR(10) DEFAULT 0;           
    DECLARE de_127_090 VARCHAR(10) DEFAULT 0;           
    DECLARE de_127_090_flag INTEGER(10) DEFAULT 0;      
     
    DECLARE de_127_091 VARCHAR(10) DEFAULT NULL;        
    DECLARE de_127_091_flag VARCHAR(10) DEFAULT NULL;   
     
    DECLARE de_127_064 VARCHAR(15) DEFAULT '00:00:00';  
    DECLARE de_127_065 VARCHAR(15) DEFAULT '00:00:00';  
 
 
    DECLARE de_127_089_C TEXT DEFAULT 0;            
    DECLARE de_127_090_C TEXT DEFAULT 0;            
    DECLARE de_127_091_C TEXT DEFAULT NULL;         
    DECLARE de_127_064_C TEXT DEFAULT NULL;         
    DECLARE de_127_065_C TEXT DEFAULT NULL;         
     
 
     
    DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
    DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
     
 
 
 
 
     
    DROP TEMPORARY TABLE if exists TBL_MESSAGE;
     
     
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
         
     
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
     
 
 
 
 
 
 
    SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
    set de_53 = (select right(de_53,11));
     
    SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
    SET de_120_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.12');
     
    SET DS_SL = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'SL');
    SET DS_SL = (SELECT CONVERT(unhex(DS_SL) USING utf8 ));
 
    SET DS_SL = REPLACE(DS_SL,'{"1','{"_1');
    SET DS_SL = REPLACE(DS_SL,',"1',',"_1');
    SET DS_SL = REPLACE(DS_SL,'{"48','{"_48');
    SET DS_SL = REPLACE(DS_SL,',"48',',"_48');
    SET DS_SL = REPLACE(DS_SL,'{"47','{"_47');
     
    set de_127_089_C = (select common_schema.extract_json_value_nmc(concat('{"SL":', DS_SL ,'}'),'//_127.89')); 
    set de_127_090_C = (select common_schema.extract_json_value_nmc(concat('{"SL":', DS_SL ,'}'),'//_127.90'));         
    set de_127_091_C = (select common_schema.extract_json_value_nmc(concat('{"SL":', DS_SL ,'}'),'//_127.91')); 
    set de_127_064_C = (select common_schema.extract_json_value_nmc(concat('{"SL":', DS_SL ,'}'),'//_127.64')); 
    set de_127_065_C = (select common_schema.extract_json_value_nmc(concat('{"SL":', DS_SL ,'}'),'//_127.65')); 
     
 
 
    if (SELECT tbl_location_id FROM tbl_location where tbl_location_id = de_114_047) is null then
         
        insert into TBL_MESSAGE (CODE,DATA)
        values('39','2033'),('44','Invalid Location'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
         
    else   
 
        IF (SELECT tbl_location_schedule_id FROM tbl_location_schedule WHERE tbl_location_id = de_114_047 LIMIT 1) IS NOT NULL THEN
             
            DELETE FROM tbl_location_schedule WHERE tbl_location_id = de_114_047;
             
        END IF;
 
        WHILE (LENGTH(de_127_089_C)>0) DO
 
            SET de_127_089 = (SELECT SUBSTR(de_127_089_C,1,LOCATE('|',de_127_089_C)-1));
            SET de_127_089_C = (SELECT SUBSTR(de_127_089_C,LOCATE('|',de_127_089_C)+1));
             
            SET de_127_090 = (SELECT SUBSTR(de_127_090_C,1,LOCATE('|',de_127_090_C)-1));
            SET de_127_090_C = (SELECT SUBSTR(de_127_090_C,LOCATE('|',de_127_090_C)+1));
             
            SET de_127_091 = (SELECT SUBSTR(de_127_091_C,1,LOCATE('|',de_127_091_C)-1));
            SET de_127_091_C = (SELECT SUBSTR(de_127_091_C,LOCATE('|',de_127_091_C)+1));
             
            SET de_127_064 = (SELECT SUBSTR(de_127_064_C,1,LOCATE('|',de_127_064_C)-1));
            SET de_127_064_C = (SELECT SUBSTR(de_127_064_C,LOCATE('|',de_127_064_C)+1));
             
            SET de_127_065 = (SELECT SUBSTR(de_127_065_C,1,LOCATE('|',de_127_065_C)-1));
            SET de_127_065_C = (SELECT SUBSTR(de_127_065_C,LOCATE('|',de_127_065_C)+1));
         
         
 
            if TRIM(de_127_090) = 'true' then
                SET de_127_090_flag = '1';
                SET de_127_064 = '00:00:00';
                SET de_127_065 = '24:00:00';
            else
                SET de_127_090_flag = '0';                   
            end if;
         
            if TRIM(de_127_091) = 'true' then
                SET de_127_091_flag = '1';
            else
                SET de_127_091_flag = '0';
            end if;
             
            INSERT INTO tbl_location_schedule set
            tbl_location_id = de_114_047, 
            tbl_day_of_the_week = TRIM(de_127_089),
            tbl_24_hour = de_127_090_flag,
            tbl_closed_flag = de_127_091_flag,
            tbl_hour_open = TRIM(de_127_064),
            tbl_hour_close = TRIM(de_127_065),
            tbl_timezone = COALESCE(de_120_012,'+0000000000');
 
        END WHILE;
                 
 
        insert into TBL_MESSAGE (CODE,DATA)
        values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
     
 
    END IF;
 
     
    SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
    SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
     
    SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
         
     
    DROP TABLE TBL_MESSAGE;
  
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddLocationToWebsiteMerchant020400315` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddLocationToWebsiteMerchant020400315`(IN MSG_IN VARCHAR(20000))
BEGIN





 	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;       
	DECLARE de_120_038 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_120_039 VARCHAR(300) DEFAULT NULL;  
	
	DECLARE USER_NAME	VARCHAR(20) DEFAULT NULL;     
	DECLARE USER_EMAIL  VARCHAR(100) DEFAULT NULL;    
	DECLARE USER_WEB   VARCHAR(100) DEFAULT NULL;    

	DECLARE ADDRESSID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;  
	DECLARE PHONEIDL_AUX		VARCHAR(20) DEFAULT NULL; 



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	
	
	SET de_120_038 = (SELECT tbl_location_latitude FROM tbl_location WHERE   tbl_location_userId = de_053 LIMIT 1);
	SET de_120_039 = (SELECT tbl_location_longitude FROM tbl_location WHERE   tbl_location_userId = de_053 LIMIT 1);
	

	SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= de_053 limit 1);
	SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id= de_053 limit 1);
	SET USER_WEB = (SELECT tbl_merchant_online_store FROM tbl_merchant WHERE tbl_user_id= de_053 limit 1);

	IF USER_WEB IS NULL OR USER_WEB = '' THEN 
		SET USER_WEB = 'Online Store';
	END IF;
	
	
	IF(SELECT tbl_location_id from tbl_location where tbl_location_userId = de_053 and tbl_location_statusId = 7001 limit 1) is null then

		IF (SELECT tbl_address_id FROM tbl_address where tbl_address_nmcId = de_053 limit 1) IS not null then
			INSERT INTO tbl_location SET 
			tbl_location_storeNumber= coalesce(USER_WEB,'Online Location 1') ,
			tbl_location_storeName= Coalesce(USER_WEB,'Online Store'),
			tbl_location_contactName = USER_NAME, 
			tbl_location_contactEmail = USER_EMAIL, 
			tbl_location_userId = de_053,
			tbl_location_latitude = coalesce(de_120_038,''),
			tbl_location_longitude= coalesce(de_120_039,''),
			tbl_location_statusId= 7001;
			
			SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);
				
			SET ADDRESSID_AUX= (SELECT tbl_address_id FROM tbl_address where tbl_address_nmcId = de_053 limit 1);
		 
			INSERT tbl_locationaddress SET
			tbl_location_id = LOCATIONID_AUX, 
			tbl_address_id = ADDRESSID_AUX;
			
			
			INSERT tbl_phone SET
					tbl_phone_phoneNumber = coalesce(
													 (select A.tbl_phone_phoneNumber from tbl_phone as A where A.tbl_phone_nmcId = de_053 and A.tbl_phonetype_id = 4001 limit 1),
													 (select A.tbl_phone_phoneNumber from tbl_phone as A where A.tbl_phone_nmcId = de_053 limit 1)
													 ),
					tbl_phone_extension = coalesce(
													(select A.tbl_phone_extension from tbl_phone as A where A.tbl_phone_nmcId = de_053 and A.tbl_phonetype_id = 4001 limit 1),
													(select A.tbl_phone_extension from tbl_phone as A  where A.tbl_phone_nmcId = de_053 limit 1)
													),
					tbl_phone_nmcId = 0,
					tbl_phone_country_id = coalesce(
													(select A.tbl_phone_country_id from tbl_phone as A where A.tbl_phone_nmcId = de_053 and A.tbl_phonetype_id = 4001 limit 1),
													(select A.tbl_phone_country_id from tbl_phone as A where A.tbl_phone_nmcId = de_053  limit 1)
													),
					tbl_phonetype_id = 4001;
			
			SET PHONEIDL_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);
			
			INSERT tbl_locationphone SET
			tbl_phone_id = PHONEIDL_AUX,
			tbl_location_id=LOCATIONID_AUX;
			
			
			
		end if;
	else
		UPDATE tbl_location SET
		tbl_location_storeName= Coalesce(USER_WEB,'Online Store')
		WHERE
		tbl_location_userId = de_053  and (tbl_location_storeNumber= 'Online Location 1' or tbl_location_storeNumber= USER_WEB);
	

	end if;

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.47":"',coalesce(LOCATIONID_AUX,0),'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddMailCampaignByUserId030400399` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddMailCampaignByUserId030400399`(IN MSG_IN VARCHAR(20000))
BEGIN


-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_138 DATETIME DEFAULT NULL; 
    
-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE CAMPAIGNID_AUX INTEGER(11) DEFAULT 0;
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations  --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

        SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
		SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
		SET de_114_138 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.138');
		
-- ---------------		
-- Query of DB  --
-- ---------------

	if (select id from tbl_mailcampaign where usernmcIdstr = de_053 and name = de_114_053 limit 1) is not null then

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','2020'),('44','Duplicated Name');
	
	else
	
		insert into tbl_mailcampaign set 
		usernmcIdstr = de_053,
		name = de_114_053,
		mailContent = '',
		createdDate = de_114_138,
		updateDate = NULL;

		set CAMPAIGNID_AUX = (SELECT last_insert_id() FROM tbl_mailcampaign limit 1);		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		
	end if;

	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"117.10":"',COALESCE(CAMPAIGNID_AUX,0),'"}') ) AS JSON;
	
	
	DROP TABLE TBL_MESSAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddMerchantAccountToLocationByLocationId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddMerchantAccountToLocationByLocationId`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_114_047 INT(11) DEFAULT 0;
	DECLARE de_114_073 INT(11) DEFAULT 0;
    DECLARE de_114_179 INT(11) DEFAULT 0;
	DECLARE de_122_121 VARCHAR(45) DEFAULT NULL;
	DECLARE de_122_120 VARCHAR(45) DEFAULT NULL;
	DECLARE de_114_7 VARCHAR(255) DEFAULT NULL;
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;   
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;  
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;  
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;  
	DECLARE de_122_87 VARCHAR(15) DEFAULT NULL;  




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE PHONE_ID BIGINT(20) DEFAULT 0;	
	DECLARE ADMINNMCID_AUX INT(11) DEFAULT 0;
	DECLARE MERCHANTACCOUNT_ID INT(11) DEFAULT 0;

	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1
 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message1 Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
	
    SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.47');
	SET de_122_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.121');
	SET de_122_120 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.120');
	SET de_114_7 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '300.84');
			SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
			SET de_122_088 = common_schema.get_option( de_300_084, "122.88" );
			SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
			SET de_122_87 = common_schema.get_option( de_300_084, "122.87" );
	

		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;




		if (select tbl_location_id from tbl_location where  tbl_location_id = de_114_047) then 
	
						insert into tbl_phone SET
							tbl_phone_phoneNumber = de_048_028,
							tbl_phone_extension = de_121_167,
							tbl_phone_country_id = de_122_87,
							tbl_phonetype_id = 4001;

						
						SET PHONE_ID = LAST_INSERT_ID();
						
						insert into tbl_merchantaccount set
							tbl_merchantaccount_contacProvider = de_122_121,
							tbl_merchantaccount_contactName = de_122_120,
							tbl_merchantaccount_contactMail = de_114_7,
							tbl_merchant_nmcId = de_114_179;

						SET MERCHANTACCOUNT_ID = LAST_INSERT_ID();

						insert into tbl_merchantaccountphone set
							tbl_merchantaccount_id = LAST_INSERT_ID(),
							tbl_phone_id = PHONE_ID;


						insert into tbl_locationmerchantaccount set 
							tbl_location_id = de_114_047,
							tbl_merchantaccount_id = MERCHANTACCOUNT_ID;


						insert into TBL_MESSAGE1 (CODE,DATA)
						values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('114.73', LPAD(MERCHANTACCOUNT_ID,11,'0'));

				else
						insert into TBL_MESSAGE1 (CODE,DATA)
						values('39','2018'),('44','Invalid location');		
				end if;

	ELSE
	
		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE1(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	set de_114_073 = (select DATA from TBL_MESSAGE1 where CODE = 114.73);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"114.73":"',de_114_073,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddMerchantAccountToLocationByLocationId030400164` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddMerchantAccountToLocationByLocationId030400164`(IN MSG_IN VARCHAR(20000))
BEGIN
	










 
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	
	DECLARE de_114_047 INT(11) DEFAULT 0; 
	DECLARE de_114_073 INT(11) DEFAULT 0;
    DECLARE de_053 VARCHAR(20) DEFAULT 0;
	DECLARE de_122_121 VARCHAR(45) DEFAULT NULL;
	DECLARE de_122_120 VARCHAR(45) DEFAULT NULL;
	DECLARE de_114_7 VARCHAR(255) DEFAULT NULL;
	DECLARE DS_PH VARCHAR(5000) DEFAULT 0;   
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;  
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;  
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;  
	DECLARE de_122_87 VARCHAR(15) DEFAULT NULL;   




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE PHONE_ID BIGINT(20) DEFAULT 0;	
	DECLARE ADMINNMCID_AUX INT(11) DEFAULT 0;
	DECLARE MERCHANTACCOUNT_ID INT(11) DEFAULT 0;

	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	





	
	
    SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.47');
	SET de_122_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.121');
	SET de_122_120 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.120');
	SET de_114_7 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET DS_PH = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = 'PH');
	SET DS_PH = (SELECT CONVERT(unhex(DS_PH) USING utf8 ));
			SET de_048_028 = common_schema.get_option( DS_PH, "48.28" );
			SET de_122_088 = common_schema.get_option( DS_PH, "122.88" );
			SET de_121_167 = common_schema.get_option( DS_PH, "121.167" );
			SET de_122_87 = common_schema.get_option( DS_PH, "122.87" );
	

		




		if (select de_114_047) is null then 
			set de_114_047=(select tbl_location_id from tbl_location where tbl_location_userid= de_053 limit 1);
		end if;


		if (select tbl_location_id from tbl_location where  tbl_location_id = de_114_047) then 
	
						insert into tbl_phone SET
							tbl_phone_phoneNumber = de_048_028,
							tbl_phone_extension = de_121_167,
							tbl_phone_country_id = de_122_87,
							tbl_phonetype_id = 4001;

						
						SET PHONE_ID = (SELECT LAST_INSERT_ID() FROM tbl_phone limit 1);
						
						insert into tbl_merchantaccount set
							tbl_merchantaccount_contacProvider = de_122_121,
							tbl_merchantaccount_contactName = de_122_120,
							tbl_merchantaccount_contactMail = de_114_7,
							tbl_merchant_nmcId = 0;

						SET MERCHANTACCOUNT_ID = (SELECT LAST_INSERT_ID() FROM tbl_merchantaccount limit 1);

						insert into tbl_merchantaccountphone set
							tbl_merchantaccount_id = MERCHANTACCOUNT_ID,
							tbl_phone_id = PHONE_ID;


						insert into tbl_locationmerchantaccount set 
							tbl_location_id = de_114_047,
							tbl_merchantaccount_id = MERCHANTACCOUNT_ID;


						insert into TBL_MESSAGE1 (CODE,DATA)
						values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('114.73', LPAD(MERCHANTACCOUNT_ID,11,'0'));

				else
						insert into TBL_MESSAGE1 (CODE,DATA)
						values('39','2018'),('44','Invalid location');		
				end if;

	
	
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	set de_114_073 = (select DATA from TBL_MESSAGE1 where CODE = 114.73);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.73":"',de_114_073,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewAddress030400056` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddNewAddress030400056`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE de_114_115 INTEGER(11) DEFAULT NULL; 
	DECLARE de_121_045 INTEGER(11) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_122_087 INT(11) DEFAULT NULL; 	 
	DECLARE de_120_013 INT(11) DEFAULT NULL; 	 
	DECLARE de_114_014 INT(11) DEFAULT NULL;
    DECLARE de_114_018 VARCHAR(20) DEFAULT NULL;
	DECLARE de_122_107 INT(11) DEFAULT 0;    	 
	DECLARE de_53 VARCHAR(20) DEFAULT 0;   
	DECLARE de_120_008 VARCHAR(5) DEFAULT NULL; 


	DECLARE de_US_PH   TEXT DEFAULT NULL;             
	DECLARE de_122_088   VARCHAR(45)  DEFAULT NULL;   
	DECLARE de_048_028   VARCHAR(45)  DEFAULT NULL;   
	DECLARE de_121_167 INT(11) DEFAULT NULL;          
	DECLARE de_122_087p  INT(11) DEFAULT NULL;         
	DECLARE de_121_062  INT(11) DEFAULT NULL;         



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE ADDRESS_AUX VARCHAR(45) DEFAULT NULL;

	DECLARE PHONE_AUX INT(45) DEFAULT NULL;

	DECLARE COMPANY_ID INT(11) DEFAULT NULL;




	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_53 = (select right(de_53,11));
		SET de_121_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.45');
		SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
		SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.12');
		SET de_114_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.13');	
		SET de_114_014 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.14');
        SET de_114_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.18');
		SET de_120_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.13');
		SET de_122_107 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.107');
		SET de_122_087 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.87');
		SET de_114_115 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.115');
		SET de_US_PH = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'PH');
		
		SET de_US_PH = (SELECT CONVERT(unhex(de_US_PH) USING utf8 ));
		SET de_122_088 = common_schema.get_option( de_US_PH, "122.88" );
		SET de_048_028 = common_schema.get_option( de_US_PH, "48.28" );
		SET de_121_167 = common_schema.get_option( de_US_PH, "121.167" );
		SET de_122_087p = common_schema.get_option( de_US_PH, "122.87" );
		SET de_121_062 = common_schema.get_option( de_US_PH, "121.62" );

	SET de_120_008 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.8');

	SET COMPANY_ID = (select tbl_company_id from dbuser.tbl_user where tbl_user_id = de_53);

	if de_120_008 = 'true' then 
	
		UPDATE dbuser.tbl_address SET 
		tbl_address_primary_f = 0
		where tbl_address_nmcId = de_53;
	
	end if;

	if (select tbl_address_id from tbl_address  where tbl_address_id = de_114_115 limit 1) is null then 
		if(select tbl_address_id from tbl_address  where tbl_address_nmcId = de_53 and tbl_address_name = de_114_053) is null then
			
            if de_114_012 is not null then
            
				insert into tbl_address set 
				tbl_address_nmcId  = de_53,
                tbl_company_id = COMPANY_ID,
				tbl_addresstype_id = if(de_121_045=0,14,de_121_045),
				tbl_address_first  = de_114_012,
				tbl_address_second = COALESCE(de_114_013,''),
				tbl_address_name   = de_114_053,
				tbl_address_nickname    = de_114_053,
				tbl_address_phoneNumber = de_114_018,
				tbl_address_flag    = 0,
				tbl_address_storeNumber = 123,
				tbl_zipcode_id     = de_122_107,
				tbl_city_id        = de_114_014,
				tbl_state_id       = de_120_013,
				tbl_country_id     = de_122_087, 
				tbl_address_primary_f = if(de_120_008 = 'true',1,0);

				SET ADDRESS_AUX= (SELECT last_insert_id()  from  tbl_address limit 1);

				IF LENGTH(de_048_028)>0 THEN
					insert into tbl_phone set
					tbl_phone_nmcId       = 0,
					tbl_phone_phoneNumber = de_048_028,
					tbl_phone_extension   = de_121_167,
					tbl_phone_country_id  = de_122_087p,
					tbl_phonetype_id      = COALESCE(de_121_062,4006);

					SET PHONE_AUX= (SELECT last_insert_id()  from  tbl_phone limit 1);

					UPDATE tbl_address SET 
					tbl_address_phoneNumber = PHONE_AUX
					WHERE tbl_address_id= ADDRESS_AUX;
				END IF;
				
				insert into TBL_MESSAGE (CODE,DATA)
                values('39','0000'),('44','Transaction Approved');

			else
            
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2018'),('44','Invalid Address First line');
            
            end if;

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','Invalid Address Name');

		end if;
		
		
	else
		if(select tbl_address_id from tbl_address  where tbl_address_nmcId = de_53 and tbl_address_name = de_114_053 and tbl_address_id != de_114_115 ) is null then
			UPDATE dbuser.tbl_address
			   SET tbl_company_id = COMPANY_ID,
				   tbl_addresstype_id   = COALESCE(de_121_045,tbl_addresstype_id),
				   tbl_address_first 	= COALESCE(de_114_012,tbl_address_first),
				   tbl_address_second 	= COALESCE(de_114_013,tbl_address_second),
				   tbl_address_name     = COALESCE(de_114_053,tbl_address_name),
				   tbl_address_nickname = COALESCE(de_114_053,tbl_address_nickname),
				   tbl_country_id 		= COALESCE(de_122_087,tbl_country_id),
				   tbl_state_id 		= COALESCE(de_120_013,tbl_state_id),
				   tbl_city_id 			= COALESCE(de_114_014,tbl_city_id),
				   tbl_zipcode_id 		= COALESCE(de_122_107,tbl_zipcode_id),
				   tbl_address_phoneNumber = COALESCE(de_114_018,tbl_address_phoneNumber),
                   tbl_address_primary_f = COALESCE(if(de_120_008 = 'true',1,0),tbl_address_primary_f)
			WHERE tbl_address_id  = de_114_115
			AND tbl_address_nmcId = de_53; 
			
			SET ADDRESS_AUX= de_114_115;
			
			
			IF(SELECT tbl_address_phoneNumber FROM  tbl_address WHERE tbl_address_id= de_114_115 LIMIT 1) IS NULL THEN
			
				IF LENGTH(de_048_028)>0 THEN
						insert into tbl_phone set
						tbl_phone_nmcId       = 0,
						tbl_phone_phoneNumber = de_048_028,
						tbl_phone_extension   = de_121_167,
						tbl_phone_country_id  = de_122_087p,
						tbl_phonetype_id      = COALESCE(de_121_062,4006);

						SET PHONE_AUX= (SELECT last_insert_id()  from  tbl_phone limit 1);

						UPDATE tbl_address SET 
						tbl_address_phoneNumber = PHONE_AUX
						WHERE tbl_address_id= de_114_115;
						
					END IF;
			ELSE
			
				UPDATE tbl_phone SET
				tbl_phone_nmcId       = 0,
				tbl_phone_phoneNumber = COALESCE(de_048_028,tbl_phone_phoneNumber),
				tbl_phone_extension   = COALESCE(de_121_167,tbl_phone_extension),
				tbl_phone_country_id  = COALESCE(de_122_087p,tbl_phone_country_id),
				tbl_phonetype_id      = COALESCE(de_121_062,4006)
				WHERE tbl_phone_id = (SELECT tbl_address_phoneNumber FROM  tbl_address WHERE tbl_address_id= de_114_115 LIMIT 1);
			
			
			END IF;
					
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
			
		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','Invalid Address Name');

		end if;
				
				
	end if;	
		
		

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.115":"',ADDRESS_AUX,'"}')) as JSON;
	else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;	
	end if;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewAddressConsumerMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNewAddressConsumerMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_121_045 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_047_018 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_120_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL; 
	DECLARE de_122_107 INT(11)     DEFAULT 0;    
	DECLARE de_114_018 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_053 INT(18)         DEFAULT 0; 
	DECLARE de_120_038 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_120_039 VARCHAR(20) DEFAULT NULL; 




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
	SET de_121_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.45');
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.12');
	SET de_114_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.13');
	SET de_047_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '47.18');
	SET de_120_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.13');
	SET de_114_014 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.14');
	SET de_122_107 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.107');	
	SET de_114_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.18');
	SET de_053     = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
	SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




				

		if(select tbl_address_id from tbl_address  where tbl_address_nmcId = de_053 and tbl_address_name = de_114_053) is null then

			insert into tbl_address set 
			tbl_address_nmcId = de_053,
			tbl_address_first = de_114_012,
			tbl_address_second = de_114_013,
			tbl_address_name = de_114_053,
			tbl_address_nickname = ' ',
			tbl_address_phoneNumber = de_114_018,
			tbl_address_flag = 0,
			tbl_address_storeNumber = 123,
			tbl_address_latitude = de_120_039,
			tbl_address_longitude = de_120_038,
			tbl_zipcode_id = de_122_107,
			tbl_addresstype_id = de_121_045,
			tbl_city_id = de_114_014,
			tbl_state_id = de_120_013,
			tbl_country_id = de_047_018 ;

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','	Invalid Address Name ');

		end if;
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewAddressConsumerMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNewAddressConsumerMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_121_045 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_047_018 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_120_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL; 
	DECLARE de_122_107 INT(11)     DEFAULT 0;    
	DECLARE de_114_018 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_053 INT(18)         DEFAULT 0; 
	DECLARE de_120_038 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_120_039 VARCHAR(20) DEFAULT NULL; 




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
	SET de_121_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.45');
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.12');
	SET de_114_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.13');
	SET de_047_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '47.18');
	SET de_120_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.13');
	SET de_114_014 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.14');
	SET de_122_107 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.107');	
	SET de_114_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.18');
	SET de_053     = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
	SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




				

		if(select tbl_address_id from tbl_address  where tbl_address_nmcId = de_053 and tbl_address_name = de_114_053) is null then

			insert into tbl_address set 
			tbl_address_nmcId = de_053,
			tbl_address_first = de_114_012,
			tbl_address_second = de_114_013,
			tbl_address_name = de_114_053,
			tbl_address_nickname = de_114_053,
			tbl_address_phoneNumber = de_114_018,
			tbl_address_flag = 0,
			tbl_address_storeNumber = 123,
			tbl_address_latitude = de_120_039,
			tbl_address_longitude = de_120_038,
			tbl_zipcode_id = de_122_107,
			tbl_addresstype_id = de_121_045,
			tbl_city_id = de_114_014,
			tbl_state_id = de_120_013,
			tbl_country_id = de_047_018 ;

			insert into tbl_phone set
			tbl_phone_nmcId = de_053,
			tbl_phone_phoneNumber = de_114_018,
			tbl_phonetype_id = 4006,
			tbl_phone_country_id = de_047_018;

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','	Invalid Address Name ');

		end if;
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewLabelTranslateByLanguage030400352` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNewLabelTranslateByLanguage030400352`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE de_122_045 INT(11) DEFAULT 0;  				
	DECLARE de_123_051 INT(11) DEFAULT 0;  				
	DECLARE de_123_052 VARCHAR(255) DEFAULT 0; 			
	DECLARE de_LB TEXT DEFAULT NULL;  					





	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DECLARE LABEL_AUX VARCHAR(5000) DEFAULT NULL;  
	DECLARE TRANSLATE_AUX VARCHAR(5000) DEFAULT NULL; 





	DROP TEMPORARY TABLE if exists TBL_MESSAGE;

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
     
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
	SET de_122_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.45');
	
	SET de_LB = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'LB');
	SET de_LB = (SELECT CONVERT(unhex(de_LB) USING utf8 ));
		
	SET de_LB = REPLACE(de_LB,'{"1','{"_1');
	SET de_LB = REPLACE(de_LB,',"1',',"_1');





	set LABEL_AUX = (select common_schema.extract_json_value_nmc(concat('{"LB":', de_LB ,'}'),'//_123.51'));
	set TRANSLATE_AUX = (select common_schema.extract_json_value_nmc(concat('{"LB":', de_LB ,'}'),'//_123.52'));
				
	WHILE (LENGTH(LABEL_AUX)>0) DO
				
		SET de_123_051 = (SELECT SUBSTR(LABEL_AUX,1,LOCATE('|',LABEL_AUX)-1));
		SET LABEL_AUX = (SELECT SUBSTR(LABEL_AUX,LOCATE('|',LABEL_AUX)+1));
		
		SET de_123_052 = (SELECT SUBSTR(TRANSLATE_AUX,1,LOCATE('|',TRANSLATE_AUX)-1));
		SET TRANSLATE_AUX = (SELECT SUBSTR(TRANSLATE_AUX,LOCATE('|',TRANSLATE_AUX)+1));

		if (select tbl_languagelabel_id from tbl_languagelabel where tbl_language_id = de_122_045 and tbl_label_id = trim(de_123_051)) is null then

			insert into tbl_languagelabel set
			tbl_language_id = de_122_045,
			tbl_label_id = trim(de_123_051),
			tbl_languagelabel_name = trim(de_123_052);
		
		else 

			update tbl_languagelabel set
			tbl_languagelabel_name = trim(de_123_052)
			where tbl_language_id = de_122_045 
			and tbl_label_id = trim(de_123_051);

		end if;
		
	END WHILE;

	
	
	
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewLocationByMerchantIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNewLocationByMerchantIdPortal`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 INTEGER(11) DEFAULT 0;  		    
	DECLARE de_122_119 INTEGER(20) DEFAULT 0; 			
	DECLARE de_114_070 VARCHAR(50) DEFAULT 0;			
	
	DECLARE de_300_062 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_087 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_051 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_012 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_013 VARCHAR(45) DEFAULT NULL;		
	
	DECLARE de_300_064 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_120_013 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_065 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_014 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_066 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_107 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_114_053 VARCHAR(45) DEFAULT 0; 			
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;			
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;         
	
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;		
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;		
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;		
	
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0;			
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0;			
	DECLARE de_300_089 VARCHAR(100) DEFAULT 0;			




	DECLARE LOCATIONID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE ADDRESSID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_047 VARCHAR(15) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		
		SET de_122_119 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.119');
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		
		SET de_300_051 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.51');
		SET de_114_012 = common_schema.get_option( de_300_051, "114.12" );
		SET de_114_013 = common_schema.get_option( de_300_051, "114.13" );
		
		SET de_300_089 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');
		SET de_300_062 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');		
		SET de_122_087 = (SELECT SUBSTR(de_300_089,1,LOCATE(',',de_300_089)-1));
			
		SET de_300_064 = (SELECT SUBSTR(de_300_089,LOCATE(',',de_300_089)+1));
		SET de_120_013 = (SELECT SUBSTR(de_300_064,1,LOCATE(',',de_300_064)-1));
		
		SET de_300_065 = (SELECT SUBSTR(de_300_064,LOCATE(',',de_300_064)+1));
		SET de_114_014 = (SELECT SUBSTR(de_300_065,1,LOCATE(',',de_300_065)-1));
		
		SET de_300_066 = (SELECT SUBSTR(de_300_065,LOCATE(',',de_300_065)+1));
		SET de_122_107 = (SELECT SUBSTR(de_300_066,1,LOCATE(',',de_300_066)-1));
						
		SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.84');
		
		SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
		SET de_122_088 = common_schema.get_option( de_300_084, "122.88" );
		SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
		SET de_122_87P = common_schema.get_option( de_300_084, "122.87" );
		
		SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
		SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			
				INSERT INTO tbl_location SET 
				tbl_location_storeNumber= de_122_119 ,
				tbl_location_storeName= de_114_070 ,
				tbl_location_contactName = de_114_053, 
				tbl_location_contactEmail = de_114_007, 
				tbl_location_userId = de_114_179,
				tbl_location_latitude = de_120_038,
				tbl_location_longitude= de_120_039,
				tbl_location_statusId= 7001;
				
				SET LOCATIONID_AUX= (SELECT tbl_location_id FROM tbl_location ORDER BY tbl_location_id DESC LIMIT 1);
				
				INSERT tbl_address SET
				tbl_address_first = de_114_012,
				tbl_address_second = de_114_013,
				tbl_country_id = de_122_087,
				tbl_state_id = de_120_013,
				tbl_city_id = de_114_014,
				tbl_zipcode_id = de_122_107,
				tbl_address_phoneNumber = de_048_028,
				tbl_address_name ='Terminal Address',
				tbl_addresstype_id= 12;
				
				SET ADDRESSID_AUX= (SELECT tbl_address_id FROM tbl_address ORDER BY tbl_address_id DESC LIMIT 1);
	
				INSERT tbl_locationaddress SET
				tbl_location_id = LOCATIONID_AUX, 
				tbl_address_id = ADDRESSID_AUX;
	
				INSERT tbl_phone SET
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_nmcId = de_114_179,
				tbl_phone_country_id = de_122_87P,
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_phone ORDER BY tbl_phone_id DESC LIMIT 1);
				
				INSERT tbl_locationphone SET
				tbl_phone_id = PHONEID_AUX,
				tbl_location_id=LOCATIONID_AUX;
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('114.47', LPAD(LOCATIONID_AUX,11,'0'));
				
			
		
					
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	SET RESULT_114_047 = (select DATA from TBL_MESSAGE where CODE = 114.47);
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"114.47":"',RESULT_114_047,'","114.143":"7001"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewLocationByMerchantIdPortal_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNewLocationByMerchantIdPortal_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 INTEGER(11) DEFAULT 0;  		    
	DECLARE de_122_119 VARCHAR(40) DEFAULT 0; 			
	DECLARE de_114_070 VARCHAR(50) DEFAULT 0;			
	
	DECLARE de_300_062 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_087 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_051 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_012 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_013 VARCHAR(45) DEFAULT NULL;		
	
	DECLARE de_300_064 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_120_013 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_065 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_014 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_066 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_107 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_114_053 VARCHAR(45) DEFAULT 0; 			
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;			
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;         
	
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;		
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;		
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;		
	
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0;			
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0;			
	DECLARE de_300_089 VARCHAR(100) DEFAULT 0;			




	DECLARE LOCATIONID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE ADDRESSID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_047 VARCHAR(15) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		
		SET de_122_119 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.119');
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		
		SET de_300_051 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.51');
		SET de_114_012 = common_schema.get_option( de_300_051, "114.12" );
		SET de_114_013 = common_schema.get_option( de_300_051, "114.13" );
		
		SET de_300_089 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');
		SET de_300_062 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');		
		SET de_122_087 = (SELECT SUBSTR(de_300_089,1,LOCATE(',',de_300_089)-1));
			
		SET de_300_064 = (SELECT SUBSTR(de_300_089,LOCATE(',',de_300_089)+1));
		SET de_120_013 = (SELECT SUBSTR(de_300_064,1,LOCATE(',',de_300_064)-1));
		
		SET de_300_065 = (SELECT SUBSTR(de_300_064,LOCATE(',',de_300_064)+1));
		SET de_114_014 = (SELECT SUBSTR(de_300_065,1,LOCATE(',',de_300_065)-1));
		
		SET de_300_066 = (SELECT SUBSTR(de_300_065,LOCATE(',',de_300_065)+1));
		SET de_122_107 = (SELECT SUBSTR(de_300_066,1,LOCATE(',',de_300_066)-1));
						
		SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.84');
		
		SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
		SET de_122_088 = common_schema.get_option( de_300_084, "122.88" );
		SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
		SET de_122_87P = common_schema.get_option( de_300_084, "122.87" );
		
		SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
		SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			
				INSERT INTO tbl_location SET 
				tbl_location_storeNumber= de_122_119 ,
				tbl_location_storeName= de_114_070 ,
				tbl_location_contactName = de_114_053, 
				tbl_location_contactEmail = de_114_007, 
				tbl_location_userId = de_114_179,
				tbl_location_latitude = de_120_038,
				tbl_location_longitude= de_120_039,
				tbl_location_statusId= 7001;
				
				SET LOCATIONID_AUX= (SELECT tbl_location_id FROM tbl_location ORDER BY tbl_location_id DESC LIMIT 1);
				
				INSERT tbl_address SET
				tbl_address_first = de_114_012,
				tbl_address_second = de_114_013,
				tbl_country_id = de_122_087,
				tbl_state_id = de_120_013,
				tbl_city_id = de_114_014,
				tbl_zipcode_id = de_122_107,
				tbl_address_phoneNumber = de_048_028,
				tbl_address_name ='Terminal Address',
				tbl_addresstype_id= 12;
				
				SET ADDRESSID_AUX= (SELECT tbl_address_id FROM tbl_address ORDER BY tbl_address_id DESC LIMIT 1);
	
				INSERT tbl_locationaddress SET
				tbl_location_id = LOCATIONID_AUX, 
				tbl_address_id = ADDRESSID_AUX;
	
				INSERT tbl_phone SET
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_nmcId = de_114_179,
				tbl_phone_country_id = de_122_87P,
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_phone ORDER BY tbl_phone_id DESC LIMIT 1);
				
				INSERT tbl_locationphone SET
				tbl_phone_id = PHONEID_AUX,
				tbl_location_id=LOCATIONID_AUX;
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('114.47', LPAD(LOCATIONID_AUX,11,'0'));
				
			
		
					
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	SET RESULT_114_047 = (select DATA from TBL_MESSAGE where CODE = 114.47);
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"114.47":"',RESULT_114_047,'","114.143":"7001"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewLocationByMerchantIdPortal_1_030400162` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddNewLocationByMerchantIdPortal_1_030400162`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
		
	DECLARE de_053 VARCHAR(20) DEFAULT 0;  		        
	DECLARE de_122_119 VARCHAR(40) DEFAULT 0; 			
	DECLARE de_114_070 VARCHAR(50) DEFAULT 0;			
	
	DECLARE de_country_aux VARCHAR(5000) DEFAULT 0; 	
	DECLARE de_122_087 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE DS_AD VARCHAR(5000) DEFAULT 0; 				
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL;		
	DECLARE de_114_013 VARCHAR(99) DEFAULT NULL;		
	
	DECLARE de_state_aux VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_120_013 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_city_aux VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_014 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_zip_aux VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_107 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_114_053 VARCHAR(45) DEFAULT 0; 			
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;			
	
	DECLARE DS_PH VARCHAR(5000) DEFAULT 0;         		
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;		
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;		
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;		
	
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0;			
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0;			
	
	DECLARE de_127_60 VARCHAR(100) DEFAULT 0;			

	DECLARE de_122_197 INTEGER(11) DEFAULT 0;  	

	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL;

	DECLARE LOCATIONID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE ADDRESSID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_047 VARCHAR(15) DEFAULT NULL;
	



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	SET de_122_119 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.119');
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
	
	SET DS_AD = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'AD');
	SET DS_AD = (SELECT CONVERT(unhex(DS_AD) USING utf8 ));
	
	SET de_114_012 = common_schema.get_option( DS_AD, "114.12" );
	SET de_114_013 = common_schema.get_option( DS_AD, "114.13" );
	
	SET de_127_60 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.60');
	SET de_country_aux = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.60');		
	SET de_122_087 = (SELECT SUBSTR(de_127_60,1,LOCATE(',',de_127_60)-1));
		
	SET de_state_aux = (SELECT SUBSTR(de_127_60,LOCATE(',',de_127_60)+1));
	SET de_120_013 = (SELECT SUBSTR(de_state_aux,1,LOCATE(',',de_state_aux)-1));
	
	SET de_city_aux = (SELECT SUBSTR(de_state_aux,LOCATE(',',de_state_aux)+1));
	SET de_114_014 = (SELECT SUBSTR(de_city_aux,1,LOCATE(',',de_city_aux)-1));
	
	SET de_zip_aux = (SELECT SUBSTR(de_city_aux,LOCATE(',',de_city_aux)+1));
	SET de_122_107 = (SELECT SUBSTR(de_zip_aux,1,LOCATE(',',de_zip_aux)-1));
					
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
	SET DS_PH = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'PH');
	SET DS_PH = (SELECT CONVERT(unhex(DS_PH) USING utf8 ));
	
	SET de_048_028 = common_schema.get_option( DS_PH, "48.28" );
	SET de_122_088 = common_schema.get_option( DS_PH, "122.88" );
	SET de_121_167 = common_schema.get_option( DS_PH, "121.167" );
	SET de_122_87P = common_schema.get_option( DS_PH, "122.87" );
	
	SET de_120_038 = (select latitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
	SET de_120_039 = (select longitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
		
	SET de_122_197 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.197');
	
	set COMPANY_ID = (select tbl_company_id from dbuser.tbl_user where tbl_user_id = de_053);


			
	INSERT INTO tbl_location SET 
	tbl_company_id = COMPANY_ID,
	tbl_location_storeNumber= de_122_119 ,
	tbl_location_storeName= de_114_070 ,
	tbl_location_contactName = de_114_053, 
	tbl_location_contactEmail = de_114_007, 
	tbl_location_userId = de_053,
	tbl_location_latitude = de_120_038,
	tbl_location_longitude= de_120_039,
	tbl_location_statusId= 7001;

	SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);

	INSERT tbl_address SET
	tbl_company_id = COMPANY_ID,
    tbl_address_nmcId = de_053,
	tbl_address_first = de_114_012,
	tbl_address_second = de_114_013,
	tbl_country_id = de_122_087,
	tbl_state_id = de_120_013,
	tbl_city_id = de_114_014,
	tbl_zipcode_id = de_122_107,
	tbl_address_name ='Address',
	tbl_addresstype_id= 11;

	SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);

	INSERT tbl_locationaddress SET
	tbl_location_id = LOCATIONID_AUX, 
	tbl_address_id = ADDRESSID_AUX;

	INSERT tbl_phone SET
	tbl_phone_phoneNumber = de_048_028,
	tbl_phone_extension = de_121_167,
	tbl_phone_nmcId = 0,
	tbl_phone_country_id = de_122_87P,
	tbl_phonetype_id = 4001;

	SET PHONEID_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);

	INSERT tbl_locationphone SET
	tbl_phone_id = PHONEID_AUX,
	tbl_location_id=LOCATIONID_AUX;

	UPDATE tbl_address SET 
	tbl_address_phoneNumber = PHONEID_AUX
	WHERE tbl_address_id= ADDRESSID_AUX;


	INSERT INTO tbl_location_hardware (
	tbl_company_id,
	tbl_user_id,
	tbl_location_id,
	tbl_hardware_type_id,
	tbl_location_hardware_qty,
	tbl_location_hardware_shipped,
	tbl_shipping_status_id) 
	values (COMPANY_ID,de_053,LOCATIONID_AUX,75001,0,0,73001);


	if length(de_122_197)>0 then
    
		update dbitems.tbl_usersubscription set
        tbl_location_id = LOCATIONID_AUX
        where tbl_usersubscription_id = de_122_197;
    
    end if;

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('114.47', LPAD(LOCATIONID_AUX,11,'0'));

		
	
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	SET RESULT_114_047 = (select DATA from TBL_MESSAGE where CODE = 114.47);
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.47":"',coalesce(RESULT_114_047,0),'","114.143":"7001"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewTransactionMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNewTransactionMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 INT(18) DEFAULT NULL; 			
	DECLARE de_057 VARCHAR(50) DEFAULT NULL; 		
	
	DECLARE de_114_112 INT(11) DEFAULT 0;  		    
	DECLARE de_114_144 INT(11) DEFAULT 0;  		    
	DECLARE de_114_121 INT(11) DEFAULT 0;  		    
	DECLARE de_114_179 INT(11) DEFAULT 0;  		    
	
	DECLARE de_300_013 VARCHAR(5000) DEFAULT NULL;  
	DECLARE de_300_049 VARCHAR(5000) DEFAULT NULL;  
	DECLARE de_300_069 VARCHAR(5000) DEFAULT NULL;  

	DECLARE de_121_097 VARCHAR(255) DEFAULT 0;       
	DECLARE de_048_015 VARCHAR(300) DEFAULT 0;  		    
	DECLARE de_048_030 VARCHAR(300) DEFAULT 0;  		    
	DECLARE de_121_104 INT(11) DEFAULT 0;  		    
	DECLARE de_121_105 INT(11) DEFAULT 0;  		    
	DECLARE de_055_003 VARCHAR(11) DEFAULT 0;  		    
	DECLARE de_120_109 VARCHAR(11) DEFAULT 0;  		    
	DECLARE de_120_090 INT(1) DEFAULT 0;  		    
	
	DECLARE de_114_115 INT(11) DEFAULT 0;  		    
	DECLARE de_114_088 INT(11) DEFAULT 0;  		    
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0;  		
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0;  		






	DECLARE INVOICEID_AUX INT(11) DEFAULT 0;
	DECLARE CADENA_CARD VARCHAR(5000) DEFAULT NULL;
	DECLARE CADENA_AMOUNT VARCHAR(5000) DEFAULT NULL;
	DECLARE CADENA_TAX VARCHAR(5000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;	
	DECLARE RESULT_121_75 VARCHAR(45) DEFAULT NULL;	
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '57');
		
		SET de_114_112 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.112');
		SET de_114_144 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.144');
		SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.121');
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
		
		SET de_300_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '300.13');
		SET de_300_049 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '300.49');
		SET de_300_069 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '300.69');
		
		SET de_048_015 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '48.15');
		SET de_048_030 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '48.30');
		SET de_121_104 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.104');
		SET de_121_105 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.105');
		SET de_055_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '55.3');
		SET de_120_109 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.109');
		SET de_120_090 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.90');
		
		SET de_114_115 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.115');
		SET de_114_088 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.88');
		
		SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.38');
		SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.39');




		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;





		if (SELECT tbl_invoice_id FROM tbl_invoice ORDER BY tbl_invoice_id DESC LIMIT 1) is not null then
		   SET INVOICEID_AUX = (SELECT tbl_invoice_id FROM tbl_invoice ORDER BY tbl_invoice_id DESC LIMIT 1) +1;
		else
		   SET INVOICEID_AUX = 1;
		  
		end if;

		set CADENA_TAX = (select common_schema.extract_json_value_nmc(concat('{"_300.69":', de_300_069 ,'}'), '//_121.97'));

		
		WHILE (LENGTH(CADENA_TAX)>0) DO 

			SET de_121_097 = (SELECT SUBSTR(CADENA_TAX,1,LOCATE('|',CADENA_TAX)-1));
			SET CADENA_TAX =  (SELECT SUBSTR(CADENA_CARD,LOCATE('|',CADENA_TAX)+1));
			

		END WHILE;

			insert into tbl_invoice set
			tbl_invoice_id = INVOICEID_AUX,
			tbl_consumer_nmcId = de_053,
			tbl_merchant_nmcId = de_114_179,
			tbl_invoice_totalAmount = de_055_003,
			tbl_invoice_tip = de_120_109,
			
			tbl_invoice_tax = de_121_097,
			tbl_invoice_shippingAmount = 1,
			tbl_invoice_date = NOW(),
			tbl_invoicestatus_id = 101,
			tbl_invoice_latitude = de_120_038,
			tbl_invoice_longitude = de_120_039,
			tbl_shippingoption_id = de_120_090,
			tbl_shippingstatus_id = 71;
			
			insert into tbl_invoiceproduct set
			tbl_invoiceproduct_salePrice = (select tbl_product_saleprice from dbitems.tbl_product where tbl_product_id = de_114_144),
			tbl_invoiceproduct_quantity = de_114_121,
			tbl_invoice_id =INVOICEID_AUX,
			tbl_product_id = de_114_144,
			tbl_productype_id = (select tbl_producttype_id from dbitems.tbl_product where tbl_product_id = de_114_144);

			
			if (de_120_090 = 2) then 
			
				insert into tbl_invoiceshippingaddress set
				tbl_invoice_id = INVOICEID_AUX,
				tbl_address_id = de_114_115;
				
			end if;
			
			
			

			set CADENA_CARD = (select common_schema.extract_json_value_nmc(concat('{"_300.13":', de_300_013 ,'}'),'//_48.15'));			
			set CADENA_AMOUNT = (select common_schema.extract_json_value_nmc(concat('{"_300.49":', de_300_049 ,'}'), '//_48.30'));

			set CADENA_TAX = (select common_schema.extract_json_value_nmc(concat('{"_300.49":', de_300_069 ,'}'), '//_121.97'));
			
			

			WHILE (LENGTH(CADENA_CARD)>0 and LENGTH(CADENA_AMOUNT)>0) DO
			
				SET de_048_015 = (SELECT SUBSTR(CADENA_CARD,1,LOCATE('|',CADENA_CARD)-1));
				SET CADENA_CARD = (SELECT SUBSTR(CADENA_CARD,LOCATE('|',CADENA_CARD)+1));
			
				SET de_048_030 = (SELECT SUBSTR(CADENA_AMOUNT,1,LOCATE('|',CADENA_AMOUNT)-1));
				SET CADENA_AMOUNT = (SELECT SUBSTR(CADENA_AMOUNT,LOCATE('|',CADENA_AMOUNT)+1));
			
				insert into tbl_transaction set
				tbl_transaction_cardTocken = de_048_015,
				tbl_transaction_amount = de_048_030,
				tbl_transaction_creationDate = NOW(),
				tbl_transactiontype_id = 82,
				tbl_invoicestatus_id = 75,
				tbl_transaction_number = 123,
				tbl_invoice_id = INVOICEID_AUX;
			
			END WHILE;

			
			
			
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('121.75',INVOICEID_AUX);


	ELSE
	
		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE1(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('*11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	set RESULT_121_75 = (select DATA from TBL_MESSAGE1 where CODE = 121.75);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"121.75":"',RESULT_121_75,'"')) as JSON;

	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewTypeBusiness030400151` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `AddNewTypeBusiness030400151`(IN MSG_IN VARCHAR(20000))
BEGIN


	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  
	DECLARE _US_CA TEXT DEFAULT NULL;
	DECLARE _114_93  TEXT DEFAULT NULL; 	
	DECLARE _114_93a TEXT DEFAULT NULL; 	
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 

	DECLARE COMPANY_ID INTEGER(11) DEFAULT 0;



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	





	SET  group_concat_max_len = 1000000;
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET USER_TYPE_AUX = (SELECT substring(de_053,5,1) ) ;
	set de_053 = (select right(de_053,11));
	SET _US_CA = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = 'CU');
	SET _US_CA = (SELECT CONVERT(unhex(_US_CA) USING utf8 ));
	SET _US_CA = REPLACE(_US_CA,'{"1','{"_1');
	SET _US_CA = REPLACE(_US_CA,',"1',',"_1');
	SET _114_93 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_CA":',_US_CA,'}'),'//_114.93'));
	
	


	IF USER_TYPE_AUX IS NOT NULL THEN
			
		CASE USER_TYPE_AUX
				
			WHEN '2' THEN 
			
				set COMPANY_ID = (select tbl_company_id from dbuser.tbl_user where tbl_user_id = de_053);

            
				delete from tbl_merchantbusinesscategory  
				where tbl_merchant_nmcId = de_053
				;
				-- and tbl_businesscategory_id not in (select distinct C.tbl_category_id from dbitems.vw_product_by_merchant as B,dbitems.tbl_productcategory as C where B.tbl_main_user_id = GetMainUser(de_053) and B.tbl_product_id = C.tbl_product_id);
				
				WHILE (LENGTH(_114_93)>0) DO

					SET _114_93a = (SELECT SUBSTR(_114_93,1,LOCATE('|',_114_93)-1));
					SET _114_93 = (SELECT SUBSTR(_114_93,LOCATE('|',_114_93)+1));
					
					if (select tbl_businesscategory_id from tbl_merchantbusinesscategory where tbl_merchant_nmcId  = de_053 and tbl_businesscategory_id = TRIM(_114_93a)) is null then
					
						insert into tbl_merchantbusinesscategory set
                        tbl_company_id = COMPANY_ID,
						tbl_merchant_nmcId  = de_053,
						tbl_businesscategory_id = TRIM(_114_93a);
					
					end if;
						
				END WHILE;

			WHEN '3' THEN 
				delete from tbl_resellerbusinesscategory where tbl_reseller_nmcId = de_053;
				WHILE (LENGTH(_114_93)>0) DO

					SET _114_93a = (SELECT SUBSTR(_114_93,1,LOCATE('|',_114_93)-1));
					SET _114_93 = (SELECT SUBSTR(_114_93,LOCATE('|',_114_93)+1));
					
					insert into tbl_resellerbusinesscategory set
					tbl_reseller_nmcId      = de_053,
					tbl_businesscategory_id = TRIM(_114_93a);
				END WHILE ;
                
			WHEN '6' THEN
				delete from tbl_resellerbusinesscategory where tbl_reseller_nmcId = de_053;
				WHILE (LENGTH(_114_93)>0) DO

					SET _114_93a = (SELECT SUBSTR(_114_93,1,LOCATE('|',_114_93)-1));
					SET _114_93 = (SELECT SUBSTR(_114_93,LOCATE('|',_114_93)+1));
					
					insert into tbl_resellerbusinesscategory set
					tbl_reseller_nmcId      = de_053,
					tbl_businesscategory_id = TRIM(_114_93a);
				END WHILE ;
            
		END CASE;	
	END IF;

	
	
	
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNewUser030400130` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNewUser030400130`(IN MSG_IN VARCHAR(20000))
BEGIN











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 VARCHAR(50) DEFAULT NULL;  
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;      
	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_122_091 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  

	
	DECLARE de_122_106 INTEGER(11) DEFAULT 0;   
	DECLARE de_114_027 VARCHAR(11) DEFAULT 0;   
	DECLARE de_114_009 VARCHAR(11) DEFAULT NULL;   
	
	DECLARE de_121_170 TEXT DEFAULT NULL; 
	DECLARE de_114_75 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_114_131 VARCHAR(100) DEFAULT NULL; 
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 




	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	
	
		DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	



	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_122_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.91');
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.27');
	
	
	SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.106');
	SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
	
	
	SET de_121_170 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.170');
	SET de_114_75 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.75');
	SET de_114_131 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.131');


	
	DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;





	update tbl_user set
	
	tbl_user_userTemp_f     = 0,
	tbl_user_passwordTemp_f = 0,
	tbl_user_dateModified   = NOW(),
	tbl_user_password       = COALESCE(md5((CONVERT(unhex(de_052) using utf8))),tbl_user_password),
	tbl_user_title = COALESCE(de_122_091, tbl_user_title),
	tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName) ,           
	tbl_user_first = COALESCE(de_114_003, tbl_user_first),
	tbl_user_middle = COALESCE(de_114_004, tbl_user_middle),
	tbl_user_last = COALESCE(de_114_005, tbl_user_last)
	where tbl_user_id = de_053;
	
	SET USER_TYPE_AUX = (SELECT tbl_userType_id FROM  tbl_user where tbl_user_id = de_053 ) ;

	IF USER_TYPE_AUX IS NOT NULL THEN
			
		CASE USER_TYPE_AUX
				
			WHEN 2 THEN 
				IF (select tbl_merchant_nmcId from tbl_merchant where tbl_merchant_nmcId = de_053) THEN 
				UPDATE dbuser.tbl_merchant SET 
					tbl_merchant_taxIdNumber = COALESCE(de_114_131,tbl_merchant_taxIdNumber),
					tbl_merchant_online_store = COALESCE(de_114_75,tbl_merchant_online_store),
					tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage)
				WHERE tbl_merchant_nmcId = de_053;
				ELSE
					insert into tbl_merchant set
						tbl_user_id                     = de_053,
						tbl_merchant_nmcId              = de_053,
						tbl_merchant_taxIdNumber        = COALESCE(de_114_131, tbl_merchant_taxIdNumber),
						tbl_merchant_multipleLocation_f = if(de_114_009 = 'true',1,0),
						tbl_merchant_haveWebsite_f      = 0,
						tbl_merchant_haveAccount_f      = 0,
						tbl_merchant_logoimage 			= de_121_170;
				END IF ;
				
			WHEN 3 THEN 
				UPDATE tbl_reseller SET
					  tbl_reseller_servicesProvider_f =  if(de_114_009 = 'true',1,0),
					  tbl_reseller_clientsNumber = de_122_106
				WHERE tbl_user_id = de_053;  
		END CASE;	
	END IF;



	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
	
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddNotificationAddressByUser030400227` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddNotificationAddressByUser030400227`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE de_053 VARCHAR(20) DEFAULT 0; 		
	DECLARE de_AD VARCHAR(5000) DEFAULT NULL; 	

	DECLARE de_114_115 INT(11) DEFAULT 0; 		




	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	DECLARE CADENA_ADDRESS VARCHAR(5000) DEFAULT NULL; 




	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	SET de_053 = (SELECT RIGHT(de_053,11));

	SET de_AD = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'AD');
	SET de_AD = convert(unhex(de_AD) USING utf8);
	SET de_AD = REPLACE(de_AD,'{"1','{"_1');

	set CADENA_ADDRESS = (select common_schema.extract_json_value_nmc(concat('{"_AD":', de_AD ,'}'),'//_114.115'));
	




	WHILE (LENGTH(CADENA_ADDRESS)>0) DO
	
		SET de_114_115 = (SELECT SUBSTR(CADENA_ADDRESS,1,LOCATE('|',CADENA_ADDRESS)-1));
		SET CADENA_ADDRESS = (SELECT SUBSTR(CADENA_ADDRESS,LOCATE('|',CADENA_ADDRESS)+1));

		update tbl_address set 
		tbl_address_pushedpreference = 1
		where tbl_address_nmcId = de_053
		and tbl_address_id = de_114_115;
	
	END WHILE;

	
	
	
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddPOSInfoToLocationByLocationId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddPOSInfoToLocationByLocationId`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 INTEGER(11) DEFAULT 0;  		    
	
	DECLARE de_121_184 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_121_186 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;  		
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;  		
	DECLARE de_114_047 VARCHAR(30) DEFAULT 0;  			
	DECLARE de_048_028 VARCHAR(30) DEFAULT 0;  			
	DECLARE de_121_167 VARCHAR(15) DEFAULT 0;  			
	DECLARE de_122_87P VARCHAR(15) DEFAULT 0;  			




	DECLARE POSID_AUX VARCHAR(15) DEFAULT NULL;
	
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_120_097 VARCHAR(15) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_121_184 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.184');
		SET de_121_186 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.186');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
				
		
		SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.84');
		SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
		SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
		SET de_122_87P = common_schema.get_option( de_300_084, "122.87" );
		SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
		

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			
				INSERT INTO tbl_merchantpos SET 
				tbl_merchantpos_contacProvider= de_121_184,
				tbl_merchantpos_contacName=  de_121_186,
				tbl_merchantpos_contacMail = de_114_007, 
				
				tbl_merchant_nmcId = de_114_179;
		
				SET POSID_AUX= (SELECT tbl_merchantpos_id FROM tbl_merchantpos ORDER BY tbl_merchantpos_id DESC LIMIT 1);
				
				
				INSERT tbl_phone SET
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_country_id = de_122_87P,
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_phone ORDER BY tbl_phone_id DESC LIMIT 1);
				
				
				INSERT tbl_merchantposphone SET
				tbl_merchantpos_id = POSID_AUX,
				tbl_phone_id = PHONEID_AUX;

				insert tbl_locationpos set 
				tbl_location_id = de_114_047,
				tbl_merchantpos_id = POSID_AUX;
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('120.97', LPAD(POSID_AUX,11,'0'));
				
			
		
					
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	SET RESULT_120_097 = (select DATA from TBL_MESSAGE where CODE = 120.97);
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"120.97":"',RESULT_120_097,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddPOSInfoToLocationByLocationId030400168` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddPOSInfoToLocationByLocationId030400168`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	
	DECLARE de_053 VARCHAR(20) DEFAULT 0;  		   		
	
	DECLARE de_121_184 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_121_186 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;  		
	DECLARE DS_PH VARCHAR(5000) DEFAULT 0;  			
	DECLARE de_114_047 VARCHAR(30) DEFAULT 0;  			
	DECLARE de_048_028 VARCHAR(30) DEFAULT 0;  			
	DECLARE de_121_167 VARCHAR(15) DEFAULT 0;  			
	DECLARE de_122_87P VARCHAR(15) DEFAULT 0;  			




	DECLARE POSID_AUX VARCHAR(15) DEFAULT NULL;
	
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_120_097 VARCHAR(15) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
		SET de_121_184 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.184');
		SET de_121_186 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.186');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
				
		
		SET DS_PH = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'PH');
		SET DS_PH = (SELECT CONVERT(unhex(DS_PH) USING utf8 ));
		SET de_048_028 = common_schema.get_option( DS_PH, "48.28" );
		SET de_121_167 = common_schema.get_option( DS_PH, "121.167" );
		SET de_122_87P = common_schema.get_option( DS_PH, "122.87" );
		SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
		

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			
				INSERT INTO tbl_merchantpos SET 
				tbl_merchantpos_contacProvider= de_121_184,
				tbl_merchantpos_contacName=  de_121_186,
				tbl_merchantpos_contacMail = de_114_007, 
				
				tbl_merchant_nmcId = de_053;
		
				SET POSID_AUX= (SELECT LAST_INSERT_ID() FROM tbl_merchantpos limit 1);
				
				
				INSERT tbl_phone SET
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_country_id = de_122_87P,
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX= (SELECT LAST_INSERT_ID() FROM tbl_phone limit 1);
				
				
				INSERT tbl_merchantposphone SET
				tbl_merchantpos_id = POSID_AUX,
				tbl_phone_id = PHONEID_AUX;

				insert tbl_locationpos set 
				tbl_location_id = de_114_047,
				tbl_merchantpos_id = POSID_AUX;
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('120.97', LPAD(POSID_AUX,11,'0'));
				
			
		
	
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	SET RESULT_120_097 = (select DATA from TBL_MESSAGE where CODE = 120.97);
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"120.97":"',RESULT_120_097,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddQuestionsAndAnswersByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddQuestionsAndAnswersByConsumerIdMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 INT(18) DEFAULT NULL; 
	
	DECLARE de_122_008 INT(11) DEFAULT NULL; 
	DECLARE de_122_009 INT(11) DEFAULT NULL; 
	DECLARE de_122_010 INT(11) DEFAULT NULL; 
	DECLARE de_122_011 INT(11) DEFAULT NULL; 
	DECLARE de_114_064 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_114_045 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_114_068 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_122_007 VARCHAR(100) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	
		SET de_122_008 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.8');
		SET de_122_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.9');
		SET de_122_010 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.10');
		SET de_122_011 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.11');
		SET de_114_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.64');
		SET de_114_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.45');
		SET de_114_068 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.68');
		SET de_122_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.7');
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




	
		insert into tbl_securityquestionsanswer set 
		tbl_securityquestions_id = de_122_008,
		tbl_securityquestionsanswer_answer = de_114_064,
		tbl_cardsconsumer_nmcId = de_053;
		
		insert into tbl_securityquestionsanswer set 
		tbl_securityquestions_id = de_122_009,
		tbl_securityquestionsanswer_answer = de_114_045,
		tbl_cardsconsumer_nmcId = de_053;
		
		insert into tbl_securityquestionsanswer set 
		tbl_securityquestions_id = de_122_010,
		tbl_securityquestionsanswer_answer = de_114_068,
		tbl_cardsconsumer_nmcId = de_053;
		
		insert into tbl_securityquestionsanswer set 
		tbl_securityquestions_id = de_122_011,
		tbl_securityquestionsanswer_answer = de_122_007,
		tbl_cardsconsumer_nmcId = de_053;
		
	
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
					
				

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddStoreCheckinByUser030400683` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddStoreCheckinByUser030400683`(IN MSG_IN VARCHAR(20000))
BEGIN
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_179 VARCHAR(20) DEFAULT NULL; 

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');	
	set de_053 = (select right(de_053,11));
    
	SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
    set de_114_179 = (select right(de_114_179,11));

	if (select tbl_user_id from dbuser.tbl_user_checkin where tbl_user_id = de_053 and tbl_merchant_id = de_114_179 limit 1) is null then
	
		insert into tbl_user_checkin set 
		tbl_user_id = de_053,
		tbl_merchant_id = de_114_179,
		tbl_user_checkin_date = NOW();
        
	else
    
		update tbl_user_checkin set 
		tbl_user_checkin_date = NOW()
        where tbl_user_id = de_053
        and tbl_merchant_id = de_114_179;
        
	end if;

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddTerminalError030400540` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddTerminalError030400540`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53      VARCHAR(20)  DEFAULT NULL; 
	DECLARE de_114_047 INT(11) 		DEFAULT NULL; 
	DECLARE de_120_069 INT(11) 		DEFAULT NULL;
	DECLARE de_122_029 INT(11) 		DEFAULT NULL;
	DECLARE de_122_030 VARCHAR(255) DEFAULT NULL;
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	


	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.69');
	SET de_122_029 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.29');
	SET de_122_030 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.30');


	
	insert into dbuser.tbl_terminal_error set
	tbl_user_id = de_53,
	tbl_location_id = de_114_047,
	tbl_terminal_id = de_120_069,
	tbl_terminal_error_code = de_122_029,
	tbl_terminal_error_message = de_122_030,
	tbl_terminal_error_date = NOW() ;
	
	
	
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');


	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddTerminalToLocationByLocationId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddTerminalToLocationByLocationId`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_122_170 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_123 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_121_183 INT(11) DEFAULT NULL; 	 
	DECLARE de_122_125 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_124 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_047 INTEGER(11) DEFAULT 0;    
	DECLARE de_114_104 VARCHAR(255) DEFAULT 0;    





	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE de_120_069 VARCHAR(45) DEFAULT NULL; 



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN





	SET de_122_170 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.170');
	SET de_122_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.123');
	SET de_121_183 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.183');
	SET de_122_125 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.125');
	SET de_122_124 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.124');
	SET de_122_126 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.126');
	SET de_114_047 = (SELECT DATA from TBL_MESSAGE WHERE CODE = '114.47');
	SET de_114_104 = (SELECT DATA from TBL_MESSAGE WHERE CODE = '114.104');

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if(select tbl_location_id from tbl_location where  tbl_location_id= de_114_047) is not null then

			insert into tbl_terminal set 
			tbl_location_id = de_114_047,
			tbl_terminaltype_id = de_122_170,
			tbl_terminal_manofacturer = de_122_123,
			tbl_terminal_posTerminalId = de_121_183,
			tbl_terminal_posInternalId = de_122_125,
			tbl_terminal_provider = de_122_124,
			tbl_terminal_qrCode = de_114_104,
			tbl_terminal_reference = de_122_126;

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('120.69', LPAD((SELECT tbl_terminal_id FROM tbl_terminal ORDER BY tbl_terminal_id DESC LIMIT 1),11,'0'));

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','	Invalid Location');

		end if;
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set de_120_069 = (select DATA from TBL_MESSAGE where CODE = 120.69);
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"120.69":"',de_120_069,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddTerminalToLocationByLocationId030400172` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `AddTerminalToLocationByLocationId030400172`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	

	DECLARE de_122_170 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_123 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_121_183 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_125 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_124 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_047 INTEGER(11) DEFAULT 0;    
	DECLARE de_114_104 VARCHAR(255) DEFAULT 0;    





	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE de_120_069 VARCHAR(45) DEFAULT NULL; 



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	




	SET de_122_170 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.170');
	SET de_122_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.123');
	SET de_121_183 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.183');
	SET de_122_125 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.125');
	SET de_122_124 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.124');
	SET de_122_126 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.126');
	SET de_114_047 = (SELECT DATA from TBL_MESSAGE WHERE CODE = '114.47');
	SET de_114_104 = (SELECT DATA from TBL_MESSAGE WHERE CODE = '114.104');

	





	if (select tbl_location_id from tbl_terminal where tbl_terminal_posTerminalId = de_121_183 limit 1) is null then  

		if(select tbl_location_id from tbl_location where tbl_location_id= de_114_047 limit 1) is not null then

			insert into tbl_terminal set 
			tbl_location_id = de_114_047,
			tbl_terminaltype_id = de_122_170,
			tbl_terminal_manofacturer = de_122_123,
			tbl_terminal_posTerminalId = de_121_183,
			tbl_terminal_posInternalId = COALESCE(de_122_125,NULL),
			tbl_terminal_provider = COALESCE(de_122_124,NULL),
			tbl_terminal_qrCode = COALESCE(de_114_104,NULL),
			tbl_terminal_reference = COALESCE(de_122_126,NULL),
			tbl_terminal_lastDateActive = NOW();
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')),('120.69', LPAD((SELECT LAST_INSERT_ID() FROM tbl_terminal limit 1),11,'0'));

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','Invalid Location');

		end if;
	
	else 

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','1015'),('44','Invalid Request');

	end if;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set de_120_069 = (select DATA from TBL_MESSAGE where CODE = 120.69);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"120.69":"',de_120_069,'"}')) AS JSON;
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	end if;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `AddUserByUserId030300059` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `AddUserByUserId030300059`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_114_179 VARCHAR(20) DEFAULT 0; 			
	DECLARE de_055 VARCHAR(2) DEFAULT 10;               
    DECLARE de_056 VARCHAR(3) DEFAULT 100;              
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;		
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;      		
	
	DECLARE de_114_070  VARCHAR(300) DEFAULT NULL;		
	DECLARE de_114_091  VARCHAR(45) DEFAULT NULL;       

	DECLARE de_114_003 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_004 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_005 VARCHAR(45) DEFAULT NULL;		

	DECLARE de_114_011 INT(11) DEFAULT NULL;			
	DECLARE de_127_066 TEXT DEFAULT NULL;				
	DECLARE de_127_068 INT(11) DEFAULT NULL;       		
	
	DECLARE de_122_091 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_122_092 VARCHAR(45) DEFAULT NULL;		
    DECLARE de_122_092_aux INT(11) DEFAULT NULL;		
	DECLARE de_121_145 VARCHAR(45) DEFAULT NULL;		
	
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL;  -- Promo Sbuscription Flag


	DECLARE _US_PH TEXT DEFAULT NULL; 
	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 			
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 			
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 			
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 			
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL; 
		
	DECLARE _US_AD 	TEXT DEFAULT NULL;
	DECLARE de_114_115 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_114_012 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_114_013 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_122_087 INT(11) DEFAULT NULL;  			
	DECLARE de_120_013 INT(11) DEFAULT NULL;  			
	DECLARE de_114_014 INT(11) DEFAULT NULL;  			
	DECLARE de_122_107 INT(11) DEFAULT NULL;  			
	
	DECLARE de_127_070 INT(11) DEFAULT NULL;  		
	DECLARE de_127_071 VARCHAR(99) DEFAULT NULL;  		
	
	
	DECLARE de_122_106 INTEGER(11) DEFAULT 0;   	 	
	DECLARE de_127_072 VARCHAR(11) DEFAULT NULL; 		
	
	
	DECLARE de_121_170 TEXT DEFAULT NULL;               
	DECLARE de_114_075 VARCHAR(100) DEFAULT NULL;  	    
	DECLARE de_123_071 VARCHAR(100) DEFAULT NULL;   	
	DECLARE de_123_031 VARCHAR(100) DEFAULT NULL;   	
	DECLARE de_117_013 VARCHAR(11) DEFAULT NULL;        
	DECLARE de_122_089 VARCHAR(11) DEFAULT NULL;      

	DECLARE de_120_038 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_120_039 VARCHAR(300) DEFAULT NULL; 


	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE RESELLERID INTEGER(11) DEFAULT NULL;

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	
	DECLARE USER_NAME	VARCHAR(100) DEFAULT NULL;     
	DECLARE USER_EMAIL  VARCHAR(100) DEFAULT NULL;    
	DECLARE PHONEID_AUX		VARCHAR(20) DEFAULT NULL; 
	DECLARE PHONEIDL_AUX		VARCHAR(20) DEFAULT NULL; 
	DECLARE ADDRESSID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;  

	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL;



	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	SET de_114_179 = (select right(de_114_179,11));
	SET de_055 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '55');
	SET de_056 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '56');

	SET	de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7'); 
	SET	de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52'); 
	
	SET	de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70'); 
    SET de_114_070 = convert(unhex(de_114_070) using utf8);
    
	SET	de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
	
	SET	de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET	de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET	de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	
	SET	de_114_011 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.11'); 
	SET	de_127_066 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.66'); 
	SET	de_127_068 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.68'); 
	
	SET	de_122_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.91');
	SET	de_122_092 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.92');
    SET de_122_092_aux = de_122_092;
	SET	de_121_145 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.145'); 
	
	SET	de_120_038 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.38'); 
	SET	de_120_039 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.39'); 
	
	
	SET	de_127_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.70'); 
	SET	de_127_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.71'); 
	
    SET	de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
    
	SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
	SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

	SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
	SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
	SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
	SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
	
    SET _US_PH = REPLACE(_US_PH,'-1','');
    
	SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
	SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
	SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
	SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

	SELECT DATA INTO _US_AD FROM TBL_MESSAGE1 WHERE CODE = "AD";
	SET _US_AD = (SELECT CONVERT(unhex(_US_AD) USING utf8 ));
	
	SET de_114_115 = common_schema.get_option(_US_AD, "114.115");
	SET de_114_012 = common_schema.get_option(_US_AD, "114.12");
	SET de_114_013 = common_schema.get_option(_US_AD, "114.13");
	SET de_122_107 = common_schema.get_option(_US_AD, "122.107");
	SET de_114_014 = common_schema.get_option(_US_AD, "114.14");
	SET de_120_013 = common_schema.get_option(_US_AD, "120.13");
	SET de_122_087 = common_schema.get_option(_US_AD, "122.87");
	
	
	SET de_121_170 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.170');
	SET de_114_075 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.75');
	SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');
	SET de_123_031 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.31');
	set de_123_031 = (select right(de_123_031,11));
	SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.106');
	SET de_127_072 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.72');

	SET de_117_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.13');
	SET de_122_089 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.89');


	SET RESELLERID= (select tbl_user_reseller_id from tbl_merchant where tbl_user_id=de_114_179 limit 1);

	set COMPANY_ID = (select tbl_company_id from tbl_user where tbl_user_id = de_114_179);
			
	if (SELECT tbl_user_id FROM tbl_user WHERE tbl_user_email = de_114_007 limit 1) is null then
	
		insert into tbl_user set
		tbl_company_id = COMPANY_ID,
		tbl_user_entity = de_055,
        tbl_user_class = de_056,
		tbl_user_parentId = de_114_179,
		tbl_user_email = de_114_007,
		tbl_user_password =  md5(convert(unhex(de_052) using utf8)),
		tbl_user_pinCode = 1234,
		tbl_user_dateAdded = NOW(),
		tbl_user_companyName = COALESCE(de_114_070,''),
		tbl_user_first = de_114_003,
		tbl_user_last = de_114_005,
		tbl_user_middle = COALESCE(de_114_004,''),
		tbl_user_title = COALESCE(de_114_091,''),
		tbl_user_position = COALESCE(de_122_091,''),
        tbl_user_department = COALESCE(de_122_092_aux,61307),
		tbl_user_supervisor = de_121_145,	
		tbl_gender_type = coalesce(de_114_011,51),
		tbl_userstatus_id = 37,
		tbl_user_userTemp_f = 0,
		tbl_user_information = COALESCE(de_127_066,''),
		tbl_user_accept_tips = COALESCE(de_127_068,'1'),
		tbl_company_type = coalesce(de_127_070,4701),
		tbl_company_type_other = COALESCE(de_127_071,'');
		
		SET USERID_AUX = (SELECT last_insert_id() FROM tbl_user limit 1);
	
		if de_055 = 10 then
			
			if (select tbl_consumer_nmcId from tbl_consumer where tbl_consumer_nmcId = USERID_AUX) is null then
				insert into tbl_consumer set
				tbl_consumer_nmcId = USERID_AUX,
				tbl_consumer_facebook_f = 0,
				tbl_consumer_twitter_f = 0,
				tbl_consumer_receivePushNotificaton_f = 0,
				tbl_consumer_receiveExpireOffers_f = 0,
				tbl_consumer_deleteExpireOffers_f = 0,
				tbl_user_id = USERID_AUX;
			end if;
	
		elseif de_055 between 20 and 24  then
		
			if (select tbl_merchant_nmcId from tbl_merchant where tbl_merchant_nmcId = USERID_AUX) is null then
				insert into tbl_merchant set
				tbl_user_id = USERID_AUX,
				tbl_merchant_nmcId = USERID_AUX,
				tbl_merchant_taxIdNumber = COALESCE(de_123_071, ''),
				tbl_merchant_multipleLocation_f = coalesce(de_117_013,4801),
				tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,0),
				tbl_merchant_haveWebsite_f = 0,
				tbl_merchant_haveAccount_f = 0,
				tbl_merchant_logoimage = COALESCE(de_121_170,''),
				tbl_user_reseller_id = coalesce(de_123_031, RESELLERID),
				tbl_merchant_online_store = COALESCE(de_114_075,'');

				update dbuser.tbl_user set 
				tbl_user_crc = LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0)
				where tbl_user_id = USERID_AUX;

				insert into tbl_link set
				tbl_link_user_id = USERID_AUX,
				tbl_link_link = md5(convert(unhex(de_052) using utf8)),
				tbl_link_date = NOW(),
				tbl_link_delete = 0;

			else	
			
				update tbl_merchant set 
				tbl_merchant_multipleLocation_f = coalesce(de_117_013,4801),
				tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,0),
				tbl_merchant_logoimage = COALESCE(de_121_170,''),
				tbl_user_reseller_id = coalesce(de_123_031, RESELLERID),
				tbl_merchant_online_store = COALESCE(de_114_075,'')
				where tbl_merchant_nmcId = USERID_AUX;

				update dbuser.tbl_user set 
				tbl_user_crc = LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0)
				where tbl_user_id = USERID_AUX;

				insert into tbl_link set
				tbl_link_user_id = USERID_AUX,
				tbl_link_link = md5(convert(unhex(de_052) using utf8)),
				tbl_link_date = NOW(),
				tbl_link_delete = 0;

			end if;



			if (select tbl_user_id from tbl_user_delivery_options where tbl_user_id = USERID_AUX limit 1 ) is null  then
				
				INSERT INTO tbl_user_delivery_options set
				tbl_company_id = COMPANY_ID,
				tbl_user_id = USERID_AUX,
				tbl_delivery_company_price = 0.00,
				tbl_delivery_company_service = '',
				tbl_user_delivery_options_tier = '',
				tbl_delivery_company_tracking_code ='',
				tbl_delivery_company_option = 'Pick Up';
			
			end if;
            
            if length(de_114_009) > 0 then
            
				if de_114_009 = 'true' then
                
					insert into dbitems.tbl_usersubscription set
					tbl_company_id = COMPANY_ID,
                    tbl_usersubscription_user_nmcid = USERID_AUX,
                    tbl_subscription_id = 13,
                    tbl_subscriptionstatus_id = 2401,
                    tbl_usersubscription_date_purchase = NOW(),
                    tbl_usersubscription_date_expiration = DATE_ADD(NOW(), INTERVAL 12 MONTH);
                    
                end if;
            
            end if;
			

			if (select client_name from nmc_control.client_key where user_id = USERID_AUX limit 1) is null then
			
				INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
				values  (md5(CONCAT('Terminal',USERID_AUX)),'Terminal',CURDATE(),1,3,USERID_AUX,0),
						(md5(CONCAT('Module OsCommerce',USERID_AUX)),'Module OsCommerce',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Widget',USERID_AUX)),'Widget',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('WidgetCar',USERID_AUX)),'WidgetCar',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Tablet',USERID_AUX)),'Tablet',CURDATE(),1,6,USERID_AUX,0);
			
			end if;
					
		elseif de_055 = 30 then
		
			if (select tbl_reseller_nmcId from tbl_reseller where tbl_reseller_nmcId = USERID_AUX) is null then
				insert into tbl_reseller set 
				tbl_reseller_nmcId = USERID_AUX,
				tbl_user_id  = USERID_AUX ,
				tbl_reseller_servicesProvider_f =  if(de_127_072 = 'true',1,0),
				tbl_reseller_clientsNumber = COALESCE(de_122_106,0),
				tbl_reseller_admin_approval = 1;
			end if;
			
		elseif de_055 between 40 and 45 then
		
			if (select tbl_admin_nmcId from tbl_admin where tbl_admin_nmcId = USERID_AUX) is null then
				insert into tbl_admin set 
				tbl_admin_nmcId =USERID_AUX,
				tbl_user_id = USERID_AUX;
			end if;
					
		end if;
	

	
	
		while (LENGTH(_48_28_CADENA)>0) DO

			SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
			SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

			SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
			SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
						
			SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
			SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));
					   
			SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
			SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

			insert into tbl_phone set
			tbl_company_id 		  = COMPANY_ID,
			tbl_phone_nmcId       = USERID_AUX,
			tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
			tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
			tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
			tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);
			
			
		end while ; 

		
		
		
		if de_055 != 10 then
		
			insert into tbl_address set 
			tbl_company_id = COMPANY_ID,
			tbl_address_nmcId = USERID_AUX,
			tbl_addresstype_id = 11,
			tbl_address_first = de_114_012,
			tbl_address_second = de_114_013,
			tbl_address_phoneNumber = NULL,
			tbl_zipcode_id = de_122_107,
			tbl_city_id = de_114_014,
			tbl_state_id = de_120_013,
			tbl_country_id = de_122_087;
		
		
			SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);
			
			
            
            if length(de_122_092_aux)>0 then
            
				insert into dbuser.tbl_permission_user (tbl_user_id,
												  tbl_permission_id,
												  tbl_subpermission_id,
												  tbl_permission_user_status_f)
				select  USERID_AUX,
						B.tbl_permission_id,
						A.tbl_subpermission_id,
						A.tbl_subpermission_f

				from dbuser.tbl_permission_group as A 
                left join dbuser.tbl_subpermission as B on A.tbl_subpermission_id = B.tbl_subpermission_id
				where A.tbl_permission_type_id = de_122_092_aux;
            
				if de_122_092_aux in (61307, 61316) then
                
					insert into tbl_permission_ad set
					tbl_user_id = USERID_AUX,
					tbl_permission_ad_create_f = 1,
					tbl_permission_ad_publish_f = 1,
					tbl_permission_item_viewOnly_f = 0;
            
				else
                
					insert into tbl_permission_ad set
					tbl_user_id = USERID_AUX,
					tbl_permission_ad_create_f = 0,
					tbl_permission_ad_publish_f = 0,
					tbl_permission_item_viewOnly_f = 1;
                
				end if;
            
            end if;
            
            
            
			if de_055 between 20 and 24  then
			
				SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);
				SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);

			
					if (select tbl_location_id from tbl_location where tbl_location_userId = USERID_AUX limit 1) is null then
			
			
						INSERT INTO tbl_location SET 
						tbl_company_id = COMPANY_ID,
						tbl_location_storeNumber= 1 ,
						tbl_location_storeName= 'Main' ,
						tbl_location_contactName = USER_NAME, 
						tbl_location_contactEmail = USER_EMAIL, 
						tbl_location_userId = USERID_AUX,
						tbl_location_latitude = coalesce(de_120_038,''),
						tbl_location_longitude= coalesce(de_120_039,''),
						tbl_location_statusId= 7001;
			
						SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);
			


						INSERT tbl_phone SET
						tbl_phone_phoneNumber = coalesce(
														 (select A.tbl_phone_phoneNumber from tbl_phone as A where A.tbl_phone_nmcId = USERID_AUX and A.tbl_phonetype_id = 4001 limit 1),
														 (select A.tbl_phone_phoneNumber from tbl_phone as A where A.tbl_phone_nmcId = USERID_AUX limit 1)
														 ),
						tbl_phone_extension = coalesce(
														(select A.tbl_phone_extension from tbl_phone as A where A.tbl_phone_nmcId = USERID_AUX and A.tbl_phonetype_id = 4001 limit 1),
														(select A.tbl_phone_extension from tbl_phone as A  where A.tbl_phone_nmcId = USERID_AUX limit 1)
														),
						tbl_phone_nmcId = 0,
						tbl_phone_country_id = coalesce(
														(select A.tbl_phone_country_id from tbl_phone as A where A.tbl_phone_nmcId = USERID_AUX and A.tbl_phonetype_id = 4001 limit 1),
														(select A.tbl_phone_country_id from tbl_phone as A where A.tbl_phone_nmcId = USERID_AUX  limit 1)
														),
						tbl_phonetype_id = 4001;
				
						SET PHONEIDL_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);



						if length(PHONEIDL_AUX)>0 then
							
							INSERT tbl_locationphone SET
							tbl_phone_id = PHONEIDL_AUX,
							tbl_location_id=LOCATIONID_AUX;
						end if;
						
						if length(ADDRESSID_AUX) > 0 then

							INSERT tbl_locationaddress SET
							tbl_location_id = LOCATIONID_AUX, 
							tbl_address_id = ADDRESSID_AUX;

						end if;
						
                        
						INSERT INTO tbl_location_hardware (
						tbl_company_id,
						tbl_user_id,
						tbl_location_id,
						tbl_hardware_type_id,
						tbl_location_hardware_qty,
						tbl_location_hardware_shipped,
						tbl_shipping_status_id) 
						values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,0,0,73001);
                        
                        
                        INSERT INTO tbl_location_schedule (
						tbl_location_id,
						tbl_day_of_the_week,
						tbl_24_hour,
						tbl_closed_flag,
						tbl_hour_open,
						tbl_hour_close) 
						values (LOCATIONID_AUX,0,1,0,'00:00:00','24:00:00'),
							   (LOCATIONID_AUX,1,1,0,'00:00:00','24:00:00'),
							   (LOCATIONID_AUX,2,1,0,'00:00:00','24:00:00'),
							   (LOCATIONID_AUX,3,1,0,'00:00:00','24:00:00'),
							   (LOCATIONID_AUX,4,1,0,'00:00:00','24:00:00'),
							   (LOCATIONID_AUX,5,1,0,'00:00:00','24:00:00'),
							   (LOCATIONID_AUX,6,1,0,'00:00:00','24:00:00');
					
					end if;
					
			end if;
		
		end if;
		
		
		
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
	
	else
	 
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','2053'),('44','Email already exists');
	
	end if;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		if de_055 = '20' then
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.1":"',COMPANY_ID,'"'),CONCAT(',"53":"',(SELECT dbuser.GetNMCID(USERID_AUX)),'"}')) as JSON;
		else
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(SELECT dbuser.GetNMCID(USERID_AUX)),'"}')) as JSON;
		end if;
	else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;	
	end if;

	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ChangeLanguageStatusByPlatform020400351` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ChangeLanguageStatusByPlatform020400351`(IN MSG_IN VARCHAR(20000))
BEGIN





	DECLARE de_122_045 INT(11) DEFAULT NULL; 
	DECLARE de_123_036 INT(11) DEFAULT NULL; 
	DECLARE de_114_143 INT(11) DEFAULT NULL;

	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL; 
	DECLARE de_127_072 VARCHAR(5) DEFAULT NULL;
	DECLARE de_123_050 VARCHAR(5) DEFAULT NULL; 





	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;




	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	set de_122_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.45');
	set de_123_036 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.36');
	set de_114_143 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.143');
	set de_123_050 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.50');

	set de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.9');
	set de_127_072 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.72');







	update dbuser.tbl_language_platform set
	tbl_languagestatus_id = if ((de_114_009 = 'true'),'67001','67002')
	where  tbl_platform_id = 1
	and tbl_language_id = de_122_045;

	update dbuser.tbl_language_platform set
	tbl_languagestatus_id = if ((de_127_072 = 'true'),'67001','67002')
	where  tbl_platform_id = 2
	and tbl_language_id = de_122_045;

	update dbuser.tbl_language set
	tbl_language_active_f = de_123_050
	where tbl_language_id = de_122_045;


	SELECT 
	GROUP_CONCAT(   
	CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}') )as JSON;
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ChangeUserStatus020400251` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ChangeUserStatus020400251`(IN MSG_IN VARCHAR(20000))
BEGIN
-- -------------------------	
-- Declare Data Elements --
-- ------------------------- 

	DECLARE de_53 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_143 INT(11) DEFAULT NULL; 
	
-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE ENTITY_AUX INTEGER(2) DEFAULT NULL;
	DECLARE CLASS_AUX INTEGER(1) DEFAULT NULL; 


-- ---------------
-- Validations --
-- ---------------	
	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables --
-- -----------------

	set de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

	set ENTITY_AUX = (select substring(de_53,5,2));
	set CLASS_AUX = (select substring(de_53,9,1));

	set de_53 = (select right(de_53,11));
	
	SET de_114_143 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.143');

-- ---------------		
-- Query of DB --
-- ---------------


	if de_114_143 between 31 and 39 then

		if de_114_143 = 34 then

			update dbuser.tbl_user set
			tbl_userstatus_id = de_114_143,
			tbl_user_dateModified = NOW(),
			tbl_user_date_suspended = NOW()
			where  tbl_user_id = de_53;

			if ENTITY_AUX = '20' and CLASS_AUX = '0' then

				/*
				update dbitems.tbl_product set
				tbl_productstatus_id = '1004'
				where tbl_product_id in (select tbl_product_id 
										from dbitems.vw_product_by_merchant 
										where tbl_main_user_id = dbuser.GetNMCId(de_53)) 
				and tbl_productstatus_id = '1001';
                */
                
                update dbitems.tbl_product set
				tbl_productstatus_id = '1004'
				where tbl_product_usernmcId = de_53;

			end if;

		else

			update dbuser.tbl_user set
			tbl_userstatus_id = de_114_143,
			tbl_user_dateModified = NOW()
			where  tbl_user_id = de_53;

		end if;

	end if;

	SELECT 
	GROUP_CONCAT(   
	CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}') )as JSON;
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ClearHardwareCart020400467` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ClearHardwareCart020400467`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53  VARCHAR(20) DEFAULT NULL;    	
	
    
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
	
    
    
    
	delete from dbuser.tbl_hardware_cart 
	where tbl_user_id = de_53
	and tbl_hardware_cart_delete = 0;




	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
			

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

	

    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ConfigTablet010300215` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `ConfigTablet010300215`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: ConfigTablet010400215
-- Method: 010400215
-- Version: 1.0
-- Last modified: 2015-11-23
-- --------------------------------------------------------


-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE de_053	    VARCHAR(20) DEFAULT 0; 		   -- 53 User id 
	DECLARE de_057	    VARCHAR(45) DEFAULT 0; 		   -- 57 Device id 
	
-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE JSON TEXT;
    
	DECLARE CLIENT_KEY VARCHAR(70) DEFAULT NULL;
	DECLARE LOGO_IMAGE VARCHAR(70) DEFAULT NULL;
    DECLARE COMPANY_NAME VARCHAR(70) DEFAULT NULL;
    DECLARE LOCATION VARCHAR(11) DEFAULT NULL;
    DECLARE TERMINAL VARCHAR(11) DEFAULT NULL;
    DECLARE TERMINAL_REFERENCE VARCHAR(70) DEFAULT NULL;
    DECLARE TERMINAL_GCM VARCHAR(255) DEFAULT NULL;
	DECLARE DONGLE_SIZE INT(11) DEFAULT NULL;
     
	-- Mandatory Validations
    DECLARE MANDATORY_F VARCHAR(5) DEFAULT NULL;
    DECLARE CATEGORY_F VARCHAR(5) DEFAULT NULL;
	DECLARE SUBSCRIPTION_F VARCHAR(5) DEFAULT NULL;
	DECLARE MONTHLY_F VARCHAR(5) DEFAULT NULL;
	DECLARE HARDWARE_F VARCHAR(5) DEFAULT NULL;
	DECLARE SHIPPING_F VARCHAR(5) DEFAULT NULL;
	DECLARE TAX_F VARCHAR(5) DEFAULT NULL;
	-- DECLARE LOCATION_F VARCHAR(5) DEFAULT NULL;

-- --------------------
--                   --
-- -------------------- 

	SET  group_concat_max_len = 1000000;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_053 = (select right(de_053,11));

	SET de_057 = (select DATA from TBL_MESSAGE1 where CODE = '57');
	
-- ---------------		
-- Query of DB  --
-- ---------------

	set CLIENT_KEY = (select client_key.`key` from  nmc_control.client_key where client_key.user_id = de_053 AND client_key.type=6);
    set LOGO_IMAGE = (select tbl_merchant.tbl_merchant_logoimage from  dbuser.tbl_merchant where tbl_merchant.tbl_user_id = de_053);
	set COMPANY_NAME = (select tbl_user.tbl_user_companyName from  dbuser.tbl_user where tbl_user.tbl_user_id = de_053);
    set LOCATION = (select tbl_location_id from  dbuser.tbl_terminal where tbl_terminal_posTerminalId = de_057);
    set TERMINAL = (select tbl_terminal_id from  dbuser.tbl_terminal where tbl_terminal_posTerminalId = de_057);
    set TERMINAL_REFERENCE = (select tbl_terminal_reference from  dbuser.tbl_terminal where tbl_terminal_posTerminalId = de_057);
    set TERMINAL_GCM = (select tbl_terminal_gcm from  dbuser.tbl_terminal where tbl_terminal_posTerminalId = de_057);
    set DONGLE_SIZE = (select version_dongle_size from nmc_control.version_update order by version_update_id DESC LIMIT 1);
    
	-- Mandatory Validations
	
	set CATEGORY_F = 	 (select(if((select tbl_merchantbusinesscategory.tbl_merchant_nmcId from dbuser.tbl_merchantbusinesscategory where tbl_merchant_nmcId = de_053 limit 1) is null,'false','true')));
    set SUBSCRIPTION_F = (select(if((select tbl_usersubscription_id from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_053 and tbl_subscription_id in (15,16) and tbl_usersubscription_date_expiration > NOW() limit 1) is null,'false','true')));
	set MONTHLY_F =  	 (select(if((select A.tbl_user_id from dbuser.tbl_merchant as A where A.tbl_user_id = de_053 and A.tbl_merchant_receivePayment_f= 1 and (select count(tbl_address_id) from dbuser.tbl_address where tbl_address_nmcId = de_053 and tbl_addresstype_id = 13)>0 limit 1) is null,'false','true')));
	set HARDWARE_F = 	 (select(if((select tbl_location_hardware_id FROM dbuser.tbl_location_hardware where tbl_user_id = de_053 limit 1) is null,'false','true')));
	set SHIPPING_F = 	 (select(if((select A.tbl_user_id from dbuser.tbl_merchant as A where A.tbl_user_id = de_053 and A.tbl_merchant_receivePayment_f= 1 and (select count(tbl_address_id) from dbuser.tbl_address where tbl_address_nmcId = de_053 and tbl_addresstype_id = 13)>0 limit 1) is null,'false','true')));
	set TAX_F = 	 	 (select(if((select A.tbl_user_id from dbuser.tbl_merchant as A where A.tbl_user_id = de_053 and A.tbl_merchant_taxIdNumber is not null and A.tbl_merchant_taxIdNumber !='' limit 1) is null,'false','true')));
	-- set LOCATION_F = 	 (select(if((select tbl_usersubscription_id FROM dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_053 and tbl_location_id is null limit 1) is not null,'false','true')));
	
	if (CATEGORY_F='true' and SUBSCRIPTION_F='true' and MONTHLY_F='true' and HARDWARE_F='true' and SHIPPING_F='true' and TAX_F='true') then
		set MANDATORY_F = 'true';
	else
		set MANDATORY_F = 'false';
	end if;


SET JSON=(
	select 
	GROUP_CONCAT(
	
		CONCAT('{"39":"','0000','"'),
		CONCAT(',"44":"','Transaction Approved','"'),
		CONCAT(',"53":"',(select dbuser.getnmcid(de_053)),'"'),
		CONCAT(',"127.22":"',COALESCE(CLIENT_KEY,''),'"'),
		CONCAT(',"121.170":"',COALESCE(LOGO_IMAGE,''),'"'),
		CONCAT(',"114.170":"',COALESCE(hex(COMPANY_NAME),''),'"'),
		CONCAT(',"114.47":"',COALESCE(LOCATION,''),'"'),
		CONCAT(',"120.69":"',COALESCE(TERMINAL,''),'"'),
		CONCAT(',"122.126":"',COALESCE(TERMINAL_REFERENCE,''),'"'),
		CONCAT(',"122.12":"',COALESCE(TERMINAL_GCM,''),'"'),
        CONCAT(',"121.46":"',COALESCE(DONGLE_SIZE,'0'),'"'),
		CONCAT(',"114.9":"',COALESCE(MANDATORY_F,''),'"}')
	
	) as JSON
	
);
	
    
 
IF JSON is NULL THEN
	SET JSON = '{}';
END IF;

SELECT JSON;

	DROP TABLE TBL_MESSAGE1;

  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `CreateCompanies` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `CreateCompanies`(IN MSG_IN VARCHAR(20000))
BEGIN
	
	DECLARE de_US TEXT(5000) DEFAULT NULL;
	DECLARE CADENA_USER TEXT DEFAULT NULL;
	
	DECLARE USER_ID INTEGER(11) DEFAULT NULL; 
	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL;
	DECLARE COMPANY_CRC VARCHAR(255) DEFAULT NULL;
	
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	SET  group_concat_max_len = 10000000;
	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	
	insert into dbuser.tbl_company (
	tbl_company_name,
	tbl_company_crc,
	tbl_company_taxId,
	tbl_company_logo,
	tbl_company_website,
	tbl_company_terms,
	tbl_company_policy,
	tbl_company_type_id,
	tbl_company_status_id,
	tbl_company_dateCreate
	)
	
	select  
	A.tbl_user_companyName,
	A.tbl_user_crc,
	B.tbl_merchant_taxIdNumber,
	B.tbl_merchant_logoimage,
	B.tbl_merchant_online_store,
	A.tbl_user_terms,
	A.tbl_user_policy,
	A.tbl_company_type,
	33,
	A.tbl_user_dateAdded
	from dbuser.tbl_user as A, dbuser.tbl_merchant as B
	where A.tbl_user_entity = 20
	and A.tbl_user_class in ('2A0','2C0')
	and length(A.tbl_user_companyName) > 0
    and length(A.tbl_user_crc) > 0
	and A.tbl_user_id = B.tbl_user_id
	;
	
	
	set de_US = (select GROUP_CONCAT(CONCAT('',tbl_user_id,'|'))
				from dbuser.tbl_user 
				where tbl_user_entity = 20
				and tbl_user_class in ('2A0','2C0')
				and length(tbl_user_companyName) > 0
                and length(tbl_user_crc) > 0
				);
	
	set CADENA_USER = REPLACE(de_US,'|,','|');	
	
	WHILE (LENGTH(CADENA_USER)>0) DO
			
		SET USER_ID = (SELECT SUBSTR(CADENA_USER,1,LOCATE('|',CADENA_USER)-1));
		SET CADENA_USER = (SELECT SUBSTR(CADENA_USER,LOCATE('|',CADENA_USER)+1));

		SET COMPANY_CRC = (select tbl_user_crc from tbl_user where tbl_user_id = USER_ID);
		SET COMPANY_ID = (select tbl_company_id from tbl_company where tbl_company_crc = COMPANY_CRC limit 1);
	
		update dbuser.tbl_user set
		tbl_company_id = COMPANY_ID
		where tbl_user_id = USER_ID;
		
		update dbuser.tbl_user set
		tbl_company_id = COMPANY_ID
		where tbl_user_parentId = USER_ID;
		
		update dbuser.tbl_merchant_info set
		tbl_company_id = COMPANY_ID
		where tbl_user_id = USER_ID;
		
		update dbuser.tbl_merchantbusinesscategory set
		tbl_company_id = COMPANY_ID
		where tbl_merchant_nmcId = USER_ID;
	
		update dbuser.tbl_user_delivery_options set
		tbl_company_id = COMPANY_ID
		where tbl_user_id = USER_ID;
		
		update dbuser.tbl_phone set
		tbl_company_id = COMPANY_ID
		where tbl_phone_nmcId = USER_ID;
		
		update dbuser.tbl_address set
		tbl_company_id = COMPANY_ID
		where tbl_address_nmcId = USER_ID;
		
		update dbuser.tbl_location set
		tbl_company_id = COMPANY_ID
		where tbl_location_userId = USER_ID;
		
		update dbuser.tbl_hardware_cart set
		tbl_company_id = COMPANY_ID
		where tbl_user_id = USER_ID;
		
		update dbuser.tbl_location_hardware set
		tbl_company_id = COMPANY_ID
		where tbl_user_id = USER_ID;
		
		update dbitems.tbl_module set
		tbl_company_id = COMPANY_ID
		where tbl_user_id = USER_ID;
		
		update dbitems.tbl_usersubscription set
		tbl_company_id = COMPANY_ID
		where tbl_usersubscription_user_nmcid = USER_ID;
		
	END WHILE;
	

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
			
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteDeliveryOptionsByUser040400322` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `DeleteDeliveryOptionsByUser040400322`(IN MSG_IN VARCHAR(20000))
BEGIN
	




	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;       		

	
	DECLARE de_122_109 INTEGER(15) DEFAULT NULL;		






	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
		

	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
     
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	
		
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
	

		set de_122_109 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.109');
		
	






			IF (select tbl_productdelivery_id from dbitems.tbl_productdelivery where tbl_deliverycompany_id = de_122_109 limit 1)IS NULL THEN
						
						DELETE FROM  tbl_user_delivery_options 
						WHERE tbl_delivery_id=de_122_109 AND tbl_user_id = de_053
						;
				
			  				
					
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
				
				
			ELSE
				
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','2068'),('44','Delivery Option in Use'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
					
			END IF;
			
		
	
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteLead020400668` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `DeleteLead020400668`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  	   
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	
    
	update tbl_user set
    tbl_userstatus_id = 38,
	tbl_user_dateModified = NOW()
	where tbl_user_id = de_053;
		
	

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
        
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteLocationQRCodeById020400513` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `DeleteLocationQRCodeById020400513`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
  		
	DECLARE de_114_047 INTEGER(11) DEFAULT NULL; 		
	
	 
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;


	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
		
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');

	
		
	DELETE FROM tbl_location_qrcode WHERE tbl_location_id = de_114_047;
			
		
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
    
	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
		
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteMerchantAccountLocationById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `DeleteMerchantAccountLocationById`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
    DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_73 INTEGER(11) DEFAULT 0;    
	



	DECLARE PHONE_ID_AUX INT(11) DEFAULT 0;
	DECLARE LOCATION_ID_AUX BIGINT(20) DEFAULT 0;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_114_73 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.73');

		
		
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		SET PHONE_ID_AUX = (SELECT tbl_phone_id FROM tbl_merchantaccountphone WHERE tbl_merchantaccount_id = de_114_73);
		delete from tbl_phone WHERE tbl_phone_id = PHONE_ID_AUX;

		delete from tbl_merchantaccount WHERE tbl_merchantaccount_id = de_114_73;

		delete from  tbl_locationmerchantaccount WHERE tbl_merchantaccount_id = de_114_73;
		
		
		
		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteMerchantAccountLocationById040400166` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `DeleteMerchantAccountLocationById040400166`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
    DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	
	
	DECLARE de_114_73 INTEGER(11) DEFAULT 0;    
	



	DECLARE PHONE_ID_AUX INT(11) DEFAULT 0;
	DECLARE LOCATION_ID_AUX BIGINT(20) DEFAULT 0;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	




	
		SET de_114_73 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.73');




		SET PHONE_ID_AUX = (SELECT tbl_phone_id FROM tbl_merchantaccountphone WHERE tbl_merchantaccount_id = de_114_73);
		delete from tbl_phone WHERE tbl_phone_id = PHONE_ID_AUX;

		delete from tbl_merchantaccount WHERE tbl_merchantaccount_id = de_114_73;

		delete from  tbl_locationmerchantaccount WHERE tbl_merchantaccount_id = de_114_73;
		
		
		
		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeletePOSInfoLocationById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `DeletePOSInfoLocationById`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 INTEGER(11) DEFAULT 0;  		    
	DECLARE de_120_097 VARCHAR(15) DEFAULT 0; 			
	




	
	
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_120_097 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.97');
		
		
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




				
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_merchantposphone  WHERE tbl_merchantpos_id = de_120_097);
				
				delete from tbl_merchantpos 
				where tbl_merchantpos_id = de_120_097;
			
			
				DELETE FROM tbl_phone
				WHERE tbl_phone_id = PHONEID_AUX;
				
				DELETE FROM tbl_merchantposphone
				WHERE tbl_merchantpos_id = de_120_097;
				
	
		
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			
		
					
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeletePOSInfoLocationById040400169` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `DeletePOSInfoLocationById040400169`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	
	DECLARE de_053 INTEGER(18) DEFAULT 0;  		   		
	DECLARE de_120_097 VARCHAR(15) DEFAULT 0; 			
	




	
	
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		SET de_120_097 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.97');
		
		
	



				
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_merchantposphone  WHERE tbl_merchantpos_id = de_120_097);
				
				delete from tbl_merchantpos 
				where tbl_merchantpos_id = de_120_097;
			
			
				DELETE FROM tbl_phone
				WHERE tbl_phone_id = PHONEID_AUX;
				
				DELETE FROM tbl_merchantposphone
				WHERE tbl_merchantpos_id = de_120_097;
				
	
		
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			
		
					
	
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteTerminalLocationById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `DeleteTerminalLocationById`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_120_069 INTEGER(11) DEFAULT 0;    
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.69');

		
		
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		
		delete from tbl_terminal 
		where tbl_terminal_id = de_120_069;
		
		
		
		
		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `DeleteTerminalLocationById040400174` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `DeleteTerminalLocationById040400174`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
		
	DECLARE de_120_069 INTEGER(11) DEFAULT 0;    
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	





	
		SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.69');




		delete from tbl_terminal 
		where tbl_terminal_id = de_120_069;
		

		
		
		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditAddNewUser030400130` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditAddNewUser030400130`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  	   
	DECLARE de_052 VARCHAR(32) DEFAULT NULL;      
	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_122_091 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_127_061 INT(20) DEFAULT NULL;		


	
	DECLARE de_122_106 INTEGER(11) DEFAULT 0;   
	DECLARE de_114_027 VARCHAR(11) DEFAULT 0;   
	DECLARE de_114_009 VARCHAR(11) DEFAULT NULL;   
	
	DECLARE de_121_170 TEXT DEFAULT NULL; 
	DECLARE de_114_75 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_114_131 VARCHAR(100) DEFAULT NULL; 
	



	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	
	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET USER_TYPE_AUX = (select  substring(de_053,5,1) );
	
	set de_053 = (select right(de_053,11));
	
	
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_122_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.91');
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.27');
	SET	de_127_061 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.61'); 
	
	SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.106');
	SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
	
	SET de_121_170 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.170');
	SET de_114_75 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.75');
	SET de_114_131 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.131');





	
		update tbl_user set
		
		tbl_user_userTemp_f     = 0,
	
		tbl_user_dateModified   = NOW(),
		tbl_user_password       = COALESCE(md5((CONVERT(unhex(de_052) using utf8))),tbl_user_password),
		tbl_user_title = COALESCE(de_122_091, tbl_user_title),
		tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName) ,           
		tbl_user_first = COALESCE(de_114_003, tbl_user_first),
		tbl_user_middle = COALESCE(de_114_004, tbl_user_middle),
		tbl_user_last = COALESCE(de_114_005, tbl_user_last),
		tbl_user_pay_nmcId = COALESCE(de_127_061, tbl_user_pay_nmcId)

		where tbl_user_id = de_053;
		
		

		IF USER_TYPE_AUX IS NOT NULL THEN
				
			CASE USER_TYPE_AUX
					
				WHEN 2 THEN 

					UPDATE dbuser.tbl_merchant SET 
						tbl_merchant_taxIdNumber = COALESCE(de_114_131,tbl_merchant_taxIdNumber),
						tbl_merchant_online_store = COALESCE(de_114_75,tbl_merchant_online_store),
						tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage)
					WHERE tbl_merchant_nmcId = de_053;
					
					
				WHEN 3 THEN 
					UPDATE tbl_reseller SET
						  tbl_reseller_servicesProvider_f =  if(de_114_009 = 'true',1,0),
						  tbl_reseller_clientsNumber = COALESCE(de_122_106,tbl_reseller_clientsNumber)
					WHERE tbl_user_id = de_053;  
			END CASE;	
		END IF;



		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		

	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditAddressConsumerByAddressIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditAddressConsumerByAddressIdMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_114_115 INT(11)     DEFAULT 0;    
	DECLARE de_121_045 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_121_047  INT(6) DEFAULT 0;   
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_047_018 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_120_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL; 
	DECLARE de_122_107 INT(11)     DEFAULT 0;    
	DECLARE de_114_018 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_053 INT(18)         DEFAULT 0; 
	DECLARE de_120_038 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_120_039 VARCHAR(20) DEFAULT NULL; 




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
	SET de_114_115 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.115');
	SET de_121_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.45');
	SET de_121_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.47');
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.12');
	SET de_114_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.13');
	SET de_047_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '47.18');
	SET de_120_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.13');
	SET de_114_014 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.14');
	SET de_122_107 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.107');	
	SET de_114_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.18');
	SET de_053     = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
	SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if(select tbl_address_id from tbl_address  where tbl_address_id = de_114_115 and tbl_address_nmcId = de_053) is not null then 
					
			update  tbl_address set 
					tbl_address_nmcId = de_053,
					tbl_address_first = de_114_012,
					tbl_address_second = de_114_013,
					tbl_address_name = de_114_053,
					tbl_address_nickname = ' ',
					tbl_address_phoneNumber = de_114_018,
					tbl_address_flag = de_121_047,
					tbl_address_storeNumber = 123,
					tbl_address_latitude = de_120_039,
					tbl_address_longitude = de_120_038,
					tbl_zipcode_id = de_122_107,
					tbl_addresstype_id = de_121_045,
					tbl_city_id = de_114_014,
					tbl_state_id = de_120_013,
					tbl_country_id = de_047_018

			where tbl_address_id = de_114_115;

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','Invalid Address');

		end if;
		
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditAddressConsumerByAddressIdMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditAddressConsumerByAddressIdMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_114_115 INT(11)     DEFAULT 0;    
	DECLARE de_121_045 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_121_047  INT(6) DEFAULT 0;   
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_047_018 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_120_013 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL; 
	DECLARE de_122_107 INT(11)     DEFAULT 0;    
	DECLARE de_114_018 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_053 INT(18)         DEFAULT 0; 
	DECLARE de_120_038 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_120_039 VARCHAR(20) DEFAULT NULL; 




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	DECLARE PHONE_AUX VARCHAR(20) DEFAULT NULL; 




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
	SET de_114_115 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.115');
	SET de_121_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.45');
	SET de_121_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.47');
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.12');
	SET de_114_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.13');
	SET de_047_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '47.18');
	SET de_120_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.13');
	SET de_114_014 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.14');
	SET de_122_107 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.107');	
	SET de_114_018 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.18');
	SET de_053     = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
	SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if(select tbl_address_id from tbl_address  where tbl_address_id = de_114_115 and tbl_address_nmcId = de_053) is not null then 
				
			set PHONE_AUX = (select tbl_address_phoneNumber from tbl_address where tbl_address_id = de_114_115);
	
			update  tbl_address set 
					tbl_address_nmcId = de_053,
					tbl_address_first = de_114_012,
					tbl_address_second = de_114_013,
					tbl_address_name = de_114_053,
					tbl_address_nickname = de_114_053,
					tbl_address_phoneNumber = de_114_018,
					tbl_address_flag = de_121_047,
					tbl_address_storeNumber = 123,
					tbl_address_latitude = de_120_039,
					tbl_address_longitude = de_120_038,
					tbl_zipcode_id = de_122_107,
					tbl_addresstype_id = de_121_045,
					tbl_city_id = de_114_014,
					tbl_state_id = de_120_013,
					tbl_country_id = de_047_018		
			where tbl_address_id = de_114_115;

			update tbl_phone set
				tbl_phone_phoneNumber = de_114_018,
				tbl_phone_country_id = de_047_018
			where tbl_phone_nmcId = de_053
			and tbl_phonetype_id = 4006
			and tbl_phone_phoneNumber = PHONE_AUX;
			


			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','Invalid Address');

		end if;
		
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditAddressUser020400133` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditAddressUser020400133`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_121_045 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_122_087 INT(11) DEFAULT NULL; 	 
	DECLARE de_120_013 INT(11) DEFAULT NULL; 	 
	DECLARE de_114_014 INT(11) DEFAULT NULL; 	 
	DECLARE de_122_107 INT(11) DEFAULT 0; 
    DECLARE de_114_018 VARCHAR(20) DEFAULT NULL;
	DECLARE de_53 VARCHAR(20) DEFAULT 0;        	 
	DECLARE de_114_115 INTEGER(11) DEFAULT NULL; 

	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL; 
	DECLARE de_120_008 VARCHAR(5) DEFAULT NULL; 



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	SET de_53 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
	SET de_121_045 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.45');
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.53');
	SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.12');
	SET de_114_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.13');	
	SET de_114_014 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.14');
	SET de_120_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.13');
	SET de_122_107 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.107');
	SET de_122_087 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.87');
	SET de_114_115 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.115');
	SET de_114_018 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.18');

	SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
	SET de_120_008 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.8');


	if de_120_008 = 'true' then 
	
		UPDATE dbuser.tbl_address SET 
		tbl_address_primary_f = 0
		where tbl_address_nmcId = de_53;
	
	end if;
	
	UPDATE dbuser.tbl_address SET 
    tbl_address_name = COALESCE(de_114_053,tbl_address_name),
    tbl_address_nickname = COALESCE(de_114_053,tbl_address_nickname),
    tbl_address_first = COALESCE(de_114_012,tbl_address_first),
	tbl_address_second = COALESCE(de_114_013,tbl_address_second),
	tbl_country_id = COALESCE(de_122_087,tbl_country_id),
	tbl_state_id = COALESCE(de_120_013,tbl_state_id),
	tbl_city_id = COALESCE(de_114_014,tbl_city_id),
	tbl_zipcode_id = COALESCE(de_122_107,tbl_zipcode_id),
    tbl_addresstype_id = COALESCE(de_121_045,tbl_addresstype_id),
    tbl_address_phoneNumber = COALESCE(de_114_018,tbl_address_phoneNumber),
    tbl_address_active = COALESCE(if(de_114_009 = 'true',1,0),tbl_address_active),
	tbl_address_primary_f = COALESCE(if(de_120_008 = 'true',1,0),tbl_address_primary_f)
	WHERE tbl_address_id  = de_114_115
	AND tbl_address_nmcId = de_53; 

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditBirthDateByUser020400380` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditBirthDateByUser020400380`(IN MSG_IN VARCHAR(20000))
BEGIN

-- --------------------------------------------------------
-- Autor: Juan David Zapata 
-- Procedure: EditBirthDateByUser020400380
-- Method: 020400380
-- Version: 1.0
-- Last modified: 2014-10-15
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL; -- 53 User Id
	DECLARE de_123_010 VARCHAR(5) DEFAULT NULL; -- 123.10 Age Confirmation Flag
	-- DECLARE de_123_024 VARCHAR(5) DEFAULT NULL; -- 123.24 Age Confirmation Receive Items Flag
	DECLARE de_114_008 DATE DEFAULT NULL; -- 114.8 Birth Date

-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- ---------------
-- Validations --
-- ---------------	
	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 =(select right(de_053,11));

	SET de_123_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.10');
	SET de_114_008 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.8');
	-- SET de_123_024 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.24');
	
-- -----------------	
-- Set variables --
-- -----------------

	update tbl_user set
	tbl_user_ageConfirm_f = if(de_123_010='true',1,0),
	-- tbl_user_ageReceiveItems_f = if(de_123_024='true',1,0),
	tbl_user_birthDate = de_114_008
	where tbl_user_id = de_053;
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditConsumerProfile020400477` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditConsumerProfile020400477`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: EditConsumerProfile020400477
-- Method: 020400477
-- Version: 1.0
-- last modified: 2015-12-09
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 		-- User Id
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; 		-- Password
    DECLARE de_064 VARCHAR(10) DEFAULT NULL; 		-- Pincode
    DECLARE de_114_003 VARCHAR(45) DEFAULT NULL; 	-- Firstname
    DECLARE de_114_005 VARCHAR(45) DEFAULT NULL; 	-- Lastname
	DECLARE de_123_010 VARCHAR(5) DEFAULT NULL; 	-- Age confirmation flag
	DECLARE de_123_037 VARCHAR(5) DEFAULT NULL; 	-- Language code
	DECLARE de_114_008 DATE DEFAULT NULL; 			-- 114.8 Birth Date

-- --------------------
-- Declare auxiliary --
-- --------------------
	 
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------
	-- TABLE  TEMPORARY OF IN    --
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables --
-- -----------------

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
    
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_064 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '64'); 
    SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');	
    SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');	
	SET de_123_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.10'); 	
	SET de_123_037 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.37'); 	   
	SET de_114_008 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.8');
	
	-- remove 24 - 25 - 101 - 53 - 52
	DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;

-- ---------------		
-- Query of DB --
-- ---------------
	
		IF LENGTH(de_052)>0 THEN
        
			UPDATE tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8))
			where tbl_user_id = de_053;	

			-- INSERT VALUES OF RESPONSE
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
		
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_id = de_053 ) = 37 then
				update dbuser.tbl_link set tbl_link_delete=1 where tbl_link_user_id=de_053;
				update dbuser.tbl_user set tbl_userstatus_id= 33 where tbl_user_id=de_053;
                update dbuser.tbl_user set tbl_user_firstlogin_f= 1 where tbl_user_id=de_053;
			
				IF(SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053 ) = 10 then
					update dbuser.tbl_user set tbl_user_userTemp_f = 0 where tbl_user_id=de_053;
				END IF;
			end if;
			
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_id = de_053 ) = 39 then
 
				update dbuser.tbl_link set tbl_link_delete=1 where tbl_link_user_id=de_053;
				update dbuser.tbl_user set tbl_userstatus_id= 37 where tbl_user_id=de_053;

				IF(SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053 ) = 10 then
					update dbuser.tbl_user set tbl_user_userTemp_f = 0 where tbl_user_id=de_053;
				END IF;
			
			end if;

			

		END IF;

		
		
		IF LENGTH(de_064)>0 THEN
        
			UPDATE tbl_user set 
			tbl_user_pinCode = md5(convert(unhex(de_064) using utf8))
			where tbl_user_id = de_053;	

			-- INSERT VALUES OF RESPONSE
	
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		END IF;

		IF LENGTH(de_114_003)>0 THEN

			UPDATE tbl_user set 
			tbl_user_first = de_114_003
			where tbl_user_id = de_053;				
			
			-- INSERT VALUES OF RESPONSE
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		END IF;

		IF LENGTH(de_114_005)>0 THEN

			UPDATE tbl_user set 
			tbl_user_last = de_114_005
			where tbl_user_id = de_053;				
			
			-- INSERT VALUES OF RESPONSE
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		END IF;
        

		IF LENGTH(de_123_010)>0 THEN
        
			UPDATE tbl_user set 
			tbl_user_receiveItemsAge_f = COALESCE(if(de_123_010='true',1,0),tbl_user_receiveItemsAge_f),
			tbl_user_birthDate = de_114_008
            where tbl_user_id = de_053;				
			
			-- INSERT VALUES OF RESPONSE
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
        
        END IF;

		IF LENGTH(de_123_037)>0 THEN
        
			UPDATE tbl_user set 
			tbl_user_language = de_123_037
			where tbl_user_id = de_053;	

			-- INSERT VALUES OF RESPONSE
	
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		END IF;

-- -----------------------
-- Result of operation --
-- -----------------------			

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditDeliveryOptionsByUser020400321` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditDeliveryOptionsByUser020400321`(IN MSG_IN VARCHAR(20000))
BEGIN

	-- ----------
	-- Declare --
	-- ----------

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;       		
	
	DECLARE de_122_109 INTEGER(15) DEFAULT NULL;		
	DECLARE de_122_161 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_122_133 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_122_039 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_120_157 TEXT DEFAULT NULL;				
	DECLARE de_123_060 VARCHAR(50) DEFAULT NULL;		

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	DECLARE OLD_PRICE VARCHAR(50) DEFAULT NULL;
    
	-- -----------------
	-- Temporal table --
	-- -----------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
		
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	-- ------
	-- Set --
	-- ------
    
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_053 = (select right(de_053,11));

	set de_122_109 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.109');
	set de_122_161 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.161');
	set de_122_133 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.133');
	
	set de_122_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.39');
	set de_120_157 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.157');

	set de_123_060 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.60');

	-- --------
	-- Query --
	-- --------
	
    SET OLD_PRICE = (select tbl_delivery_company_price from tbl_user_delivery_options where tbl_delivery_id = de_122_109);

	update tbl_user_delivery_options set
	tbl_delivery_company_price = coalesce(de_122_161,tbl_delivery_company_price),
	tbl_delivery_company_service = coalesce(de_122_039,tbl_delivery_company_service),
	tbl_user_delivery_options_tier = coalesce(de_120_157,tbl_user_delivery_options_tier),
	tbl_delivery_company_tracking_code = coalesce(de_123_060,''),
	tbl_delivery_company_option = coalesce(de_122_133,tbl_delivery_company_option)
	where tbl_delivery_id = de_122_109
	and tbl_user_id = de_053;
	
    if length(de_122_161) > 0 then
    
		update dbitems.tbl_productdelivery set
		tbl_productdelivery_ajustedPrice = de_122_161
		where tbl_deliverycompany_id = de_122_109
		and tbl_productdelivery_ajustedPrice = OLD_PRICE;
		
	end if;
    
	-- -----------
	-- Response --
	-- -----------
			
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditDeviceByUser020400482` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditDeviceByUser020400482`(IN MSG_IN VARCHAR(20000))
BEGIN
     
-- --------------------------------------------------------
-- Author: Juan David Zapata 
-- Procedure: EditDeviceByUser020400482
-- Method: 020400482
-- Version: 1.0
-- Last modified: 2015-12-21
-- --------------------------------------------------------
 
-- -------------------------    
-- Declare Data Elements --
-- -------------------------
 
    DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
 
    DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
    DECLARE de_057 VARCHAR(75) DEFAULT NULL;  
    DECLARE de_048_006 VARCHAR(20) DEFAULT NULL; 
    DECLARE de_064 INT(20) DEFAULT NULL; 
    DECLARE de_114_143 INT(11) DEFAULT NULL; 
    DECLARE de_127_088 INT(20) DEFAULT NULL; 
 
 
-- --------------------
-- Declare auxiliary --
-- --------------------
 
    DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
    DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
     
-- ---------------
-- Validations --
-- ---------------
    DROP TEMPORARY TABLE if exists TBL_MESSAGE;
     
    -- TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
     
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
     
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
     
     
-- -----------------    
-- Set variables --
-- -----------------
 
    SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
    set de_053 = (select right(de_053,11));
    SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
    SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');  
    SET de_048_006 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '48.6');
    SET de_114_143 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.143'); 
    SET de_127_088 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.88');  
 
-- ---------------      
-- Query of DB  --
-- ---------------
 
    if(select tbl_user_id from dbuser.tbl_user where tbl_user_id = de_053 and tbl_user_pinCode = md5(convert(unhex(de_064) using utf8))) is not null then
 
        if(select tbl_consumer_nmcId FROM tbl_device WHERE tbl_consumer_nmcId = de_053 AND tbl_device_nickName = de_048_006 and tbl_device_udid != de_057 limit 1) IS NULL THEN
                         
            UPDATE tbl_device SET
            tbl_device_nickName = coalesce(de_048_006,tbl_device_nickName),
            tbl_themecolor_id = coalesce(de_127_088,tbl_themecolor_id),
            tbl_status_id = coalesce(de_114_143,tbl_status_id)
            WHERE tbl_device_udid = de_057  
            AND tbl_consumer_nmcId = de_053;
 
            insert into TBL_MESSAGE (CODE,DATA)
            values('39','0000'),('44','Transaction Approved');          
 
        else
 
            insert into TBL_MESSAGE (CODE,DATA)
            values('39','2056'),('44','Duplicated Nickname');   
             
        end if;
         
    else
 
        insert into TBL_MESSAGE (CODE,DATA)
        values('39','1825'),('44','Invalid Pincode');   
             
    end if;
 
    set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
    set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
 
    select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
     
 
    DROP TABLE TBL_MESSAGE;
  
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditElavonParameters020400814` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`Administrador`@`%` PROCEDURE `EditElavonParameters020400814`(IN MSG_IN VARCHAR(20000))
BEGIN
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_PM TEXT DEFAULT NULL;              	-- PC Item Struct
	DECLARE de_123_075_CADENA TEXT DEFAULT NULL; 	
	DECLARE de_123_076_CADENA TEXT DEFAULT NULL; 	
	DECLARE de_123_078_CADENA TEXT DEFAULT NULL; 	

	DECLARE de_123_075 INTEGER(11) DEFAULT NULL; 
	DECLARE de_123_076 VARCHAR(70) DEFAULT NULL; 
	DECLARE de_123_078 TEXT DEFAULT NULL; 
    
-- --------------------
-- Declare auxiliary --
-- --------------------	
  
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	
	
    -- SET de_123_075 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.75');
	-- SET de_123_076 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.76');
    -- SET de_123_078 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.78');
    
    SELECT DATA INTO de_PM FROM TBL_MESSAGE1 WHERE CODE = "PI";
	SET de_PM = (SELECT CONVERT(unhex(de_PM) USING utf8 ));
	SET de_PM = REPLACE(de_PM,'{"1','{"_1');
	SET de_PM = REPLACE(de_PM,',"1',',"_1');
    
    SET de_123_075_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_PM":',de_PM,'}'),'//_123.75'));
	SET de_123_076_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_PM":',de_PM,'}'),'//_123.76'));
	SET de_123_078_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_PM":',de_PM,'}'),'//_123.78'));
    
-- -----------------	
-- Set variables --
-- -----------------

	while (LENGTH(de_123_075_CADENA)>0) DO
		
		SET de_123_075 = TRIM((SELECT SUBSTR(de_123_075_CADENA,1,LOCATE('|',de_123_075_CADENA)-1)));
		SET de_123_075_CADENA = (SELECT SUBSTR(de_123_075_CADENA,LOCATE('|',de_123_075_CADENA)+1));

		SET de_123_076 = TRIM((SELECT SUBSTR(de_123_076_CADENA,1,LOCATE('|',de_123_076_CADENA)-1)));
		SET de_123_076_CADENA = (SELECT SUBSTR(de_123_076_CADENA,LOCATE('|',de_123_076_CADENA)+1));
	
		SET de_123_078 = TRIM((SELECT SUBSTR(de_123_078_CADENA,1,LOCATE('|',de_123_078_CADENA)-1)));
		SET de_123_078_CADENA = (SELECT SUBSTR(de_123_078_CADENA,LOCATE('|',de_123_078_CADENA)+1));
		
		update nmc_control.parameter_elavon set
		parameter_elavon_name = COALESCE(de_123_076, parameter_elavon_name),
		parameter_elavon_value =  COALESCE(de_123_078, parameter_elavon_value)
		where parameter_elavon_id = de_123_075;
		 
	end while;
         
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditGCMToTerminal020400417` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditGCMToTerminal020400417`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Author: Juan David Zapata 
-- Procedure: EditGCMToTerminal020400417
-- Method: 020400417
-- Version: 1.0
-- Last modified: 2015-04-22
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

    DECLARE de_120_069 VARCHAR(45) DEFAULT NULL; -- TERMINAL ID
	DECLARE de_122_012 VARCHAR(255) DEFAULT NULL; -- 122.12 GCM


-- --------------------
-- Declare auxiliary --
-- --------------------

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
-- ---------------
-- Validations --
-- ---------------
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	-- TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
-- -----------------	
-- Set variables --
-- -----------------

	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.69');
	SET de_122_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.12');

-- ---------------		
-- Query of DB  --
-- ---------------

	update tbl_terminal set 
	tbl_terminal_gcm = de_122_012
	where tbl_terminal_id = de_120_069;


	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
    

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditHardwareQtyByLocation020400441` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditHardwareQtyByLocation020400441`(IN MSG_IN VARCHAR(20000))
BEGIN
-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 	-- 53 User Id
	DECLARE de_114_047 INT(11) DEFAULT NULL; 	-- 114.47 Location Id 

	DECLARE de_121_021 VARCHAR(12) DEFAULT NULL; 	-- 121.21 Hardware Location Id
	DECLARE de_127_088 VARCHAR(12) DEFAULT NULL; 	-- 127.88 Hardware Type Id 
	DECLARE de_121_022 VARCHAR(12) DEFAULT NULL; 	-- 121.22 Hardware Qty

	DECLARE DE_HL 	TEXT DEFAULT NULL;
    DECLARE de_121_021_CADENA TEXT DEFAULT NULL; 
	DECLARE de_127_088_CADENA TEXT DEFAULT NULL; 
	DECLARE de_121_022_CADENA TEXT DEFAULT NULL; 
	
-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
    SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.47');

    SELECT DATA INTO DE_HL FROM TBL_MESSAGE1 WHERE CODE = "HL";
	SET DE_HL = (SELECT CONVERT(unhex(DE_HL) USING utf8 ));
	
	SET DE_HL = REPLACE(DE_HL,'{"1','{"_1');
	SET DE_HL = REPLACE(DE_HL,',"1',',"_1');
	
    SET de_121_021_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_121.21'));
	SET de_127_088_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_127.88'));
	SET de_121_022_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_121.22'));
	
    
-- -----------------	
-- Set variables --
-- -----------------

	if LENGTH(de_121_021_CADENA) >0 then
		
		while (LENGTH(de_121_021_CADENA)>0) DO

			SET de_121_021 = (SELECT SUBSTR(de_121_021_CADENA,1,LOCATE('|',de_121_021_CADENA)-1));
			SET de_121_021_CADENA = (SELECT SUBSTR(de_121_021_CADENA,LOCATE('|',de_121_021_CADENA)+1));

			SET de_127_088 = (SELECT SUBSTR(de_127_088_CADENA,1,LOCATE('|',de_127_088_CADENA)-1));
			SET de_127_088_CADENA = (SELECT SUBSTR(de_127_088_CADENA,LOCATE('|',de_127_088_CADENA)+1));

			SET de_121_022 = (SELECT SUBSTR(de_121_022_CADENA,1,LOCATE('|',de_121_022_CADENA)-1));
			SET de_121_022_CADENA = (SELECT SUBSTR(de_121_022_CADENA,LOCATE('|',de_121_022_CADENA)+1));

			if TRIM(de_121_021) != 0 then

				update dbuser.tbl_location_hardware set
				tbl_hardware_type_id = TRIM(de_127_088) ,
				tbl_location_hardware_qty = TRIM(de_121_022)
				where tbl_location_hardware_id = TRIM(de_121_021);
                
			else
            
				insert into dbuser.tbl_location_hardware set
				tbl_user_id = de_053,
				tbl_location_id = de_114_047,
				tbl_hardware_type_id = TRIM(de_127_088),
				tbl_location_hardware_qty = TRIM(de_121_022);
            
            end if;
		
		end while ; 
			
	end if;
  
  
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditHardwareStock020400448` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditHardwareStock020400448`(IN MSG_IN VARCHAR(20000))
BEGIN

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE DE_HL 	TEXT DEFAULT NULL;
	DECLARE de_127_088_CADENA TEXT DEFAULT NULL; 
	DECLARE de_121_022_CADENA TEXT DEFAULT NULL;
	DECLARE de_121_023_CADENA TEXT DEFAULT NULL;
	DECLARE de_121_024_CADENA TEXT DEFAULT NULL; 
	DECLARE de_121_025_CADENA TEXT DEFAULT NULL; 
	DECLARE de_121_026_CADENA TEXT DEFAULT NULL; 
	
	DECLARE de_127_088 VARCHAR(12) DEFAULT NULL; 	-- 127.88 Hardware Type Id 
	DECLARE de_121_022 VARCHAR(12) DEFAULT NULL; 	-- 121.22 Hardware Qty
	DECLARE de_121_023 VARCHAR(12) DEFAULT NULL; 	-- 121.23 Re-order Due Date
	DECLARE de_121_024 VARCHAR(12) DEFAULT NULL; 	-- 121.24 Hardware to be shipped
	DECLARE de_121_025 VARCHAR(12) DEFAULT NULL; 	-- 121.25 Re-order status
	DECLARE de_121_026 VARCHAR(12) DEFAULT NULL; 	-- 121.25 Re-order ref

-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	

    SELECT DATA INTO DE_HL FROM TBL_MESSAGE1 WHERE CODE = "HL";
	SET DE_HL = (SELECT CONVERT(unhex(DE_HL) USING utf8 ));
	
	SET DE_HL = REPLACE(DE_HL,'{"1','{"_1');
	SET DE_HL = REPLACE(DE_HL,',"1',',"_1');
	
    SET de_127_088_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_127.88'));
	SET de_121_022_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_121.22'));
	SET de_121_023_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_121.23'));
	SET de_121_024_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_121.24'));
	SET de_121_025_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_121.25'));
	SET de_121_026_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"DE_HL":',DE_HL,'}'),'//_121.26'));
	
-- -----------------	
-- Set variables --
-- -----------------

	if LENGTH(de_127_088_CADENA) >0 then
		
		while (LENGTH(de_127_088_CADENA)>0) DO

			SET de_127_088 = (SELECT SUBSTR(de_127_088_CADENA,1,LOCATE('|',de_127_088_CADENA)-1));
			SET de_127_088_CADENA = (SELECT SUBSTR(de_127_088_CADENA,LOCATE('|',de_127_088_CADENA)+1));

			SET de_121_022 = (SELECT SUBSTR(de_121_022_CADENA,1,LOCATE('|',de_121_022_CADENA)-1));
			SET de_121_022_CADENA = (SELECT SUBSTR(de_121_022_CADENA,LOCATE('|',de_121_022_CADENA)+1));

			SET de_121_023 = (SELECT SUBSTR(de_121_023_CADENA,1,LOCATE('|',de_121_023_CADENA)-1));
			SET de_121_023_CADENA = (SELECT SUBSTR(de_121_023_CADENA,LOCATE('|',de_121_023_CADENA)+1));

			SET de_121_024 = (SELECT SUBSTR(de_121_024_CADENA,1,LOCATE('|',de_121_024_CADENA)-1));
			SET de_121_024_CADENA = (SELECT SUBSTR(de_121_024_CADENA,LOCATE('|',de_121_024_CADENA)+1));

			SET de_121_025 = (SELECT SUBSTR(de_121_025_CADENA,1,LOCATE('|',de_121_025_CADENA)-1));
			SET de_121_025_CADENA = (SELECT SUBSTR(de_121_025_CADENA,LOCATE('|',de_121_025_CADENA)+1));

			SET de_121_026 = (SELECT SUBSTR(de_121_026_CADENA,1,LOCATE('|',de_121_026_CADENA)-1));
			SET de_121_026_CADENA = (SELECT SUBSTR(de_121_026_CADENA,LOCATE('|',de_121_026_CADENA)+1));

			
			update dbuser.tbl_hardware_type set
			tbl_hardware_type_stock = TRIM(de_121_022),
			tbl_hardware_type_dueDate = TRIM(de_121_023),
			tbl_hardware_type_shipped = TRIM(de_121_024),
			tbl_hardware_type_status = TRIM(de_121_025),
			tbl_hardware_type_ref = TRIM(de_121_026)					
			where tbl_hardware_type_id = TRIM(de_127_088);

		end while ; 
			
	end if;
  
  
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditHelpTicketsAssigned020400252` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditHelpTicketsAssigned020400252`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_122_114 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_123_031 VARCHAR(20) DEFAULT NULL; 




  
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



	
	SET de_122_114 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.114');
	SET de_123_031 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.31');
	
	SET de_123_031 = (select right(de_123_031,11)) ;




	update tbl_help_ticket set
	tbl_help_ticket_assigned = COALESCE(de_123_031, tbl_help_ticket_assigned)           
	where tbl_parent_id = de_122_114;
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditHelpTicketsStatus020400253` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditHelpTicketsStatus020400253`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_114_150 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_143 VARCHAR(20) DEFAULT NULL; 





	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



	
	SET de_114_150 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.150');
	SET de_114_143 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.143');
	




	update tbl_help_ticket set
	tbl_help_ticket_status = COALESCE(de_114_143, tbl_help_ticket_status)           
	where tbl_parent_id = de_114_150;
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditInvoiceShippingStatus` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_AUTO_VALUE_ON_ZERO,STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditInvoiceShippingStatus`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_121_048 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_143 VARCHAR(255) DEFAULT NULL; 
	
	



	
		
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	




	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;

	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = false;
	IF flag_validation = FALSE THEN





        SET de_121_048 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.48');
		SET de_114_143 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.143');
		
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		Update tbl_invoice set 
		tbl_invoicestatus_id = de_114_143
		where tbl_invoice_id = de_121_048;
				






		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
			
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),();
		
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	
	 SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"114.143":"',de_114_143,'"}')) AS JSON;

	
	
	
	
    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditLocationByLocationId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditLocationByLocationId`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 INTEGER(15) DEFAULT 0;  		    
	DECLARE de_114_047 INTEGER(15) DEFAULT 0;  		    
	DECLARE de_122_119 INTEGER(20) DEFAULT 0; 			
	DECLARE de_114_070 VARCHAR(50) DEFAULT 0;			
	
	DECLARE de_300_062 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_087 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_051 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_012 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_013 VARCHAR(45) DEFAULT NULL;		
	
	DECLARE de_300_064 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_120_013 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_065 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_014 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_066 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_107 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_114_053 VARCHAR(45) DEFAULT 0; 			
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;			
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;         
	
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;		
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;		
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;		
	
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0;			
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0;			
	DECLARE de_300_089 VARCHAR(100) DEFAULT 0;			




	
	DECLARE ADDRESSID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		
		SET de_122_119 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.119');
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		
		SET de_300_051 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.51');
		SET de_114_012 = common_schema.get_option( de_300_051, "114.12" );
		SET de_114_013 = common_schema.get_option( de_300_051, "114.13" );
		
		
		
		SET de_300_089 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');
		SET de_300_062 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');		
		SET de_122_087 = (SELECT SUBSTR(de_300_089,1,LOCATE(',',de_300_089)-1));
			
		SET de_300_064 = (SELECT SUBSTR(de_300_089,LOCATE(',',de_300_089)+1));
		SET de_120_013 = (SELECT SUBSTR(de_300_064,1,LOCATE(',',de_300_064)-1));
		
		SET de_300_065 = (SELECT SUBSTR(de_300_064,LOCATE(',',de_300_064)+1));
		SET de_114_014 = (SELECT SUBSTR(de_300_065,1,LOCATE(',',de_300_065)-1));
		
		SET de_300_066 = (SELECT SUBSTR(de_300_065,LOCATE(',',de_300_065)+1));
		SET de_122_107 = (SELECT SUBSTR(de_300_066,1,LOCATE(',',de_300_066)-1));
						
		SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.84');
		
		SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
		SET de_122_088 = common_schema.get_option( de_300_084, "122.88" );
		SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
		SET de_122_87P = common_schema.get_option( de_300_084, "122.87" );
		
		SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
		SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




				
				UPDATE tbl_location SET
				tbl_location_storeNumber= de_122_119 ,
				tbl_location_storeName= de_114_070 ,
				tbl_location_contactName = de_114_053, 
				tbl_location_contactEmail = de_114_007, 
				tbl_location_userId = de_114_179,
				tbl_location_latitude = de_120_038,
				tbl_location_longitude= de_120_039,
				tbl_location_statusId= 7001
				where tbl_location_id = de_114_047;
							
				SET ADDRESSID_AUX= (SELECT tbl_address_id FROM tbl_locationaddress where tbl_location_id = de_114_047);
				
				
				UPDATE tbl_address SET
				tbl_address_first = de_114_012,
				tbl_address_second = de_114_013,
				tbl_country_id = de_122_087,
				tbl_state_id = de_120_013,
				tbl_city_id = de_114_014,
				tbl_zipcode_id = de_122_107,
				tbl_address_phoneNumber = de_048_028,
				tbl_address_name ='Terminal Address',
				tbl_addresstype_id= 12
				WHERE tbl_address_id = ADDRESSID_AUX;
				
				
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_locationphone WHERE tbl_location_id = de_114_047 );
				
				
				UPDATE tbl_phone SET 
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_nmcId = de_114_179,
				tbl_phone_country_id = de_122_87P,
				tbl_phonetype_id = 4001
				WHERE  tbl_phone_id = PHONEID_AUX;
	
				
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			
		
					
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditLocationByLocationId_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditLocationByLocationId_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 INTEGER(15) DEFAULT 0;  		    
	DECLARE de_114_047 INTEGER(15) DEFAULT 0;  		    
	DECLARE de_122_119 INTEGER(20) DEFAULT 0; 			
	DECLARE de_114_070 VARCHAR(50) DEFAULT 0;			
	
	DECLARE de_300_062 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_087 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_051 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_012 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_013 VARCHAR(45) DEFAULT NULL;		
	
	DECLARE de_300_064 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_120_013 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_065 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_014 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_300_066 VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_107 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_114_053 VARCHAR(45) DEFAULT 0; 			
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;			
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;         
	
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;		
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;		
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;		
	
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0;			
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0;			
	DECLARE de_300_089 VARCHAR(100) DEFAULT 0;			




	
	DECLARE ADDRESSID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		
		SET de_122_119 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.119');
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		
		SET de_300_051 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.51');
		SET de_114_012 = common_schema.get_option( de_300_051, "114.12" );
		SET de_114_013 = common_schema.get_option( de_300_051, "114.13" );
		
		
		
		SET de_300_089 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');
		SET de_300_062 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.89');		
		SET de_122_087 = (SELECT SUBSTR(de_300_089,1,LOCATE(',',de_300_089)-1));
			
		SET de_300_064 = (SELECT SUBSTR(de_300_089,LOCATE(',',de_300_089)+1));
		SET de_120_013 = (SELECT SUBSTR(de_300_064,1,LOCATE(',',de_300_064)-1));
		
		SET de_300_065 = (SELECT SUBSTR(de_300_064,LOCATE(',',de_300_064)+1));
		SET de_114_014 = (SELECT SUBSTR(de_300_065,1,LOCATE(',',de_300_065)-1));
		
		SET de_300_066 = (SELECT SUBSTR(de_300_065,LOCATE(',',de_300_065)+1));
		SET de_122_107 = (SELECT SUBSTR(de_300_066,1,LOCATE(',',de_300_066)-1));
						
		SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.84');
		
		SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
		SET de_122_088 = common_schema.get_option( de_300_084, "122.88" );
		SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
		SET de_122_87P = common_schema.get_option( de_300_084, "122.87" );
		
		SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
		SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




				
				UPDATE tbl_location SET
				tbl_location_storeNumber= de_122_119 ,
				tbl_location_storeName= de_114_070 ,
				tbl_location_contactName = de_114_053, 
				tbl_location_contactEmail = de_114_007, 
				tbl_location_userId = de_114_179,
				tbl_location_latitude = de_120_038,
				tbl_location_longitude= de_120_039,
				tbl_location_statusId= 7001
				where tbl_location_id = de_114_047;
							
				SET ADDRESSID_AUX= (SELECT tbl_address_id FROM tbl_locationaddress where tbl_location_id = de_114_047);
				
				
				UPDATE tbl_address SET
				tbl_address_first = de_114_012,
				tbl_address_second = de_114_013,
				tbl_country_id = de_122_087,
				tbl_state_id = de_120_013,
				tbl_city_id = de_114_014,
				tbl_zipcode_id = de_122_107,
				tbl_address_phoneNumber = de_048_028,
				tbl_address_name ='Terminal Address',
				tbl_addresstype_id= 12
				WHERE tbl_address_id = ADDRESSID_AUX;
				
				
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_locationphone WHERE tbl_location_id = de_114_047 );
				
				
				UPDATE tbl_phone SET 
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_nmcId = de_114_179,
				tbl_phone_country_id = de_122_87P,
				tbl_phonetype_id = 4001
				WHERE  tbl_phone_id = PHONEID_AUX;
	
				
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			
		
					
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditLocationByLocationId_1_020400163` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditLocationByLocationId_1_020400163`(IN MSG_IN VARCHAR(20000))
BEGIN
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_114_047 INTEGER(15) DEFAULT 0;  		    
	DECLARE de_122_119 VARCHAR(45) DEFAULT 0; 			
	DECLARE de_114_070 VARCHAR(50) DEFAULT 0;			
	
	DECLARE de_country_aux VARCHAR(5000) DEFAULT 0; 	
	DECLARE de_122_087 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE DS_AD VARCHAR(5000) DEFAULT 0; 				
	DECLARE de_114_012 VARCHAR(99) DEFAULT NULL;		
	DECLARE de_114_013 VARCHAR(99) DEFAULT NULL;		
	
	DECLARE de_state_aux VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_120_013 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_city_aux VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_114_014 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_zip_aux VARCHAR(5000) DEFAULT 0; 		
	DECLARE de_122_107 VARCHAR(25) DEFAULT NULL;		
	
	DECLARE de_114_053 VARCHAR(45) DEFAULT 0; 			
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;			
	DECLARE DS_PH VARCHAR(5000) DEFAULT 0;      	    
	
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;		
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;		
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;		
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;		
	
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0;			
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0;			
	DECLARE de_127_60 VARCHAR(100) DEFAULT 0;			


	DECLARE de_122_197 INTEGER(11) DEFAULT 0;  	

	
	DECLARE ADDRESSID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	


	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
	
	SET de_122_119 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.119');
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
	
	SET DS_AD = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'AD');
	SET DS_AD = (SELECT CONVERT(unhex(DS_AD) USING utf8 ));
	SET de_114_012 = common_schema.get_option( DS_AD, "114.12" );
	SET de_114_013 = common_schema.get_option( DS_AD, "114.13" );
			
	SET de_127_60 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.60');
	SET de_country_aux = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.60');		
	SET de_122_087 = (SELECT SUBSTR(de_127_60,1,LOCATE(',',de_127_60)-1));
		
	SET de_state_aux = (SELECT SUBSTR(de_127_60,LOCATE(',',de_127_60)+1));
	SET de_120_013 = (SELECT SUBSTR(de_state_aux,1,LOCATE(',',de_state_aux)-1));
	
	SET de_city_aux = (SELECT SUBSTR(de_state_aux,LOCATE(',',de_state_aux)+1));
	SET de_114_014 = (SELECT SUBSTR(de_city_aux,1,LOCATE(',',de_city_aux)-1));
	
	SET de_zip_aux = (SELECT SUBSTR(de_city_aux,LOCATE(',',de_city_aux)+1));
	SET de_122_107 = (SELECT SUBSTR(de_zip_aux,1,LOCATE(',',de_zip_aux)-1));
					
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
	SET DS_PH = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'PH');
	SET DS_PH = (SELECT CONVERT(unhex(DS_PH) USING utf8 ));
	SET de_048_028 = common_schema.get_option( DS_PH, "48.28" );
	SET de_122_088 = common_schema.get_option( DS_PH, "122.88" );
	SET de_121_167 = common_schema.get_option( DS_PH, "121.167" );
	SET de_122_87P = common_schema.get_option( DS_PH, "122.87" );
	
	SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.38');
	SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.39');

	SET de_122_197 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.197');

			
	UPDATE tbl_location SET
	tbl_location_storeNumber= COALESCE(de_122_119,tbl_location_storeNumber) ,
	tbl_location_storeName= COALESCE(de_114_070,tbl_location_storeName) ,
	tbl_location_contactName = COALESCE(de_114_053,tbl_location_contactName), 
	tbl_location_contactEmail = COALESCE(de_114_007,tbl_location_contactEmail), 
	tbl_location_latitude = COALESCE(de_120_038,tbl_location_latitude),
	tbl_location_longitude= COALESCE(de_120_039,tbl_location_longitude),
	tbl_location_statusId= 7001
	where tbl_location_id = de_114_047;
				
	SET ADDRESSID_AUX= (SELECT tbl_address_id FROM tbl_locationaddress where tbl_location_id = de_114_047);
	
    IF ADDRESSID_AUX IS NOT NULL THEN
	
		UPDATE tbl_address SET
		tbl_address_first = COALESCE(de_114_012,tbl_address_first),
		tbl_address_second = COALESCE(de_114_013,tbl_address_second),
		tbl_country_id = COALESCE(de_122_087,tbl_country_id),
		tbl_state_id = COALESCE(de_120_013,tbl_state_id),
		tbl_city_id = COALESCE(de_114_014,tbl_city_id),
		tbl_zipcode_id = COALESCE(de_122_107,tbl_zipcode_id),
		tbl_address_name ='Terminal Address',
		tbl_addresstype_id= 11
		WHERE tbl_address_id = ADDRESSID_AUX;
        
	ELSE
		
		INSERT tbl_address SET
		tbl_address_first = de_114_012,
		tbl_address_second = de_114_013,
		tbl_country_id = de_122_087,
		tbl_state_id = de_120_013,
		tbl_city_id = de_114_014,
		tbl_zipcode_id = de_122_107,
		tbl_address_name ='Terminal Address',
		tbl_addresstype_id= 11;
	
		SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);

		INSERT tbl_locationaddress SET
		tbl_location_id = de_114_047, 
		tbl_address_id = ADDRESSID_AUX;

	END IF;
	
	
	SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_locationphone WHERE tbl_location_id = de_114_047 );
	 
	IF PHONEID_AUX IS NOT NULL THEN
	
		if (select tbl_phone_id from dbuser.tbl_phone where tbl_phone_id = PHONEID_AUX) is not null then
    
			UPDATE tbl_phone SET 
			tbl_phone_phoneNumber = COALESCE(de_048_028,tbl_phone_phoneNumber),
			tbl_phone_extension = COALESCE(de_121_167,tbl_phone_extension),
			tbl_phone_country_id = COALESCE(de_122_87P,tbl_phone_country_id),
			tbl_phonetype_id = 4001
			WHERE  tbl_phone_id = PHONEID_AUX;
            
		else 
        
			INSERT tbl_phone SET
            tbl_phone_id = PHONEID_AUX,
			tbl_phone_phoneNumber = de_048_028,
			tbl_phone_extension = de_121_167,
			tbl_phone_country_id = de_122_87P,
			tbl_phonetype_id = 4001;

		end if;
        
	ELSE
    
		if length(de_048_028)>0 then
    
			INSERT tbl_phone SET
			tbl_phone_phoneNumber = de_048_028,
			tbl_phone_extension = de_121_167,
			tbl_phone_country_id = de_122_87P,
			tbl_phonetype_id = 4001;

			SET PHONEID_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);
		
			INSERT tbl_locationphone SET
			tbl_phone_id = PHONEID_AUX,
			tbl_location_id = de_114_047;
		
			if ADDRESSID_AUX is not null then
				UPDATE tbl_address SET 
				tbl_address_phoneNumber = PHONEID_AUX
				WHERE tbl_address_id= ADDRESSID_AUX;
			end if;
		
        end if;
        
	END IF;


	if length(de_122_197)>0 then
		
        delete from dbitems.tbl_usersubscription where tbl_location_id = de_114_047;
        
		update dbitems.tbl_usersubscription set
        tbl_location_id = de_114_047
        where tbl_usersubscription_id = de_122_197;
    
    end if;


	
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
				
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMailCampaignByUserId020400400` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMailCampaignByUserId020400400`(IN MSG_IN VARCHAR(20000))
BEGIN



-- -------------------------	
-- Declare Data Elements --
-- -------------------------
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_117_010 INT(11) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_120_157 TEXT DEFAULT NULL; 
    
	DECLARE de_EM TEXT DEFAULT NULL; 
    
-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE IDRECORD_AUX INTEGER(11) DEFAULT 0;
	
	DECLARE de_114_007_CADENA TEXT DEFAULT NULL; 
	DECLARE de_114_007 VARCHAR(99) DEFAULT NULL; 
    
    DECLARE de_120_014_CADENA TEXT DEFAULT NULL; 
    DECLARE de_120_014 VARCHAR(20) DEFAULT NULL;
    
    DECLARE de_117_011_CADENA TEXT DEFAULT NULL; 
    DECLARE de_117_011 INT(11) DEFAULT NULL;
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables --
-- -----------------

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	SET de_117_010 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.10');
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_120_157 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.157');

	
	SELECT DATA INTO de_EM FROM TBL_MESSAGE WHERE CODE = "EM";
	SET de_EM = (SELECT CONVERT(unhex(de_EM) USING utf8 ));

	SET de_EM = REPLACE(de_EM,'{"1','{"_1');
	SET de_EM = REPLACE(de_EM,',"1',',"_1');
	
	SET de_114_007_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_EM":',de_EM,'}'),'//_114.7'));
	SET de_120_014_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_EM":',de_EM,'}'),'//_120.14'));
	SET de_117_011_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_EM":',de_EM,'}'),'//_117.11'));
	
	
	
-- ---------------		
-- Query of DB --
-- ---------------

	update tbl_mailcampaign set 	
	name = coalesce(de_114_053,name),
	mailContent = coalesce(CONVERT(unhex(de_120_157) USING utf8 ),mailContent),
	updateDate = NOW()
	where id = de_117_010;
	
	if LENGTH(de_114_007_CADENA) >0 then
		while (LENGTH(de_114_007_CADENA)>0) DO

			SET de_114_007 = (SELECT SUBSTR(de_114_007_CADENA,1,LOCATE('|',de_114_007_CADENA)-1));
			SET de_114_007_CADENA = (SELECT SUBSTR(de_114_007_CADENA,LOCATE('|',de_114_007_CADENA)+1));

			SET de_120_014 = (SELECT SUBSTR(de_120_014_CADENA,1,LOCATE('|',de_120_014_CADENA)-1));
			SET de_120_014_CADENA = (SELECT SUBSTR(de_120_014_CADENA,LOCATE('|',de_120_014_CADENA)+1));

			SET de_117_011 = (SELECT SUBSTR(de_117_011_CADENA,1,LOCATE('|',de_117_011_CADENA)-1));
			SET de_117_011_CADENA = (SELECT SUBSTR(de_117_011_CADENA,LOCATE('|',de_117_011_CADENA)+1));

			if de_117_011 = 0 then
            
				if (select A.id from tbl_mailrecord as A, tbl_campaign_record as B where A.email = TRIM(de_114_007) and A.state = 70001 and B.idcampaign = de_117_010 and A.id = B.idrecord limit 1) is null then
            
					insert into tbl_mailrecord set
					email = TRIM(de_114_007),
					state = COALESCE(TRIM(de_120_014),70001),
					date_state = NOW();
					
					set IDRECORD_AUX = (SELECT last_insert_id() FROM tbl_mailrecord limit 1);
					
					insert into tbl_campaign_record set
					idcampaign = de_117_010,
					idrecord = IDRECORD_AUX;
                    
				end if;
                
			else 
            
				update tbl_mailrecord set
                state = COALESCE(TRIM(de_120_014),state),
                date_state = NOW()
                where id = TRIM(de_117_011);

			end if;

		end while ; 
	end if;
	
	
	
	
	
	
	
	
	
	

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}') ) AS JSON;
	
	
	DROP TABLE TBL_MESSAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMailCampaignStatusById020400404` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMailCampaignStatusById020400404`(IN MSG_IN VARCHAR(20000))
BEGIN



-- -------------------------	
-- Declare Data Elements --
-- -------------------------
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_117_010 INT(11) DEFAULT NULL; 
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL; 
	DECLARE de_120_157 TEXT DEFAULT NULL; 
    
	DECLARE de_EM TEXT DEFAULT NULL; 
    
-- --------------------
-- Declare auxiliary --
-- --------------------	

    DECLARE de_120_014_CADENA TEXT DEFAULT NULL; 
    DECLARE de_120_014 VARCHAR(20) DEFAULT NULL;
    
    DECLARE de_117_011_CADENA TEXT DEFAULT NULL; 
    DECLARE de_117_011 INT(11) DEFAULT NULL;
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables --
-- -----------------

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	SET de_117_010 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.10');
	SET de_114_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.53');
	SET de_120_157 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.157');

	
	SELECT DATA INTO de_EM FROM TBL_MESSAGE WHERE CODE = "EM";
	SET de_EM = (SELECT CONVERT(unhex(de_EM) USING utf8 ));

	SET de_EM = REPLACE(de_EM,'{"1','{"_1');
	SET de_EM = REPLACE(de_EM,',"1',',"_1');
	
	SET de_120_014_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_EM":',de_EM,'}'),'//_120.14'));
	SET de_117_011_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"de_EM":',de_EM,'}'),'//_117.11'));
	
	
	
-- ---------------		
-- Query of DB --
-- ---------------

	update tbl_mailcampaign set 	
	tbl_mailcampaign_status = coalesce(de_114_143,tbl_mailcampaign_status),
	updateDate = NOW()
	where id = de_117_010;
	
	if LENGTH(de_117_011_CADENA) >0 then
		while (LENGTH(de_117_011_CADENA)>0) DO

			SET de_120_014 = (SELECT SUBSTR(de_120_014_CADENA,1,LOCATE('|',de_120_014_CADENA)-1));
			SET de_120_014_CADENA = (SELECT SUBSTR(de_120_014_CADENA,LOCATE('|',de_120_014_CADENA)+1));

			SET de_117_011 = (SELECT SUBSTR(de_117_011_CADENA,1,LOCATE('|',de_117_011_CADENA)-1));
			SET de_117_011_CADENA = (SELECT SUBSTR(de_117_011_CADENA,LOCATE('|',de_117_011_CADENA)+1));

			update tbl_mailrecord set
			state = COALESCE(TRIM(de_120_014),state),
			date_state = NOW()
			where id = TRIM(de_117_011);


		end while ; 
	end if;
	

	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}') ) AS JSON;
	
	
	DROP TABLE TBL_MESSAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantAccountLocationById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantAccountLocationById`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_114_047 INT(11) DEFAULT 0; 
	DECLARE de_114_073 INT(11) DEFAULT 0;
    DECLARE de_114_179 INT(11) DEFAULT 0;
	DECLARE de_122_121 VARCHAR(45) DEFAULT NULL;
	DECLARE de_122_120 VARCHAR(45) DEFAULT NULL;
	DECLARE de_114_7 VARCHAR(255) DEFAULT NULL;
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;   
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;  
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;  
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;  
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;  




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE PHONE_ID BIGINT(20) DEFAULT 0;	

	

	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1
 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message1 Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
	
	SET de_114_073 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.73');
    SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.47');
	SET de_122_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.121');
	SET de_122_120 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.120');
	SET de_114_7 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '300.84');
			SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
			SET de_122_088 = common_schema.get_option( de_300_084, "122.88" );
			SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
			SET de_122_87P = common_schema.get_option( de_300_084, "122.87" );
	

		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;




		SET PHONE_ID = (select tbl_phone_id from tbl_merchantaccountphone where tbl_merchantaccount_id = de_114_073 limit 1);
	
						update tbl_phone SET
							tbl_phone_phoneNumber = de_048_028,
							tbl_phone_extension = de_121_167,
							tbl_phone_country_id = de_122_87P,
							tbl_phonetype_id = 4001
							WHERE tbl_phone_id = PHONE_ID;

						
						UPDATE tbl_merchantaccount set
							tbl_merchantaccount_contacProvider = de_122_121,
							tbl_merchantaccount_contactName = de_122_120,
							tbl_merchantaccount_contactMail = de_114_7
							WHERE tbl_merchantaccount_id = de_114_073;

						insert into TBL_MESSAGE1 (CODE,DATA)
						values('39','0000'),('44','Transaction Approved');

			

	ELSE
	
		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE1(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantAccountLocationById020400165` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantAccountLocationById020400165`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
 
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	

	DECLARE de_114_047 INT(11) DEFAULT 0; 
	DECLARE de_114_073 INT(11) DEFAULT 0;
    DECLARE de_114_179 INT(11) DEFAULT 0;
	DECLARE de_122_121 VARCHAR(45) DEFAULT NULL;
	DECLARE de_122_120 VARCHAR(45) DEFAULT NULL;
	DECLARE de_114_7 VARCHAR(255) DEFAULT NULL;
	DECLARE DS_PH VARCHAR(5000) DEFAULT 0;   
	DECLARE de_048_028 VARCHAR(25) DEFAULT NULL;  
	DECLARE de_122_088 VARCHAR(15) DEFAULT NULL;  
	DECLARE de_121_167 VARCHAR(10) DEFAULT NULL;  
	DECLARE de_122_87P VARCHAR(15) DEFAULT NULL;  




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE PHONE_ID BIGINT(20) DEFAULT 0;	

	

	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	





	
	
	SET de_114_073 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.73');
    SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.47');
	SET de_122_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.121');
	SET de_122_120 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.120');
	SET de_114_7 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET DS_PH = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = 'PH');
	SET DS_PH = (SELECT CONVERT(unhex(DS_PH) USING utf8 ));
			SET de_048_028 = common_schema.get_option( DS_PH, "48.28" );
			SET de_122_088 = common_schema.get_option( DS_PH, "122.88" );
			SET de_121_167 = common_schema.get_option( DS_PH, "121.167" );
			SET de_122_87P = common_schema.get_option( DS_PH, "122.87" );
	

		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;




		SET PHONE_ID = (select tbl_phone_id from tbl_merchantaccountphone where tbl_merchantaccount_id = de_114_073 limit 1);
	
						update tbl_phone SET
							tbl_phone_phoneNumber = COALESCE(de_048_028,tbl_phone_phoneNumber),
							tbl_phone_extension = COALESCE(de_121_167,tbl_phone_extension),
							tbl_phone_country_id = COALESCE(de_122_87P,tbl_phone_country_id),
							tbl_phonetype_id = 4001
							WHERE tbl_phone_id = PHONE_ID;

						
						UPDATE tbl_merchantaccount set
							tbl_merchantaccount_contacProvider = COALESCE(de_122_121,tbl_merchantaccount_contacProvider),
							tbl_merchantaccount_contactName = COALESCE(de_122_120,tbl_merchantaccount_contactName),
							tbl_merchantaccount_contactMail = COALESCE(de_114_7,tbl_merchantaccount_contactMail)
							WHERE tbl_merchantaccount_id = de_114_073;

						insert into TBL_MESSAGE1 (CODE,DATA)
						values('39','0000'),('44','Transaction Approved');
	
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantBussnesCategoriesTree` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantBussnesCategoriesTree`(PARAM VARCHAR(20000))
BEGIN
	DECLARE UNHEXPARAM 		VARCHAR(20000) DEFAULT NULL;
    DECLARE ORIGINAL 		VARCHAR(20000) DEFAULT NULL;
	
    
	
	
	DECLARE _300_27 		VARCHAR(20000) DEFAULT NULL;
    DECLARE _114_179 		VARCHAR(20000) DEFAULT NULL;  		
	DECLARE _122_18 		VARCHAR(20000) DEFAULT NULL; 
	DECLARE _122_18_a 		VARCHAR(20000) DEFAULT NULL;

DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1
 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message1 Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;

	 CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM)); 
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	SELECT DATA INTO _300_27 FROM TBL_MESSAGE1 WHERE CODE = "300.27";
	SELECT DATA INTO _114_179 FROM TBL_MESSAGE1 WHERE CODE = "114.179";
	SET _300_27 = REPLACE(_300_27,'{"1','{"_1');
    SET _300_27 = REPLACE(_300_27,',"1',',"_1');
    SET _122_18 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_27,'}'),'//_122.18'));
	
	DELETE FROM dbuser.tbl_merchantbusinesscategory
		 WHERE tbl_merchant_nmcId = _114_179;
	WHILE (LENGTH(_122_18)>0) DO

	   SET _122_18_a = (SELECT SUBSTR(_122_18,1,LOCATE('|',_122_18)-1));
	   SET _122_18 = (SELECT SUBSTR(_122_18,LOCATE('|',_122_18)+1));
	   INSERT INTO dbuser.tbl_merchantbusinesscategory VALUES (_114_179,_122_18_a);

    END WHILE;
	select GROUP_CONCAT(CONCAT('"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"')) as JSON;
	DROP TABLE IF EXISTS TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantProducBarCode020400238` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantProducBarCode020400238`(IN MSG_IN VARCHAR(20000))
BEGIN












	
	DECLARE de_127_009 VARCHAR(45) DEFAULT NULL;   
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 	 





	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET de_127_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.9');
	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));





	UPDATE dbuser.tbl_merchant
		SET tbl_merchant_product_barcode_database = coalesce(de_127_009,tbl_merchant_product_barcode_database)
	WHERE tbl_merchant_nmcId = de_053;

	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantProducBarCodeDatabase` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantProducBarCodeDatabase`(PARAM VARCHAR(20000))
BEGIN
	DECLARE UNHEXPARAM 		VARCHAR(20000) DEFAULT NULL;
    DECLARE ORIGINAL 		VARCHAR(20000) DEFAULT NULL;
    DECLARE _127_9 		VARCHAR(300) DEFAULT NULL;
	DECLARE _114_179  		VARCHAR(11) DEFAULT NULL;      	

	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1
 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message1 Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM)); 
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
    SELECT DATA INTO _114_179 	FROM TBL_MESSAGE1 WHERE CODE = "114.179";
	SELECT DATA INTO _127_9 	FROM TBL_MESSAGE1 WHERE CODE = "127.9";

    UPDATE dbuser.tbl_merchant
		SET tbl_merchant_product_barcode_database = _127_9
	WHERE tbl_merchant_nmcId = _114_179;

	select GROUP_CONCAT(CONCAT('"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"')) as JSON;
	DROP TABLE IF EXISTS TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantProfilePortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantProfilePortal`(PARAM VARCHAR(20000))
BEGIN
	DECLARE UNHEXPARAM 		VARCHAR(20000) DEFAULT NULL;
    DECLARE ORIGINAL 		VARCHAR(20000) DEFAULT NULL;
    DECLARE _300_51 		TEXT DEFAULT NULL;
	
	DECLARE _300_75 		TEXT DEFAULT NULL;
	DECLARE _114_75ec  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_75eca  		VARCHAR(300) DEFAULT NULL;       
	DECLARE _121_150  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _121_150a  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181a 		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7a  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _300_89 		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _300_89a		VARCHAR(300) DEFAULT NULL;       	
	DECLARE PHONEID_AUX		VARCHAR(20) DEFAULT NULL;       	
	DECLARE INDICATIVE_AUX	VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL;     		
	
	
	
	
	
	DECLARE _300_62 		VARCHAR(500) DEFAULT NULL;
    DECLARE _300_64 		VARCHAR(500) DEFAULT NULL;
	DECLARE _300_65 		VARCHAR(500) DEFAULT NULL;
    DECLARE _300_66 		VARCHAR(500) DEFAULT NULL;  
    DECLARE _122_88 		VARCHAR(500) DEFAULT NULL; 			
    DECLARE _122_88_a 		VARCHAR(500) DEFAULT NULL; 
    DECLARE _114_179 		VARCHAR(500) DEFAULT NULL;  		
    DECLARE _122_87P 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _122_87P_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _48_28 			VARCHAR(500) DEFAULT NULL; 			
    DECLARE _48_28_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_167 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _121_167_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_62 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _121_62_a 		VARCHAR(500) DEFAULT NULL; 
    DECLARE _300_28 		TEXT DEFAULT NULL;  
    DECLARE _114_91  		VARCHAR(60) DEFAULT NULL;     		
	DECLARE _114_170  		VARCHAR(60) DEFAULT NULL;    		
    DECLARE _114_75  		VARCHAR(100) DEFAULT NULL;    		
	DECLARE _114_9  		VARCHAR(2) DEFAULT NULL;       		
    DECLARE _114_3  		VARCHAR(60) DEFAULT NULL;       	
    DECLARE _114_5  		VARCHAR(60) DEFAULT NULL;       	
    DECLARE _114_131  		VARCHAR(11) DEFAULT NULL;      		


	DECLARE _114_115  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _121_45  		VARCHAR(255) DEFAULT NULL;      	
	DECLARE _114_12  		VARCHAR(255) DEFAULT NULL;      	
	DECLARE _114_13  		VARCHAR(255) DEFAULT NULL;      	

	DECLARE _122_87  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _120_13  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _114_14  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _122_107  		VARCHAR(11) DEFAULT NULL;      	


	
	DECLARE AUX VARCHAR(20000) DEFAULT NULL;
    DECLARE AUX1 VARCHAR(20000) DEFAULT NULL;

	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1
 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message1 Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM)); 
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	SELECT DATA INTO ORIGINAL FROM TBL_MESSAGE1 WHERE CODE = "300.51";
	
	SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',1) INTO _300_51;
    SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.64',1) INTO _300_62;
    SELECT SUBSTRING_INDEX(AUX,'300.64',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.65',1) INTO _300_64;
    SELECT SUBSTRING_INDEX(AUX,'300.65',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.66',1) INTO _300_65;
    SELECT SUBSTRING_INDEX(AUX,'114.12',-1) INTO AUX1;
	SELECT SUBSTRING_INDEX(AUX,'114.12',1) INTO _300_66;
    SELECT SUBSTRING_INDEX(_300_66,'300.66',-1) INTO _300_66; 

    SELECT DATA INTO _114_179 	FROM TBL_MESSAGE1 WHERE CODE = "114.179";
	SELECT DATA INTO _114_91 	FROM TBL_MESSAGE1 WHERE CODE = "114.91";
	SELECT DATA INTO _114_170 	FROM TBL_MESSAGE1 WHERE CODE = "114.170";
	SELECT DATA INTO _114_75 	FROM TBL_MESSAGE1 WHERE CODE = "114.75";
	SELECT DATA INTO _114_9 	FROM TBL_MESSAGE1 WHERE CODE = "114.9";
    SELECT DATA INTO _114_3 	FROM TBL_MESSAGE1 WHERE CODE = "114.3";
	SELECT DATA INTO _114_5 	FROM TBL_MESSAGE1 WHERE CODE = "114.5";
    SELECT DATA INTO _114_131 	FROM TBL_MESSAGE1 WHERE CODE = "114.131";

    

    SET SQL_SAFE_UPDATES=0;
	UPDATE TBL_MESSAGE1 SET DATA = CONCAT(_300_51,'114.12',AUX1) WHERE CODE = "300.51";
    SELECT DATA INTO _300_51 	FROM TBL_MESSAGE1 WHERE CODE = "300.51";
	INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES
    ('300.62',SUBSTRING(_300_62,3,LENGTH(_300_62)-4)),
    ('300.64',SUBSTRING(_300_64,3,LENGTH(_300_64)-4)),
    ('300.65',SUBSTRING(_300_65,3,LENGTH(_300_65)-4)),
    ('300.66',SUBSTRING(_300_66,3,LENGTH(_300_66)-4));

	SELECT DATA INTO _300_28 FROM TBL_MESSAGE1 WHERE CODE = "300.28";
    SELECT DATA INTO _300_62 FROM TBL_MESSAGE1 WHERE CODE = "300.62";
	SELECT DATA INTO _300_64 FROM TBL_MESSAGE1 WHERE CODE = "300.64";
	SELECT DATA INTO _300_65 FROM TBL_MESSAGE1 WHERE CODE = "300.65";
	SELECT DATA INTO _300_66 FROM TBL_MESSAGE1 WHERE CODE = "300.66";
	SELECT DATA INTO _300_75 FROM TBL_MESSAGE1 WHERE CODE = "300.75";
	SELECT DATA INTO _300_89 FROM TBL_MESSAGE1 WHERE CODE = "300.89";
	
    SET _300_28 = REPLACE(_300_28,'{"1','{"_1');
    SET _300_28 = REPLACE(_300_28,',"1',',"_1');
    SET _300_28 = REPLACE(_300_28,'{"4','{"_4');
    SET _300_28 = REPLACE(_300_28,',"4',',"_4');
	SET _122_88 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.88'));
    SET _48_28 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));
    SET _121_167 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));
    SET _122_87P = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));
    SET _121_62 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));
    
    SET _114_115 	= common_schema.get_option(_300_51,"114.115");
    SET _121_45 	= common_schema.get_option(_300_51,"121.45");
    SET _114_12 	= common_schema.get_option(_300_51,"114.12");
    SET _114_13 	= common_schema.get_option(_300_51,"114.13");

	SET _122_87 	= common_schema.get_option(_300_62,"122.87");
	SET _120_13 	= common_schema.get_option(_300_64,"120.13");
	SET _114_14 	= common_schema.get_option(_300_65,"114.14");
	SET _122_107 	= common_schema.get_option(_300_66,"122.107");

	SET _300_75 = REPLACE(_300_75,'{"1','{"_1');
	SET _300_75 = REPLACE(_300_75,',"1',',"_1');
	SET _300_75 = REPLACE(_300_75,',"48',',"_48');
	SET _300_75 = REPLACE(_300_75,',"300',',"_300');
	SET _114_75ec = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.75'));
	SET _121_150 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_121.150'));
	SET _122_181 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_122.181'));
	SET _114_7 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.7'));
	

	
	delete from tbl_merchantwebsite 
	where tbl_merchant_nmcId = _114_179;

	update tbl_merchant set tbl_merchant_haveWebsite_f=0  where tbl_merchant_nmcId=_114_179;
	
		
		WHILE (LENGTH(_114_75ec)>0) DO
		
			SET _114_75eca = (SELECT SUBSTR(_114_75ec,1,LOCATE('|',_114_75ec)-1));
			SET _114_75ec = (SELECT SUBSTR(_114_75ec,LOCATE('|',_114_75ec)+1));
			
			SET _121_150a = (SELECT SUBSTR(_121_150,1,LOCATE('|',_121_150)-1));
			SET _121_150 = (SELECT SUBSTR(_121_150,LOCATE('|',_121_150)+1));
			
			SET _122_181a = (SELECT SUBSTR(_122_181,1,LOCATE('|',_122_181)-1));
			SET _122_181 = (SELECT SUBSTR(_122_181,LOCATE('|',_122_181)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7 = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
			
			SET _300_89a = (SELECT SUBSTR(_300_89,1,LOCATE('|',_300_89)-1));
			SET _300_89 = (SELECT SUBSTR(_300_89,LOCATE('|',_300_89)+1));

			SET INDICATIVE_AUX = (SELECT SUBSTRING_INDEX(_300_89a,';',1) );
			SET PHONE_NUMBER_AUX = (SELECT SUBSTR(_300_89a,LOCATE(';',_300_89a)+1));
	
			
	
			INSERT dbuser.tbl_phone SET
				tbl_phone_phoneNumber = TRIM(PHONE_NUMBER_AUX),
				tbl_phone_extension = 0,
				
				tbl_phone_country_id = TRIM(INDICATIVE_AUX),
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_phone ORDER BY tbl_phone_id DESC LIMIT 1);
	
	
			insert into dbuser.tbl_merchantwebsite
			set tbl_merchantwebsite_website = _114_75eca,
			tbl_merchantwebsite_ecommerceProvider= _121_150a,
			tbl_merchantwebsite_ecommerceName= _122_181a,
			tbl_merchantwebsite_ecommerceMail= _114_7a,
			tbl_merchantwebsite_ecommercePhone= PHONEID_AUX,
			tbl_merchant_nmcId= _114_179;
			
			update tbl_merchant set tbl_merchant_haveWebsite_f=1  where tbl_merchant_nmcId=_114_179;
			
		end while;
			
			
	
	
	INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES
	('122.88',_122_88),('114.179',_114_179), ('48.28',_48_28), ('121.167',_121_167), ('122.87',_122_87P),
     ('121.62',_121_62);

    UPDATE dbuser.tbl_user
		SET tbl_user_title = _114_91,
			tbl_user_companyName 	= COALESCE(_114_170,tbl_user_companyName) ,           
			tbl_user_first 			= COALESCE(_114_3,tbl_user_first),
			tbl_user_last  			= COALESCE(_114_5,tbl_user_last),
			tbl_user_status_f 		= COALESCE(_114_9,tbl_user_status_f)	
	WHERE tbl_user_id = _114_179;

	UPDATE dbuser.tbl_merchant
		SET tbl_merchant_taxIdNumber = COALESCE(_114_131,tbl_merchant_taxIdNumber),
		tbl_merchant_online_store = COALESCE(_114_75,tbl_merchant_online_store)
	WHERE tbl_merchant_nmcId = _114_179;

	WHILE (LENGTH(_122_88)>0) DO

	   SET _122_88_a = (SELECT SUBSTR(_122_88,1,LOCATE('|',_122_88)-1));
	   SET _122_88 = (SELECT SUBSTR(_122_88,LOCATE('|',_122_88)+1));

	   SET _122_87P_a = (SELECT SUBSTR(_122_87P,1,LOCATE('|',_122_87P)-1));
	   SET _122_87P = (SELECT SUBSTR(_122_87P,LOCATE('|',_122_87P)+1));

	   SET _48_28_a = (SELECT SUBSTR(_48_28,1,LOCATE('|',_48_28)-1));
	   SET _48_28 = (SELECT SUBSTR(_48_28,LOCATE('|',_48_28)+1));

	   SET _121_167_a = (SELECT SUBSTR(_121_167,1,LOCATE('|',_121_167)-1));
	   SET _121_167 = (SELECT SUBSTR(_121_167,LOCATE('|',_121_167)+1));
	   
	   SET _121_62_a = (SELECT SUBSTR(_121_62,1,LOCATE('|',_121_62)-1));
	   SET _121_62 = (SELECT SUBSTR(_121_62,LOCATE('|',_121_62)+1));

		UPDATE dbuser.tbl_phone
				SET tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
					
					tbl_phone_country_id = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id)
		WHERE  tbl_phone_id = _122_88_a;
   END WHILE;
	
	UPDATE dbuser.tbl_address
		   SET tbl_address_first 	= COALESCE(_114_12,tbl_address_first),
			   tbl_address_second 	= COALESCE(_114_13,tbl_address_second),
               tbl_addresstype_id 	= COALESCE(_121_45,tbl_addresstype_id),
			   tbl_country_id 		= COALESCE(_122_87,tbl_country_id),
			   tbl_state_id 		= COALESCE(_120_13,tbl_state_id),
			   tbl_city_id 			= COALESCE(_114_14,tbl_city_id),
			   tbl_zipcode_id 		= COALESCE(_122_107,tbl_zipcode_id)
    WHERE tbl_address_id  = _114_115;

	select GROUP_CONCAT(CONCAT('"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"')) as JSON;
	DROP TABLE IF EXISTS TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantProfilePortal_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantProfilePortal_1`(PARAM VARCHAR(20000))
BEGIN
	DECLARE UNHEXPARAM 		VARCHAR(20000) DEFAULT NULL;
    DECLARE ORIGINAL 		VARCHAR(20000) DEFAULT NULL;
    DECLARE _300_51 		TEXT DEFAULT NULL;
	
	DECLARE _300_75 		TEXT DEFAULT NULL;
	DECLARE _114_75ec  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_75eca  		VARCHAR(300) DEFAULT NULL;       
	DECLARE _121_150  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _121_150a  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181a 		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7a  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _300_89 		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _300_89a		VARCHAR(300) DEFAULT NULL;       	
	DECLARE PHONEID_AUX		VARCHAR(20) DEFAULT NULL;       	
	DECLARE INDICATIVE_AUX	VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL;     		
	
	
	
	
	
	DECLARE _300_62 		VARCHAR(500) DEFAULT NULL;
    DECLARE _300_64 		VARCHAR(500) DEFAULT NULL;
	DECLARE _300_65 		VARCHAR(500) DEFAULT NULL;
    DECLARE _300_66 		VARCHAR(500) DEFAULT NULL;  
    DECLARE _122_88 		VARCHAR(500) DEFAULT NULL; 			
    DECLARE _122_88_a 		VARCHAR(500) DEFAULT NULL; 
    DECLARE _114_179 		VARCHAR(500) DEFAULT NULL;  		
    DECLARE _122_87P 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _122_87P_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _48_28 			VARCHAR(500) DEFAULT NULL; 			
    DECLARE _48_28_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_167 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _121_167_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_62 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _121_62_a 		VARCHAR(500) DEFAULT NULL; 
    DECLARE _300_28 		TEXT DEFAULT NULL;  
    DECLARE _114_91  		VARCHAR(60) DEFAULT NULL;     		
	DECLARE _114_170  		VARCHAR(60) DEFAULT NULL;    		
    DECLARE _114_75  		VARCHAR(100) DEFAULT NULL;    		
	DECLARE _114_9  		VARCHAR(2) DEFAULT NULL;       		
    DECLARE _114_3  		VARCHAR(60) DEFAULT NULL;       	
    DECLARE _114_5  		VARCHAR(60) DEFAULT NULL;       	
    DECLARE _114_131  		VARCHAR(100) DEFAULT NULL;      	


	DECLARE _114_115  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _121_45  		VARCHAR(255) DEFAULT NULL;      	
	DECLARE _114_12  		VARCHAR(255) DEFAULT NULL;      	
	DECLARE _114_13  		VARCHAR(255) DEFAULT NULL;      	

	DECLARE _122_87  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _120_13  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _114_14  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _122_107  		VARCHAR(11) DEFAULT NULL;      	


	
	DECLARE AUX VARCHAR(20000) DEFAULT NULL;
    DECLARE AUX1 VARCHAR(20000) DEFAULT NULL;

	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1
 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message1 Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM)); 
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	SELECT DATA INTO ORIGINAL FROM TBL_MESSAGE1 WHERE CODE = "300.51";
	
	SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',1) INTO _300_51;
    SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.64',1) INTO _300_62;
    SELECT SUBSTRING_INDEX(AUX,'300.64',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.65',1) INTO _300_64;
    SELECT SUBSTRING_INDEX(AUX,'300.65',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.66',1) INTO _300_65;
    SELECT SUBSTRING_INDEX(AUX,'114.12',-1) INTO AUX1;
	SELECT SUBSTRING_INDEX(AUX,'114.12',1) INTO _300_66;
    SELECT SUBSTRING_INDEX(_300_66,'300.66',-1) INTO _300_66; 

    SELECT DATA INTO _114_179 	FROM TBL_MESSAGE1 WHERE CODE = "114.179";
	SELECT DATA INTO _114_91 	FROM TBL_MESSAGE1 WHERE CODE = "114.91";
	SELECT DATA INTO _114_170 	FROM TBL_MESSAGE1 WHERE CODE = "114.170";
	SELECT DATA INTO _114_75 	FROM TBL_MESSAGE1 WHERE CODE = "114.75";
	SELECT DATA INTO _114_9 	FROM TBL_MESSAGE1 WHERE CODE = "114.9";
    SELECT DATA INTO _114_3 	FROM TBL_MESSAGE1 WHERE CODE = "114.3";
	SELECT DATA INTO _114_5 	FROM TBL_MESSAGE1 WHERE CODE = "114.5";
    SELECT DATA INTO _114_131 	FROM TBL_MESSAGE1 WHERE CODE = "114.131";

    

    SET SQL_SAFE_UPDATES=0;
	UPDATE TBL_MESSAGE1 SET DATA = CONCAT(_300_51,'114.12',AUX1) WHERE CODE = "300.51";
    SELECT DATA INTO _300_51 	FROM TBL_MESSAGE1 WHERE CODE = "300.51";
	INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES
    ('300.62',SUBSTRING(_300_62,3,LENGTH(_300_62)-4)),
    ('300.64',SUBSTRING(_300_64,3,LENGTH(_300_64)-4)),
    ('300.65',SUBSTRING(_300_65,3,LENGTH(_300_65)-4)),
    ('300.66',SUBSTRING(_300_66,3,LENGTH(_300_66)-4));

	SELECT DATA INTO _300_28 FROM TBL_MESSAGE1 WHERE CODE = "300.28";
    SELECT DATA INTO _300_62 FROM TBL_MESSAGE1 WHERE CODE = "300.62";
	SELECT DATA INTO _300_64 FROM TBL_MESSAGE1 WHERE CODE = "300.64";
	SELECT DATA INTO _300_65 FROM TBL_MESSAGE1 WHERE CODE = "300.65";
	SELECT DATA INTO _300_66 FROM TBL_MESSAGE1 WHERE CODE = "300.66";
	SELECT DATA INTO _300_75 FROM TBL_MESSAGE1 WHERE CODE = "300.75";
	SELECT DATA INTO _300_89 FROM TBL_MESSAGE1 WHERE CODE = "300.89";
	
    SET _300_28 = REPLACE(_300_28,'{"1','{"_1');
    SET _300_28 = REPLACE(_300_28,',"1',',"_1');
    SET _300_28 = REPLACE(_300_28,'{"4','{"_4');
    SET _300_28 = REPLACE(_300_28,',"4',',"_4');
	SET _122_88 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.88'));
    SET _48_28 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));
    SET _121_167 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));
    SET _122_87P = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));
    SET _121_62 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));
    
    SET _114_115 	= common_schema.get_option(_300_51,"114.115");
    SET _121_45 	= common_schema.get_option(_300_51,"121.45");
    SET _114_12 	= common_schema.get_option(_300_51,"114.12");
    SET _114_13 	= common_schema.get_option(_300_51,"114.13");

	SET _122_87 	= common_schema.get_option(_300_62,"122.87");
	SET _120_13 	= common_schema.get_option(_300_64,"120.13");
	SET _114_14 	= common_schema.get_option(_300_65,"114.14");
	SET _122_107 	= common_schema.get_option(_300_66,"122.107");

	SET _300_75 = REPLACE(_300_75,'{"1','{"_1');
	SET _300_75 = REPLACE(_300_75,',"1',',"_1');
	SET _300_75 = REPLACE(_300_75,',"48',',"_48');
	SET _300_75 = REPLACE(_300_75,',"300',',"_300');
	SET _114_75ec = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.75'));
	SET _121_150 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_121.150'));
	SET _122_181 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_122.181'));
	SET _114_7 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.7'));
	

	
	delete from tbl_merchantwebsite 
	where tbl_merchant_nmcId = _114_179;

	update tbl_merchant set tbl_merchant_haveWebsite_f=0  where tbl_merchant_nmcId=_114_179;
	
		
		WHILE (LENGTH(_114_75ec)>0) DO
		
			SET _114_75eca = (SELECT SUBSTR(_114_75ec,1,LOCATE('|',_114_75ec)-1));
			SET _114_75ec = (SELECT SUBSTR(_114_75ec,LOCATE('|',_114_75ec)+1));
			
			SET _121_150a = (SELECT SUBSTR(_121_150,1,LOCATE('|',_121_150)-1));
			SET _121_150 = (SELECT SUBSTR(_121_150,LOCATE('|',_121_150)+1));
			
			SET _122_181a = (SELECT SUBSTR(_122_181,1,LOCATE('|',_122_181)-1));
			SET _122_181 = (SELECT SUBSTR(_122_181,LOCATE('|',_122_181)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7 = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
			
			SET _300_89a = (SELECT SUBSTR(_300_89,1,LOCATE('|',_300_89)-1));
			SET _300_89 = (SELECT SUBSTR(_300_89,LOCATE('|',_300_89)+1));

			SET INDICATIVE_AUX = (SELECT SUBSTRING_INDEX(_300_89a,';',1) );
			SET PHONE_NUMBER_AUX = (SELECT SUBSTR(_300_89a,LOCATE(';',_300_89a)+1));
	
			
	
			INSERT dbuser.tbl_phone SET
				tbl_phone_phoneNumber = TRIM(PHONE_NUMBER_AUX),
				tbl_phone_extension = 0,
				
				tbl_phone_country_id = TRIM(INDICATIVE_AUX),
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_phone ORDER BY tbl_phone_id DESC LIMIT 1);
	
	
			insert into dbuser.tbl_merchantwebsite
			set tbl_merchantwebsite_website = _114_75eca,
			tbl_merchantwebsite_ecommerceProvider= _121_150a,
			tbl_merchantwebsite_ecommerceName= _122_181a,
			tbl_merchantwebsite_ecommerceMail= _114_7a,
			tbl_merchantwebsite_ecommercePhone= PHONEID_AUX,
			tbl_merchant_nmcId= _114_179;
			
			update tbl_merchant set tbl_merchant_haveWebsite_f=1  where tbl_merchant_nmcId=_114_179;
			
		end while;
			
			
	
	
	INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES
	('122.88',_122_88),('114.179',_114_179), ('48.28',_48_28), ('121.167',_121_167), ('122.87',_122_87P),
     ('121.62',_121_62);

    UPDATE dbuser.tbl_user
		SET tbl_user_title = _114_91,
			tbl_user_companyName 	= COALESCE(_114_170,tbl_user_companyName) ,           
			tbl_user_first 			= COALESCE(_114_3,tbl_user_first),
			tbl_user_last  			= COALESCE(_114_5,tbl_user_last),
			tbl_user_status_f 		= COALESCE(_114_9,tbl_user_status_f)	
	WHERE tbl_user_id = _114_179;

	UPDATE dbuser.tbl_merchant
		SET tbl_merchant_taxIdNumber = COALESCE(_114_131,tbl_merchant_taxIdNumber),
		tbl_merchant_online_store = COALESCE(_114_75,tbl_merchant_online_store)
	WHERE tbl_merchant_nmcId = _114_179;

	WHILE (LENGTH(_122_88)>0) DO

	   SET _122_88_a = (SELECT SUBSTR(_122_88,1,LOCATE('|',_122_88)-1));
	   SET _122_88 = (SELECT SUBSTR(_122_88,LOCATE('|',_122_88)+1));

	   SET _122_87P_a = (SELECT SUBSTR(_122_87P,1,LOCATE('|',_122_87P)-1));
	   SET _122_87P = (SELECT SUBSTR(_122_87P,LOCATE('|',_122_87P)+1));

	   SET _48_28_a = (SELECT SUBSTR(_48_28,1,LOCATE('|',_48_28)-1));
	   SET _48_28 = (SELECT SUBSTR(_48_28,LOCATE('|',_48_28)+1));

	   SET _121_167_a = (SELECT SUBSTR(_121_167,1,LOCATE('|',_121_167)-1));
	   SET _121_167 = (SELECT SUBSTR(_121_167,LOCATE('|',_121_167)+1));
	   
	   SET _121_62_a = (SELECT SUBSTR(_121_62,1,LOCATE('|',_121_62)-1));
	   SET _121_62 = (SELECT SUBSTR(_121_62,LOCATE('|',_121_62)+1));

		UPDATE dbuser.tbl_phone
				SET tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
					
					tbl_phone_country_id = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id)
		WHERE  tbl_phone_id = _122_88_a;
   END WHILE;
	
	UPDATE dbuser.tbl_address
		   SET tbl_address_first 	= COALESCE(_114_12,tbl_address_first),
			   tbl_address_second 	= COALESCE(_114_13,tbl_address_second),
               tbl_addresstype_id 	= COALESCE(_121_45,tbl_addresstype_id),
			   tbl_country_id 		= COALESCE(_122_87,tbl_country_id),
			   tbl_state_id 		= COALESCE(_120_13,tbl_state_id),
			   tbl_city_id 			= COALESCE(_114_14,tbl_city_id),
			   tbl_zipcode_id 		= COALESCE(_122_107,tbl_zipcode_id)
    WHERE tbl_address_id  = _114_115;

	select GROUP_CONCAT(CONCAT('"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"')) as JSON;
	DROP TABLE IF EXISTS TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMerchantProfilePortal_2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditMerchantProfilePortal_2`(PARAM VARCHAR(20000))
BEGIN
	DECLARE UNHEXPARAM 		VARCHAR(20000) DEFAULT NULL;
    DECLARE ORIGINAL 		VARCHAR(20000) DEFAULT NULL;
    DECLARE _300_51 		TEXT DEFAULT NULL;
	
	DECLARE _300_75 		TEXT DEFAULT NULL;
	DECLARE _114_75ec  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_75eca  		VARCHAR(300) DEFAULT NULL;       
	DECLARE _121_150  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _121_150a  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _122_181a 		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _114_7a  		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _300_89 		VARCHAR(300) DEFAULT NULL;       	
	DECLARE _300_89a		VARCHAR(300) DEFAULT NULL;       	
	DECLARE PHONEID_AUX		VARCHAR(20) DEFAULT NULL;       	
	DECLARE INDICATIVE_AUX	VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL;     		
	
	
	
	DECLARE _300_62 		VARCHAR(500) DEFAULT NULL;
    DECLARE _300_64 		VARCHAR(500) DEFAULT NULL;
	DECLARE _300_65 		VARCHAR(500) DEFAULT NULL;
    DECLARE _300_66 		VARCHAR(500) DEFAULT NULL;  
    DECLARE _122_88 		VARCHAR(500) DEFAULT NULL; 			
    DECLARE _122_88_a 		VARCHAR(500) DEFAULT NULL; 
    DECLARE _114_179 		VARCHAR(500) DEFAULT NULL;  		
    DECLARE _122_87P 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _122_87P_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _48_28 			VARCHAR(500) DEFAULT NULL; 			
    DECLARE _48_28_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_167 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _121_167_a 		VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_62 		VARCHAR(500) DEFAULT NULL; 			
	DECLARE _121_62_a 		VARCHAR(500) DEFAULT NULL; 
    DECLARE _300_28 		TEXT DEFAULT NULL;  
    DECLARE _114_91  		VARCHAR(60) DEFAULT NULL;     		
	DECLARE _114_170  		VARCHAR(60) DEFAULT NULL;    		
    DECLARE _114_75  		VARCHAR(100) DEFAULT NULL;    		
	DECLARE _114_9  		VARCHAR(2) DEFAULT NULL;       		
    DECLARE _114_3  		VARCHAR(60) DEFAULT NULL;       	
    DECLARE _114_5  		VARCHAR(60) DEFAULT NULL;       	
    DECLARE _114_131  		VARCHAR(100) DEFAULT NULL;      	


	DECLARE _114_115  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _121_45  		VARCHAR(255) DEFAULT NULL;      	
	DECLARE _114_12  		VARCHAR(255) DEFAULT NULL;      	
	DECLARE _114_13  		VARCHAR(255) DEFAULT NULL;      	

	DECLARE _122_87  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _120_13  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _114_14  		VARCHAR(11) DEFAULT NULL;      	
	DECLARE _122_107  		VARCHAR(11) DEFAULT NULL;      	

	DECLARE de_300_067 VARCHAR(4000) DEFAULT 0; 				
	DECLARE de_047_042 VARCHAR(45) DEFAULT NULL; 				
	
	DECLARE AUX VARCHAR(20000) DEFAULT NULL;
    DECLARE AUX1 VARCHAR(20000) DEFAULT NULL;

	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1
 (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message1 Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE1  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE1 ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE1;
	END;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM)); 
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	SELECT DATA INTO ORIGINAL FROM TBL_MESSAGE1 WHERE CODE = "300.51";
	
	SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',1) INTO _300_51;
    SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.64',1) INTO _300_62;
    SELECT SUBSTRING_INDEX(AUX,'300.64',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.65',1) INTO _300_64;
    SELECT SUBSTRING_INDEX(AUX,'300.65',-1) INTO AUX;
	SELECT SUBSTRING_INDEX(AUX,'300.66',1) INTO _300_65;
    SELECT SUBSTRING_INDEX(AUX,'114.12',-1) INTO AUX1;
	SELECT SUBSTRING_INDEX(AUX,'114.12',1) INTO _300_66;
    SELECT SUBSTRING_INDEX(_300_66,'300.66',-1) INTO _300_66; 

    SELECT DATA INTO _114_179 	FROM TBL_MESSAGE1 WHERE CODE = "114.179";
	SELECT DATA INTO _114_91 	FROM TBL_MESSAGE1 WHERE CODE = "114.91";
	SELECT DATA INTO _114_170 	FROM TBL_MESSAGE1 WHERE CODE = "114.170";
	SELECT DATA INTO _114_75 	FROM TBL_MESSAGE1 WHERE CODE = "114.75";
	SELECT DATA INTO _114_9 	FROM TBL_MESSAGE1 WHERE CODE = "114.9";
    SELECT DATA INTO _114_3 	FROM TBL_MESSAGE1 WHERE CODE = "114.3";
	SELECT DATA INTO _114_5 	FROM TBL_MESSAGE1 WHERE CODE = "114.5";
    SELECT DATA INTO _114_131 	FROM TBL_MESSAGE1 WHERE CODE = "114.131";

	SELECT DATA INTO de_300_067	FROM TBL_MESSAGE1 WHERE CODE = "300.67";
	

    SET SQL_SAFE_UPDATES=0;
	UPDATE TBL_MESSAGE1 SET DATA = CONCAT(_300_51,'114.12',AUX1) WHERE CODE = "300.51";
    SELECT DATA INTO _300_51 	FROM TBL_MESSAGE1 WHERE CODE = "300.51";
	INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES
    ('300.62',SUBSTRING(_300_62,3,LENGTH(_300_62)-4)),
    ('300.64',SUBSTRING(_300_64,3,LENGTH(_300_64)-4)),
    ('300.65',SUBSTRING(_300_65,3,LENGTH(_300_65)-4)),
    ('300.66',SUBSTRING(_300_66,3,LENGTH(_300_66)-4));

	SELECT DATA INTO _300_28 FROM TBL_MESSAGE1 WHERE CODE = "300.28";
    SELECT DATA INTO _300_62 FROM TBL_MESSAGE1 WHERE CODE = "300.62";
	SELECT DATA INTO _300_64 FROM TBL_MESSAGE1 WHERE CODE = "300.64";
	SELECT DATA INTO _300_65 FROM TBL_MESSAGE1 WHERE CODE = "300.65";
	SELECT DATA INTO _300_66 FROM TBL_MESSAGE1 WHERE CODE = "300.66";
	SELECT DATA INTO _300_75 FROM TBL_MESSAGE1 WHERE CODE = "300.75";
	SELECT DATA INTO _300_89 FROM TBL_MESSAGE1 WHERE CODE = "300.89";
	
    SET _300_28 = REPLACE(_300_28,'{"1','{"_1');
    SET _300_28 = REPLACE(_300_28,',"1',',"_1');
    SET _300_28 = REPLACE(_300_28,'{"4','{"_4');
    SET _300_28 = REPLACE(_300_28,',"4',',"_4');
	SET _122_88 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.88'));
    SET _48_28 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));
    SET _121_167 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));
    SET _122_87P = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));
    SET _121_62 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));
    
    SET _114_115 	= common_schema.get_option(_300_51,"114.115");
    SET _121_45 	= common_schema.get_option(_300_51,"121.45");
    SET _114_12 	= common_schema.get_option(_300_51,"114.12");
    SET _114_13 	= common_schema.get_option(_300_51,"114.13");
	
	SET _122_87 	= common_schema.get_option(_300_62,"122.87");
	SET _120_13 	= common_schema.get_option(_300_64,"120.13");
	SET _114_14 	= common_schema.get_option(_300_65,"114.14");
	SET _122_107 	= common_schema.get_option(_300_66,"122.107");

	SET de_047_042 = common_schema.get_option( de_300_067, "47.42" );
	
	SET _300_75 = REPLACE(_300_75,'{"1','{"_1');
	SET _300_75 = REPLACE(_300_75,',"1',',"_1');
	SET _300_75 = REPLACE(_300_75,',"48',',"_48');
	SET _300_75 = REPLACE(_300_75,',"300',',"_300');
	SET _114_75ec = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.75'));
	SET _121_150 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_121.150'));
	SET _122_181 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_122.181'));
	SET _114_7 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.7'));
	

	
	delete from tbl_merchantwebsite 
	where tbl_merchant_nmcId = _114_179;

	update tbl_merchant set tbl_merchant_haveWebsite_f=0  where tbl_merchant_nmcId=_114_179;
	
		
		WHILE (LENGTH(_114_75ec)>0) DO
		
			SET _114_75eca = (SELECT SUBSTR(_114_75ec,1,LOCATE('|',_114_75ec)-1));
			SET _114_75ec = (SELECT SUBSTR(_114_75ec,LOCATE('|',_114_75ec)+1));
			
			SET _121_150a = (SELECT SUBSTR(_121_150,1,LOCATE('|',_121_150)-1));
			SET _121_150 = (SELECT SUBSTR(_121_150,LOCATE('|',_121_150)+1));
			
			SET _122_181a = (SELECT SUBSTR(_122_181,1,LOCATE('|',_122_181)-1));
			SET _122_181 = (SELECT SUBSTR(_122_181,LOCATE('|',_122_181)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7 = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
			
			SET _300_89a = (SELECT SUBSTR(_300_89,1,LOCATE('|',_300_89)-1));
			SET _300_89 = (SELECT SUBSTR(_300_89,LOCATE('|',_300_89)+1));

			SET INDICATIVE_AUX = (SELECT SUBSTRING_INDEX(_300_89a,';',1) );
			SET PHONE_NUMBER_AUX = (SELECT SUBSTR(_300_89a,LOCATE(';',_300_89a)+1));
	
			
	
			INSERT dbuser.tbl_phone SET
				tbl_phone_phoneNumber = TRIM(PHONE_NUMBER_AUX),
				tbl_phone_extension = 0,
				
				tbl_phone_country_id = TRIM(INDICATIVE_AUX),
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_phone ORDER BY tbl_phone_id DESC LIMIT 1);
	
	
			insert into dbuser.tbl_merchantwebsite
			set tbl_merchantwebsite_website = _114_75eca,
			tbl_merchantwebsite_ecommerceProvider= _121_150a,
			tbl_merchantwebsite_ecommerceName= _122_181a,
			tbl_merchantwebsite_ecommerceMail= _114_7a,
			tbl_merchantwebsite_ecommercePhone= PHONEID_AUX,
			tbl_merchant_nmcId= _114_179;
			
			update tbl_merchant set tbl_merchant_haveWebsite_f=1  where tbl_merchant_nmcId=_114_179;
			
		end while;
			
			
	
	
	INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES
	('122.88',_122_88),('114.179',_114_179), ('48.28',_48_28), ('121.167',_121_167), ('122.87',_122_87P),
     ('121.62',_121_62);

    UPDATE dbuser.tbl_user
		SET tbl_user_title = _114_91,
			tbl_user_companyName 	= COALESCE(_114_170,tbl_user_companyName) ,           
			tbl_user_first 			= COALESCE(_114_3,tbl_user_first),
			tbl_user_last  			= COALESCE(_114_5,tbl_user_last),
			tbl_user_status_f 		= COALESCE(_114_9,tbl_user_status_f)	
	WHERE tbl_user_id = _114_179;

	UPDATE dbuser.tbl_merchant
		SET tbl_merchant_taxIdNumber = COALESCE(_114_131,tbl_merchant_taxIdNumber),
		tbl_merchant_online_store = COALESCE(_114_75,tbl_merchant_online_store),
		tbl_merchant_logoimage = COALESCE(de_047_042,tbl_merchant_logoimage)
	WHERE tbl_merchant_nmcId = _114_179;

	WHILE (LENGTH(_122_88)>0) DO

	   SET _122_88_a = (SELECT SUBSTR(_122_88,1,LOCATE('|',_122_88)-1));
	   SET _122_88 = (SELECT SUBSTR(_122_88,LOCATE('|',_122_88)+1));

	   SET _122_87P_a = (SELECT SUBSTR(_122_87P,1,LOCATE('|',_122_87P)-1));
	   SET _122_87P = (SELECT SUBSTR(_122_87P,LOCATE('|',_122_87P)+1));

	   SET _48_28_a = (SELECT SUBSTR(_48_28,1,LOCATE('|',_48_28)-1));
	   SET _48_28 = (SELECT SUBSTR(_48_28,LOCATE('|',_48_28)+1));

	   SET _121_167_a = (SELECT SUBSTR(_121_167,1,LOCATE('|',_121_167)-1));
	   SET _121_167 = (SELECT SUBSTR(_121_167,LOCATE('|',_121_167)+1));
	   
	   SET _121_62_a = (SELECT SUBSTR(_121_62,1,LOCATE('|',_121_62)-1));
	   SET _121_62 = (SELECT SUBSTR(_121_62,LOCATE('|',_121_62)+1));

		UPDATE dbuser.tbl_phone
				SET tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
					
					tbl_phone_country_id = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id)
		WHERE  tbl_phone_id = _122_88_a;
   END WHILE;
	
	UPDATE dbuser.tbl_address
		   SET tbl_address_first 	= COALESCE(_114_12,tbl_address_first),
			   tbl_address_second 	= COALESCE(_114_13,tbl_address_second),
               tbl_addresstype_id 	= COALESCE(_121_45,tbl_addresstype_id),
			   tbl_country_id 		= COALESCE(_122_87,tbl_country_id),
			   tbl_state_id 		= COALESCE(_120_13,tbl_state_id),
			   tbl_city_id 			= COALESCE(_114_14,tbl_city_id),
			   tbl_zipcode_id 		= COALESCE(_122_107,tbl_zipcode_id)
    WHERE tbl_address_id  = _114_115;

	select GROUP_CONCAT(CONCAT('"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"')) as JSON;
	DROP TABLE IF EXISTS TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditMobileVersionAdmin020400475` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditMobileVersionAdmin020400475`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Author: Juan David
-- Procedure: EditMobileVersionAdmin020400475
-- Method: 020400475
-- Version: 1.0
-- Last modified: 2015-11-23
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_117_028 VARCHAR(45) DEFAULT NULL;    -- 117.28 Version Code
    DECLARE de_117_029 VARCHAR(45) DEFAULT NULL;    -- 117.29 Version Name

-- --------------------
-- Declare auxiliary --
-- --------------------

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	-- TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
		
-- -----------------	
-- Set variables --
-- -----------------

	SET de_117_028 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.28');
	SET de_117_029 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.29');
    
-- ---------------		
-- Query of DB  --
-- ---------------

	update nmc_control.version set
	version_dongle = COALESCE(de_117_028, version_dongle),
    version_mobile = COALESCE(de_117_029, version_mobile)
	where version_id = 1;
    
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
    
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditNewUser020400130` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditNewUser020400130`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  	   
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;      
	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_122_091 VARCHAR(60) DEFAULT NULL; 
	DECLARE de_114_091 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_122_092 INTEGER(60) DEFAULT NULL; 
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  

	
	DECLARE de_122_106 INTEGER(11) DEFAULT 0;   
	DECLARE de_114_027 VARCHAR(11) DEFAULT 0;   
	DECLARE de_127_072 VARCHAR(11) DEFAULT NULL;   
	
	DECLARE de_121_170 TEXT DEFAULT NULL; 
	DECLARE de_114_75 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_123_071 VARCHAR(100) DEFAULT NULL; 
	
	DECLARE de_114_011 INT(11) DEFAULT NULL;		
	DECLARE de_127_066 TEXT DEFAULT NULL;			
	
	DECLARE de_127_068 INT(11) DEFAULT 0;		    

	DECLARE de_127_070 INT(11) DEFAULT NULL;  		
	DECLARE de_127_071 VARCHAR(99) DEFAULT NULL;  		

	DECLARE de_117_013 VARCHAR(11) DEFAULT NULL;        
	DECLARE de_122_089 VARCHAR(11) DEFAULT NULL;        
	



	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET USER_TYPE_AUX = (select  substring(de_053,5,1) );
	SET de_053 = (select right(de_053,11));
	
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_122_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.91');
	SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
	SET de_122_092 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.92');
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.27');
	
	
	SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.106');
	SET de_127_072 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.72');
	
	SET de_121_170 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.170');
	SET de_114_75 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.75');
	SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');
	
	SET	de_114_011 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.11'); 
	SET	de_127_066 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.66');
	SET	de_127_068 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.68');
	
	SET	de_127_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.70'); 
	SET	de_127_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.71'); 
	
	SET de_117_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.13');
	SET de_122_089 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.89');
	





	update tbl_user set
	
	tbl_user_userTemp_f     = 0,

	tbl_user_dateModified = NOW(),
	tbl_user_password = COALESCE(md5((CONVERT(unhex(de_052) using utf8))),tbl_user_password),
	tbl_user_title = COALESCE(de_114_091, tbl_user_title),
	tbl_user_position = COALESCE(de_122_091, tbl_user_position),
	tbl_user_department = COALESCE(de_122_092, tbl_user_department),
	tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName) ,           
	tbl_user_first = COALESCE(de_114_003, tbl_user_first),
	tbl_user_middle = COALESCE(de_114_004, tbl_user_middle),
	tbl_user_last = COALESCE(de_114_005, tbl_user_last),
	
	tbl_gender_type =  COALESCE(de_114_011, tbl_gender_type),
	tbl_user_information= COALESCE(de_127_066, tbl_user_information),
	tbl_user_accept_tips= COALESCE(de_127_068, tbl_user_accept_tips),
	tbl_company_type = COALESCE(de_127_070,tbl_company_type),
	tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other)
 
	where tbl_user_id = de_053;
		
	IF USER_TYPE_AUX IS NOT NULL THEN

		CASE USER_TYPE_AUX

			WHEN '2' THEN 

				update dbuser.tbl_merchant set 
					tbl_merchant_taxIdNumber = COALESCE(de_123_071,tbl_merchant_taxIdNumber),
					tbl_merchant_online_store = COALESCE(de_114_75,tbl_merchant_online_store),
					tbl_merchant_multipleLocation_f = coalesce(de_117_013,tbl_merchant_multipleLocation_f),
					tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,tbl_merchant_multiple_locations_quantity),
					tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage)
				where tbl_merchant_nmcId = de_053;
				
				
			WHEN '3' THEN 
				update tbl_reseller set
					  tbl_reseller_servicesProvider_f =  if(de_127_072 = 'true',1,0),
					  tbl_reseller_clientsNumber = COALESCE(de_122_106,tbl_reseller_clientsNumber)
				where tbl_user_id = de_053;  
		END CASE;	
	END IF;

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditNotificationByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditNotificationByConsumerIdMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_53 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_125 VARCHAR(45) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE ADDRESSTYPE_AUX VARCHAR(45) DEFAULT NULL;
	
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_114_125 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.125');
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		
		
		
		UPDATE tbl_consumer SET 
		tbl_consumer_notificationSettings = de_114_125
		where tbl_consumer_nmcId = de_53;
		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditNotificationSettingsByUser020400226` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditNotificationSettingsByUser020400226`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_053 VARCHAR(20) DEFAULT 0; 		
	DECLARE de_120_027 INT(1) DEFAULT NULL; 	
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL; 	


	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	SET de_053 = (SELECT RIGHT(de_053,11));
	SET de_120_027 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.27');
	SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.9');


	update tbl_consumer set 
	tbl_consumer_notificationSettings = COALESCE(de_120_027,tbl_consumer_notificationSettings),
    tbl_consumer_priorityNotices_f = COALESCE(if(de_114_009='true',1,0),tbl_consumer_priorityNotices_f)
	where tbl_consumer_nmcId = de_053;


	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPackage020400335` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditPackage020400335`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(45) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	
	DECLARE de_114_101 INTEGER(11) DEFAULT NULL;  		
	DECLARE de_048_006 VARCHAR(45) DEFAULT NULL;  		
	
	
	


	DECLARE de_127_102 INTEGER(11) DEFAULT NULL;  		
	DECLARE de_114_070 VARCHAR(300) DEFAULT NULL;  		
	
	
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;      	
	DECLARE de_114_004 VARCHAR(40) DEFAULT NULL;      	
	DECLARE de_114_005 VARCHAR(300) DEFAULT NULL;       
	
	
	
	DECLARE de_114_053 VARCHAR(99) DEFAULT NULL;  		
	DECLARE de_121_077 VARCHAR(255) DEFAULT NULL;  		
	DECLARE de_114_007 VARCHAR(255) DEFAULT NULL;  		
	DECLARE _US_PH TEXT DEFAULT NULL;  					
	

	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 
	
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;        	
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;		
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;		
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;			
	
	
	
	
	
	DECLARE DS_SP TEXT DEFAULT NULL;					
	
	DECLARE de_127_089 VARCHAR(10) DEFAULT 0;			
	DECLARE de_127_090 VARCHAR(10) DEFAULT 0;			
	DECLARE de_127_090_flag INTEGER(10) DEFAULT 0;		
	
	DECLARE de_127_091 VARCHAR(10) DEFAULT NULL;		
	DECLARE de_127_091_flag VARCHAR(10) DEFAULT NULL;	
	
	DECLARE de_127_064 VARCHAR(15) DEFAULT '00:00:00';	
	DECLARE de_127_065 VARCHAR(15) DEFAULT '00:00:00';	

	DECLARE de_114_138 VARCHAR(45) DEFAULT 0;			
	DECLARE de_114_139 VARCHAR(45) DEFAULT 0;			
	
	
	DECLARE de_127_089_C TEXT DEFAULT 0;				
	DECLARE de_127_090_C TEXT DEFAULT 0;				
	DECLARE de_127_091_C TEXT DEFAULT NULL;				
	DECLARE de_127_064_C TEXT DEFAULT NULL;				
	DECLARE de_127_065_C TEXT DEFAULT NULL;				
	
		
	
	
	DECLARE DS_CA TEXT DEFAULT NULL;					
	DECLARE de_114_93 TEXT DEFAULT NULL; 				
	DECLARE de_114_93_C VARCHAR(500) DEFAULT NULL; 		
	
	
	
	DECLARE DS_LO TEXT DEFAULT NULL;  					
	DECLARE CADENA_LOCATION TEXT DEFAULT 0;
	DECLARE de_114_047 INTEGER(11) DEFAULT 0;			
	DECLARE CADENA_FLAG_LOCATION_ALL_TERMINAL TEXT DEFAULT 0;
	DECLARE de_127_104 varchar(11) DEFAULT 0;			

	
	
	
	DECLARE DS_TE TEXT DEFAULT NULL;					
	DECLARE de_120_069 TEXT DEFAULT NULL; 				
	DECLARE de_120_069_C TEXT DEFAULT NULL; 			
	
	

	
	DECLARE DS_AP TEXT DEFAULT NULL;  					
	DECLARE chain_adverising TEXT DEFAULT 0;
	DECLARE de_121_018 INTEGER(11) DEFAULT 0;			
	DECLARE chain_order TEXT DEFAULT 0;
	DECLARE de_127_054 INTEGER(11) DEFAULT 0;			
	
	
	
	DECLARE DS_LZ TEXT DEFAULT NULL;  					
	DECLARE de_122_087 INTEGER(11) DEFAULT 0;			
	DECLARE de_122_087C TEXT DEFAULT NULL;					
	
	DECLARE de_120_013 INTEGER(11) DEFAULT 0;			
	DECLARE de_120_013C TEXT DEFAULT NULL;					
	
	DECLARE de_114_014 INTEGER(11) DEFAULT 0;			
	DECLARE de_114_014C TEXT DEFAULT NULL;					
	
	DECLARE de_122_107 INTEGER(11) DEFAULT 0;			
	DECLARE de_122_107C TEXT DEFAULT NULL;					
	
	
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		
		SET de_114_101 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.101');
		SET de_048_006 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '48.6');
		
		
		
		SET de_127_102 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.102');
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		SET de_121_077 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.77');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		
		
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
		SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
		
		
		SET de_114_053 = CONCAT(de_114_003,' ',de_114_004,' ',de_114_005);
	

		SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
		SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

		SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
		SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
		SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
		SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
		
		SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
		SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
		SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
		SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

		
		
		
		SET de_114_138 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.138');
		SET de_114_139 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.139');
		
		SET DS_SP = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'SL');
		
		SET DS_SP = (SELECT CONVERT(unhex(DS_SP) USING utf8 ));
		
		
		SET DS_SP = REPLACE(DS_SP,'{"1','{"_1');
		SET DS_SP = REPLACE(DS_SP,',"1',',"_1');
		SET DS_SP = REPLACE(DS_SP,'{"48','{"_48');
		SET DS_SP = REPLACE(DS_SP,',"48',',"_48');
		SET DS_SP = REPLACE(DS_SP,'{"47','{"_47');
		SET DS_SP = REPLACE(DS_SP,',"47',',"_47');
		SET DS_SP = REPLACE(DS_SP,'{"5','{"_5');
		SET DS_SP = REPLACE(DS_SP,',"5',',"_5');
		
		set de_127_089_C = (select common_schema.extract_json_value_nmc(concat('{"SP":', DS_SP ,'}'),'//_127.89'));	
		set de_127_090_C = (select common_schema.extract_json_value_nmc(concat('{"SP":', DS_SP ,'}'),'//_127.90'));			
		set de_127_091_C = (select common_schema.extract_json_value_nmc(concat('{"SP":', DS_SP ,'}'),'//_127.91'));	
		set de_127_064_C = (select common_schema.extract_json_value_nmc(concat('{"SP":', DS_SP ,'}'),'//_127.64'));	
		set de_127_065_C = (select common_schema.extract_json_value_nmc(concat('{"SP":', DS_SP ,'}'),'//_127.65'));	
	
		
		
		SET DS_CA = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'CA');
		SET DS_CA = (SELECT CONVERT(unhex(DS_CA) USING utf8 ));
		SET DS_CA = REPLACE(DS_CA,'{"1','{"_1');
		SET DS_CA = REPLACE(DS_CA,',"1',',"_1');
		SET DS_CA = REPLACE(DS_CA,'{"48','{"_48');
		SET DS_CA = REPLACE(DS_CA,',"48',',"_48');
		SET DS_CA = REPLACE(DS_CA,'{"47','{"_47');
		SET DS_CA = REPLACE(DS_CA,',"47',',"_47');
		SET DS_CA = REPLACE(DS_CA,'{"5','{"_5');
		SET DS_CA = REPLACE(DS_CA,',"5',',"_5');
		
		SET de_114_93_C = (SELECT common_schema.extract_json_value_nmc(concat('{"DS_CA":',DS_CA,'}'),'//_114.93'));
		
		
		SET DS_LO = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'LO');
	
		SET DS_LO = (SELECT CONVERT(unhex(DS_LO) USING utf8 ));
			
		SET DS_LO = REPLACE(DS_LO,'{"1','{"_1');
		SET DS_LO = REPLACE(DS_LO,',"1',',"_1');
		SET DS_LO = REPLACE(DS_LO,',"48',',"_48');
		SET DS_LO = REPLACE(DS_LO,',"48',',"_48');
		SET DS_LO = REPLACE(DS_LO,'{"47','{"_47');
		SET DS_LO = REPLACE(DS_LO,',"47',',"_47');
		SET DS_LO = REPLACE(DS_LO,'{"5','{"_5');
		SET DS_LO = REPLACE(DS_LO,',"5',',"_5');
		
		SET CADENA_LOCATION = (select common_schema.extract_json_value_nmc(concat('{"LO":', DS_LO ,'}'),'//_114.47'));	
		SET CADENA_FLAG_LOCATION_ALL_TERMINAL = (select common_schema.extract_json_value_nmc(concat('{"LO":', DS_LO ,'}'),'//_127.104'));	

		
	
		SET DS_TE = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'TE');
	
		SET DS_TE = (SELECT CONVERT(unhex(DS_TE) USING utf8 ));
		
		SET DS_TE = REPLACE(DS_TE,'{"1','{"_1');
		SET DS_TE = REPLACE(DS_TE,',"1',',"_1');
		SET DS_TE = REPLACE(DS_TE,',"48',',"_48');
		SET DS_TE = REPLACE(DS_TE,',"48',',"_48');
		SET DS_TE = REPLACE(DS_TE,'{"47','{"_47');
		SET DS_TE = REPLACE(DS_TE,',"47',',"_47');
		SET DS_TE = REPLACE(DS_TE,'{"5','{"_5');
		SET DS_TE = REPLACE(DS_TE,',"5',',"_5');
		

		SET de_120_069_C = (select common_schema.extract_json_value_nmc(concat('{"TE":', DS_TE ,'}'),'//_120.69'));	
					
		
		SET DS_AP = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'AP');
	
		SET DS_AP = (SELECT CONVERT(unhex(DS_LO) USING utf8 ));
			
		SET DS_AP = REPLACE(DS_AP,'{"1','{"_1');
		SET DS_AP = REPLACE(DS_AP,',"1',',"_1');
		SET DS_AP = REPLACE(DS_AP,',"48',',"_48');
		SET DS_AP = REPLACE(DS_AP,',"48',',"_48');
		SET DS_AP = REPLACE(DS_AP,'{"47','{"_47');
		SET DS_AP = REPLACE(DS_AP,',"47',',"_47');
		SET DS_AP = REPLACE(DS_AP,'{"5','{"_5');
		SET DS_AP = REPLACE(DS_AP,',"5',',"_5');
		
		SET chain_adverising = (select common_schema.extract_json_value_nmc(concat('{"AP":', DS_AP ,'}'),'//_121.18'));	
		SET chain_order = (select common_schema.extract_json_value_nmc(concat('{"AP":', DS_AP ,'}'),'//_127.54'));	
		
		
		
		
		SET DS_LZ = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'LZ');
	
		SET DS_LZ = (SELECT CONVERT(unhex(DS_LZ) USING utf8 ));
		
		SET DS_LZ = REPLACE(DS_LZ,'{"1','{"_1');
		SET DS_LZ = REPLACE(DS_LZ,',"1',',"_1');
		SET DS_LZ = REPLACE(DS_LZ,',"48',',"_48');
		SET DS_LZ = REPLACE(DS_LZ,',"48',',"_48');
		SET DS_LZ = REPLACE(DS_LZ,'{"47','{"_47');
		SET DS_LZ = REPLACE(DS_LZ,',"47',',"_47');
		SET DS_LZ = REPLACE(DS_LZ,'{"5','{"_5');
		SET DS_LZ = REPLACE(DS_LZ,',"5',',"_5');
		
		SET de_122_087C = (select common_schema.extract_json_value_nmc(concat('{"LZ":',DS_LZ,'}'),'//_122.87'));	
		SET de_120_013C = (select common_schema.extract_json_value_nmc(concat('{"LZ":',DS_LZ,'}'),'//_120.13'));	
		SET de_114_014C = (select common_schema.extract_json_value_nmc(concat('{"LZ":',DS_LZ,'}'),'//_114.14'));	
		SET de_122_107C = (select common_schema.extract_json_value_nmc(concat('{"LZ":',DS_LZ,'}'),'//_122.107'));	
		




		
			
		IF(select tbl_package_id from tbl_package where tbl_package_name = de_048_006 and  tbl_package_id !=de_114_101 ) is not null then
		
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2056'),('44','Duplicated Nickname');
			
		ELSE
			
			
			IF de_127_102 IS NULL THEN
			
				insert into dbuser.tbl_user set 
				tbl_user_email 		= de_114_007,
				tbl_user_first 		= de_114_003,
				tbl_user_middle		= COALESCE(de_114_004,''),
				tbl_user_last 		= de_114_005,
				tbl_user_companyName= COALESCE(de_114_070,''),
				tbl_user_password 	= COALESCE(md5(convert(unhex('Aa1#aaaa') using utf8)),''),
				tbl_user_dateAdded 	= NOW(),
				tbl_userstatus_id 	= 33,
				tbl_user_dateModified= NOW(),
				tbl_user_entity 	= '80',
				tbl_user_class 		= '8A0',
				tbl_owner_id 		= '006',
				tbl_user_pinCode 	=  1234;
				
				SET de_127_102 = last_insert_id();
							
				
				INSERT INTO dbuser.tbl_advertiser SET
				tbl_advertiser_contactname 	= de_114_053,
				tbl_advertiser_logo 		= de_121_077,
				tbl_usernmcid 				= de_127_102;
				
				
			
			ELSE
			
				UPDATE dbuser.tbl_user set 
				tbl_user_email 		= COALESCE(de_114_007,tbl_user_email),
				tbl_user_first 		= COALESCE(de_114_003,tbl_user_first),
				tbl_user_middle 	= COALESCE(de_114_004,tbl_user_middle),
				tbl_user_last 		= COALESCE(de_114_005,tbl_user_last),
				tbl_user_companyName = COALESCE(de_114_070,tbl_user_companyName),
				tbl_user_dateModified = NOW()
				where 
				tbl_user_id = de_127_102;
				
				
				UPDATE dbuser.tbl_advertiser SET 
				tbl_advertiser_contactname=COALESCE(de_114_053,tbl_advertiser_contactname) ,
				tbl_advertiser_logo= COALESCE(de_121_077,tbl_advertiser_logo)
				WHERE tbl_usernmcid = de_127_102;
				
				
			END IF;
			
			
				while (LENGTH(_48_28_CADENA)>0) DO

						SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
						SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

						SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
						SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
						
						SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
						SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

					   
						SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
						SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

						insert into dbuser.tbl_phone set
						tbl_phone_nmcId       = de_127_102,
						tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
						tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
						tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
						tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

				end while ; 




			UPDATE tbl_package set 
			tbl_package_name 		= coalesce(de_048_006,tbl_package_name),
			tbl_packagestatus_id 	= '66001',
			tbl_package_usernmcid	= coalesce(de_127_102,tbl_package_usernmcid)
			where tbl_package_id 	= de_114_101;
			
			
			
			
			IF (SELECT tbl_package_schedule_id FROM tbl_package_schedule WHERE tbl_package_id = de_114_101 LIMIT 1) IS NOT NULL THEN
				
				DELETE FROM tbl_package_schedule WHERE tbl_package_id = de_114_101;
				
			END IF;

			WHILE (LENGTH(de_127_089_C)>0) DO

				SET de_127_089 = (SELECT SUBSTR(de_127_089_C,1,LOCATE('|',de_127_089_C)-1));
				SET de_127_089_C = (SELECT SUBSTR(de_127_089_C,LOCATE('|',de_127_089_C)+1));
				
				SET de_127_090 = (SELECT SUBSTR(de_127_090_C,1,LOCATE('|',de_127_090_C)-1));
				SET de_127_090_C = (SELECT SUBSTR(de_127_090_C,LOCATE('|',de_127_090_C)+1));
				
				SET de_127_091 = (SELECT SUBSTR(de_127_091_C,1,LOCATE('|',de_127_091_C)-1));
				SET de_127_091_C = (SELECT SUBSTR(de_127_091_C,LOCATE('|',de_127_091_C)+1));
				
				SET de_127_064 = (SELECT SUBSTR(de_127_064_C,1,LOCATE('|',de_127_064_C)-1));
				SET de_127_064_C = (SELECT SUBSTR(de_127_064_C,LOCATE('|',de_127_064_C)+1));
				
				SET de_127_065 = (SELECT SUBSTR(de_127_065_C,1,LOCATE('|',de_127_065_C)-1));
				SET de_127_065_C = (SELECT SUBSTR(de_127_065_C,LOCATE('|',de_127_065_C)+1));
			
				
				
				if TRIM(de_127_090) = 'true' then
					SET de_127_090_flag = '1';
					SET de_127_064 = '00:00:01';
					SET de_127_065 = '23:59:59';
				else 
					SET de_127_090_flag = '0';
				end if;
			
				if TRIM(de_127_091) = 'true' then
					SET de_127_091_flag = '1';
				else 
					SET de_127_091_flag = '0';
				end if;
				
			
			
				INSERT INTO tbl_package_schedule set 
				tbl_package_id = de_114_101, 
				tbl_day_of_the_week = TRIM(de_127_089),
				tbl_24_hour = de_127_090_flag,
				tbl_closed_flag = de_127_091_flag,
				tbl_hour_open = TRIM(de_127_064),
				tbl_hour_close = TRIM(de_127_065),
				tbl_package_schedule_startDate = de_114_138,
				tbl_package_schedule_endDate =de_114_139 ;
				
				
		
			END WHILE;
			
			
			
			
			IF (SELECT tbl_package_id FROM tbl_packagecategory WHERE tbl_package_id = de_114_101 LIMIT 1) IS NOT NULL THEN
				
				DELETE FROM tbl_packagecategory WHERE tbl_package_id = de_114_101;
				
			END IF;
				
				WHILE (LENGTH(de_114_93_C)>0) DO

					SET de_114_93 = (SELECT SUBSTR(de_114_93_C,1,LOCATE('|',de_114_93_C)-1));
					SET de_114_93_C = (SELECT SUBSTR(de_114_93_C,LOCATE('|',de_114_93_C)+1));
					
					if (select tbl_package_id from tbl_packagecategory where tbl_package_id = de_114_101 and tbl_category_id = TRIM(de_114_93)) is null then
					
						insert into tbl_packagecategory set
						tbl_package_id = de_114_101,
						tbl_category_id = TRIM(de_114_93);
					
					end if;
						
				END WHILE;
			
			
			
			
			
			IF (SELECT tbl_package_id FROM dbitems.tbl_packagelocation WHERE tbl_package_id = de_114_101 LIMIT 1 ) IS NOT NULL then
				delete from dbitems.tbl_packagelocation WHERE tbl_package_id = de_114_101;
			END IF;
			
			
			WHILE (LENGTH(CADENA_LOCATION)>0) DO

				SET de_114_047 = (SELECT SUBSTR(CADENA_LOCATION,1,LOCATE('|',CADENA_LOCATION)-1));
				SET CADENA_LOCATION = (SELECT SUBSTR(CADENA_LOCATION,LOCATE('|',CADENA_LOCATION)+1));
				
				SET de_127_104 = (SELECT SUBSTR(CADENA_FLAG_LOCATION_ALL_TERMINAL,1,LOCATE('|',CADENA_FLAG_LOCATION_ALL_TERMINAL)-1));
				SET CADENA_FLAG_LOCATION_ALL_TERMINAL = (SELECT SUBSTR(CADENA_FLAG_LOCATION_ALL_TERMINAL,LOCATE('|',CADENA_FLAG_LOCATION_ALL_TERMINAL)+1));


				
				IF (SELECT tbl_package_id FROM tbl_packagelocation WHERE tbl_package_id = de_114_101 and tbl_location_id = trim(de_114_047) limit 1) IS NULL THEN
					INSERT INTO tbl_packagelocation set
					tbl_package_id = de_114_101,
					tbl_location_id = trim(de_114_047),
					tbl_packagelocation_allterminal_f=trim(de_127_104);
				END IF;
				
			END WHILE;
			
				
			
		
			IF (SELECT tbl_package_id FROM tbl_packageterminal WHERE tbl_package_id = de_114_101 LIMIT 1) IS NOT NULL THEN
				
				DELETE FROM tbl_packageterminal WHERE tbl_package_id = de_114_101;
				
			END IF;
				
				WHILE (LENGTH(de_114_93_C)>0) DO

					SET de_120_069 = (SELECT SUBSTR(de_120_069_C,1,LOCATE('|',de_120_069_C)-1));
					SET de_120_069_C = (SELECT SUBSTR(de_120_069_C,LOCATE('|',de_120_069_C)+1));
					
					if (select tbl_package_id from tbl_packageterminal where tbl_package_id = de_114_101 and tbl_terminal_id = TRIM(de_120_069)) is null then
					
						insert into tbl_packageterminal set
						tbl_package_id = de_114_101,
						tbl_terminal_id = TRIM(de_120_069);
					
					end if;
						
				END WHILE;
			




			
			
			IF (SELECT tbl_package_id FROM dbitems.tbl_packageadvertising WHERE tbl_package_id = de_114_101 LIMIT 1 ) IS NOT NULL then
				delete from dbitems.tbl_packageadvertising WHERE tbl_package_id = de_114_101;
			END IF;
			
			
			WHILE (LENGTH(chain_adverising)>0) DO

				SET de_121_018 = (SELECT SUBSTR(chain_adverising,1,LOCATE('|',chain_adverising)-1));
				SET chain_adverising = (SELECT SUBSTR(chain_adverising,LOCATE('|',chain_adverising)+1));
				
				SET de_127_054 = (SELECT SUBSTR(chain_order,1,LOCATE('|',chain_order)-1));
				SET chain_order = (SELECT SUBSTR(chain_order,LOCATE('|',chain_order)+1));
				

				
				
				IF (SELECT tbl_package_id FROM tbl_packageadvertising WHERE tbl_package_id = de_114_101 and tbl_advertising_id = trim(de_121_018) limit 1) IS NULL THEN
					INSERT INTO tbl_packageadvertising set
					tbl_package_id = de_114_101,
					tbl_advertising_id = trim(de_121_018),
					tbl_packageadvertising_order = trim(de_127_054);
				END IF;
				
			END WHILE;
			
			
			
			IF (SELECT tbl_package_id FROM dbitems.tbl_packagelocalization WHERE tbl_package_id = de_114_101 LIMIT 1 ) IS NOT NULL then
				delete from dbitems.tbl_packagelocalization WHERE tbl_package_id = de_114_101;
			END IF;
			
			
			WHILE (LENGTH(de_122_087C)>0) DO

				SET de_122_087 = (SELECT SUBSTR(de_122_087C,1,LOCATE('|',de_122_087C)-1));
				SET de_122_087C = (SELECT SUBSTR(de_122_087C,LOCATE('|',de_122_087C)+1));
				
				SET de_120_013 = (SELECT SUBSTR(de_120_013C,1,LOCATE('|',de_120_013C)-1));
				SET de_120_013C = (SELECT SUBSTR(de_120_013C,LOCATE('|',de_120_013C)+1));
				
				SET de_114_014 = (SELECT SUBSTR(de_114_014C,1,LOCATE('|',de_114_014C)-1));
				SET de_114_014C = (SELECT SUBSTR(de_114_014C,LOCATE('|',de_114_014C)+1));
				
				SET de_122_107 = (SELECT SUBSTR(de_122_107C,1,LOCATE('|',de_122_107C)-1));
				SET de_122_107C = (SELECT SUBSTR(de_122_107C,LOCATE('|',de_122_107C)+1));
				

					INSERT INTO tbl_packagelocalization set
					tbl_package_id = de_114_101,
					tbl_country_id = IF(trim(de_122_087) = 0,NULL,trim(de_122_087)),
					tbl_state_id = IF(trim(de_120_013) = 0,NULL,trim(de_120_013)),
					tbl_city_id = IF(trim(de_114_014) = 0,NULL,trim(de_114_014)),
					tbl_zipcode_id = IF(trim(de_122_107) = 0,NULL,trim(de_122_107));
				
				
			END WHILE;
			
			
			insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
			
			
			
		END IF;

	 
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
		
	
	SELECT
	 GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPassPinEmailUser020400150` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `EditPassPinEmailUser020400150`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Autor: Alejandra Moreno Vallejo
-- Procedure: EditPassPinEmailUser020400150
-- Method:020400150
-- Version: 3.0
-- last modified: 2014-03-28
-- --------------------------------------------------------
-- -------------------------	
-- Declare Data Elements --
-- -------------------------
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; -- User Id
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; -- Password
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; -- nickname
	DECLARE de_064 VARCHAR(10) DEFAULT NULL; -- pin

	DECLARE de_123_010 VARCHAR(5) DEFAULT NULL; -- age confirmation flag

-- --------------------
-- Declare auxiliary --
-- --------------------
	 
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------
	-- TABLE  TEMPORARY OF IN    --
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables --
-- -----------------

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
    
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_064 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '64'); 
    SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');	
	SET de_123_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.10'); 	
        
        
	-- remove 24 - 25 - 101 - 53 - 52
	DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;

-- ---------------		
-- Query of DB --
-- ---------------
	
		IF LENGTH(de_052)>0 THEN
			UPDATE tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8))
			where tbl_user_id = de_053;	

			-- INSERT VALUES OF RESPONSE
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
		
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_id = de_053 ) = 37 then
				-- Merchant
                if  (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053) = 20 then
					if (SELECT tbl_user_userTemp_f FROM dbuser.tbl_user WHERE tbl_user_id =de_053) = 1 then
						update dbuser.tbl_user set tbl_userstatus_id= 35 where tbl_user_id=de_053;
					else
						update dbuser.tbl_user set tbl_userstatus_id= 33 where tbl_user_id=de_053;
                    end if;
                end if;
                
                -- Agent
                if  (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053) = 30 then
					if (SELECT tbl_user_userTemp_f FROM dbuser.tbl_user WHERE tbl_user_id =de_053) = 1 then
						update dbuser.tbl_user set tbl_userstatus_id= 35 where tbl_user_id=de_053;
					else
						update dbuser.tbl_user set tbl_userstatus_id= 33 where tbl_user_id=de_053;
                    end if;
                end if;
                
                -- Affiliate
                if  (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053) = 60 then
					if (SELECT tbl_user_userTemp_f FROM dbuser.tbl_user WHERE tbl_user_id =de_053) = 1 then
						update dbuser.tbl_user set tbl_userstatus_id= 35 where tbl_user_id=de_053;
					else
						update dbuser.tbl_user set tbl_userstatus_id= 33 where tbl_user_id=de_053;
                    end if;
                end if;
                
                -- Admin
                if  (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053) = 44 then
					update dbuser.tbl_user set tbl_userstatus_id= 33 where tbl_user_id=de_053;
                end if;
                
                update dbuser.tbl_link set tbl_link_delete=1 where tbl_link_user_id=de_053;
                update dbuser.tbl_user set tbl_user_firstlogin_f= 1 where tbl_user_id=de_053;
			
				IF(SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053 ) = 10 then
					update dbuser.tbl_user set tbl_user_userTemp_f = 0 where tbl_user_id=de_053;
				END IF;
                
			end if;
			
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_id = de_053 ) = 39 then
            
				if (select tbl_user_id from tbl_user where tbl_user_id = de_053 and tbl_user_class = '2C0' and tbl_user_pinCode = '1234') is null then
					
                    update dbuser.tbl_link set tbl_link_delete=1 where tbl_link_user_id=de_053;
					update dbuser.tbl_user set tbl_userstatus_id= 33 where tbl_user_id=de_053;
                    
				else
                
					update dbuser.tbl_link set tbl_link_delete=1 where tbl_link_user_id=de_053;
					update dbuser.tbl_user set tbl_userstatus_id= 37 where tbl_user_id=de_053;
                    
				end if;
			
				IF(SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053 ) = 10 then
					update dbuser.tbl_user set tbl_user_userTemp_f = 0 where tbl_user_id=de_053;
				END IF;
			
			end if;

			

		END IF;

		
		
		IF LENGTH(de_064)>0 THEN
			UPDATE tbl_user set 
			tbl_user_pinCode = md5(convert(unhex(de_064) using utf8))
			where tbl_user_id = de_053;	

			-- INSERT VALUES OF RESPONSE
	
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		END IF;

		IF LENGTH(de_114_007)>0 THEN
			
			IF(SELECT tbl_user_email FROM tbl_user where tbl_user_email= de_114_007 LIMIT 1 ) is NOT null then
			
				-- INSERT VALUES OF RESPONSE
				DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','2053'),('44','Email already exists');
			ELSE
			
				UPDATE tbl_user set 
				tbl_user_email = de_114_007
				where tbl_user_id = de_053;				
				
				-- INSERT VALUES OF RESPONSE
				DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');

			END IF;
		
		END IF;

			

		IF LENGTH(de_123_010)>0 THEN
        
			UPDATE tbl_user set 
			tbl_user_receiveItemsAge_f = COALESCE(if(de_123_010='true',1,0),tbl_user_receiveItemsAge_f)
			where tbl_user_id = de_053;				
			
			-- INSERT VALUES OF RESPONSE
			DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('39','44') OR CODE>44;
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
        
        END IF;

-- -----------------------
-- Result of operation --
-- -----------------------			

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPassPinEmailUserPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditPassPinEmailUserPortal`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 VARCHAR(15) DEFAULT NULL; 
	DECLARE de_052 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_027 VARCHAR(10) DEFAULT NULL; 
	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
      
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




		
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');	
		SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.27'); 
		
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		IF LENGTH(de_052)>0 THEN
			UPDATE tbl_user set 
			tbl_user_password = convert(unhex(de_052) using utf8)
			where tbl_user_id = de_114_179;	

			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

			
		END IF;
			
		
		IF LENGTH(de_114_007)>0 THEN
			
			IF(SELECT tbl_user_email FROM tbl_user where tbl_user_email= de_114_007) is NOT null then
			
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2012'),('44','Not Approved');
			ELSE
			
				UPDATE tbl_user set 
				tbl_user_email = de_114_007
				where tbl_user_id = de_114_179;				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');

			end if;
		
		END IF;
		
		
		
		IF LENGTH(de_114_027)>0 THEN
			UPDATE tbl_user set 
			tbl_user_pinCode = de_114_027
			where tbl_user_id = de_114_179;	

			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		END IF;
		
		




			
		

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPassPinEmailUserPortal_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditPassPinEmailUserPortal_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 VARCHAR(15) DEFAULT NULL; 
	DECLARE de_052 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_027 VARCHAR(10) DEFAULT NULL; 
	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
      
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




		
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');	
		SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.27'); 
		
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		IF LENGTH(de_052)>0 THEN
			UPDATE tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8))
			where tbl_user_id = de_114_179;	

			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

			
		END IF;
			
		
		IF LENGTH(de_114_007)>0 THEN
			
			IF(SELECT tbl_user_email FROM tbl_user where tbl_user_email= de_114_007) is NOT null then
			
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2012'),('44','Not Approved');
			ELSE
			
				UPDATE tbl_user set 
				tbl_user_email = de_114_007
				where tbl_user_id = de_114_179;				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');

			end if;
		
		END IF;
		
		
		
		IF LENGTH(de_114_027)>0 THEN
			UPDATE tbl_user set 
			tbl_user_pinCode = md5(de_114_027)
			where tbl_user_id = de_114_179;	

			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		END IF;
		
		




			
		

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPasswordByAdmin020300261` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `EditPasswordByAdmin020300261`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_53 VARCHAR(20) DEFAULT NULL;           
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;  		  



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	

	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
    
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		

	if (select tbl_user_id from dbuser.tbl_user where tbl_user_id = de_53 and tbl_user_entity in (30,60) and tbl_user_userTemp_f = 1) is not null then
	
		UPDATE dbuser.tbl_user SET
		tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),tbl_user_password),
		tbl_userstatus_id = 35,
		tbl_user_dateModified = NOW()
		WHERE  tbl_user_id = de_53;
    
    else
    
		UPDATE dbuser.tbl_user SET
		tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),tbl_user_password),
		tbl_userstatus_id = 37,
		tbl_user_dateModified = NOW()
		WHERE  tbl_user_id = de_53;

	end if;

	SELECT GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}') )as JSON;
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPasswordBySendMail020400184` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditPasswordBySendMail020400184`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;      
	
	




	DECLARE USERID_AUX INTEGER(11) DEFAULT 0;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
	
	
	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007) is not null then 

			update tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8)),
			tbl_user_passwordTemp_f = 1
			where tbl_user_email = de_114_007;
			
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','3001'),('44','Invalid Email'); 
			
		end if;
		
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	DROP TABLE TBL_MESSAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPasswordBySendMail_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditPasswordBySendMail_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 		
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;            
	
	



	
	DECLARE USERID_AUX INTEGER(11) DEFAULT 0;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	

		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
	
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007) is not null then 

			update tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8)),
			tbl_user_passwordTemp_f = 1
			where tbl_user_email = de_114_007;
			
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','3001'),('44','Invalid Email'); 
			
		
			
		end if;


	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPOSInfoLocationById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditPOSInfoLocationById`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 INTEGER(11) DEFAULT 0;  		    
	DECLARE de_120_097 VARCHAR(15) DEFAULT 0; 			
	DECLARE de_121_184 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_121_186 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;  		
	DECLARE de_300_084 VARCHAR(5000) DEFAULT 0;  		
	
	DECLARE de_048_028 VARCHAR(30) DEFAULT 0;  			
	DECLARE de_121_167 VARCHAR(15) DEFAULT 0;  			
	DECLARE de_122_87P VARCHAR(15) DEFAULT 0;  			




	
	
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_120_097 VARCHAR(15) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_120_097 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.97');
		SET de_121_184 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.184');
		SET de_121_186 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.186');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		
		
		SET de_300_084 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.84');
		SET de_048_028 = common_schema.get_option( de_300_084, "48.28" );
		SET de_121_167 = common_schema.get_option( de_300_084, "121.167" );
		SET de_122_87P = common_schema.get_option( de_300_084, "122.87" );
		
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			
				UPDATE tbl_merchantpos SET 
				tbl_merchantpos_contacProvider= de_121_184,
				tbl_merchantpos_contacName=  de_121_186,
				tbl_merchantpos_contacMail = de_114_007, 
				tbl_merchantpos_contacPhone = de_048_028
				WHERE tbl_merchant_nmcId = de_114_179
				AND tbl_merchantpos_id = de_120_097 ;
						
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_merchantposphone  WHERE tbl_merchantpos_id = de_120_097);
				
				UPDATE tbl_phone SET
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_country_id = de_122_87P,
				tbl_phonetype_id = 4001
				WHERE tbl_phone_id = PHONEID_AUX;
	
		
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			
		
					
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditPOSInfoLocationById020400170` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditPOSInfoLocationById020400170`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	 
	
	DECLARE de_053  VARCHAR(20) DEFAULT 0;  		   	
	DECLARE de_120_097 VARCHAR(15) DEFAULT 0; 			
	DECLARE de_121_184 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_121_186 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;  		
	DECLARE DS_PH VARCHAR(5000) DEFAULT 0;  			
	
	DECLARE de_048_028 VARCHAR(30) DEFAULT 0;  			
	DECLARE de_121_167 VARCHAR(15) DEFAULT 0;  			
	DECLARE de_122_87P VARCHAR(15) DEFAULT 0;  			




	
	
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_120_097 VARCHAR(15) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
		SET de_120_097 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.97');
		SET de_121_184 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.184');
		SET de_121_186 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.186');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		
		
		SET DS_PH = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = 'PH');
		SET DS_PH = (SELECT CONVERT(unhex(DS_PH) USING utf8 ));
		SET de_048_028 = common_schema.get_option( DS_PH, "48.28" );
		SET de_121_167 = common_schema.get_option( DS_PH, "121.167" );
		SET de_122_87P = common_schema.get_option( DS_PH, "122.87" );
		





			
				UPDATE tbl_merchantpos SET 
				tbl_merchantpos_contacProvider= coalesce(de_121_184,tbl_merchantpos_contacProvider),
				tbl_merchantpos_contacName= coalesce(de_121_186,tbl_merchantpos_contacName),
				tbl_merchantpos_contacMail = coalesce(de_114_007,tbl_merchantpos_contacMail), 
				tbl_merchantpos_contacPhone = coalesce(de_048_028,tbl_merchantpos_contacPhone)
				WHERE tbl_merchant_nmcId = de_053
				AND tbl_merchantpos_id = de_120_097 ;
						
				SET PHONEID_AUX= (SELECT tbl_phone_id FROM tbl_merchantposphone  WHERE tbl_merchantpos_id = de_120_097);
				
				UPDATE tbl_phone SET
				tbl_phone_phoneNumber = coalesce(de_048_028,tbl_phone_phoneNumber),
				tbl_phone_extension = coalesce(de_121_167,tbl_phone_extension),
				tbl_phone_country_id = coalesce(de_122_87P,tbl_phone_country_id),
				tbl_phonetype_id = 4001
				WHERE tbl_phone_id = PHONEID_AUX;
	
		
				



				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			
		
					
	
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditResellerProfileByIdPortal_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditResellerProfileByIdPortal_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	
	

	DECLARE de_114_179 VARCHAR(50) DEFAULT NULL;  
	

	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_122_091 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  

	DECLARE de_122_106 INTEGER(11) DEFAULT 0;   
	DECLARE de_114_027 VARCHAR(11) DEFAULT 0;   
	DECLARE de_114_009 VARCHAR(11) DEFAULT NULL;   
	
	
	
	
	DECLARE ORIGINAL   VARCHAR(20000) DEFAULT NULL;
	DECLARE AUX VARCHAR(20000) DEFAULT NULL;
    DECLARE AUX1 VARCHAR(20000) DEFAULT NULL;
	
	DECLARE _300_51    TEXT DEFAULT NULL;
	DECLARE _300_62    VARCHAR(500) DEFAULT NULL;
    DECLARE _300_64    VARCHAR(500) DEFAULT NULL;
	DECLARE _300_65    VARCHAR(500) DEFAULT NULL;
    DECLARE _300_66    VARCHAR(500) DEFAULT NULL;
	DECLARE de_121_045 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_115 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_122_087 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_120_013 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_122_107 INTEGER(11) DEFAULT NULL;  
	
	
	
	DECLARE _300_28 	TEXT DEFAULT NULL;
	DECLARE _122_88 	VARCHAR(500) DEFAULT NULL; 	
    DECLARE _122_88_a 	VARCHAR(500) DEFAULT NULL;
	DECLARE _48_28 		VARCHAR(500) DEFAULT NULL; 	
    DECLARE _48_28_a 	VARCHAR(500) DEFAULT NULL; 
	DECLARE _122_87P 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_87P_a 	VARCHAR(500) DEFAULT NULL;
	DECLARE _121_167 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_167_a 	VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_62 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_62_a 	VARCHAR(500) DEFAULT NULL; 
	
	
	
	DECLARE _300_27 	TEXT DEFAULT NULL;
	DECLARE _122_18 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_18a 	VARCHAR(500) DEFAULT NULL; 	
	
	
	DECLARE _300_16 	TEXT DEFAULT NULL;
	DECLARE _114_70 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_70a 	VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE _122_140 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_140a 	VARCHAR(500) DEFAULT NULL; 	 
	
	DECLARE _114_3 		VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_3a 	VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE _114_7 		VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_7a 	VARCHAR(500) DEFAULT NULL; 	
	
	




	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	

		



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	
	IF flag_validation = FALSE THEN




		
		
		
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		

		SET de_122_091 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "122.91");
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.3");
		SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.4");
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.5");
	
		SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "122.106");
		SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.27");
		SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.9");
		
		
		
		SELECT DATA INTO ORIGINAL FROM TBL_MESSAGE WHERE CODE = "300.51";
		
		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',1) INTO _300_51;
		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.64',1) INTO _300_62;
		SELECT SUBSTRING_INDEX(AUX,'300.64',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.65',1) INTO _300_64;
		SELECT SUBSTRING_INDEX(AUX,'300.65',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.66',1) INTO _300_65;
		SELECT SUBSTRING_INDEX(AUX,'114.12',-1) INTO AUX1;
		SELECT SUBSTRING_INDEX(AUX,'114.12',1) INTO _300_66;
		SELECT SUBSTRING_INDEX(_300_66,'300.66',-1) INTO _300_66;
		SELECT SUBSTRING_INDEX(_300_66,'121.45',1) INTO _300_66;

		UPDATE TBL_MESSAGE SET DATA = CONCAT(_300_51,'114.12',AUX1) WHERE CODE = "300.51";
		SELECT DATA INTO _300_51 FROM TBL_MESSAGE WHERE CODE = "300.51";
		INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES
		('300.62',SUBSTRING(_300_62,3,LENGTH(_300_62)-4)),
		('300.64',SUBSTRING(_300_64,3,LENGTH(_300_64)-4)),
		('300.65',SUBSTRING(_300_65,3,LENGTH(_300_65)-4)),
		('300.66',SUBSTRING(_300_66,3,LENGTH(_300_66)-4));

		SELECT DATA INTO _300_62 FROM TBL_MESSAGE WHERE CODE = "300.62";
		SELECT DATA INTO _300_64 FROM TBL_MESSAGE WHERE CODE = "300.64";
		SELECT DATA INTO _300_65 FROM TBL_MESSAGE WHERE CODE = "300.65";
		SELECT DATA INTO _300_66 FROM TBL_MESSAGE WHERE CODE = "300.66";

		SET de_114_012 	= common_schema.get_option(_300_51,"114.12");
		SET de_114_115 	= common_schema.get_option(_300_51,"114.115");
		SET de_114_013 	= common_schema.get_option(_300_51,"114.13");
		SET de_121_045 	= common_schema.get_option(_300_51,"121.45");
		SET de_122_087 	= common_schema.get_option(_300_62,"122.87");
		SET de_120_013 	= common_schema.get_option(_300_64,"120.13");
		SET de_114_014 	= common_schema.get_option(_300_65,"114.14");
		SET de_122_107 	= common_schema.get_option(_300_66,"122.107");
		
		
		
		SELECT DATA INTO _300_28 FROM TBL_MESSAGE WHERE CODE = "300.28";
		
		SET _300_28 = REPLACE(_300_28,'{"1','{"_1');
		SET _300_28 = REPLACE(_300_28,',"1',',"_1');
		SET _300_28 = REPLACE(_300_28,'{"4','{"_4');
		SET _300_28 = REPLACE(_300_28,',"4',',"_4');
		
		SET _122_88  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.88'));
		SET _48_28   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));
		SET _121_167 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));
		SET _122_87P = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));
		SET _121_62  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));

	
		
		
	
		SELECT DATA INTO _300_27 FROM TBL_MESSAGE WHERE CODE = "300.27";
		
		SET _300_27 = REPLACE(_300_27,'{"1','{"_1');
		SET _300_27 = REPLACE(_300_27,',"1',',"_1');
		SET _122_18 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_27,'}'),'//_122.18'));
		

		
		
		
		SELECT DATA INTO _300_16 FROM TBL_MESSAGE WHERE CODE = "300.16";

		SET _300_16 = REPLACE(_300_16,'{"1','{"_1');
		SET _300_16 = REPLACE(_300_16,',"1',',"_1');
		
		SET _300_16   = REPLACE(_300_16,',"300',',"_300');
		SET _114_70   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_114.70'));
		SET _122_140  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_122.140'));
		SET _114_3    = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_114.3'));
		SET _114_7    = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_114.7'));		
		

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		
		
		



	

		
	
		update tbl_user set
		
		tbl_user_dateModified   = NOW(),
		tbl_user_title          = COALESCE(de_122_091, tbl_user_title) ,
		tbl_user_companyName 	= COALESCE(de_114_070, tbl_user_companyName) ,           
		tbl_user_first 			= COALESCE(de_114_003, tbl_user_first),
		tbl_user_middle 		= COALESCE(de_114_004, tbl_user_middle),
		tbl_user_last  			= COALESCE(de_114_005, tbl_user_last)
		where tbl_user_id = de_114_179;
		
		update tbl_reseller SET
		tbl_reseller_servicesProvider_f =  if(de_114_009 = 'true',1,0),
		tbl_reseller_clientsNumber	 	= de_122_106
		WHERE tbl_user_id 				= de_114_179  ;
	
		
		
		UPDATE dbuser.tbl_address
		   SET tbl_address_first 	= COALESCE(de_114_012,tbl_address_first),
			   tbl_address_second 	= COALESCE(de_114_013,tbl_address_second),
			   tbl_country_id 		= COALESCE(de_122_087,tbl_country_id),
			   tbl_state_id 		= COALESCE(de_120_013,tbl_state_id),
			   tbl_city_id 			= COALESCE(de_114_014,tbl_city_id),
			   tbl_zipcode_id 		= COALESCE(de_122_107,tbl_zipcode_id)
		WHERE tbl_address_id  = de_114_115;
		
		
		delete from tbl_phone where tbl_phone_nmcId = de_114_179;
		while (LENGTH(_122_88)>0) DO

			SET _122_88_a = (SELECT SUBSTR(_122_88,1,LOCATE('|',_122_88)-1));
		    SET _122_88 = (SELECT SUBSTR(_122_88,LOCATE('|',_122_88)+1));

		    SET _122_87P_a = (SELECT SUBSTR(_122_87P,1,LOCATE('|',_122_87P)-1));
		    SET _122_87P = (SELECT SUBSTR(_122_87P,LOCATE('|',_122_87P)+1));

		    SET _48_28_a = (SELECT SUBSTR(_48_28,1,LOCATE('|',_48_28)-1));
		    SET _48_28 = (SELECT SUBSTR(_48_28,LOCATE('|',_48_28)+1));

		    SET _121_167_a = (SELECT SUBSTR(_121_167,1,LOCATE('|',_121_167)-1));
		    SET _121_167 = (SELECT SUBSTR(_121_167,LOCATE('|',_121_167)+1));
		   
		    SET _121_62_a = (SELECT SUBSTR(_121_62,1,LOCATE('|',_121_62)-1));
		    SET _121_62 = (SELECT SUBSTR(_121_62,LOCATE('|',_121_62)+1));

			insert into tbl_phone set
			tbl_phone_nmcId       = de_114_179,
			tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
			tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
			tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
			tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);
		
	    end while ;
		
		
		
		
		delete from tbl_resellerbusinesscategory where tbl_reseller_nmcId = de_114_179;
		while (LENGTH(_122_18)>0) DO

			SET _122_18a = (SELECT SUBSTR(_122_18,1,LOCATE('|',_122_18)-1));
		    SET _122_18 = (SELECT SUBSTR(_122_18,LOCATE('|',_122_18)+1));
			
			insert into tbl_resellerbusinesscategory set
			tbl_reseller_nmcId      = de_114_179,
			tbl_businesscategory_id = _122_18a;
			
		end while ;
		
		
	
		
		delete from tbl_resellercompaniesprovider where tbl_reseller_nmcId= de_114_179;
		while (LENGTH(_114_70)>0) DO
		
			SET _114_70a = (SELECT SUBSTR(_114_70,1,LOCATE('|',_114_70)-1));
			SET _114_70  = (SELECT SUBSTR(_114_70,LOCATE('|',_114_70)+1));
			
			SET _122_140a = (SELECT SUBSTR(_122_140,1,LOCATE('|',_122_140)-1));
			SET _122_140  = (SELECT SUBSTR(_122_140,LOCATE('|',_122_140)+1));

			SET _114_3a = (SELECT SUBSTR(_114_3,1,LOCATE('|',_114_3)-1));
			SET _114_3  = (SELECT SUBSTR(_114_3,LOCATE('|',_114_3)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7  = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
		
			
			INSERT INTO dbuser.tbl_resellercompaniesprovider set
			tbl_resellercompaniesprovider_companyName= _114_70a,
			tbl_resellercompaniesprovider_type= _122_140a,
			tbl_resellercompaniesprovider_contactName=_114_3a ,
			tbl_resellercompaniesprovider_contactEmail=_114_7a ,
			tbl_reseller_nmcId= de_114_179;
		end while;
		
	
		
		
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
		
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditShipmentDetail020400449` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditShipmentDetail020400449`(IN MSG_IN VARCHAR(20000))
BEGIN

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
		
	DECLARE de_122_015 INT(11) DEFAULT NULL; 		-- 122.15 Shipping Id
	DECLARE de_119_013 VARCHAR(45) DEFAULT NULL; 	-- 119.13 Carrier
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL; 	-- 122.126 Ref Number
	DECLARE de_118_009 DATE DEFAULT NULL; 	-- 118.9 Shipping Date 
	DECLARE de_121_011 INT(11) DEFAULT NULL; 	-- 121.11 Boxes Qty
	
-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	

    SET de_122_015 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.15');
    SET de_119_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '119.13');
    SET de_122_126 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.126');
    SET de_118_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '118.9');
    SET de_121_011 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.11');
    
-- -----------------	
-- Set variables --
-- -----------------

	update dbuser.tbl_shipping set
	tbl_shipping_carrier_id = de_119_013,
	tbl_shipping_refNumber = de_122_126,
	tbl_shipping_date = de_118_009,
    tbl_shipping_boxes =  de_121_011
	where tbl_shipping_id = de_122_015;


	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
        
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTemporalPasswordForgot020300279` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTemporalPasswordForgot020300279`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: EditTemporalPasswordForgot020300279
-- Method: 020300279
-- Version: 1.0
-- Last modified: 2014-05-28
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;   -- 114.7 Email
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; 		-- 52 Password
	DECLARE de_057 VARCHAR(75) DEFAULT NULL;  		-- 57 Device Id (udid)
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL;   	-- 114.9 Flag (true - portal ... false - mobile)

-- --------------------
-- Declare auxiliary --
-- --------------------
	 
	DECLARE USER_ID INT(11) DEFAULT NULL;

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------
	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- ----------------	
-- Set variables --
-- ----------------

	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_057 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '57');
	SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
	
	SET USER_ID = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 limit 1);

	-- remove 24 - 25 - 101 - 53 - 52
	DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;

-- ---------------		
-- Query of DB --
-- ---------------

	if length(USER_ID) > 0 then
		IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 ) = 34 then
			
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','3001'),('44','Account Not Valid');
		ELSE
			
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 ) = 38 then
			
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','3001'),('44','Account Not Valid');
			ELSE
			
				if de_114_009 = 'true' then -- Portal

					update tbl_user set 
					tbl_user_password = md5(convert(unhex(de_052) using utf8)),
					tbl_userstatus_id = 39
					where tbl_user_id = USER_ID;	

					insert into TBL_MESSAGE1 (CODE,DATA)
					values('39','0000'),('44','Transaction Approved');


				elseif de_114_009 = 'false' then -- Mobile

					-- if (select tbl_device_id from tbl_device where tbl_consumer_nmcId = USER_ID and tbl_device_udid = de_057) is not null then

						update tbl_user set 
						tbl_user_password = md5(convert(unhex(de_052) using utf8)),
						tbl_userstatus_id = 39
						where tbl_user_id = USER_ID;	

						delete from tbl_link where tbl_link_user_id = USER_ID;

						insert into tbl_link set
						tbl_link_user_id = USER_ID,
						tbl_link_link = md5(convert(unhex(de_052) using utf8)),
						tbl_link_date = NOW(),
						tbl_link_delete = 0;

						insert into TBL_MESSAGE1 (CODE,DATA)
						values('39','0000'),('44','Transaction Approved');

					-- else
				
						-- insert into TBL_MESSAGE1 (CODE,DATA)
						-- values('39','1015'),('44','Invalid Request');

					-- end if;

				end if;
			end if;
		END IF;
	else

		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','3001'),('44','Account Not Valid');

	end if;

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.53":"',GetNMCUserName(USER_ID),'"}')) as JSON;
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	end if;


	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTemporalPasswordMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTemporalPasswordMobile`(IN MSG_IN VARCHAR(20000))
BEGIN

	

























	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;



	DECLARE de_39 VARCHAR(4) DEFAULT NULL;

	DECLARE de_44 VARCHAR(25) DEFAULT NULL;

	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	

	DECLARE de_053 INTEGER(18) DEFAULT NULL; 			

	DECLARE de_121_127 VARCHAR(16) DEFAULT NULL; 		











	

	DECLARE USERID_AUX INTEGER(11) DEFAULT 0;

	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	







	

	

	DECLARE exit HANDLER FOR 1292 

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		

		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	

	DECLARE EXIT HANDLER FOR 1050

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		

		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	

	DECLARE EXIT HANDLER FOR 1064

	BEGIN

		

		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	

	DECLARE EXIT HANDLER FOR 1264

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		

		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

		

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

		

    

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	

	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);

	

	IF flag_validation = FALSE THEN









	



		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');

	

		

		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;











		if (select tbl_user_email 

			from tbl_user 

			where tbl_user_id = de_053 

			and tbl_user_userTemp_f = 0 

			and tbl_user_passwordTemp_f = 0) is not null then 

			

			update tbl_user set 

			tbl_user_password = convert(unhex(de_121_127) using utf8),

			tbl_user_passwordTemp_f = 1

			where tbl_user_id = de_053 

			and tbl_user_userTemp_f = 0 

			and tbl_user_passwordTemp_f = 0;

			

			

			

			

			insert into TBL_MESSAGE (CODE,DATA)

			values('39','0000'),('44','Transaction Approved');

			

		else  



			if (select tbl_user_id 

				from tbl_user 

				where tbl_user_id = de_053 

				and tbl_user_userTemp_f = 0 

				and tbl_user_passwordTemp_f = 1) is not null then

			

				update tbl_user set 

				tbl_user_password = convert(unhex(de_121_127) using utf8),

				tbl_user_passwordTemp_f = 0

				where tbl_user_id = de_053

				and tbl_user_userTemp_f = 0 

				and tbl_user_passwordTemp_f = 1;



				

				

				

				insert into TBL_MESSAGE (CODE,DATA)

				values('39','0000'),('44','Transaction Approved');

				

			else 

			

				

				

				

				insert into TBL_MESSAGE (CODE,DATA)

				values('39','0000'),('44','Invalid Data');

				

			end if;

		

		end if;





	ELSE

	

		

		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		

		

		INSERT INTO TBL_MESSAGE(CODE, DATA)

		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	

	END IF;

	

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);

	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

		

	DROP TABLE TBL_MESSAGE;

 

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTemporalPasswordMobile020400111` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTemporalPasswordMobile020400111`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 			
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; 			
	DECLARE de_114_009 INT(1) DEFAULT NULL; 			



	DECLARE USERID_AUX INTEGER(11) DEFAULT 0;
	DECLARE NAME_AUX VARCHAR(45) DEFAULT NULL;
	DECLARE EMAIL_AUX VARCHAR(300) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
		
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.9');
	




		if de_114_009 = 1 then

			if (select tbl_user_email 
				from tbl_user 
				where tbl_user_id = de_053 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 0) is not null then 
				
				update tbl_user set 
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_passwordTemp_f = 1
				where tbl_user_id = de_053 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 0;

				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			else  

				if (select tbl_user_id 
					from tbl_user 
					where tbl_user_id = de_053 
					and tbl_user_userTemp_f = 0 
					and tbl_user_passwordTemp_f = 1) is not null then
				
					update tbl_user set 
					tbl_user_password = md5(convert(unhex(de_052) using utf8))
					where tbl_user_id = de_053
					and tbl_user_userTemp_f = 0 
					and tbl_user_passwordTemp_f = 1;

					
					
					
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Transaction Approved');
				
				else 
				
					
					
					
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Invalid Data');
				
				end if;

			end if;

		else  

			if (select tbl_user_id 
				from tbl_user 
				where tbl_user_id = de_053 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1) is not null then
			
				update tbl_user set 
				tbl_user_password = convert(unhex(de_052) using utf8),
				tbl_user_passwordTemp_f = 0
				where tbl_user_id = de_053
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1;

				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
			
			else 
				
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Invalid Data');

			end if;
		
		end if;

	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	set NAME_AUX = (select tbl_user_first from tbl_user where tbl_user_id = de_053);
	set EMAIL_AUX = (select tbl_user_email from tbl_user where tbl_user_id = de_053);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.7":"',EMAIL_AUX,'"'),CONCAT(',"114.3":"',NAME_AUX,'"}')) as JSON;
		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTemporalPasswordMobile_2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTemporalPasswordMobile_2`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 INTEGER(18) DEFAULT NULL; 			
	DECLARE de_052 VARCHAR(16) DEFAULT NULL; 		
	DECLARE de_114_009 INT(1) DEFAULT NULL; 			




	
	DECLARE USERID_AUX INTEGER(11) DEFAULT 0;
	DECLARE NAME_AUX VARCHAR(45) DEFAULT NULL;
	DECLARE EMAIL_AUX VARCHAR(300) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
		
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	

		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.9');
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if de_114_009 = 1 then

			if (select tbl_user_email 
				from tbl_user 
				where tbl_user_id = de_053 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 0) is not null then 
				
				update tbl_user set 
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_passwordTemp_f = 1
				where tbl_user_id = de_053 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 0;

				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			else  

				if (select tbl_user_id 
					from tbl_user 
					where tbl_user_id = de_053 
					and tbl_user_userTemp_f = 0 
					and tbl_user_passwordTemp_f = 1) is not null then
				
					update tbl_user set 
					tbl_user_password = md5(convert(unhex(de_052) using utf8))
					where tbl_user_id = de_053
					and tbl_user_userTemp_f = 0 
					and tbl_user_passwordTemp_f = 1;

					
					
					
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Transaction Approved');
				
				else 
				
					
					
					
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Invalid Data');
				
				end if;

			end if;

		else  

			if (select tbl_user_id 
				from tbl_user 
				where tbl_user_id = de_053 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1) is not null then
			
				update tbl_user set 
				tbl_user_password = convert(unhex(de_052) using utf8),
				tbl_user_passwordTemp_f = 0
				where tbl_user_id = de_053
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1;

				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
			
			else 
				
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Invalid Data');

			end if;
		
		end if;


	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	set NAME_AUX = (select tbl_user_first from tbl_user where tbl_user_id = de_053);
	set EMAIL_AUX = (select tbl_user_email from tbl_user where tbl_user_id = de_053);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.7":"',EMAIL_AUX,'"'),CONCAT(',"114.3":"',NAME_AUX,'"}')) as JSON;
		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTemporalPasswordPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTemporalPasswordPortal`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 		
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;            
	DECLARE de_121_127 VARCHAR(16) DEFAULT NULL; 		
	
		



	
	DECLARE USERID_AUX INTEGER(11) DEFAULT 0;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	

		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if (select tbl_user_email 
			from tbl_user 
			where tbl_user_email = de_114_007 
			and tbl_user_userTemp_f = 0 
			and tbl_user_passwordTemp_f = 0) is not null then 

			update tbl_user set 
			tbl_user_password = convert(unhex(de_052) using utf8),
			tbl_user_passwordTemp_f = 1
			where tbl_user_email = de_114_007
			and tbl_user_userTemp_f = 0 
			and tbl_user_passwordTemp_f = 0;
			
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			if (select tbl_user_email 
				from tbl_user 
				where tbl_user_email = de_114_007 
				and tbl_user_password = convert(unhex(de_121_127) using utf8) 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1) is not null then 
			
				update tbl_user set 
				tbl_user_password = convert(unhex(de_052) using utf8),
				tbl_user_passwordTemp_f = 0
				where tbl_user_email = de_114_007
				and tbl_user_password = convert(unhex(de_121_127) using utf8)
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1;
			
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			else
			
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1825'),('44','Invalid Password'); 
			
			end if;
			
		end if;


	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTemporalPasswordPortal_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTemporalPasswordPortal_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 		
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;            
	DECLARE de_121_127 VARCHAR(16) DEFAULT NULL; 		
	
		



	
	DECLARE USERID_AUX INTEGER(11) DEFAULT 0;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	

		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if (select tbl_user_email 
			from tbl_user 
			where tbl_user_email = de_114_007 
			and tbl_user_userTemp_f = 0 
			and tbl_user_passwordTemp_f = 0) is not null then 

			update tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8)),
			tbl_user_passwordTemp_f = 1
			where tbl_user_email = de_114_007
			and tbl_user_userTemp_f = 0 
			and tbl_user_passwordTemp_f = 0;
			
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			if (select tbl_user_email 
				from tbl_user 
				where tbl_user_email = de_114_007 
				and tbl_user_password = md5(convert(unhex(de_121_127) using utf8)) 
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1) is not null then 
			
				update tbl_user set 
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_passwordTemp_f = 0
				where tbl_user_email = de_114_007
				and tbl_user_password = md5(convert(unhex(de_121_127) using utf8))
				and tbl_user_userTemp_f = 0 
				and tbl_user_passwordTemp_f = 1;
			
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			else
			
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1825'),('44','Invalid Password'); 
			
			end if;
			
		end if;


	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTerminalDateCampaignsDownload020400539` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditTerminalDateCampaignsDownload020400539`(IN MSG_IN VARCHAR(20000))
BEGIN

-- --------------------------------------------------------
-- Autor: Juan David Zapata 
-- Procedure: EditTerminalDateCampaignsDownload020400539
-- Method: 020400539
-- Version: 1.0
-- Last modified: 2016-06-13
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_120_069 INT(11) DEFAULT NULL; -- 120.69 Terminal Id
	DECLARE de_114_121 INT(11) DEFAULT NULL; -- 114.121 Memory left
	
-- --------------------
-- Declare auxiliary --
-- --------------------	
    DECLARE VERSION VARCHAR(45) DEFAULT NULL;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- ---------------
-- Validations --
-- ---------------	
	
	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.69');
	SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.121');
	
-- -----------------	
-- Set variables --
-- -----------------

	update dbuser.tbl_terminal set
	tbl_terminal_date_campaigns = NOW(),
    tbl_terminal_lastDateActive = NOW(),
	tbl_terminal_memory = de_114_121
	where tbl_terminal_id = de_120_069;
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
    
	SELECT 
	GROUP_CONCAT(
    CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')
    ) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTerminalDateCampaignsDownloadNight020400552` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditTerminalDateCampaignsDownloadNight020400552`(IN MSG_IN VARCHAR(20000))
BEGIN

-- --------------------------------------------------------
-- Autor: Oscar Lazaro
-- Procedure: EditTerminalDateCampaignsDownloadNight020400552
-- Method: 020400552
-- Version: 1.0
-- Last modified: 2016-08-02
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_120_069 INT(11) DEFAULT NULL; -- 120.69 Terminal Id
	DECLARE de_114_121 INT(11) DEFAULT NULL; -- 114.121 Memory left
	
-- --------------------
-- Declare auxiliary --
-- --------------------	
    DECLARE VERSION VARCHAR(45) DEFAULT NULL;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- ---------------
-- Validations --
-- ---------------	
	
	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.69');
	SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.121');
	
-- -----------------	
-- Set variables --
-- -----------------

	update dbuser.tbl_terminal set
	tbl_terminal_date_campaigns = NOW(),
    tbl_terminal_lastDateActive = NOW(),
	tbl_terminal_nightUpdateActive = NOW(),
	tbl_terminal_memory = de_114_121
	where tbl_terminal_id = de_120_069;
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
    
	SELECT 
	GROUP_CONCAT(
    CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')
    ) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTerminalDateDownload020400538` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditTerminalDateDownload020400538`(IN MSG_IN VARCHAR(20000))
BEGIN


-- --------------------------------------------------------
-- Autor: Juan David Zapata 
-- Procedure: EditTerminalDateDownload020400538
-- Method: 020400538
-- Version: 1.0
-- Last modified: 2016-06-13
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_120_069 INT(11) DEFAULT NULL; -- 120.69 Terminal Id
	DECLARE de_117_028 VARCHAR(45) DEFAULT NULL; -- 117.28 Version
	
-- --------------------
-- Declare auxiliary --
-- --------------------	
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	
	
	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.69');
	SET de_117_028 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.28');
	
-- -----------------	
-- Set variables --
-- -----------------

	update dbuser.tbl_terminal set
	tbl_terminal_date_download = NOW(), 
    tbl_terminal_lastDateActive = NOW(),
	tbl_terminal_version = de_117_028
	where tbl_terminal_id = de_120_069;

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
   
	SELECT 
	GROUP_CONCAT(
    CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')
    ) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTerminalLastDateActive020400378` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditTerminalLastDateActive020400378`(IN MSG_IN VARCHAR(20000))
BEGIN

-- --------------------------------------------------------
-- Autor: Juan David Zapata 
-- Procedure: EditTerminalLastDateActive020400378
-- Method: 020400378
-- Version: 1.0
-- Last modified: 2014-10-15
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_120_069 INT(11) DEFAULT NULL; -- 120.69 Terminal Id
	DECLARE de_123_067 INT(11) DEFAULT NULL; -- 123.67 Terminal Position

-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE GCM_FLAG VARCHAR(5) DEFAULT NULL;
    DECLARE SUBSCRIPTION_FLAG VARCHAR(5) DEFAULT NULL;
	DECLARE BUSINESS_NAME VARCHAR(45) DEFAULT NULL;
    DECLARE VERSION VARCHAR(45) DEFAULT NULL;
    DECLARE UPDATE_FLAG VARCHAR(5) DEFAULT NULL;
    
    DECLARE USER_AUX INT(11) DEFAULT NULL;
    
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	
	
	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.69');
	SET de_123_067 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.67');
	
-- -----------------	
-- Set variables --
-- -----------------

	update tbl_terminal set
	tbl_terminal_lastDateActive = NOW(),
	tbl_terminalposition_id = de_123_067
	where tbl_terminal_id = de_120_069;
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
    
    SET BUSINESS_NAME = (select C.tbl_user_companyName 
						from tbl_terminal as A, tbl_location as B, tbl_user as C 
                        where A.tbl_terminal_id = de_120_069 
                        and A.tbl_location_id = B.tbl_location_id 
                        and B.tbl_location_userId = C.tbl_user_id);
    
    if (select tbl_terminal_gcm from tbl_terminal where tbl_terminal_id = de_120_069) is not null then 
		SET GCM_FLAG = 'true';
	else 
		SET GCM_FLAG = 'false';
    end if;
    
    set UPDATE_FLAG = if((select tbl_terminal_update_f from tbl_terminal where tbl_terminal_id = de_120_069)=1,'true','false');
	
    set USER_AUX = (select B.tbl_location_userId from tbl_terminal as A, tbl_location as B where A.tbl_terminal_id = de_120_069 and A.tbl_location_id = B.tbl_location_id);
    
    set SUBSCRIPTION_FLAG = (select(if((select A.tbl_usersubscription_id from dbitems.tbl_usersubscription as A, dbuser.tbl_terminal as B where A.tbl_usersubscription_user_nmcid = USER_AUX and A.tbl_subscription_id in (14,15,16) and A.tbl_usersubscription_date_expiration > NOW() and A.tbl_location_id = B.tbl_location_id limit 1) is null,'false','true')));
    
    set VERSION = (select version_dongle from nmc_control.version where version_id = 1);
	
	update tbl_terminal set
	tbl_terminal_update_f = 1
	where tbl_terminal_id = de_120_069
	and tbl_terminal_update_f = 0;
	
    
	SELECT 
	GROUP_CONCAT(
    CONCAT('{"39":"',RESULT_39,'"'),
    CONCAT(',"44":"',RESULT_44,'"'),
    CONCAT(',"117.28":"',VERSION,'"'),
    CONCAT(',"127.72":"',UPDATE_FLAG,'"'),
    CONCAT(',"114.9":"',GCM_FLAG,'"'),
    CONCAT(',"127.87":"',SUBSCRIPTION_FLAG,'"'),
    CONCAT(',"114.70":"',BUSINESS_NAME,'"'),
    CONCAT(',"123.55":"',(select dayofmonth(NOW())),'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTerminalLocationById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTerminalLocationById`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_122_170 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_123 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_121_183 INT(11) 	   DEFAULT NULL; 
	DECLARE de_122_125 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_124 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_120_069 INTEGER(11) DEFAULT 0;    
	DECLARE de_114_104 VARCHAR(255) DEFAULT 0;   

	




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN





	SET de_122_170 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.170');
	SET de_122_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.123');
	SET de_121_183 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.183');
	SET de_122_125 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.125');
	SET de_122_124 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.124');
	SET de_122_126 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.126');
	SET de_114_104 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.104');
	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.69');

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if(select tbl_terminal_id from tbl_terminal  where tbl_terminal_id = de_120_069 ) is not null then

			update tbl_terminal set 
			tbl_terminaltype_id = de_122_170,
			tbl_terminal_manofacturer = de_122_123,
			tbl_terminal_posTerminalId = de_121_183,
			tbl_terminal_posInternalId = de_122_125,
			tbl_terminal_provider = de_122_124,
			tbl_terminal_reference = de_122_126,
			tbl_terminal_qrCode = de_114_104
			
			where tbl_terminal_id = de_120_069;

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','	Invalid Terminal ');

		end if;
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"122.170":"',de_122_170,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTerminalLocationById020400173` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditTerminalLocationById020400173`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE de_122_170 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_123 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_121_183 INT(11) 	   DEFAULT NULL; 
	DECLARE de_122_125 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_124 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_120_069 INTEGER(11) DEFAULT 0;    
	DECLARE de_114_104 VARCHAR(255) DEFAULT 0;   

	




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	






	SET de_122_170 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.170');
	SET de_122_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.123');
	SET de_121_183 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.183');
	SET de_122_125 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.125');
	SET de_122_124 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.124');
	SET de_122_126 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.126');
	SET de_114_104 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.104');
	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.69');

		





		if(select tbl_terminal_id from tbl_terminal  where tbl_terminal_id = de_120_069 limit 1) is not null then

			update tbl_terminal set 
			tbl_terminaltype_id = coalesce(de_122_170,tbl_terminaltype_id),
			tbl_terminal_manofacturer = coalesce(de_122_123,tbl_terminal_manofacturer),
			tbl_terminal_posTerminalId = coalesce(de_121_183,tbl_terminal_posTerminalId),
			tbl_terminal_posInternalId = coalesce(de_122_125,tbl_terminal_posInternalId),
			tbl_terminal_provider = coalesce(de_122_124,tbl_terminal_provider),
			tbl_terminal_reference = coalesce(de_122_126,tbl_terminal_reference),
			tbl_terminal_qrCode = coalesce(de_114_104,tbl_terminal_qrCode)
			
			where tbl_terminal_id = de_120_069;

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2018'),('44','	Invalid Terminal ');

		end if;
	
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.170":"',de_122_170,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditTerminalUpdatesByShuffle020400473` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditTerminalUpdatesByShuffle020400473`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Author: Juan David
-- Procedure: EditTerminalUpdatesByShuffle020400473
-- Method: 020400473
-- Version: 1.0
-- Last modified: 2015-11-19
-- --------------------------------------------------------
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_127_107 INTEGER(11) DEFAULT 0;    -- 114.47 Location id

	DECLARE de_TE TEXT DEFAULT NULL;
	DECLARE CADENA_TERMINAL TEXT DEFAULT NULL;
	DECLARE TERMINAL_AUX TEXT DEFAULT NULL;
	
    DECLARE COUNTER_AUX INT(11) DEFAULT 0; 
    
-- --------------------
-- Declare auxiliary --
-- --------------------

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	-- TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
-- -----------------	
-- Set variables --
-- -----------------

	SET de_127_107 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.107');

-- ---------------		
-- Query of DB  --
-- ---------------
	
	set de_TE = (select GROUP_CONCAT(CONCAT('',tbl_terminal_id,'|'))
				from dbitems.tbl_shuffleterminal 
				where tbl_shuffle_id = de_127_107
				);
 
	set CADENA_TERMINAL = REPLACE(de_TE,'|,','|');	
	
	WHILE (LENGTH(CADENA_TERMINAL)>0) DO
					
		SET TERMINAL_AUX = TRIM((SELECT SUBSTR(CADENA_TERMINAL,1,LOCATE('|',CADENA_TERMINAL)-1)));
		SET CADENA_TERMINAL = (SELECT SUBSTR(CADENA_TERMINAL,LOCATE('|',CADENA_TERMINAL)+1));
 
		update dbuser.tbl_terminal set
		tbl_terminal_update_f = 0
		where tbl_terminal_id = TERMINAL_AUX;
 
	END WHILE;
    
    SET COUNTER_AUX = (select tbl_shuffle_republished_count from dbitems.tbl_package_shuffle where tbl_shuffle_id = de_127_107); 

	SET COUNTER_AUX= COUNTER_AUX + 1;

	update dbitems.tbl_package_shuffle
	set tbl_shuffle_republished_count = COUNTER_AUX
	where tbl_shuffle_id = de_127_107;
    
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
    
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditUser020400130` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `EditUser020400130`(IN MSG_IN VARCHAR(20000))
BEGIN











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	
	DECLARE de_053 VARCHAR(50) DEFAULT NULL;  	  
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;      
	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_091 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  

	DECLARE de_127_070 INT(11) DEFAULT NULL;  		
	DECLARE de_127_071 VARCHAR(99) DEFAULT NULL;  		

	
	DECLARE de_122_106 INTEGER(11) DEFAULT 0;    
	DECLARE de_114_027 VARCHAR(11) DEFAULT 0;    
	DECLARE de_114_009 VARCHAR(11) DEFAULT NULL; 
	
	DECLARE de_121_170 TEXT DEFAULT NULL; 
	DECLARE de_114_75 VARCHAR(100) DEFAULT NULL;  
	DECLARE de_114_131 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_117_013 VARCHAR(11) DEFAULT NULL;        
	DECLARE de_122_089 VARCHAR(11) DEFAULT NULL;        
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 
	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	
	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	



	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.27');
	SET	de_127_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.70'); 
	SET	de_127_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.71'); 
	
	
	SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.106');
	SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
	
	
	SET de_121_170 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.170');
	SET de_114_75 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.75');
	SET de_114_131 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.131');
	SET de_117_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.13');
	SET de_122_089 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.89');


	
	DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('24','25') OR CODE>44;


	IF(select tbl_user_parentId from tbl_user where tbl_user_id = de_053) is not null then 


		update tbl_user set
		
		tbl_user_userTemp_f     = 0,
		tbl_user_passwordTemp_f = 0,
		tbl_user_dateModified   = NOW(),
		tbl_user_password       = COALESCE(md5((CONVERT(unhex(de_052) using utf8))),tbl_user_password),
		tbl_user_title = COALESCE(de_114_091, tbl_user_title),
		tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName) ,           
		tbl_user_first = COALESCE(de_114_003, tbl_user_first),
		tbl_user_middle = COALESCE(de_114_004, tbl_user_middle),
		tbl_user_last = COALESCE(de_114_005, tbl_user_last),
		tbl_company_type = COALESCE(de_127_070,tbl_company_type),
		tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other)
		where tbl_user_id = de_053;
		
		SET USER_TYPE_AUX = (SELECT tbl_userType_id FROM  tbl_user where tbl_user_id = de_053 ) ;

		IF USER_TYPE_AUX IS NOT NULL THEN
				
			CASE USER_TYPE_AUX
					
				WHEN 2 THEN 
					IF (select tbl_merchant_nmcId from tbl_merchant where tbl_merchant_nmcId = de_053) is not null THEN 
						UPDATE dbuser.tbl_merchant SET 
							tbl_merchant_taxIdNumber = COALESCE(de_114_131,tbl_merchant_taxIdNumber),
							tbl_merchant_online_store = COALESCE(de_114_75,tbl_merchant_online_store),
							tbl_merchant_multipleLocation_f = coalesce(de_117_013,tbl_merchant_multipleLocation_f),
							tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,tbl_merchant_multiple_locations_quantity),
							tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage)
						WHERE tbl_merchant_nmcId = de_053;
					ELSE
						insert into tbl_merchant set
							tbl_user_id                     = de_053,
							tbl_merchant_nmcId              = de_053,
							tbl_merchant_taxIdNumber        = COALESCE(de_114_131, tbl_merchant_taxIdNumber),
							tbl_merchant_multipleLocation_f = coalesce(de_117_013,4801),
							tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,0),
							tbl_merchant_haveWebsite_f      = 0,
							tbl_merchant_haveAccount_f      = 0,
							tbl_merchant_logoimage 			= de_121_170;
					END IF ;
					
				WHEN 3 THEN 
					UPDATE tbl_reseller SET
						  tbl_reseller_servicesProvider_f =  if(de_114_009 = 'true',1,0),
						  tbl_reseller_clientsNumber = de_122_106
					WHERE tbl_user_id = de_053;  
			END CASE;	
		END IF;



		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
	

	else

		IF (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070 and tbl_user_id != de_053 limit 1) is not null then
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','2067'),('44','Duplicated Company Name');
		else
			update tbl_user set
		
			tbl_user_userTemp_f     = 0,
			tbl_user_passwordTemp_f = 0,
			tbl_user_dateModified   = NOW(),
			tbl_user_password       = COALESCE(md5((CONVERT(unhex(de_052) using utf8))),tbl_user_password),
			tbl_user_title = COALESCE(de_114_091, tbl_user_title),
			tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName) ,           
			tbl_user_first = COALESCE(de_114_003, tbl_user_first),
			tbl_user_middle = COALESCE(de_114_004, tbl_user_middle),
			tbl_user_last = COALESCE(de_114_005, tbl_user_last),
			tbl_company_type = COALESCE(de_127_070,tbl_company_type),
			tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other)
			where tbl_user_id = de_053;
			
			SET USER_TYPE_AUX = (SELECT tbl_userType_id FROM  tbl_user where tbl_user_id = de_053 ) ;

			IF USER_TYPE_AUX IS NOT NULL THEN
					
				CASE USER_TYPE_AUX
						
					WHEN 2 THEN 
						IF (select tbl_merchant_nmcId from tbl_merchant where tbl_merchant_nmcId = de_053) is not null THEN 
							UPDATE dbuser.tbl_merchant SET 
								tbl_merchant_taxIdNumber = COALESCE(de_114_131,tbl_merchant_taxIdNumber),
								tbl_merchant_online_store = COALESCE(de_114_75,tbl_merchant_online_store),
								tbl_merchant_multipleLocation_f = coalesce(de_117_013,tbl_merchant_multipleLocation_f),
								tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,tbl_merchant_multiple_locations_quantity),
								tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage)
							WHERE tbl_merchant_nmcId = de_053;
						ELSE
							insert into tbl_merchant set
								tbl_user_id                     = de_053,
								tbl_merchant_nmcId              = de_053,
								tbl_merchant_taxIdNumber        = COALESCE(de_114_131, tbl_merchant_taxIdNumber),
								tbl_merchant_multipleLocation_f = coalesce(de_117_013,4801),
								tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,0),
								tbl_merchant_haveWebsite_f      = 0,
								tbl_merchant_haveAccount_f      = 0,
								tbl_merchant_logoimage 			= de_121_170;
						END IF ;
						
					WHEN 3 THEN 
						UPDATE tbl_reseller SET
							  tbl_reseller_servicesProvider_f =  if(de_114_009 = 'true',1,0),
							  tbl_reseller_clientsNumber = de_122_106
						WHERE tbl_user_id = de_053;  
				END CASE;	
			END IF;



			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');


		end if;

	end if;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditUserByUserId020400061` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `EditUserByUserId020400061`(IN MSG_IN TEXT)
BEGIN

	DECLARE de_114_001 INT(11) DEFAULT NULL;	

	DECLARE de_53 VARCHAR(20) DEFAULT NULL;	            
	DECLARE de_114_179 VARCHAR(20) DEFAULT 0; 		
	DECLARE de_127_057 VARCHAR(20) DEFAULT 0; 	
	DECLARE de_123_031 VARCHAR(20) DEFAULT 0; 
    
    DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;
	DECLARE de_114_070  VARCHAR(500) DEFAULT NULL;	    
	DECLARE de_114_091  VARCHAR(45) DEFAULT NULL;       
	
	DECLARE de_114_003 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_004 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_114_005 VARCHAR(45) DEFAULT NULL;		

	DECLARE de_114_011 INT(11) DEFAULT NULL;			
	DECLARE de_127_066 TEXT DEFAULT NULL;				
	DECLARE de_127_068 INT(11) DEFAULT NULL;       		

	DECLARE de_122_091 VARCHAR(45) DEFAULT NULL;		
	DECLARE de_122_092 VARCHAR(45) DEFAULT NULL;		
    DECLARE de_122_092_aux INT(11) DEFAULT NULL;	
	DECLARE de_121_145 VARCHAR(45) DEFAULT NULL;		
	-- DECLARE de_127_061 varchar(32) DEFAULT NULL;			
	
	DECLARE de_119_015 TEXT DEFAULT NULL;
	DECLARE de_119_016 TEXT DEFAULT NULL;
	
	DECLARE _US_PH TEXT DEFAULT NULL; 
	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 			
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 			
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 			
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 			
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL; 
		
	DECLARE _US_AD 	TEXT DEFAULT NULL;
	DECLARE de_114_115 INT(11) DEFAULT NULL;  			
	DECLARE de_114_012 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_114_013 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_122_087 INT(11) DEFAULT NULL;  			
	DECLARE de_120_013 INT(11) DEFAULT NULL;  			
	DECLARE de_114_014 INT(11) DEFAULT NULL;  			
	DECLARE de_122_107 INT(11) DEFAULT NULL;  			

	DECLARE de_122_106 INT(11) DEFAULT NULL;  		
	DECLARE de_127_072 VARCHAR(5) DEFAULT NULL;
	
	DECLARE de_120_038 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_120_039 VARCHAR(300) DEFAULT NULL;  		

	DECLARE de_127_070 INT(11) DEFAULT NULL;  		
	DECLARE de_127_071 VARCHAR(99) DEFAULT NULL;  		

	DECLARE de_123_071 VARCHAR(100) DEFAULT NULL;      
  	DECLARE de_121_170 TEXT DEFAULT NULL;               
	DECLARE de_114_75 VARCHAR(100) DEFAULT NULL;       

	DECLARE de_117_013 VARCHAR(11) DEFAULT NULL;        
	DECLARE de_122_089 VARCHAR(11) DEFAULT NULL;        

	DECLARE de_120_008 VARCHAR(5) DEFAULT NULL;	

	DECLARE de_122_020 VARCHAR(5) DEFAULT NULL;  	
    DECLARE de_122_022 VARCHAR(99) DEFAULT NULL;  	
    DECLARE de_122_023 VARCHAR(99) DEFAULT NULL;  	
	
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 
	DECLARE UNHEXPARAM TEXT DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	DECLARE USER_NAME	VARCHAR(100) DEFAULT NULL;     
	DECLARE USER_EMAIL  VARCHAR(100) DEFAULT NULL;    
	DECLARE PHONEID_AUX		VARCHAR(20) DEFAULT NULL; 
	DECLARE PHONEIDL_AUX		VARCHAR(20) DEFAULT NULL; 
	DECLARE ADDRESSID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;  
    
    DECLARE ONLINE_AUX TEXT DEFAULT NULL;  
    
	DECLARE DEPARTMENT_AUX INT(11) DEFAULT NULL;



	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA TEXT NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	


		SET de_114_001 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.1');

		SET	de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		SET USER_TYPE_AUX = (select  substring(de_53,5,1) );
		set de_53 = (select right(de_53,11));
		SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		set de_114_179 = (select right(de_114_179,11));
        SET	de_123_031 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.31');
		set de_123_031 = (select right(de_123_031,11));
        SET	de_127_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.57');
		set de_127_057 = (select right(de_127_057,11));
        
		SET	de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70'); 
		SET de_114_070 = (SELECT CONVERT(unhex(de_114_070) USING utf8 ));

        SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET	de_114_091 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.91');
		SET	de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.3');
		SET	de_114_004 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.4');
		SET	de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.5');
		
		SET	de_114_011 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.11'); 
		SET	de_127_066 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.66'); 
		SET	de_127_068 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.68');
		
		SET	de_122_091 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.91');
		SET	de_122_092 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.92');
		SET de_122_092_aux = de_122_092;
		SET	de_121_145 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.145'); 
		-- SET	de_127_061 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.61'); 

		SET	de_127_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.70'); 
		SET	de_127_071 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.71'); 
		
		SET de_121_170 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.170');
		SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.71');

		SET de_114_75 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.75');
		
		SET de_117_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.13');
		SET de_122_089 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.89');

		SET	de_119_015 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '119.15');
		SET	de_119_016 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '119.16');
		
        SET	de_120_008 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.8');
        
        SET	de_122_106 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.106');
        SET	de_127_072 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.72');
        
        SET	de_122_020 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.20');
        SET	de_122_022 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.22');
        SET	de_122_023 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.23');
        
		SELECT DATA INTO _US_PH FROM TBL_MESSAGE WHERE CODE = "PH";
		SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

		SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
		SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
		SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
		SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
		
        SET _US_PH = REPLACE(_US_PH,'-1','');
        
        SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));
		SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
		SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
		SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
		

		SELECT DATA INTO _US_AD FROM TBL_MESSAGE WHERE CODE = "AD";
		SET _US_AD = (SELECT CONVERT(unhex(_US_AD) USING utf8 ));
		
		SET de_114_115 = common_schema.get_option(_US_AD, "114.115");
		SET de_114_012 = common_schema.get_option(_US_AD, "114.12");
		SET de_114_013 = common_schema.get_option(_US_AD, "114.13");
		SET de_122_107 = common_schema.get_option(_US_AD, "122.107");
		SET de_114_014 = common_schema.get_option(_US_AD, "114.14");
		SET de_120_013 = common_schema.get_option(_US_AD, "120.13");
		SET de_122_087 = common_schema.get_option(_US_AD, "122.87");
		SET de_120_038 = common_schema.get_option(_US_AD, "120.38");
		SET de_120_039 = common_schema.get_option(_US_AD, "120.39");
		
		SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= de_53 limit 1);
		SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id= de_53 limit 1);

		SET DEPARTMENT_AUX = (SELECT tbl_user_department from dbuser.tbl_user where tbl_user_id= de_53);

		if length(de_114_001) > 0 then
			set de_114_001 = de_114_001;
        else
			set de_114_001 = (SELECT tbl_company_id FROM tbl_user WHERE tbl_user_id= de_53 limit 1);
        end if;

	IF(select tbl_user_parentId from tbl_user where tbl_user_id = de_53) is not null then 
	

		update tbl_user set
		tbl_user_parentId = COALESCE(de_114_179,tbl_user_parentId),
        tbl_user_email = COALESCE(de_114_007, tbl_user_email),
		tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName),
		tbl_user_first = COALESCE(de_114_003, tbl_user_first),
		tbl_user_middle =  de_114_004,
		tbl_user_last = COALESCE(de_114_005, tbl_user_last),
		tbl_user_title = COALESCE(de_114_091, tbl_user_title),
		tbl_user_position = COALESCE(de_122_091, tbl_user_position),
		tbl_user_department = COALESCE(de_122_092_aux, tbl_user_department),
        -- tbl_user_supervisor = COALESCE(de_121_145, tbl_user_supervisor),
		tbl_user_supervisor = COALESCE(de_123_031, tbl_user_supervisor),
		tbl_user_information = COALESCE(convert(unhex(de_127_066) using utf8), tbl_user_information),
		tbl_gender_type = COALESCE(if(de_114_011=0,51,de_114_011), tbl_gender_type),
		tbl_user_accept_tips= COALESCE(de_127_068,tbl_user_accept_tips),
		tbl_company_type = COALESCE(de_127_070,tbl_company_type),
		tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other),
        tbl_user_transition_f = COALESCE(if(de_120_008='true',1,0),tbl_user_transition_f),
        tbl_user_modifiedBy = COALESCE(de_127_057,tbl_user_modifiedBy)
		where tbl_user_id = de_53; 


		delete from tbl_resellercompaniesprovider where tbl_reseller_nmcId= de_53;
		
        
        
        
        
        

        if length(de_122_092_aux)>0 and length(DEPARTMENT_AUX)>0 then
		
			if de_122_092_aux != DEPARTMENT_AUX then
		
				delete from dbuser.tbl_permission_user where tbl_user_id = de_53;
                            
				insert into dbuser.tbl_permission_user (tbl_user_id,
													tbl_permission_id,
													tbl_subpermission_id,
													tbl_permission_user_status_f)
				select  de_53,
							B.tbl_permission_id,
							A.tbl_subpermission_id,
							A.tbl_subpermission_f

				from dbuser.tbl_permission_group as A 
				left join dbuser.tbl_subpermission as B on A.tbl_subpermission_id = B.tbl_subpermission_id
				where A.tbl_permission_type_id = de_122_092_aux;
				
                delete from dbuser.tbl_permission_ad where tbl_user_id = de_53;
                
                if de_122_092_aux in (61307, 61316) then
					
					insert into tbl_permission_ad set
					tbl_user_id = de_53,
					tbl_permission_ad_create_f = 1,
					tbl_permission_ad_publish_f = 1,
					tbl_permission_item_viewOnly_f = 0;
					
				else
					
					insert into tbl_permission_ad set
					tbl_user_id = de_53,
					tbl_permission_ad_create_f = 0,
					tbl_permission_ad_publish_f = 0,
					tbl_permission_item_viewOnly_f = 1;
            
				end if;
                
                if (select tbl_permission_user_status_f from dbuser.tbl_permission_user  where tbl_user_id = de_53 and tbl_subpermission_id = 3 limit 1) = 0 then
                
					update tbl_permission_ad set
					tbl_permission_item_viewOnly_f = 1
                    where tbl_user_id = de_53;
                
                end if;
                
			end if;
				
		end if;
        
        

		-- delete from tbl_phone where tbl_phone_nmcId = de_53;
		
		while (LENGTH(_48_28_CADENA)>0) DO

			SET _48_28_a = TRIM((SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1)));
			SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

			SET _121_167_a = TRIM((SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1)));
			SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
						
			SET _122_87P_a = TRIM((SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1)));
			SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));
					   
			SET _121_62_a = TRIM((SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1)));
			SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

			if (select tbl_phone_phoneNumber from tbl_phone where tbl_phone_nmcId = de_53 AND tbl_phonetype_id = _121_62_a limit 1) is null then
				
                case _121_62_a
                
					when 4001 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Work Phone',
						tbl_activity_value_new = _48_28_a,
						tbl_activity_date = NOW();
						
					when 4002 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Home Phone',
						tbl_activity_value_new = _48_28_a,
						tbl_activity_date = NOW();
                        
					when 4003 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Mobile Phone',
						tbl_activity_value_new = _48_28_a,
						tbl_activity_date = NOW();
						
					when 4004 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Other',
						tbl_activity_value_new = _48_28_a,
						tbl_activity_date = NOW();
                        
					when 4005 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Customer Service Phone',
						tbl_activity_value_new = _48_28_a,
						tbl_activity_date = NOW();
                        
					when 4006 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Other',
						tbl_activity_value_new = _48_28_a,
						tbl_activity_date = NOW();
                        
				end case;
                
				insert into tbl_phone set
				tbl_company_id = de_114_001,
				tbl_phone_nmcId = de_53,
				tbl_phone_phoneNumber = COALESCE(_48_28_a, tbl_phone_phoneNumber),
				tbl_phone_extension   = COALESCE(_121_167_a,tbl_phone_extension),
				tbl_phone_country_id  = COALESCE(_122_87P_a, tbl_phone_country_id),
				tbl_phonetype_id      = COALESCE(_121_62_a, tbl_phonetype_id);
                
			else
            
				if (select tbl_phone_phoneNumber from tbl_phone where tbl_phone_nmcId = de_53 and tbl_phonetype_id = _121_62_a limit 1) != _48_28_a then
					
                    case _121_62_a
                
						when 4001 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Work Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4002 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Home Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4003 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Mobile Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4004 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Other',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4005 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Customer Service Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4006 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Other',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
                            
					end case;
					
                end if;
                
					update tbl_phone set
					tbl_phone_phoneNumber = COALESCE(_48_28_a,tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(_121_167_a,tbl_phone_extension),
					tbl_phone_country_id  = COALESCE(_122_87P_a,tbl_phone_country_id)
					where tbl_phone_nmcId = de_53
					and tbl_phonetype_id = _121_62_a;
            
            end if;

		end while ; 
		

		IF USER_TYPE_AUX =2 THEN
				
			if (select tbl_location_id from tbl_location where tbl_location_userId = de_53 limit 1) is null then

				INSERT INTO tbl_location SET 
                tbl_company_id = de_114_001,
				tbl_location_storeNumber= 1 ,
				tbl_location_storeName= 'Main' ,
				tbl_location_contactName = USER_NAME, 
				tbl_location_contactEmail = USER_EMAIL, 
				tbl_location_userId = de_53,
				tbl_location_latitude = coalesce(de_120_038,''),
				tbl_location_longitude= coalesce(de_120_039,''),
				tbl_location_statusId= 7001;
					
				SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);
				
				
				INSERT tbl_phone SET
				tbl_phone_phoneNumber = coalesce(
												 (select tbl_phone_phoneNumber from tbl_phone where tbl_phone_nmcId = de_53 and tbl_phonetype_id = 4001 limit 1),
												 (select tbl_phone_phoneNumber from tbl_phone where tbl_phone_nmcId = de_53 limit 1)
												 ),
				tbl_phone_extension =  coalesce(
												(select tbl_phone_extension from tbl_phone where tbl_phone_nmcId = de_53 and tbl_phonetype_id = 4001 limit 1),
												(select tbl_phone_extension from tbl_phone where tbl_phone_nmcId = de_53 limit 1)
												),
				tbl_phone_nmcId = 0,
				tbl_phone_country_id = coalesce(
												(select tbl_phone_country_id from tbl_phone where tbl_phone_nmcId = de_53 and tbl_phonetype_id = 4001 limit 1),
												(select tbl_phone_country_id from tbl_phone where tbl_phone_nmcId = de_53  limit 1)
												),
				tbl_phonetype_id = 4001;
				
				SET PHONEIDL_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);
				
				INSERT tbl_locationphone SET
				tbl_phone_id = PHONEIDL_AUX,
				tbl_location_id=LOCATIONID_AUX;
				

			end if;

			if LENGTH(de_114_75)>0 then 
			
				SET ONLINE_AUX = (select tbl_merchant_online_store from dbuser.tbl_merchant where tbl_merchant_nmcId = de_53);

				if (select tbl_location_id from dbuser.tbl_location where tbl_location_userId = de_53 and tbl_location_storeName = ONLINE_AUX) is null then 
					
					insert into dbuser.tbl_location set
                    tbl_company_id = de_114_001,
					tbl_location_storeNumber= de_114_75 ,
					tbl_location_storeName= de_114_75,
					tbl_location_contactName = USER_NAME, 
					tbl_location_contactEmail = USER_EMAIL, 
					tbl_location_userId = de_53,
					tbl_location_latitude = coalesce(de_120_038,''),
					tbl_location_longitude= coalesce(de_120_039,''),
					tbl_location_statusId= 7001;
                    
                    SET LOCATIONID_AUX = (SELECT last_insert_id()  from  tbl_location limit 1);
					SET ADDRESSID_AUX = (SELECT tbl_address_id FROM tbl_address where tbl_address_nmcId = de_53 limit 1);
	 
					INSERT tbl_locationaddress SET
					tbl_location_id = LOCATIONID_AUX, 
					tbl_address_id = ADDRESSID_AUX;

				else 
				
					update tbl_location set
					tbl_location_storeNumber= de_114_75 ,
					tbl_location_storeName= de_114_75
					where tbl_location_userId = de_53 
					and tbl_location_storeName= ONLINE_AUX;

				end if;
				
			end if;


			update dbuser.tbl_merchant set 
			tbl_user_reseller_id = COALESCE(de_123_031,tbl_user_reseller_id),
			tbl_merchant_taxIdNumber = COALESCE(de_123_071,tbl_merchant_taxIdNumber),
			tbl_merchant_online_store = COALESCE(de_114_75,tbl_merchant_online_store),
			tbl_merchant_multipleLocation_f = coalesce(de_117_013,tbl_merchant_multipleLocation_f),
			tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,tbl_merchant_multiple_locations_quantity),
			tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage),
            tbl_merchant_sellApitapWebsite_f = COALESCE(if(de_122_020='true',1,0), tbl_merchant_sellApitapWebsite_f),
            tbl_merchant_taxJar_clientId = COALESCE(de_122_022, tbl_merchant_taxJar_clientId),
            tbl_merchant_taxJar_token = COALESCE(de_122_023, tbl_merchant_taxJar_token),
            tbl_user_modifiedBy = COALESCE(de_127_057,tbl_user_modifiedBy)
			where tbl_merchant_nmcId = de_53;
            
            
            update tbl_company set
			tbl_company_name = COALESCE(de_114_070, tbl_company_name),
			tbl_company_taxId = COALESCE(de_123_071, tbl_company_taxId),
			tbl_company_logo = COALESCE(de_121_170, tbl_company_logo),
			tbl_company_website = COALESCE(de_114_75, tbl_company_website),
			tbl_company_terms = COALESCE(convert(unhex(de_119_015) using utf8), tbl_company_terms),
			tbl_company_policy = COALESCE(convert(unhex(de_119_016) using utf8), tbl_company_policy),
			tbl_company_type_id = COALESCE(de_127_070, tbl_company_type_id)
			where tbl_company_id = de_114_001;
		
		else 
			
			IF USER_TYPE_AUX = 3 THEN
			
				update dbuser.tbl_user set 
				tbl_agent_type_id = 74001
				where tbl_user_id = de_53;
			
				update dbuser.tbl_reseller set
				tbl_reseller_taxNumber = COALESCE(de_123_071,tbl_reseller_taxNumber),
				tbl_reseller_clientsNumber = COALESCE(de_122_106, tbl_reseller_clientsNumber)
                where tbl_user_id = de_53;

			end if;

		end if;
		
        if length(de_114_012)>0 then
        
			if de_114_115 is null then

				insert into tbl_address set 
				tbl_company_id = de_114_001,
				tbl_address_nmcId = de_53,
				tbl_addresstype_id = 11,
				tbl_address_first = de_114_012,
				tbl_address_second = de_114_013,
				tbl_address_phoneNumber = NULL,
				tbl_zipcode_id = de_122_107,
				tbl_city_id = de_114_014,
				tbl_state_id = de_120_013,
				tbl_country_id = de_122_087;

				SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);
				
				if length(LOCATIONID_AUX) > 0 then

					INSERT tbl_locationaddress SET
					tbl_location_id = LOCATIONID_AUX, 
					tbl_address_id = ADDRESSID_AUX;

				end if;
				
				insert into dbuser.tbl_crm_activity set
				tbl_editor_id = de_127_057,
				tbl_user_id = de_53,
				tbl_activity_field = 'Address line 1',
				tbl_activity_value_new = de_114_012,
				tbl_activity_date = NOW();
				
				if length(de_114_013) > 0 then
					insert into dbuser.tbl_crm_activity set
					tbl_editor_id = de_127_057,
					tbl_user_id = de_53,
					tbl_activity_field = 'Address line 2',
					tbl_activity_value_new = de_114_013,
					tbl_activity_date = NOW();
				end if;
				
			else
			
				if length(de_114_012) > 0 then
					if (select tbl_address_first from tbl_address where tbl_address_id = de_114_115) != de_114_012 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Address line 1',
						tbl_activity_value_old = (select tbl_address_first from tbl_address where tbl_address_id = de_114_115),
						tbl_activity_value_new = de_114_012,
						tbl_activity_date = NOW();
					end if;
				end if;
				
				if length(de_114_013) > 0 then
					if (select tbl_address_second from tbl_address where tbl_address_id = de_114_115) != de_114_013 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Address line 2',
						tbl_activity_value_old = (select tbl_address_second from tbl_address where tbl_address_id = de_114_115),
						tbl_activity_value_new = de_114_013,
						tbl_activity_date = NOW();
					end if;
				end if;
			
				update tbl_address set 
				tbl_addresstype_id = 11,
				tbl_address_first = coalesce(de_114_012,tbl_address_first),
				tbl_address_second = coalesce(de_114_013,tbl_address_second),
				tbl_zipcode_id =coalesce(de_122_107,tbl_zipcode_id),
				tbl_city_id = coalesce(de_114_014,tbl_city_id),
				tbl_state_id = coalesce(de_120_013,tbl_state_id),
				tbl_country_id = coalesce(de_122_087,tbl_country_id)
				where tbl_address_id = de_114_115;
				
			end if;
		end if;
        
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');

	else

		if (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070 and tbl_user_id != de_53 and tbl_user_class in ('2A0','2B0','2C0') limit 1) is not null then
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','2067'),('44','Duplicated Company Name');
		else

			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_id != de_53 limit 1) is not null then
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2053'),('44','Email Already Exists');
			else
       
			update tbl_user set
			tbl_user_parentId = COALESCE(de_114_179,tbl_user_parentId),
			tbl_user_email = COALESCE(de_114_007, tbl_user_email),
			tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName),
			tbl_user_first = COALESCE(de_114_003, tbl_user_first),
			tbl_user_middle =  de_114_004,
			tbl_user_last = COALESCE(de_114_005, tbl_user_last),
			tbl_user_title = COALESCE(de_114_091, tbl_user_title),
			tbl_user_position = COALESCE(de_122_091, tbl_user_position),
			tbl_user_department = COALESCE(de_122_092_aux, tbl_user_department),
            -- tbl_user_supervisor = COALESCE(de_121_145, tbl_user_supervisor),
			tbl_user_supervisor = COALESCE(de_123_031, tbl_user_supervisor),
			tbl_user_information = COALESCE(convert(unhex(de_127_066) using utf8), tbl_user_information),
			tbl_gender_type = COALESCE(de_114_011, tbl_gender_type),
			tbl_user_accept_tips= COALESCE(de_127_068,tbl_user_accept_tips),
			tbl_company_type = COALESCE(de_127_070,tbl_company_type),
			tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other),
			tbl_user_terms = COALESCE(convert(unhex(de_119_015) using utf8), tbl_user_terms),
			tbl_user_policy = COALESCE(convert(unhex(de_119_016) using utf8), tbl_user_policy),
			tbl_user_transition_f = COALESCE(if(de_120_008='true',1,0),tbl_user_transition_f),
            tbl_user_modifiedBy = COALESCE(de_127_057,tbl_user_modifiedBy)
			where tbl_user_id = de_53; 

		
			
		
				
			delete from tbl_resellercompaniesprovider where tbl_reseller_nmcId= de_53;
			
            
            
            
                      
            if length(de_122_092_aux)>0 and length(DEPARTMENT_AUX)>0 then
			
				if de_122_092_aux != DEPARTMENT_AUX then
						
					delete from dbuser.tbl_permission_user where tbl_user_id = de_53;
								
					insert into dbuser.tbl_permission_user (tbl_user_id,
																  tbl_permission_id,
																  tbl_subpermission_id,
																  tbl_permission_user_status_f)
					select  de_53,
								B.tbl_permission_id,
								A.tbl_subpermission_id,
								A.tbl_subpermission_f

					from dbuser.tbl_permission_group as A 
					left join dbuser.tbl_subpermission as B on A.tbl_subpermission_id = B.tbl_subpermission_id
					where A.tbl_permission_type_id = de_122_092_aux;
					
                    delete from dbuser.tbl_permission_ad where tbl_user_id = de_53;
                
					if de_122_092_aux in (61307, 61316) then
						
						insert into tbl_permission_ad set
						tbl_user_id = de_53,
						tbl_permission_ad_create_f = 1,
						tbl_permission_ad_publish_f = 1,
						tbl_permission_item_viewOnly_f = 0;
						
					else
						
						insert into tbl_permission_ad set
						tbl_user_id = de_53,
						tbl_permission_ad_create_f = 0,
						tbl_permission_ad_publish_f = 0,
						tbl_permission_item_viewOnly_f = 1;
				
					end if;
					
					if (select tbl_permission_user_status_f from dbuser.tbl_permission_user  where tbl_user_id = de_53 and tbl_subpermission_id = 3 limit 1) = 0 then
					
						update tbl_permission_ad set
						tbl_permission_item_viewOnly_f = 1
						where tbl_user_id = de_53;
					
					end if;
                    
				end if;
							
			end if;
            
            
            

			-- delete from tbl_phone where tbl_phone_nmcId = de_53;
		
			while (LENGTH(_48_28_CADENA)>0) DO

				SET _48_28_a = TRIM((SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1)));
				SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

				SET _121_167_a = TRIM((SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1)));
				SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
							
				SET _122_87P_a = TRIM((SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1)));
				SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));
						   
				SET _121_62_a = TRIM((SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1)));
				SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

				if (select tbl_phone_phoneNumber from tbl_phone where tbl_phone_nmcId = de_53 AND tbl_phonetype_id = _121_62_a limit 1) is null then

					case _121_62_a
                
						when 4001 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Work Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4002 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Home Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4003 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Mobile Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4004 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Other',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4005 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Customer Service Phone',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
							
						when 4006 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Other',
							tbl_activity_value_new = _48_28_a,
							tbl_activity_date = NOW();
                        
					end case;

					insert into tbl_phone set
					tbl_company_id 		  = de_114_001,
					tbl_phone_nmcId       = de_53,
					tbl_phone_phoneNumber = COALESCE(_48_28_a,tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(_121_167_a,tbl_phone_extension),
					tbl_phone_country_id  = COALESCE(_122_87P_a,tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(_121_62_a,tbl_phonetype_id);
					
				else
			
					if (select tbl_phone_phoneNumber from tbl_phone where tbl_phone_nmcId = de_53 and tbl_phonetype_id = _121_62_a limit 1) != _48_28_a then
						
                        case _121_62_a
                
							when 4001 then
								insert into dbuser.tbl_crm_activity set
								tbl_editor_id = de_127_057,
								tbl_user_id = de_53,
								tbl_activity_field = 'Work Phone',
								tbl_activity_value_new = _48_28_a,
								tbl_activity_date = NOW();
								
							when 4002 then
								insert into dbuser.tbl_crm_activity set
								tbl_editor_id = de_127_057,
								tbl_user_id = de_53,
								tbl_activity_field = 'Home Phone',
								tbl_activity_value_new = _48_28_a,
								tbl_activity_date = NOW();
								
							when 4003 then
								insert into dbuser.tbl_crm_activity set
								tbl_editor_id = de_127_057,
								tbl_user_id = de_53,
								tbl_activity_field = 'Mobile Phone',
								tbl_activity_value_new = _48_28_a,
								tbl_activity_date = NOW();
								
							when 4004 then
								insert into dbuser.tbl_crm_activity set
								tbl_editor_id = de_127_057,
								tbl_user_id = de_53,
								tbl_activity_field = 'Other',
								tbl_activity_value_new = _48_28_a,
								tbl_activity_date = NOW();
								
							when 4005 then
								insert into dbuser.tbl_crm_activity set
								tbl_editor_id = de_127_057,
								tbl_user_id = de_53,
								tbl_activity_field = 'Customer Service Phone',
								tbl_activity_value_new = _48_28_a,
								tbl_activity_date = NOW();
								
							when 4006 then
								insert into dbuser.tbl_crm_activity set
								tbl_editor_id = de_127_057,
								tbl_user_id = de_53,
								tbl_activity_field = 'Other',
								tbl_activity_value_new = _48_28_a,
								tbl_activity_date = NOW();
                                
						end case;
						
					end if;
					
						update tbl_phone set
						tbl_phone_phoneNumber = COALESCE(_48_28_a,tbl_phone_phoneNumber),
						tbl_phone_extension   = COALESCE(_121_167_a,tbl_phone_extension),
						tbl_phone_country_id  = COALESCE(_122_87P_a,tbl_phone_country_id)
						where tbl_phone_nmcId = de_53
						and tbl_phonetype_id = _121_62_a;
				
				end if;

			end while ; 
		

			IF USER_TYPE_AUX =2 THEN
				
				if (select tbl_location_id from tbl_location where tbl_location_userId = de_53 limit 1) is null then
		
					INSERT INTO tbl_location SET 
                    tbl_company_id = de_114_001,
					tbl_location_storeNumber= 1 ,
					tbl_location_storeName= 'Main' ,
					tbl_location_contactName = USER_NAME, 
					tbl_location_contactEmail = USER_EMAIL, 
					tbl_location_userId = de_53,
					tbl_location_latitude = coalesce(de_120_038,''),
					tbl_location_longitude= coalesce(de_120_039,''),
					tbl_location_statusId= 7001;
						
					SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);
					
					INSERT tbl_phone SET
					tbl_phone_phoneNumber = coalesce(
													 (select A.tbl_phone_phoneNumber from tbl_phone as A where A.tbl_phone_nmcId = de_53 and A.tbl_phonetype_id = 4001 limit 1),
													 (select A.tbl_phone_phoneNumber from tbl_phone as A where A.tbl_phone_nmcId = de_53 limit 1)
													 ),
					tbl_phone_extension = coalesce(
													(select A.tbl_phone_extension from tbl_phone as A where A.tbl_phone_nmcId = de_53 and A.tbl_phonetype_id = 4001 limit 1),
													(select A.tbl_phone_extension from tbl_phone as A  where A.tbl_phone_nmcId = de_53 limit 1)
													),
					tbl_phone_nmcId = 0,
					tbl_phone_country_id = coalesce(
													(select A.tbl_phone_country_id from tbl_phone as A where A.tbl_phone_nmcId = de_53 and A.tbl_phonetype_id = 4001 limit 1),
													(select A.tbl_phone_country_id from tbl_phone as A where A.tbl_phone_nmcId = de_53  limit 1)
													),
					tbl_phonetype_id = 4001;
					
					SET PHONEIDL_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);
					
					INSERT tbl_locationphone SET
					tbl_phone_id = PHONEIDL_AUX,
					tbl_location_id=LOCATIONID_AUX;

				end if;

				if LENGTH(de_114_75)>0 then 
                
					SET ONLINE_AUX = (select tbl_merchant_online_store from dbuser.tbl_merchant where tbl_merchant_nmcId = de_53);

					if (select tbl_location_id from dbuser.tbl_location where tbl_location_userId = de_53 and tbl_location_storeName = ONLINE_AUX) is null then 
						
                        insert into dbuser.tbl_location set
                        tbl_company_id = de_114_001,
                        tbl_location_storeNumber= de_114_75 ,
						tbl_location_storeName= de_114_75,
						tbl_location_contactName = USER_NAME, 
						tbl_location_contactEmail = USER_EMAIL, 
						tbl_location_userId = de_53,
						tbl_location_latitude = coalesce(de_120_038,''),
						tbl_location_longitude= coalesce(de_120_039,''),
						tbl_location_statusId= 7001;
                        
                        SET LOCATIONID_AUX = (SELECT last_insert_id()  from  tbl_location limit 1);
                        SET ADDRESSID_AUX = (SELECT tbl_address_id FROM tbl_address where tbl_address_nmcId = de_53 limit 1);
		 
						INSERT tbl_locationaddress SET
						tbl_location_id = LOCATIONID_AUX, 
						tbl_address_id = ADDRESSID_AUX;

					else 
					
						update tbl_location set
						tbl_location_storeNumber= de_114_75 ,
						tbl_location_storeName= de_114_75
						where tbl_location_userId = de_53 
                        and tbl_location_storeName= ONLINE_AUX;
	
					end if;
                    
				end if;

				update dbuser.tbl_merchant set 
				-- tbl_user_reseller_id = COALESCE(de_123_031,tbl_user_reseller_id),
				tbl_merchant_taxIdNumber = COALESCE(de_123_071,tbl_merchant_taxIdNumber),
				tbl_merchant_online_store = COALESCE(de_114_75,tbl_merchant_online_store),
				tbl_merchant_multipleLocation_f = coalesce(de_117_013,tbl_merchant_multipleLocation_f),
				tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,tbl_merchant_multiple_locations_quantity),
				tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage),
				tbl_merchant_sellApitapWebsite_f = COALESCE(if(de_122_020='true',1,0), tbl_merchant_sellApitapWebsite_f),
				tbl_merchant_taxJar_clientId = COALESCE(de_122_022, tbl_merchant_taxJar_clientId),
				tbl_merchant_taxJar_token = COALESCE(de_122_023, tbl_merchant_taxJar_token),
                tbl_user_modifiedBy = COALESCE(de_127_057,tbl_user_modifiedBy)
				where tbl_merchant_nmcId = de_53;
                
                
                update tbl_company set
				tbl_company_name = COALESCE(de_114_070, tbl_company_name),
				tbl_company_taxId = COALESCE(de_123_071, tbl_company_taxId),
				tbl_company_logo = COALESCE(de_121_170, tbl_company_logo),
				tbl_company_website = COALESCE(de_114_75, tbl_company_website),
				tbl_company_terms = COALESCE(convert(unhex(de_119_015) using utf8), tbl_company_terms),
				tbl_company_policy = COALESCE(convert(unhex(de_119_016) using utf8), tbl_company_policy),
				tbl_company_type_id = COALESCE(de_127_070, tbl_company_type_id)
				where tbl_company_id = de_114_001;
					
			else 
			
				IF USER_TYPE_AUX = 3 THEN
				
					update dbuser.tbl_user set 
					tbl_agent_type_id = 74001
					where tbl_user_id = de_53;
				
					update dbuser.tbl_reseller set
					tbl_reseller_taxNumber = COALESCE(de_123_071,tbl_reseller_taxNumber),
					tbl_reseller_clientsNumber = COALESCE(de_122_106, tbl_reseller_clientsNumber)
					where tbl_user_id = de_53;
				
                
				end if;
			
			end if;
			
             if length(de_114_012)>0 then
             
				if de_114_115 is null then

					insert into tbl_address set 
					tbl_company_id = de_114_001,
					tbl_address_nmcId = de_53,
					tbl_addresstype_id = 11,
					tbl_address_first = de_114_012,
					tbl_address_second = de_114_013,
					tbl_address_phoneNumber = NULL,
					tbl_zipcode_id = de_122_107,
					tbl_city_id = de_114_014,
					tbl_state_id = de_120_013,
					tbl_country_id = de_122_087;

					SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);
					
					if length(LOCATIONID_AUX) > 0 then

						INSERT tbl_locationaddress SET
						tbl_location_id = LOCATIONID_AUX, 
						tbl_address_id = ADDRESSID_AUX;

					end if;
					
					
					insert into dbuser.tbl_crm_activity set
					tbl_editor_id = de_127_057,
					tbl_user_id = de_53,
					tbl_activity_field = 'Address line 1',
					tbl_activity_value_new = de_114_012,
					tbl_activity_date = NOW();
				
					if length(de_114_013) > 0 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_127_057,
						tbl_user_id = de_53,
						tbl_activity_field = 'Address line 2',
						tbl_activity_value_new = de_114_013,
						tbl_activity_date = NOW();
					end if;
					
					
				else
				
					if length(de_114_012) > 0 then
						if (select tbl_address_first from tbl_address where tbl_address_id = de_114_115) != de_114_012 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Address line 1',
							tbl_activity_value_old = (select tbl_address_first from tbl_address where tbl_address_id = de_114_115),
							tbl_activity_value_new = de_114_012,
							tbl_activity_date = NOW();
						end if;
					end if;
					
					if length(de_114_013) > 0 then
						if (select tbl_address_second from tbl_address where tbl_address_id = de_114_115) != de_114_013 then
							insert into dbuser.tbl_crm_activity set
							tbl_editor_id = de_127_057,
							tbl_user_id = de_53,
							tbl_activity_field = 'Address line 2',
							tbl_activity_value_old = (select tbl_address_second from tbl_address where tbl_address_id = de_114_115),
							tbl_activity_value_new = de_114_013,
							tbl_activity_date = NOW();
						end if;
					end if;
				
					update tbl_address set 
					tbl_addresstype_id = 11,
					tbl_address_first = coalesce(de_114_012,tbl_address_first),
					tbl_address_second = coalesce(de_114_013,tbl_address_second),
					tbl_zipcode_id =coalesce(de_122_107,tbl_zipcode_id),
					tbl_city_id = coalesce(de_114_014,tbl_city_id),
					tbl_state_id = coalesce(de_120_013,tbl_state_id),
					tbl_country_id = coalesce(de_122_087,tbl_country_id)
					where tbl_address_id = de_114_115;
				
				end if;
			end if;
            
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

			end if;
		end if;
    end if;

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	 SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',dbuser.GetNMCId(de_53),'"}')) AS JSON;

DROP TABLE TBL_MESSAGE;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `EditUserStatus020400574` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `EditUserStatus020400574`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  	   
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	
    
	update tbl_user set
    tbl_userstatus_id = 37,
	tbl_user_userTemp_f = 1,
    tbl_user_firstlogin_f = 1,
	tbl_user_dateModified = NOW()
	where tbl_user_id = de_053;
		
	

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
        
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAddressCountByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetAddressCountByConsumerIdMobile`(PARAM VARCHAR(20000))
BEGIN 











	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI        INT(11)        DEFAULT 1;  
	DECLARE FIN        INT(11)        DEFAULT 0;  

	DECLARE de_053 INT(18) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  
		select 
			CONCAT('"114.121":"',W.Counter,'"') as JSON
		from 
			(select count(B.tbl_address_id) as Counter
			from tbl_consumer A, 
				 tbl_address B
			where A.tbl_consumer_nmcId = B.tbl_address_nmcId
			and A.tbl_consumer_nmcId = de_053) as W

	LIMIT INI,FIN;   

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAddressesByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetAddressesByConsumerIdMobile`(PARAM VARCHAR(20000))
BEGIN 











	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	DECLARE de_053 INTEGER(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  
	


	
SELECT 
     
          GROUP_CONCAT(
				CONCAT('{"114.115":"',if(tbl_address_id  is null,'',tbl_address_id ),'"'),
				CONCAT(',"114.53":"',if(tbl_address_name  is null,'',tbl_address_name ),'"'),
				CONCAT(',"114.12":"',if(tbl_address_first  is null,'',tbl_address_first ),'"'),
				CONCAT(',"114.13":"',if(tbl_address_second  is null,'',tbl_address_second ),'"'),
				CONCAT(',"114.9":"',if(tbl_address_flag  is null,0,tbl_address_flag ),'"}')
             ) as JSON
	from tbl_address 
	where tbl_address_nmcId = de_053

	LIMIT INI,FIN;   

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAddressesTypesMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetAddressesTypesMobile`(PARAM VARCHAR(20000))
BEGIN 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
		 CONCAT(
			  GROUP_CONCAT(
			    CONCAT('{"121.45":"',A.tbl_addresstype_id ,'"'),
				CONCAT(',"114.13":"',if(A.tbl_addresstype_name is null,'',A.tbl_addresstype_name ),'"}')
				)
			)  as JSON
	from tbl_addresstype A
		
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetAdminProfileByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetAdminProfileByIdPortal`(PARAM VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_179       INT(11)       DEFAULT 0;  
	DECLARE LIST_PHONE_AUX VARCHAR(3000) DEFAULT NULL; 
	DECLARE LIST_PHONE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 


	DROP TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    


	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		
	SET group_concat_max_len=150000;
	
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	





	SET LIST_PHONE_EMPTY_AUX = (SELECT  CONCAT(',"300.28":[]') AS JSON);
	IF (SELECT A.tbl_phone_nmcId 
		FROM tbl_phone as A, tbl_user as B, tbl_admin as C
		WHERE B.tbl_user_id = de_114_179
			AND B.tbl_user_id = C.tbl_admin_nmcId
			AND C.tbl_admin_nmcId = A.tbl_phone_nmcId LIMIT 1) IS NULL THEN												
		SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
	ELSE
								
		SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
								CONCAT('{"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
								CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
								CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
								CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"'),
								CONCAT(',"114.179":"',COALESCE(A.tbl_phone_nmcId,''),'"}')
								),"]") 
							AS JSON 
							FROM tbl_phone AS A, tbl_user AS B, tbl_admin AS C
							WHERE B.tbl_user_id = de_114_179
								AND B.tbl_user_id = C.tbl_admin_nmcId
								AND C.tbl_admin_nmcId = A.tbl_phone_nmcId);
	END IF;


	SELECT 
		  GROUP_CONCAT(   
				CONCAT('{"114.179":"',tbl_user_id,'"'),
				CONCAT(',"114.123":"',tbl_userType_id,'"'),
				CONCAT(',"114.9":"',tbl_user_userTemp_f,'"'),
				CONCAT(LIST_PHONE_AUX),
				CONCAT(',"114.7":"',COALESCE(tbl_user_email,''),'"'),
				CONCAT(',"114.3":"',COALESCE(tbl_user_first,''),'"'),
				CONCAT(',"114.5":"',COALESCE(tbl_user_last,''),'"'),
				CONCAT(',"114.91":"',COALESCE(tbl_user_title,''),'"}')
		  ) AS JSON
	FROM tbl_user 
	WHERE tbl_user_id = de_114_179
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetBussinessDetailsMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetBussinessDetailsMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_179 INT(11) DEFAULT NULL;   

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');


	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




		SELECT 
			GROUP_CONCAT(           
				CONCAT('"114.179":"', A.tbl_merchant_nmcId,'"'),
				CONCAT(',"114.13":"', if (B.tbl_user_companyName is null,'', B.tbl_user_companyName),'"'),
				
				CONCAT(',"114.12":"', if ((select C.tbl_address_first from tbl_merchant as A, tbl_address as C where A.tbl_merchant_nmcId = de_114_179 and A.tbl_merchant_nmcId = C.tbl_address_nmcId limit 1) is null,'',
										  (select C.tbl_address_first from tbl_merchant as A, tbl_address as C where A.tbl_merchant_nmcId = de_114_179 and A.tbl_merchant_nmcId = C.tbl_address_nmcId limit 1)),'"'),

				CONCAT(',"97":"', if ((select D.tbl_phone_phoneNumber from tbl_merchant as A, tbl_phone as D where A.tbl_merchant_nmcId = de_114_179 and A.tbl_merchant_nmcId = D.tbl_phone_nmcId and D.tbl_phonetype_id = 4005 limit 1) is null,'', 
									  (select D.tbl_phone_phoneNumber from tbl_merchant as A, tbl_phone as D where A.tbl_merchant_nmcId = de_114_179 and A.tbl_merchant_nmcId = D.tbl_phone_nmcId and D.tbl_phonetype_id = 4005 limit 1)),'"'),
				
				CONCAT(',"120.148":"', if ((select E.tbl_merchantwebsite_website from tbl_merchant as A, tbl_merchantwebsite as E where A.tbl_merchant_nmcId = de_114_179 and A.tbl_merchant_nmcId = E.tbl_merchant_nmcId limit 1) is null,'', 
										   (select E.tbl_merchantwebsite_website from tbl_merchant as A, tbl_merchantwebsite as E where A.tbl_merchant_nmcId = de_114_179 and A.tbl_merchant_nmcId = E.tbl_merchant_nmcId limit 1)),'"'),
				
				CONCAT(',"121.170":"', if (A.tbl_merchant_logoimage is null,'', A.tbl_merchant_logoimage),'"')
			) as JSON
		
		from tbl_merchant as A,
			 tbl_user as B

		where A.tbl_merchant_nmcId = de_114_179
		and A.tbl_user_id = B.tbl_user_id
		
		
		
		LIMIT INI,FIN;


    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCitiesByStateMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetCitiesByStateMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_120_064 INTEGER(11) DEFAULT 0; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_120_064 = (select DATA from TBL_MESSAGE1 where CODE = '120.64');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	 SELECT
		  CONCAT(
			GROUP_CONCAT(
				CONCAT('{"114.14":"',A.tbl_city_id,'"'),
				CONCAT(',"47.15":"',if(A.tbl_city_name is null,'',A.tbl_city_name),'"}')
			)
        )  as JSON
	from tbl_city as A, tbl_state as B
	where A.tbl_state_id = de_120_064 
	and A.tbl_state_id = B.tbl_state_id

	LIMIT INI,FIN;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCityByStateIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetCityByStateIdPortal`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_120_013 INTEGER(11) DEFAULT 0; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_120_013 = (select DATA from TBL_MESSAGE1 where CODE = '120.13');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  	SELECT 
   
          GROUP_CONCAT(
            CONCAT('{"114.14":"',A.tbl_city_id,'"'),
			CONCAT(',"47.15":"',if(A.tbl_city_name is null,'',A.tbl_city_name),'"}')
			)
        as JSON
	from tbl_city as A, tbl_state as B
	where  A.tbl_state_id = B.tbl_state_id
	and B.tbl_state_id = de_120_013
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetConsumerAddressByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetConsumerAddressByIdPortal`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_115 INT(11) DEFAULT NULL;   
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		
	SET group_concat_max_len = 150000;
	
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_114_115 = (select DATA from TBL_MESSAGE1 where CODE = '114.115');





	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
		GROUP_CONCAT(
			CONCAT('"114.115":"',A.tbl_address_nmcId,'"'),
			CONCAT(',"121.47":"',if(A.tbl_address_flag is null,'',A.tbl_address_flag),'"'),
			CONCAT(',"47.18":"' ,if(A.tbl_country_id is null,'',A.tbl_country_id),'"'),
			CONCAT(',"114.12":"',if(A.tbl_address_first is null,'',A.tbl_address_first),'"'),
			CONCAT(',"114.13":"',if(A.tbl_address_second is null,'',A.tbl_address_second),'"'),
			CONCAT(',"121.45":"',if(B.tbl_addresstype_name is null,'',B.tbl_addresstype_name),'"'),
			CONCAT(',"47.16":"' ,if(A.tbl_state_id is null,'',A.tbl_state_id),'"'),
			CONCAT(',"47.15":"' ,if(A.tbl_city_id is null,'',A.tbl_city_id),'"'),
			CONCAT(',"47.17":"' ,if(A.tbl_zipcode_id is null,'',A.tbl_zipcode_id),'"'),
			CONCAT(',"48.28":"' ,if(A.tbl_address_phoneNumber is null,'',A.tbl_address_phoneNumber),'"'),
			CONCAT(',"114.3":"' ,if(C.tbl_user_last is null,'',C.tbl_user_last),'"'),
			CONCAT(',"114.5":"' ,if(C.tbl_user_first is null,'',C.tbl_user_first),'"')
		)  as JSON

	from tbl_address as A,
		 tbl_addresstype as B,
		 tbl_user as C
		
    where A.tbl_address_id = de_114_115 
    and A.tbl_addresstype_id = B.tbl_addresstype_id 
	and A.tbl_address_nmcId = C.tbl_user_id
	
	LIMIT INI, FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetConsumerAddressPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetConsumerAddressPortal`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_179 INT(11) DEFAULT NULL;   

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		
	SET group_concat_max_len=150000;
	
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');





	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




		SELECT 
			GROUP_CONCAT(
			    CONCAT('{"114.179":"',A.tbl_address_nmcId,'"'),
				CONCAT(',"114.115":"',A.tbl_address_id ,'"'),
				CONCAT(',"121.45":"',if(B.tbl_addresstype_name is null,'',B.tbl_addresstype_name),'"'),
				CONCAT(',"114.12":"',if(A.tbl_address_first is null,'',A.tbl_address_first),'"'),
				CONCAT(',"121.47":"',if(A.tbl_address_flag is null,'',A.tbl_address_flag),'"}')
			)  as JSON

		from tbl_address as A,
			 tbl_addresstype as B
		

		where A.tbl_addresstype_id = B.tbl_addresstype_id
		and A.tbl_address_nmcId = de_114_179
		order by B.tbl_addresstype_name, A.tbl_address_flag DESC
		LIMIT INI, FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCountriesMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetCountriesMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

 DECLARE INI       INT(11)       DEFAULT 1;  
 DECLARE FIN       INT(11)       DEFAULT 0;  
 

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));

	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
 



 SET group_concat_max_len=150000;

 SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');




 
 IF (length(INI) > 0) then 
  SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 ELSE
  set INI = 0;
 END IF;
  
 IF (length(FIN) > 0) then 
  SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
 ELSE
  set FIN = 999999999;
 END IF;
 




  	SELECT 
     CONCAT(
          GROUP_CONCAT(
            CONCAT('{"47.18":"',if(tbl_country_name  is null,'',tbl_country_name ),'"'),
			CONCAT(',"114.17":"',if(tbl_country_id  is null,'',tbl_country_id ),'"}')
			)
        )  as JSON
	from tbl_country
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCountryByZipcodePortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetCountryByZipcodePortal`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_047_017 VARCHAR(45) DEFAULT 0; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_047_017 = (select DATA from TBL_MESSAGE1 where CODE = '47.17');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




   SELECT 
     CONCAT(
          GROUP_CONCAT(
            CONCAT('{"122.87":"',D.tbl_country_id,'"'),
			CONCAT(',"120.13":"',C.tbl_state_id,'"'),
			CONCAT(',"114.14":"',B.tbl_city_id,'"'),
			CONCAT(',"47.18":"',if(D.tbl_country_name  is null,'',D.tbl_country_name ),'"'),
			CONCAT(',"47.16":"',if(C.tbl_state_name  is null,'',C.tbl_state_name ),'"'),
			CONCAT(',"47.15":"',if(B.tbl_city_name  is null,'',B.tbl_city_name ),'"}')
			)
        )  as JSON
	from tbl_zipcode as A, tbl_city as B, tbl_state as C, tbl_country as D
	where A.tbl_zipcode_name = de_047_017
	and A.tbl_city_id = B.tbl_city_id
	and B.tbl_state_id = C.tbl_state_id
	and C.tbl_country_id = D.tbl_country_id
	LIMIT INI,FIN;
	
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCountryListPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetCountryListPortal`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
	 SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT 
			  CONCAT('{"122.87":"233","114.17":"US","120.129":"1","47.18":"United States"},',
			  GROUP_CONCAT(
				CONCAT('{"122.87":"',tbl_country_id ,'"'),
				CONCAT(',"114.17":"',tbl_country_code ,'"'),
				CONCAT(',"120.129":"',if(tbl_country_indicative is null,'',tbl_country_indicative) ,'"'),
				CONCAT(',"47.18":"',if(tbl_country_name  is null,'',tbl_country_name ) ,'"}')
				
			))  as JSON
	from tbl_country
	LIMIT INI, FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetCreditCardCountByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetCreditCardCountByConsumerIdMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_053 INT(18) DEFAULT 0 ; 
	



		
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
        GROUP_CONCAT(           
			CONCAT('"114.121":"', B.Counter,'"')
        ) as JSON
	
	from 
			(select count(*) as Counter
			from tbl_cardsconsumer 
			where tbl_cardsconsumer_nmcId = de_053) as B
		LIMIT INI,FIN;


    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetDataElementsPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetDataElementsPortal`()
BEGIN 













	



  	SELECT 
     CONCAT('[',
          GROUP_CONCAT(
            CONCAT('{"1":"',MTI,'"'),
			CONCAT(',"2":"',MTI_description,'"'),
			CONCAT(',"3":"',MTI_format,'"'),
			CONCAT(',"4":"',MTI_type,'"'),
			CONCAT(',"5":"',MTI_lenght,'"'),
			CONCAT(',"6":"',MTI_format_java,'"'),
			CONCAT(',"7":"',MTI_format_rex,'"'),
			CONCAT(',"8":"',MTI_mandatory,'"}')
			),']'
        )  as JSON
	from tbl_data_elements A;
	
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetExistingUsers010400292` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetExistingUsers010400292`(PARAM VARCHAR(20000))
BEGIN 



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;  
	DECLARE FIN       BIGINT       DEFAULT 0;  

	DECLARE de_055 INT(5) DEFAULT NULL; 				
	DECLARE de_056 VARCHAR(5) DEFAULT NULL; 			
	DECLARE de_127_010 INT(5) DEFAULT NULL; 			
	DECLARE de_114_150 VARCHAR(20) DEFAULT NULL; 		
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 		
	DECLARE de_114_138 DATE DEFAULT NULL; 				
	DECLARE de_114_139 DATE DEFAULT NULL; 				
	
	DECLARE de_122_087 INT(11) DEFAULT NULL;			
	DECLARE de_120_013 INT(11) DEFAULT NULL;			
	DECLARE de_114_014 INT(11) DEFAULT NULL;			
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 			
	DECLARE de_114_003 VARCHAR(5) DEFAULT NULL; 		
	DECLARE de_114_143 VARCHAR(11) DEFAULT NULL; 		
	DECLARE de_127_087 VARCHAR(5) DEFAULT NULL; 		
	
	DECLARE de_48_28 VARCHAR(40) DEFAULT NULL;			
	
	DECLARE QUERY_AUX TEXT;

	DECLARE JSON TEXT;



 
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_055 = (select DATA from TBL_MESSAGE1 where CODE = '55'); 
	SET de_056 = (select DATA from TBL_MESSAGE1 where CODE = '56'); 
	SET de_127_010 = (select DATA from TBL_MESSAGE1 where CODE = '127.10'); 
	
	SET de_114_150 = (select DATA from TBL_MESSAGE1 where CODE = '114.150'); 
	SET de_114_150 = (select right(de_114_150,11)); 
	
	SET de_114_138 = (select DATA from TBL_MESSAGE1 where CODE = '114.138'); 
	SET de_114_139 = (select DATA from TBL_MESSAGE1 where CODE = '114.139'); 
	
	SET de_122_087 = (select DATA from TBL_MESSAGE1 where CODE = '122.87'); 
	SET de_120_013 = (select DATA from TBL_MESSAGE1 where CODE = '120.13'); 
	SET de_114_014 = (select DATA from TBL_MESSAGE1 where CODE = '114.14'); 
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53'); 
	SET de_053 = (select right(de_053,11)); 
	
	SET de_114_003 = (select DATA from TBL_MESSAGE1 where CODE = '114.3'); 
	SET de_114_143 = (select DATA from TBL_MESSAGE1 where CODE = '114.143'); 
	SET de_127_087 = (select DATA from TBL_MESSAGE1 where CODE = '127.87');
	SET de_114_007 = (select DATA from TBL_MESSAGE1 where CODE = '114.7');	
	
	
	SET de_48_28 = (select DATA from TBL_MESSAGE1 where CODE = '48.28');	
	
	

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;



set  QUERY_AUX = (

		SELECT 
				GROUP_CONCAT(  
				CONCAT('{"53":"',(select dbuser.getNMCID(W.tbl_user_id)),'"'),
				CONCAT(',"114.70":"',W.tbl_user_companyName,'"'),
				CONCAT(',"114.3":"',W.tbl_user_first,'"'),
				CONCAT(',"114.4":"',W.tbl_user_middle,'"'),						
				CONCAT(',"114.5":"',W.tbl_user_last,'"'),
				CONCAT(',"114.143":"',W.tbl_userstatus_id,'"'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(W.tbl_user_id),']'),
				CONCAT(',"114.7":"',W.tbl_user_email,'"'),						
				CONCAT(',"127.66":"',W.tbl_user_information,'"'),
				CONCAT(',"114.11":"',W.tbl_gender_type,'"'),						
				CONCAT(',"114.91":"',W.tbl_user_title,'"}')
				)as JSON
			   
				from 
				
				(
				SELECT distinct

					tbl_user.tbl_user_id,
					coalesce(tbl_user.tbl_user_companyName,'') as tbl_user_companyName,
					coalesce(tbl_user.tbl_user_first,'') as tbl_user_first,
					coalesce(tbl_user.tbl_user_middle,'') as tbl_user_middle,
					coalesce(tbl_user.tbl_user_last,'') as tbl_user_last ,
					tbl_user.tbl_userstatus_id,
					tbl_user.tbl_user_email,
					coalesce(tbl_user.tbl_user_information,'') as tbl_user_information,
					coalesce(tbl_user.tbl_gender_type,'')as tbl_gender_type,
					coalesce(tbl_user.tbl_user_title,'') as tbl_user_title
					
					
					FROM tbl_user 
					LEFT JOIN tbl_address ON tbl_address.tbl_address_nmcId = tbl_user.tbl_user_id
					LEFT JOIN tbl_help_ticket ON tbl_help_ticket.tbl_help_ticket_sender = tbl_user.tbl_user_id
					LEFT JOIN dbuser.tbl_phone ON tbl_phone.tbl_phone_nmcId = tbl_user.tbl_user_id
					where  tbl_user.tbl_user_id
					
					and if(length(de_114_138)>0 , 
					date_format(tbl_user.tbl_user_dateAdded, '%Y-%m-%d') >=  str_to_date(de_114_138, '%Y-%m-%d'),
					tbl_user.tbl_user_id)
					
					and if(length(de_114_139)>0 , 
					date_format(tbl_user.tbl_user_dateAdded, '%Y-%m-%d') <= str_to_date(de_114_139, '%Y-%m-%d'),
					tbl_user.tbl_user_id)

					and if(length(de_055)>0 , 
					(select left(tbl_user.tbl_user_entity,1)) = (select left(de_055,1)),
					tbl_user.tbl_user_id)
					
					and if(length(de_114_007)>0 , 
					tbl_user.tbl_user_email = de_114_007,
					tbl_user.tbl_user_id)
					
					and if(length(de_056)>0 , 
					tbl_user.tbl_user_class = de_056,
					tbl_user.tbl_user_id)
					
					and if(length(de_48_28)>0 , 
					tbl_phone.tbl_phone_phoneNumber = de_48_28 and tbl_phonetype_id = 4003,
					tbl_user.tbl_user_id)
					
					and if(length(de_122_087)>0 , 
					tbl_address.tbl_country_id = de_122_087,
					tbl_user.tbl_user_id)
					
					and if(length(de_120_013)>0 , 
					tbl_address.tbl_state_id = de_120_013,
					tbl_user.tbl_user_id)
					
					and if(length(de_114_014)>0 , 
					tbl_address.tbl_city_id = de_114_014,
					tbl_user.tbl_user_id)
					
					and if(length(de_053)>0 , 
					tbl_user.tbl_user_id >= de_053,
					tbl_user.tbl_user_id)
					
					and if(length(de_114_003)>0 , 
					UPPER(tbl_user.tbl_user_first) like CONCAT(UPPER(de_114_003),"%"),
					tbl_user.tbl_user_id)
				
					and if(de_127_087 = 'true' , 
					(tbl_help_ticket.tbl_help_ticket_type = 91 or 
					tbl_help_ticket.tbl_help_ticket_type = 93 or 
					tbl_help_ticket.tbl_help_ticket_type = 97 
					),
					tbl_user.tbl_user_id)
				
					LIMIT INI,FIN
				) AS W);
						
		

		set JSON = QUERY_AUX;
		IF JSON is NULL THEN
			SET JSON = '{}';
		END IF;
		
		SELECT JSON;
			
	DROP TABLE TBL_MESSAGE1;
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetFavoriteMerchantCountMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetFavoriteMerchantCountMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_053      INT(18)       DEFAULT 0;  

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	select 
		CONCAT('"114.121":"',W.Counter,'"') as JSON
	from
		(select count(M.tbl_merchant_nmcId) as Counter
		from tbl_merchantfav M
		where M.tbl_merchant_nmcId = de_053) as W	
		
	LIMIT INI,FIN;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetFavoriteMerchantCountMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetFavoriteMerchantCountMobile_1`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_053      INT(18)       DEFAULT 0;  

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	select 
		CONCAT('"114.121":"',W.Counter,'"') as JSON
	from
		(select count(tbl_merchant_nmcId) as Counter
		from tbl_merchantfav where tbl_consumer_nmcId= de_053) as W	
	LIMIT INI,FIN;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetFavoriteMerchantsMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetFavoriteMerchantsMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

 DECLARE INI     		  INT(11)       DEFAULT 1;  
 DECLARE FIN      		  INT(11)       DEFAULT 0;  



    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
 



 SET group_concat_max_len=150000;

 SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');




 
 IF (length(INI) > 0) then 
  SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 ELSE
  set INI = 0;
 END IF;
  
 IF (length(FIN) > 0) then 
  SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
 ELSE
  set FIN = 999999999;
 END IF;
 




		SELECT 
			GROUP_CONCAT(
				   CONCAT('{"114.179":"',A.tbl_merchant_id,'"'),
				   CONCAT(',"121.170":"',A.tbl_merchant_logoimage,'"'),
				   CONCAT(',"114.70":"',if (B.tbl_user_companyName is null,'', B.tbl_user_companyName),'"}')
			)as JSON
		from tbl_merchant A,
			 tbl_user B,
			 tbl_merchantfav C
		where A.tbl_merchant_nmcId = C.tbl_merchant_nmcId
		and A.tbl_user_id = B.tbl_user_id
		LIMIT INI,FIN;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetFavoriteMerchantsMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetFavoriteMerchantsMobile_1`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

 DECLARE INI     		  INT(11)       DEFAULT 1;  
 DECLARE FIN      		  INT(11)       DEFAULT 0;  
 DECLARE de_053      INT(18)       DEFAULT 0;  



    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
 



 SET group_concat_max_len=150000;

 SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');



 
 IF (length(INI) > 0) then 
  SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 ELSE
  set INI = 0;
 END IF;
  
 IF (length(FIN) > 0) then 
  SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
 ELSE
  set FIN = 999999999;
 END IF;
 




		SELECT 
			GROUP_CONCAT(
				   CONCAT('{"114.179":"',A.tbl_merchant_id,'"'),
				   CONCAT(',"121.170":"',A.tbl_merchant_logoimage,'"'),
				   CONCAT(',"114.70":"',if (B.tbl_user_companyName is null,'', B.tbl_user_companyName),'"}')
			)as JSON
		from tbl_merchant A,
			 tbl_user B,
			 tbl_merchantfav C
		where A.tbl_merchant_nmcId = C.tbl_merchant_nmcId
		and A.tbl_user_id = B.tbl_user_id
		and C.tbl_consumer_nmcId = de_053
		LIMIT INI,FIN;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetGuideContentMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetGuideContentMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_121_194 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_121_194 = (select DATA from TBL_MESSAGE1 where CODE = '121.194');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
        GROUP_CONCAT(     
			CONCAT('{"120.157":"',if(A.tbl_help_guide_description is null,'', A.tbl_help_guide_description) ,'"'),
			CONCAT(',"120.83":"',if(A.tbl_help_guide_title is null,'',A.tbl_help_guide_title ),'"}')	
        ) as JSON

	from tbl_help_guide as A
	where A.tbl_help_guide_id = de_121_194

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetHardwareQtyByLocation010400440` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetHardwareQtyByLocation010400440`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: GetHardwareQtyByLocation010400440
-- Method: 010400440
-- Version: 1.0
-- Last modified: 2016-01-13
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;   -- START LIMIT
	DECLARE FIN       BIGINT	   DEFAULT 0;   -- END LIMIT

	DECLARE de_114_047  INT(11) DEFAULT 0;	
	
    DECLARE USERID_AUX  INT(11) DEFAULT NULL;
    
-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET  group_concat_max_len = 1000000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1);
	
	SET de_114_047 = (select DATA from TBL_MESSAGE1 where CODE = '114.47');

-- -------------		
-- Limits     --
-- -------------

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;

-- ---------------		
-- Query of DB  --
-- ---------------

	set USERID_AUX = (select tbl_location_userId from tbl_location where tbl_location_id = de_114_047);

	if (select tbl_location_hardware_id from tbl_location_hardware where tbl_location_id = de_114_047 limit 1) is null then 

		INSERT INTO tbl_location_hardware (
		tbl_user_id,
		tbl_location_id,
		tbl_hardware_type_id,
		tbl_location_hardware_qty,
		tbl_location_hardware_shipped,
		tbl_shipping_status_id) 
		values (USERID_AUX,de_114_047,75001,0,0,73001),
			   (USERID_AUX,de_114_047,75002,0,0,73001),
			   (USERID_AUX,de_114_047,75003,0,0,73001),
			   (USERID_AUX,de_114_047,75004,0,0,73001),
			   (USERID_AUX,de_114_047,75005,0,0,73001),
			   (USERID_AUX,de_114_047,75006,0,0,73001);

	end if;

	select 
	GROUP_CONCAT(
	CONCAT('{"121.21":"',W.tbl_location_hardware_id,'"'), 
	CONCAT(',"127.88":"',W.tbl_hardware_type_id,'"'), 
	CONCAT(',"121.22":"',W.tbl_location_hardware_qty,'"'), 
	CONCAT(',"120.84":"',W.tbl_hardware_type_price,'"'), 
	CONCAT(',"114.9":"',if(W.tbl_hardware_type_status_f = 1, 'true','false'),'"}')
	)  as JSON

	from 
	
		(
		select
		A.tbl_location_hardware_id,
		A.tbl_hardware_type_id,
		A.tbl_location_hardware_qty,
		B.tbl_hardware_type_price,
		B.tbl_hardware_type_status_f
		from tbl_location_hardware as A 
		left join tbl_hardware_type as B on A.tbl_hardware_type_id = B.tbl_hardware_type_id 
		where tbl_location_id = de_114_047
		limit INI,FIN ) as W;

		
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetHelpFaqCountMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetHelpFaqCountMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	






	SELECT 
        GROUP_CONCAT(     
			CONCAT('"114.121":"', W.Counter,'"')
        ) as JSON

	from 
	
		(select count(*) as Counter 
		from tbl_help_faq as A
		where 
		(		
				UPPER(A.tbl_help_faq_question) like CONCAT("%",UPPER(de_114_127),"%")
			or 	UPPER(A.tbl_help_faq_answer) like CONCAT("%",UPPER(de_114_127),"%")
		)) as W

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetHelpGuideCountMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetHelpGuideCountMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	






	SELECT 
        GROUP_CONCAT(     
			CONCAT('"114.121":"', W.Counter,'"')
        ) as JSON

	from 
	
		(select count(*) as Counter 
		from tbl_help_guide as A
		where 
		(		UPPER(A.tbl_help_guide_title) like CONCAT("%",UPPER(de_114_127),"%")
			or  UPPER(A.tbl_help_guide_description) like CONCAT("%",UPPER(de_114_127),"%")
		)) as W

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetHelpTutorialCountMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetHelpTutorialCountMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	






	SELECT 
        GROUP_CONCAT(     
			CONCAT('"114.121":"', W.Counter,'"')
        ) as JSON

	from 
	
		(select count(*) as Counter 
		from tbl_help_tutorial_steps as A
		where 
		(		UPPER(A.tbl_help_tutorial_steps_tutorial_title) like CONCAT("%",UPPER(de_114_127),"%")
			or  UPPER(A.tbl_help_tutorial_steps_step_title) like CONCAT("%",UPPER(de_114_127),"%")
			or  UPPER(A.tbl_help_tutorial_steps_step_description) like CONCAT("%",UPPER(de_114_127),"%")
		)) as W

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetHelpVideoCountMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetHelpVideoCountMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	






	SELECT 
        GROUP_CONCAT(     
			CONCAT('"114.121":"', W.Counter,'"')
        ) as JSON

	from 
	
		(select count(*) as Counter 
		from tbl_help_video as A
		where 
		(		
			UPPER(A.tbl_help_video_title) like CONCAT("%",UPPER(de_114_127),"%")
		)) as W

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetInactiveTerminal010400418` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetInactiveTerminal010400418`(PARAM VARCHAR(20000))
BEGIN 

-- -------------------------	
-- Declare Data Elements --
-- -------------------------
	
	DECLARE de_053 VARCHAR(20) DEFAULT 0 ; 

-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE JSON TEXT;
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables --
-- -----------------
	SET group_concat_max_len = 1000000;
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	SET de_053 =(select right(de_053,11));
    
-- ---------------		
-- Query of DB --
-- ---------------	

	if (select tbl_help_ticket_sender 
		from dbuser.tbl_help_ticket 
        where tbl_help_ticket_sender = 1
        and tbl_help_ticket_receiver = de_053
        and tbl_help_ticket_type = 98
        and DATE(tbl_help_ticket_date) = DATE(NOW())
        limit 1) is null then

		insert into dbuser.tbl_help_ticket(
											tbl_help_ticket_sender,
											tbl_help_ticket_receiver,
											tbl_help_ticket_type,
											tbl_help_ticket_status,
											tbl_help_ticket_subject,
											tbl_help_ticket_content,
											tbl_help_ticket_date,
											tbl_help_ticket_read_flag
											)
			select  
			1,
			de_053,
			98,
			1501,
			CONCAT(A.tbl_terminal_reference, ' Disconnected'),
            CONCAT('Your TV Player ', A.tbl_terminal_reference, ' is not connected'),
			-- CONCAT('Disconnected since ', DATE_FORMAT(A.tbl_terminal_lastDateActive,'%b %d %Y %h:%i %p')),
			NOW(),
			0
			
			from dbuser.tbl_terminal as A 
			left join tbl_location as B on A.tbl_location_id = B.tbl_location_id 
			where B.tbl_location_userId = de_053
			and (A.tbl_terminal_lastDateActive is null or A.tbl_terminal_lastDateActive < DATE_SUB(NOW(), INTERVAL 1 DAY));
		
	end if;
		

	
	SET JSON = '{}';
	
	SELECT JSON;
		
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetLanguageSelectedMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetLanguageSelectedMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
 	DECLARE de_053      VARCHAR(40)       DEFAULT 0;  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT 
		GROUP_CONCAT(
				CONCAT('"122.94":"',L.tbl_language_cod,'"')
						)  as JSON 

	from tbl_languagescreenlock LS, tbl_language L
	where L.tbl_language_id = LS.tbl_language_idApp
	and LS.tbl_consumer_nmcId = de_053

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetLanguagesMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetLanguagesMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
 	DECLARE de_053      VARCHAR(40)       DEFAULT 0;  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT 
		GROUP_CONCAT(
				CONCAT('{"122.94":"',L.tbl_language_name,'"'),
				CONCAT(',"122.45":"',L.tbl_language_id,'"'),
				CONCAT(',"114.9":"',if( LS.tbl_consumer_nmcId = de_053,1,0),'"}')
						)  as JSON 

	from tbl_languagescreenlock LS right join tbl_language L on L.tbl_language_id = LS.tbl_language_idApp and LS.tbl_consumer_nmcId = de_053
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetLocationsByMerchantGPS010400516` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetLocationsByMerchantGPS010400516`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: GetLocationsByMerchantGPS010400516
-- Method: 010400516
-- Version: 1.0
-- Last modified: 2016-03-29
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 	   VARCHAR(20) DEFAULT NULL;    -- 53 User Id

	DECLARE de_120_038 VARCHAR(20) DEFAULT 0; 		-- 120.38 latitude
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0; 		-- 120.39 longitude
	
    
    SET  group_concat_max_len = 1000000;
    
-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_053 = (select right(de_053,11));
	
	SET de_120_038 = (select DATA from TBL_MESSAGE1 where CODE = '120.38');
	SET de_120_039 = (select DATA from TBL_MESSAGE1 where CODE = '120.39');

-- ---------------		
-- Query of DB  --
-- ---------------

	select dbuser.getNMCLocationRootDongleGPS(de_053, de_120_038, de_120_039) as JSON;

	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetLocationsByMerchantIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetLocationsByMerchantIdPortal`(PARAM VARCHAR(20000))
BEGIN 











	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI        INT(11)        DEFAULT 1;  
	DECLARE FIN        INT(11)        DEFAULT 0;  
	DECLARE de_114_179 INTEGER(11)    DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  
	



SELECT 
          GROUP_CONCAT(
				CONCAT('{"114.47":"',if(tbl_location.tbl_location_id  is null,'',tbl_location.tbl_location_id ),'"'),
				CONCAT(',"114.70":"',if(tbl_location.tbl_location_storeName  is null,'',tbl_location.tbl_location_storeName ),'"'),
				CONCAT(',"122.119":"',if(tbl_location.tbl_location_storeNumber  is null,'',tbl_location.tbl_location_storeNumber ),'"'),
				CONCAT(',"114.53":"',if(tbl_location.tbl_location_contactName  is null,'',tbl_location.tbl_location_contactName ),'"'),
				CONCAT(',"114.143":"',tbl_location.tbl_location_statusId,'"'),
                CONCAT(',"120.97":"',(SELECT COUNT(*) FROM tbl_terminal where tbl_location_id=tbl_location.tbl_location_id),'"'),
				CONCAT(',"114.7":"',if(tbl_location.tbl_location_contactEmail  is null,0,tbl_location.tbl_location_contactEmail ),'"'),
				CONCAT(',"300.51":{"114.115":"',tbl_address.tbl_address_id,'","114.179":"',tbl_address.tbl_address_nmcId,'","114.12":"',tbl_address.tbl_address_first,'","114.13":"',tbl_address.tbl_address_second,'","300.62":{"122.87":"',tbl_country.tbl_country_id,'","47.18":"',tbl_country.tbl_country_name,'","114.17":"',tbl_country.tbl_country_code,'"},','"114.13":"',tbl_address.tbl_address_second,'",','"300.64":{"120.13":"',tbl_state.tbl_state_id,'","47.16":"',tbl_state.tbl_state_name,'"},','"300.65":{"114.14":"',tbl_city.tbl_city_id,'","47.15":"',tbl_city.tbl_city_name,'"},','"300.66":{"122.107":"',tbl_zipcode.tbl_zipcode_id,'","47.17":"',tbl_zipcode.tbl_zipcode_name,'"}'),
				CONCAT(',"300.84":{"114.179":"',tbl_phone.tbl_phone_nmcId,'","48.28":"',tbl_phone.tbl_phone_phoneNumber,'","122.88":"',tbl_phone.tbl_phone_id,'","121.167":"',if(tbl_phone.tbl_phone_extension  is null,'',tbl_phone.tbl_phone_extension),'","122.87":"',if(tbl_phone.tbl_phone_country_id  is null,'',tbl_phone.tbl_phone_country_id),'"}}'),
				CONCAT(',"300.84":{"114.179":"',tbl_phone.tbl_phone_nmcId,'","48.28":"',tbl_phone.tbl_phone_phoneNumber,'","122.88":"',tbl_phone.tbl_phone_id,'","121.167":"',if(tbl_phone.tbl_phone_extension  is null,'',tbl_phone.tbl_phone_extension),'","122.87":"',if(tbl_phone.tbl_phone_country_id  is null,'',tbl_phone.tbl_phone_country_id),'"}'),
				CONCAT(',"114.179":"',if(tbl_location.tbl_location_userId  is null,0,tbl_location.tbl_location_userId),'"}')
             ) as JSON
			from tbl_location left join tbl_locationaddress on tbl_locationaddress.tbl_location_id=tbl_location.tbl_location_id
                      left join tbl_address ON  tbl_address.tbl_address_id = tbl_locationaddress.tbl_address_id
					  left join tbl_locationphone on tbl_locationphone.tbl_location_id=tbl_location.tbl_location_id
					  left join tbl_phone ON tbl_phone.tbl_phone_id = tbl_locationphone.tbl_phone_id
					  left join tbl_country ON tbl_country.tbl_country_id = tbl_address.tbl_country_id
					  left join tbl_city ON tbl_city.tbl_city_id = tbl_address.tbl_city_id 
					  left join tbl_state ON tbl_state.tbl_state_id = tbl_address.tbl_state_id
					  left join tbl_zipcode ON tbl_zipcode.tbl_zipcode_id = tbl_address.tbl_zipcode_id
	where tbl_location_userId = de_114_179

	LIMIT INI,FIN;   

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantAccountLocationByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantAccountLocationByIdPortal`(PARAM VARCHAR(20000))
BEGIN 











	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI        INT(11)        DEFAULT 1;  
	DECLARE FIN        INT(11)        DEFAULT 0;  
	DECLARE de_114_47 INTEGER(11)    DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;


	DROP TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_114_47 = (select DATA from TBL_MESSAGE1 where CODE = '114.47');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  
	



SELECT 
          GROUP_CONCAT(
				CONCAT('{"114.73":"',if(tbl_merchantaccount.tbl_merchantaccount_id  is null,'',tbl_merchantaccount.tbl_merchantaccount_id ),'"'),
				CONCAT(',"122.120":"',if(tbl_merchantaccount.tbl_merchantaccount_contactName  is null,'',tbl_merchantaccount.tbl_merchantaccount_contactName ),'"'),
				CONCAT(',"122.121":"',if(tbl_merchantaccount.tbl_merchantaccount_contacProvider  is null,'',tbl_merchantaccount.tbl_merchantaccount_contacProvider ),'"'),
			    CONCAT(',"114.47":"',de_114_47,'"'),
				CONCAT(',"300.84":{"114.179":"',tbl_phone.tbl_phone_nmcId,'","48.28":"',tbl_phone.tbl_phone_phoneNumber,'","122.88":"',tbl_phone.tbl_phone_id,'","121.167":"',if(tbl_phone.tbl_phone_extension  is null,'',tbl_phone.tbl_phone_extension),'","122.87":"',if(tbl_phone.tbl_phone_country_id  is null,'',tbl_phone.tbl_phone_country_id),'"}'),
				CONCAT(',"114.7":"',if(tbl_merchantaccount.tbl_merchantaccount_contactMail is null,0,tbl_merchantaccount.tbl_merchantaccount_contactMail),'"}')
             ) as JSON
	from tbl_locationmerchantaccount
			left join tbl_merchantaccount ON tbl_merchantaccount.tbl_merchantaccount_id = tbl_locationmerchantaccount.tbl_merchantaccount_id
			left join tbl_merchantaccountphone on tbl_merchantaccountphone.tbl_merchantaccount_id=tbl_merchantaccount.tbl_merchantaccount_id
			left join tbl_phone ON tbl_phone.tbl_phone_id = tbl_merchantaccountphone.tbl_phone_id
	where tbl_locationmerchantaccount.tbl_location_id = de_114_47

	LIMIT INI,FIN;   

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantCategoryTree` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantCategoryTree`(IN MSG_IN VARCHAR(20000))
BEGIN
	 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_179 INT(11) DEFAULT 0;  
	DECLARE de_122_094 VARCHAR(3) DEFAULT NULL;  
	DECLARE JSON_RESULT      MEDIUMTEXT    DEFAULT 0;  

	DECLARE LANG_AUX VARCHAR(3) DEFAULT NULL;  


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		
	SET group_concat_max_len=150000;
	
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');
	SET de_122_094 = (select DATA from TBL_MESSAGE1 where CODE = '122.94');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	IF (length(de_122_094) > 0) then 
		set LANG_AUX = de_122_094 ;
	ELSE
		set LANG_AUX = 'EN' ;
	END IF;


	SELECT GROUP_CONCAT(    
		CONCAT(
			  '{"122.18":"',PQ.tbl_category_id,
			  '","120.45":"',PQ.tbl_categorydescription_name,
			  '","120.44":"',1,
			  '","122.183":"',PQ.tbl_category_active,
				 '","300.80":{"122.18":"',PQ.tbl_category_parentId,
				 '"},"300.27":[', 
					
					COALESCE ( (
						SELECT GROUP_CONCAT(    
						CONCAT('{"122.18":"',C.tbl_category_id,
							  '","120.45":"',D.tbl_categorydescription_name,
							  '","120.44":"',2,
							  '","122.183":"',C.tbl_category_active,
								 '","300.80":{"122.18":"',C.tbl_category_parentId,
								 '"},"300.27":[', if ((select count(*) from  dbitems.tbl_category 
												where tbl_category_parentId = C.tbl_category_id) > 0, 
												GetBussCategoryJSONLevel1(C.tbl_category_id, L.tbl_language_id),''),
								']}'))  
						FROM dbitems.tbl_category C, dbitems.tbl_categorydescription D,
						tbl_merchantbusinesscategory M, tbl_language L
						WHERE ( M.tbl_merchant_nmcId = de_114_179 )
						AND ( M.tbl_businesscategory_id = C.tbl_category_id )
						AND ( C.tbl_category_id = D.tbl_category_id )
						AND ( C.tbl_category_active=1)
						AND ( C.tbl_category_parentId = PQ.tbl_category_id )
						AND ( L.tbl_language_id = D.tbl_language_id ) 
						AND ( L.tbl_language_cod = LANG_AUX )

					), '' ),
				']}')
		)  AS JSON
	FROM

	( SELECT CP.tbl_category, D.tbl_categorydescription_name,
	CP.tbl_category_level,CP.tbl_category_active,CP.tbl_category_parentId
	FROM
	(((( tbl_merchantbusinesscategory M 
	INNER JOIN dbitems.tbl_category C ON (M.tbl_businesscategory_id = C.tbl_category_id AND M.tbl_merchant_nmcId = de_114_179 AND C.tbl_category_active=1) ) 
	INNER JOIN dbitems.tbl_category CP ON (CP.tbl_category_id = C.tbl_category_parentId) )
	INNER JOIN dbitems.tbl_categorydescription D ON CP.tbl_category_id = D.tbl_category_id  )
	INNER JOIN tbl_language L ON D.tbl_language_id = L.tbl_language_id AND L.tbl_language_cod = LANG_AUX)
	GROUP BY CP.tbl_category_id, D.tbl_categorydescription_name,
	CP.tbl_category_level, CP.tbl_category_level,
	CP.tbl_category_active ) AS PQ INTO JSON_RESULT;

    SELECT CONCAT( '{"122.18":"0","120.45":"root","120.44":"0","300.27":[', COALESCE( JSON_RESULT, '' ), ']}' ) AS JSON;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantPOSLocationByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantPOSLocationByIdPortal`(PARAM VARCHAR(20000))
BEGIN 











	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI        INT(11)        DEFAULT 1;  
	DECLARE FIN        INT(11)        DEFAULT 0;  
	DECLARE de_114_47 INTEGER(11)    DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_114_47 = (select DATA from TBL_MESSAGE1 where CODE = '114.47');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  
	



SELECT 
          GROUP_CONCAT(
				CONCAT('{"120.97":"',if(tbl_merchantpos.tbl_merchantpos_id  is null,'',tbl_merchantpos.tbl_merchantpos_id ),'"'),
				CONCAT(',"121.184":"',if(tbl_merchantpos.tbl_merchantpos_contacProvider  is null,'',tbl_merchantpos.tbl_merchantpos_contacProvider ),'"'),
				CONCAT(',"121.186":"',if(tbl_merchantpos.tbl_merchantpos_contacName  is null,'',tbl_merchantpos.tbl_merchantpos_contacName ),'"'),
				CONCAT(',"114.7":"',if(tbl_merchantpos.tbl_merchantpos_contacMail  is null,0,tbl_merchantpos.tbl_merchantpos_contacMail ),'"'),
			    CONCAT(',"114.47":"',de_114_47,'"'),
				CONCAT(',"300.84":{"114.179":"',tbl_phone.tbl_phone_nmcId,'","48.28":"',tbl_phone.tbl_phone_phoneNumber,'","122.88":"',tbl_phone.tbl_phone_id,'","121.167":"',if(tbl_phone.tbl_phone_extension  is null,'',tbl_phone.tbl_phone_extension),'","122.87":"',if(tbl_phone.tbl_phone_country_id  is null,'',tbl_phone.tbl_phone_country_id),'"}'),
				CONCAT(',"114.179":"',if(tbl_locationpos.tbl_merchantpos_id  is null,0,tbl_locationpos.tbl_merchantpos_id),'"}')
             ) as JSON
	from tbl_locationpos
			left join tbl_merchantpos ON tbl_merchantpos.tbl_merchantpos_id = tbl_locationpos.tbl_merchantpos_id
			left join tbl_merchantposphone on tbl_merchantposphone.tbl_merchantpos_id=tbl_merchantpos.tbl_merchantpos_id
			left join tbl_phone ON tbl_phone.tbl_phone_id = tbl_merchantposphone.tbl_phone_id
	where tbl_locationpos.tbl_location_id = de_114_47

	LIMIT INI,FIN;   

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantProfileByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantProfileByIdPortal`(PARAM VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_179       INT(11)       DEFAULT 0;  
	DECLARE LIST_PHONE_AUX TEXT DEFAULT NULL; 
	DECLARE LIST_PHONE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 
	DECLARE ADDRESS VARCHAR(3000) DEFAULT NULL; 
	DECLARE ECOMMERCE_AUX TEXT DEFAULT NULL;
	DECLARE ECOMMERCE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 


	DROP TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    


	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		
	SET group_concat_max_len=150000;
	
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	





	SET LIST_PHONE_EMPTY_AUX = (SELECT  CONCAT(',"300.28":[]') AS JSON);
	SET ECOMMERCE_EMPTY_AUX = (SELECT  CONCAT(',"300.75":[]') AS JSON);
	
	IF (SELECT A.tbl_phone_nmcId 
		FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
		WHERE B.tbl_user_id = de_114_179
			AND B.tbl_user_id = C.tbl_merchant_nmcId
			AND C.tbl_merchant_nmcId = A.tbl_phone_nmcId LIMIT 1) IS NULL THEN												
		SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
	ELSE
		SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',
								GROUP_CONCAT(
								CONCAT('{"122.88":"',COALESCE(A.tbl_phone_id,''),'"'),
								CONCAT(',"114.179":"',COALESCE(A.tbl_phone_nmcId,''),'"'),
								CONCAT(',"48.28":"',COALESCE(A.tbl_phone_phoneNumber,''),'"'),
								CONCAT(',"121.167":"',COALESCE(A.tbl_phone_extension,''),'"'),
								
								CONCAT(',"122.87":"',COALESCE(A.tbl_phone_country_id,''),'"'), 
								CONCAT(',"121.62":"',COALESCE(A.tbl_phonetype_id,''),'"}')
								),"]") 
							AS JSON 
							FROM tbl_phone AS A, tbl_user AS B, tbl_merchant AS C
							WHERE B.tbl_user_id = de_114_179
								AND B.tbl_user_id = C.tbl_merchant_nmcId
								AND C.tbl_merchant_nmcId = A.tbl_phone_nmcId);
	END IF;


	SELECT  GROUP_CONCAT(',"300.51":{',
				CONCAT('"114.115":"',A.tbl_address_id,'"'),
				CONCAT(',"114.179":"',A.tbl_address_nmcId,'"'),
				CONCAT(',"121.45":"',COALESCE(B.tbl_addresstype_id,''),'"'),
				CONCAT(',"300.62":{',
					CONCAT('"122.87":"' ,COALESCE(C.tbl_country_id,''),'"'),
					CONCAT(',"47.18":"' ,COALESCE(C.tbl_country_name,''),'"'),
					CONCAT(',"114.17":"' ,COALESCE(C.tbl_country_code,''),'"}')
				),
				CONCAT(',"300.64":{',
					CONCAT('"120.13":"' ,COALESCE(D.tbl_state_id,''),'"'),
					CONCAT(',"47.16":"' ,COALESCE(D.tbl_state_name,''),'"'),
					CONCAT(',"122.87":"' ,COALESCE(C.tbl_country_id,''),'"}')
				),
				CONCAT(',"300.65":{',
					CONCAT('"114.14":"' ,COALESCE(E.tbl_city_id,''),'"'),
					CONCAT(',"47.15":"' ,COALESCE(E.tbl_city_name,''),'"'),
					CONCAT(',"120.13":"' ,COALESCE(D.tbl_state_id,''),'"}')
				),
				CONCAT(',"300.66":{',
					CONCAT('"122.107":"' ,COALESCE(F.tbl_zipcode_id,''),'"'),
					CONCAT(',"47.17":"' ,COALESCE(F.tbl_zipcode_name,''),'"'),
					CONCAT(',"114.14":"' ,COALESCE(E.tbl_city_id,''),'"}')
				),
				CONCAT(',"114.12":"',COALESCE(A.tbl_address_first,''),'"'),
				CONCAT(',"114.13":"',COALESCE(A.tbl_address_second,''),'"}')
			)
	AS JSON
	FROM tbl_address AS A,
		 tbl_addresstype AS B,
		 tbl_country AS C,
		 tbl_state AS D,
         tbl_city AS E,
         tbl_zipcode AS F
	WHERE A.tbl_address_nmcId = de_114_179
		AND A.tbl_addresstype_id = B.tbl_addresstype_id
		AND A.tbl_address_flag = 1
		AND A.tbl_country_id = C.tbl_country_id
		AND A.tbl_state_id = D.tbl_state_id
		AND A.tbl_city_id = E.tbl_city_id
		AND A.tbl_zipcode_id = F.tbl_zipcode_id
	INTO ADDRESS;
	
	
	
IF (SELECT tbl_merchantwebsite_id FROM tbl_merchantwebsite WHERE tbl_merchant_nmcId = de_114_179 LIMIT 1) IS NULL THEN
	SET ECOMMERCE_AUX = ECOMMERCE_EMPTY_AUX;
	
ELSE 

	

	SET ECOMMERCE_AUX = (SELECT  CONCAT(',"300.75":[',
								GROUP_CONCAT(
								CONCAT('{"127.8":"',COALESCE(tbl_merchantwebsite_id,''),'"'),
								CONCAT(',"114.75":"',COALESCE(tbl_merchantwebsite_website,''),'"'),
								CONCAT(',"121.150":"',COALESCE(tbl_merchantwebsite_ecommerceProvider,''),'"'),
								CONCAT(',"300.84":',dbuser.GetPhoneJSON(tbl_merchantwebsite_ecommercePhone) ),	
								CONCAT(',"122.181":"',COALESCE(tbl_merchantwebsite_ecommerceName,''),'"'),
								CONCAT(',"114.7":"',COALESCE(tbl_merchantwebsite_ecommerceMail,''),'"}')
								),"]") 
							AS JSON 
							FROM tbl_merchantwebsite
							WHERE tbl_merchant_nmcId = de_114_179);

END IF;
	



	SELECT 
		  GROUP_CONCAT(   
				CONCAT('{"114.179":"',A.tbl_user_id,'"'),
				CONCAT(',"114.123":"',A.tbl_userType_id,'"'),
				CONCAT(',"114.9":"',A.tbl_user_userTemp_f,'"'),
				CONCAT(',"114.7":"',COALESCE(A.tbl_user_email,''),'"'),
				CONCAT(',"114.70":"',COALESCE(A.tbl_user_companyName,''),'"'),
				CONCAT( ',"300.67":{"47.42":"', COALESCE( B.tbl_merchant_logoimage,''), '"}' ), 
				CONCAT(',"114.91":"',COALESCE(A.tbl_user_title,''),'"'),
				CONCAT(',"114.3":"',COALESCE(A.tbl_user_first,''),'"'),
				CONCAT(',"114.5":"',COALESCE(A.tbl_user_last,''),'"'),
				CONCAT(',"114.75":"',COALESCE(B.tbl_merchant_online_store,''),'"'),
				CONCAT(LIST_PHONE_AUX),
				CONCAT(ADDRESS),
				CONCAT(',"120.148":"',(select if ((select tbl_merchant_haveWebsite_f from tbl_merchant where tbl_merchant_nmcId=de_114_179)= 1,'true','false')),'"'),
			 	CONCAT(ECOMMERCE_AUX),
				CONCAT(',"114.131":"',COALESCE(B.tbl_merchant_taxIdNumber,''),'"}')
		  ) AS JSON
	FROM tbl_user AS A, tbl_merchant AS B
	WHERE A.tbl_user_id = de_114_179
		AND A.tbl_user_id = B.tbl_merchant_nmcId
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantsByCategoryIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantsByCategoryIdMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_093 INT(11) DEFAULT 0;  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	SET group_concat_max_len = 150000;
	
	SET de_114_093 = (select DATA from TBL_MESSAGE1 where CODE = '114.93');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	select 
        GROUP_CONCAT(           
			CONCAT('{"114.141":"', B.tbl_merchant_nmcId,'"'),
			CONCAT(',"114.114":"', concat_ws(' ', A.tbl_user_first, A.tbl_user_last),'"'),
			CONCAT(',"121.170":"', if (B.tbl_merchant_logoimage is null,'', B.tbl_merchant_logoimage),'"}')
        ) as JSON
	
	from tbl_user as A,
	tbl_merchant as B,
	tbl_merchantbusinesscategory as C,
	dbitems.tbl_category as D
	where D.tbl_category_id = de_114_093
	and D.tbl_category_id = C.tbl_businesscategory_id
	and C.tbl_merchant_nmcId = B.tbl_merchant_nmcId
	and B.tbl_user_id = A.tbl_user_id
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantSignUp010400263` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantSignUp010400263`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: GetMerchantSignUp010400263 
-- Method: 010400263
-- Version: 1.0
-- Last modified: 2014-05-13
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053	    VARCHAR(20) DEFAULT 0; 		   -- Reseller id 

-- --------------------
-- Declare auxiliary --
-- -------------------- 
	SET  group_concat_max_len = 1000000;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_053 = (select right(de_053,11));

-- ---------------		
-- Query of DB  --
-- ---------------

	select GROUP_CONCAT(
	CONCAT('{"127.24":"',(select date_format(date_sub(NOW(), INTERVAL 0 MONTH),'%Y-%m')),'"'),
	CONCAT(',"114.121":"',(select count(merchant_Id) from view_signup where type = 1 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 0 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"114.132":"',(select count(merchant_Id) from view_signup where type = 2 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 0 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"122.148":"',(select count(merchant_Id) from view_signup where type = 3 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 0 MONTH),'%Y-%m'))),'"},'),

	CONCAT('{"127.24":"',(select date_format(date_sub(NOW(), INTERVAL 1 MONTH),'%Y-%m')),'"'),
	CONCAT(',"114.121":"',(select count(merchant_Id) from view_signup where type = 1 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 1 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"114.132":"',(select count(merchant_Id) from view_signup where type = 2 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 1 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"122.148":"',(select count(merchant_Id) from view_signup where type = 3 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 1 MONTH),'%Y-%m'))),'"},'),

	CONCAT('{"127.24":"',(select date_format(date_sub(NOW(), INTERVAL 2 MONTH),'%Y-%m')),'"'),
	CONCAT(',"114.121":"',(select count(merchant_Id) from view_signup where type = 1 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 2 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"114.132":"',(select count(merchant_Id) from view_signup where type = 2 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 2 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"122.148":"',(select count(merchant_Id) from view_signup where type = 3 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 2 MONTH),'%Y-%m'))),'"},'),

	CONCAT('{"127.24":"',(select date_format(date_sub(NOW(), INTERVAL 3 MONTH),'%Y-%m')),'"'),
	CONCAT(',"114.121":"',(select count(merchant_Id) from view_signup where type = 1 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 3 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"114.132":"',(select count(merchant_Id) from view_signup where type = 2 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 3 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"122.148":"',(select count(merchant_Id) from view_signup where type = 3 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 3 MONTH),'%Y-%m'))),'"},'),

	CONCAT('{"127.24":"',(select date_format(date_sub(NOW(), INTERVAL 4 MONTH),'%Y-%m')),'"'),
	CONCAT(',"114.121":"',(select count(merchant_Id) from view_signup where type = 1 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 4 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"114.132":"',(select count(merchant_Id) from view_signup where type = 2 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 4 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"122.148":"',(select count(merchant_Id) from view_signup where type = 3 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 4 MONTH),'%Y-%m'))),'"},'),

	CONCAT('{"127.24":"',(select date_format(date_sub(NOW(), INTERVAL 5 MONTH),'%Y-%m')),'"'),
	CONCAT(',"114.121":"',(select count(merchant_Id) from view_signup where type = 1 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 5 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"114.132":"',(select count(merchant_Id) from view_signup where type = 2 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 5 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"122.148":"',(select count(merchant_Id) from view_signup where type = 3 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 5 MONTH),'%Y-%m'))),'"},'),

	CONCAT('{"127.24":"',(select date_format(date_sub(NOW(), INTERVAL 6 MONTH),'%Y-%m')),'"'),
	CONCAT(',"114.121":"',(select count(merchant_Id) from view_signup where type = 1 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 6 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"114.132":"',(select count(merchant_Id) from view_signup where type = 2 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 6 MONTH),'%Y-%m'))),'"'),
	CONCAT(',"122.148":"',(select count(merchant_Id) from view_signup where type = 3 and (reseller_Id = de_053 or parent_Id = de_053) and date_format(date_add, '%Y-%m') = (select date_format(date_sub(NOW(), INTERVAL 6 MONTH),'%Y-%m'))),'"}')
	) as JSON;


	

	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantSignUpDetail010400264` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantSignUpDetail010400264`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: GetMerchantSignUpDetail010400264
-- Method: 010400264
-- Version: 1.0
-- Last modified: 2014-05-13
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053	    VARCHAR(20) DEFAULT 0; 		   -- Reseller id 
	DECLARE de_127_024	VARCHAR(7) DEFAULT 0; 		   -- Date
	DECLARE de_120_027	INT(1) DEFAULT 0; 		   	   -- Type
	DECLARE JSON TEXT;
-- --------------------
-- Declare auxiliary --
-- -------------------- 

	SET  group_concat_max_len = 1000000;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_053 = (select right(de_053,11));
	SET de_127_024 = (select DATA from TBL_MESSAGE1 where CODE = '127.24');
	SET de_120_027 = (select DATA from TBL_MESSAGE1 where CODE = '120.27');

-- ---------------		
-- Query of DB  --
-- ---------------
SET JSON=(
	select 
	GROUP_CONCAT(
		CONCAT('{"53":"',(select dbuser.getnmcid(A.merchant_Id)),'"'),
		CONCAT(',"114.70":"',B.tbl_user_companyName,'"'),
		CONCAT(',"AD":{',getNMCAddress((select tbl_address_id from tbl_address where tbl_address_nmcId = A.merchant_Id limit 1)),'}'),
		CONCAT(',"PH":[',getNMCPhone((select tbl_phone_id from tbl_phone where tbl_phone_nmcId = A.merchant_Id limit 1)),']'),
		CONCAT(',"120.27":"',A.type,'"}')
	) as JSON
	from view_signup as A,
	tbl_user as B
	where A.type = COALESCE(de_120_027,1)
	and A.reseller_Id = de_053
	and date_format(A.date_add, '%Y-%m') = de_127_024
	and A.merchant_Id = B.tbl_user_id
);
	
 
IF JSON is NULL THEN
	SET JSON = '{}';
END IF;

SELECT JSON;

	DROP TABLE TBL_MESSAGE1;

  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMerchantTerminalLocationByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMerchantTerminalLocationByIdPortal`(PARAM VARCHAR(20000))
BEGIN 











	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI        INT(11)        DEFAULT 1;  
	DECLARE FIN        INT(11)        DEFAULT 0;  
	DECLARE de_114_47 INTEGER(11)    DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_114_47 = (select DATA from TBL_MESSAGE1 where CODE = '114.47');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  
	



SELECT 
          GROUP_CONCAT(
				CONCAT('{"114.47":"',if(tbl_terminal.tbl_location_id  is null,'',tbl_terminal.tbl_location_id ),'"'),
				CONCAT(',"120.69":"',if(tbl_terminal.tbl_terminal_id  is null,'',tbl_terminal.tbl_terminal_id ),'"'),
				CONCAT(',"122.170":"',if(tbl_terminal.tbl_terminaltype_id  is null,'',tbl_terminal.tbl_terminaltype_id ),'"'),
				CONCAT(',"122.123":"',if(tbl_terminal.tbl_terminal_manofacturer  is null,'',tbl_terminal.tbl_terminal_manofacturer ),'"'),
				CONCAT(',"121.183":"',if(tbl_terminal.tbl_terminal_posTerminalId  is null,'',tbl_terminal.tbl_terminal_posTerminalId ),'"'),
				CONCAT(',"122.124":"',if(tbl_terminal.tbl_terminal_provider  is null,'',tbl_terminal.tbl_terminal_provider ),'"'),
				CONCAT(',"122.125":"',if(tbl_terminal.tbl_terminal_posInternalId  is null,'',tbl_terminal.tbl_terminal_posInternalId ),'"'),
				CONCAT(',"122.126":"',if(tbl_terminal.tbl_terminal_reference  is null,'',tbl_terminal.tbl_terminal_reference ),'"'),
				CONCAT(',"114.104":"',if(tbl_terminal.tbl_terminal_qrCode  is null,'',tbl_terminal.tbl_terminal_qrCode ),'"}')
             ) as JSON
			from tbl_terminal
			where tbl_location_id = de_114_47

	LIMIT INI,FIN;   

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMissingDataUser050400327` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMissingDataUser050400327`(PARAM VARCHAR(20000))
BEGIN 
 
-- --------------------------------------------------------
-- Autor: Luis G.Porras
-- Procedure: GetMissingDataUser050400327
-- Version: 1.0 
-- last modified: 2014-07-17
-- --------------------------------------------------------

DECLARE SELECCION text; 
DECLARE DESDE text; 
DECLARE FILTRO text; 
DECLARE qr text;
DECLARE CONSULTA text; 
DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
DECLARE de_053A INT(11) DEFAULT NULL; 
DECLARE de_055 INT(2) DEFAULT NULL;  

DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET  group_concat_max_len = 1000000;
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET  de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053A = (select right(de_053,11));
	SET de_055 = (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =de_053A );
    
    if de_055 = 60 then
		SET de_055 = 30;
	end if;

	if (select left(de_055,1)) in (SELECT distinct tbl_entity FROM dbuser.tbl_user_data_validation ) then
		SET SELECCION = concat(" SELECT CONCAT(
				  GROUP_CONCAT( '{',CONCAT('\"127.95\":\"',coalesce(VALIDATION,''),'\"'),
									CONCAT(',\"127.96\":\"',coalesce(TBL_LEVEL,''),'\"'),
									CONCAT(',\"127.97\":\"',coalesce(MESSAGE_RESPONSE,''),'\"}')  SEPARATOR ','))
				  as JSON "); 
		SET DESDE= " FROM ( "; 
		SET FILTRO= " ) AS tabl"; 
		SET qr =  (SELECT GROUP_CONCAT( '(', (replace(tbl_query,'PARAMUSERID',de_053A)), ')' SEPARATOR 'union')  AS RTA from  dbuser.tbl_user_data_validation where tbl_user_data_validation.tbl_entity =(select left(de_055,1)));
		SET @CONSULTA = CONCAT(SELECCION,DESDE,qr,FILTRO); 
		PREPARE stmt1 FROM @CONSULTA;
		EXECUTE stmt1;
	else
	
	select '{}' as json;
	

	end if;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `getMobileKey` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `getMobileKey`(IN DEVICEID VARCHAR(250),IN NMCID VARCHAR(20))
BEGIN

DECLARE LOST_PHONE INT DEFAULT 0;
DECLARE LOCK_PHONE INT DEFAULT 0;
DECLARE KEY_AUX VARCHAR(32) DEFAULT '';

-- Check if the device is missing or stolen

SET LOST_PHONE = (SELECT COUNT(DISTINCT(tbl_device_id)) AS COUNT FROM dbuser.tbl_device 
				  where dbuser.tbl_device.tbl_device_udid=DEVICEID and 
                  dbuser.tbl_device.tbl_status_id=3
			   );

IF LOST_PHONE = 0 THEN
    -- Check if the device is blocke for that user
    SET LOCK_PHONE = (SELECT COUNT(DISTINCT(tbl_device_id)) AS COUNT FROM dbuser.tbl_device D
				      where D.tbl_device_udid=DEVICEID and 
				      D.tbl_consumer_nmcId = (SELECT SUBSTRING(NMCID FROM 9)) and
                      D.tbl_status_id=2
                   );
    IF LOCK_PHONE = 0 THEN
       SET KEY_AUX = (select COALESCE(`mobile_key`.`key`,'') from nmc_control.mobile_key 
					  where mobile_key.device_id = DEVICEID
                   );
	   IF ISNULL(KEY_AUX) THEN
          SELECT (CONCAT('{"39":"0000","127.18":""}'));
	   ELSE	
		  SELECT (CONCAT('{"39":"0000","127.18":"',KEY_AUX,'"}'));
	   END IF;
	ELSE -- The device is locked for that user
	   SELECT (CONCAT('{"39":"1828"}'));
    END IF;
ELSE  -- The device is marked as missing or stolen
	SELECT (CONCAT('{"39":"1829"}'));
END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetMyAccountsByConsumerIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetMyAccountsByConsumerIdPortal`(PARAM VARCHAR(20000))
BEGIN 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	

	
	DECLARE de_114_179 VARCHAR(11) DEFAULT 0; 	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	





select 
	GROUP_CONCAT(
              	CONCAT('{"48.6":"',A.tbl_card_nickname,'"'),
				CONCAT(',"120.7":"',A.tbl_cardstype_id,'"}')
          ) as JSON
  	from dbcards.tbl_card As A, dbcards.tbl_cardsconsumer as B
	where 
	A.tbl_card_tocken = B.tbl_card_tocken
	and B.tbl_cardsconsumer_nmcId= de_114_179

	
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetNmcTypePortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetNmcTypePortal`(PARAM VARCHAR(20000))
BEGIN 












DECLARE INI       INT(11)       DEFAULT 1;  
DECLARE FIN       INT(11)       DEFAULT 0;  
DECLARE SELECCION text; 
DECLARE DESDE text; 
DECLARE FILTRO text; 
DECLARE qr text;
DECLARE CONSULTA text; 
DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

 

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET  group_concat_max_len = 1000000;
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
 




 SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');




 
 IF (length(INI) > 0) then 
  SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 ELSE
  set INI = 0;
 END IF;
  
 IF (length(FIN) > 0) then 
  SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
 ELSE
  set FIN = 999999999;
 END IF;
 




SET SELECCION = " SELECT CONCAT(
          GROUP_CONCAT( '{',CONCAT('\"122.179\":\"',id,'\"'),
                       CONCAT(',\"122.178\":\"',if(name  is null,'',name ),'\"'),
					   CONCAT(',\"122.180\":\"',if(type  is null,'',type ) ,'\"}')  SEPARATOR ','))
		  as JSON "; 
SET DESDE= " FROM ( "; 
SET FILTRO= " ) as tbl order by id"; 
SET qr =  (SELECT GROUP_CONCAT( '(',tbl_nmctype_nameTable, ')' SEPARATOR 'union')  AS RTA from dbuser.tbl_nmctype);
SET @CONSULTA = CONCAT(SELECCION,DESDE,qr,FILTRO); 
PREPARE stmt1 FROM @CONSULTA;
EXECUTE stmt1;


    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetNmcTypePortal010400024` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetNmcTypePortal010400024`(PARAM VARCHAR(20000))
BEGIN 








DECLARE SELECCION text; 
DECLARE DESDE text; 
DECLARE FILTRO text; 
DECLARE qr text;
DECLARE CONSULTA text; 
DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET  group_concat_max_len = 1000000;
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



SET SELECCION = " SELECT CONCAT(
          GROUP_CONCAT( '{',CONCAT('\"122.179\":\"',id,'\"'),
                       CONCAT(',\"122.178\":\"',if(name  is null,'',name ),'\"'),
					   CONCAT(',\"122.180\":\"',if(type  is null,'',type ) ,'\"}')  SEPARATOR ','))
		  as JSON "; 
SET DESDE= " FROM ( "; 
SET FILTRO= " ) as tbl order by id"; 
SET qr =  (SELECT GROUP_CONCAT( '(',tbl_nmctype_nameTable, ')' SEPARATOR 'union')  AS RTA from dbuser.tbl_nmctype);
SET @CONSULTA = CONCAT(SELECCION,DESDE,qr,FILTRO); 
PREPARE stmt1 FROM @CONSULTA;
EXECUTE stmt1;


    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetNotificationByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetNotificationByConsumerIdMobile`(PARAM VARCHAR(20000))
BEGIN 











	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	DECLARE de_053 INTEGER(11) DEFAULT 0; 
	
	
	
	SET  group_concat_max_len = 1000000;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



  
	



	
SELECT 
            GROUP_CONCAT(
				CONCAT('"126":"',if(tbl_consumer_notificationSettings  is null,0,tbl_consumer_notificationSettings ),'"')
             ) as JSON
	from dbuser.tbl_consumer 
	where tbl_user_id = de_053
	

	LIMIT INI,FIN;   

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetParamByProject` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetParamByProject`(PARAM VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
 
 	DECLARE de_127_14  VARCHAR(40)       DEFAULT '';  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET de_127_14 = (select DATA from TBL_MESSAGE1 where CODE = '127.14');




	case de_127_14
		when 'MOBILE' then
            	SELECT 	GROUP_CONCAT(
							CONCAT('{"127.11":"',P.param,'"'),
							CONCAT(',"127.12":"',P.value,'"}')
						)  as JSON 
				from parameter P where P.type = 'MOBILE' OR P.type = 'BOTH';
		when 'PORTAL' then
            	SELECT 	GROUP_CONCAT(
							CONCAT('{"127.11":"',P.param,'"'),
							CONCAT(',"127.12":"',P.value,'"}')
						)  as JSON 
				from parameter P where P.type = 'PORTAL' OR P.type = 'BOTH';
        else 
			   SELECT '' AS JSON;
    end case;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetParamByProject010100074` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetParamByProject010100074`(PARAM VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

 	DECLARE de_127_14  VARCHAR(40)       DEFAULT '';  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET de_127_14 = (select DATA from TBL_MESSAGE1 where CODE = '127.14');




	case de_127_14
		when 'MOBILE' then
            	SELECT 	GROUP_CONCAT(
							CONCAT('{"127.11":"',P.param,'"'),
							CONCAT(',"127.12":"',P.value,'"}')
						)  as JSON 
				from parameter P where P.type = 'MOBILE' OR P.type = 'BOTH';
		when 'PORTAL' then
            	SELECT 	GROUP_CONCAT(
							CONCAT('{"127.11":"',P.param,'"'),
							CONCAT(',"127.12":"',P.value,'"}')
						)  as JSON 
				from parameter P where P.type = 'PORTAL' OR P.type = 'BOTH';
        else 
			   SELECT '' AS JSON;
    end case;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetParamByProject010400027` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetParamByProject010400027`(PARAM VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
 
 	DECLARE de_127_14  VARCHAR(40)       DEFAULT '';  
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET de_127_14 = (select DATA from TBL_MESSAGE1 where CODE = '127.14');




	case de_127_14
		when 'MOBILE' then
            	SELECT 	GROUP_CONCAT(
							CONCAT('{"127.11":"',P.param,'"'),
							CONCAT(',"127.12":"',P.value,'"}')
						)  as JSON 
				from parameter P where P.type = 'MOBILE' OR P.type = 'BOTH';
		when 'PORTAL' then
            	SELECT 	GROUP_CONCAT(
							CONCAT('{"127.11":"',P.param,'"'),
							CONCAT(',"127.12":"',P.value,'"}')
						)  as JSON 
				from parameter P where P.type = 'PORTAL' OR P.type = 'BOTH';
        else 
			   SELECT '' AS JSON;
    end case;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetProductBarCodeDatabaseByMerchantId` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetProductBarCodeDatabaseByMerchantId`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_179      INT(11)       DEFAULT 0;  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



    SELECT
		CONCAT('{"127.9":"', COALESCE( A.tbl_merchant_product_barcode_database, ''),'"}') as JSON
	from tbl_merchant as A
	where A.tbl_merchant_nmcId = de_114_179
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetProductByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetProductByIdPortal`(PARAM VARCHAR(4000))
BEGIN 












	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE  de_114_144 INT(11) 	DEFAULT 0;  


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',PARAM);
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_144 = (select DATA from TBL_MESSAGE1 where CODE = '114.144');



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	select distinct 
	A.tbl_productid as '114.144',
	A.tbl_product_price as '122.158', 
	C.tbl_schedule_startdate as '114.138',
	C.tbl_schedule_enddate as '114.139',
	A.tbl_product_pricetmp as '114.98',
	concat(C.tbl_schedule_monday, C.tbl_schedule_tuesday, C.tbl_schedule_wendsday, C.tbl_schedule_thursday, C.tbl_schedule_friday, C.tbl_schedule_saturday, C.tbl_schedule_sunday) as '122.127',
	
	if (B.tbl_productdescription_productname is null,'', B.tbl_productdescription_productname) '120.83',
	if (A.tbl_product_description is null,'', A.tbl_product_description) '120.157',
	if (B.tbl_productdescription_productdescription is null,'', B.tbl_productdescription_productdescription) '47.33',
	if (A.tbl_product_Sku is null,'', A.tbl_product_Sku) '121.102',
	if (F.tbl_manufacturer_name is null,'', F.tbl_manufacturer_name) '114.149',
	if (J.tbl_condition_description is null,'', J.tbl_condition_description) '121.172',
	if (B.tbl_productdescription_qrcode is null,'', B.tbl_productdescription_qrcode) '114.104',
	if ((select H.tbl_productcategory_categorieid from tbl_product as A, tbl_productcategory as H where A.tbl_productid = de_114_144 and H.tbl_productcategory_productid = A.tbl_productid and H.tbl_productcategory_level = 0) is null,'', 
		(select H.tbl_productcategory_categorieid from tbl_product as A, tbl_productcategory as H where A.tbl_productid = de_114_144 and H.tbl_productcategory_productid = A.tbl_productid and H.tbl_productcategory_level = 0)) '121.149', 
	
	if ((select H.tbl_productcategory_categorieid from tbl_product as A, tbl_productcategory as H where A.tbl_productid = de_114_144 and H.tbl_productcategory_productid = A.tbl_productid and H.tbl_productcategory_level = 1) is null,'', 
		(select H.tbl_productcategory_categorieid from tbl_product as A, tbl_productcategory as H where A.tbl_productid = de_114_144 and H.tbl_productcategory_productid = A.tbl_productid and H.tbl_productcategory_level = 1)) '121.181', 
		
	if ((select H.tbl_productcategory_categorieid from tbl_product as A, tbl_productcategory as H where A.tbl_productid = de_114_144 and H.tbl_productcategory_productid = A.tbl_productid and H.tbl_productcategory_level > 1 order by H.tbl_productcategory_level desc limit 1) is null,'', 
		(select H.tbl_productcategory_categorieid from tbl_product as A, tbl_productcategory as H where A.tbl_productid = de_114_144 and H.tbl_productcategory_productid = A.tbl_productid and H.tbl_productcategory_level > 1 order by H.tbl_productcategory_level desc limit 1)) '114.137'
	from tbl_product as A,
		 tbl_productdescription as B,
		 tbl_schedule as C,
		 tbl_catalogproduct as D,
		 tbl_productschedule as E,
		 tbl_manufacturer as F,
		 tbl_productmanufacturer as G,
		 tbl_condition as J,
		 tbl_productcondition as I,
		 tbl_productcategory as H
    where D.tbl_catalogproduct_productid = A.tbl_productid
	and A.tbl_productid = B.tbl_productdescription_productid
	and B.tbl_productdescription_productid = tbl_productid
	and A.tbl_productid = E.tbl_productschedule_productid
	and E.tbl_productschedule_productid =C.tbl_scheduleid
	and A.tbl_productid = G.tbl_productmanufacturer_productid
	and G.tbl_productmanufacturer_productid = F.tbl_manufacturerid
	and A.tbl_productid = I.tbl_productcondition_productid
	and I.tbl_productcondition_productid = J.tbl_conditionid
	and A.tbl_productid = H.tbl_productcategory_productid
	and A.tbl_productid = de_114_144
	LIMIT INI, FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetProductDetailsByQRCodeMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetProductDetailsByQRCodeMobile_1`(PARAM VARCHAR(20000))
BEGIN 















	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	

	DECLARE de_114_104 VARCHAR(45) DEFAULT 0 ; 
	

	DECLARE de_114_144 VARCHAR(11) DEFAULT 0; 
	DECLARE de_053 VARCHAR(18) DEFAULT 0; 



    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

    

    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));

	

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	






	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');

	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET group_concat_max_len = 150000;

	

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');

	SET de_114_104 = (select DATA from TBL_MESSAGE1 where CODE = '114.104');

	SET de_114_144 = (select tbl_product_id from tbl_product where tbl_product_qrcode = de_114_104);






	

	IF (length(INI) > 0) then 

		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');

	ELSE

		set INI = 0;

	END IF;

		

	IF (length(FIN) > 0) then 

		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;

	ELSE

		set FIN = 999999999;

	END IF;

	










SELECT 

        GROUP_CONCAT(          

				CONCAT('"114.144":"',A.tbl_product_id,'"'),

				CONCAT(',"120.83":"',if( A.tbl_product_name is null,'', A.tbl_product_name),'"'),

				CONCAT(',"122.158":"',if( A.tbl_product_regularprice is null,0.0, A.tbl_product_regularprice),'"'),

				CONCAT(',"122.75":"',if( A.tbl_product_saleprice is null,0.0, A.tbl_product_saleprice) ,'"'),

				CONCAT(',"120.157":"',if( A.tbl_product_description is null,'', A.tbl_product_description) ,'"'),

				CONCAT(',"121.150":"',if( F.tbl_user_companyName is null,'', F.tbl_user_companyName) ,'"'),

				

				CONCAT(',"114.12":"',if ((select G.tbl_address_first from dbuser.tbl_address as G, dbitems.tbl_product as A where A.tbl_product_usernmcid = G.tbl_address_nmcId and A.tbl_product_id = de_114_144 limit 1) is null,'',

									(select G.tbl_address_first from dbuser.tbl_address as G, dbitems.tbl_product as A where A.tbl_product_usernmcid = G.tbl_address_nmcId and A.tbl_product_id = de_114_144 limit 1)),'"'),				

				

				CONCAT(',"114.13":"',if ((select G.tbl_address_second from dbuser.tbl_address as G, dbitems.tbl_product as A where A.tbl_product_usernmcid = G.tbl_address_nmcId and A.tbl_product_id = de_114_144 limit 1) is null,'',

									(select G.tbl_address_second from dbuser.tbl_address as G, dbitems.tbl_product as A where A.tbl_product_usernmcid = G.tbl_address_nmcId and A.tbl_product_id = de_114_144 limit 1)),'"'),

				

				CONCAT(',"97":"',if( H.tbl_phone_phonenumber is null,'', H.tbl_phone_phonenumber) ,'"'),

				

				CONCAT(',"120.148":"', if ((select E.tbl_merchantwebsite_website from dbuser.tbl_merchantwebsite as E, dbitems.tbl_product as A where  E.tbl_merchant_nmcId = A.tbl_product_usernmcid and A.tbl_product_id =de_114_144 limit 1) is null,'', 

				(select E.tbl_merchantwebsite_website from dbuser.tbl_merchantwebsite as E , dbitems.tbl_product as A where  E.tbl_merchant_nmcId = A.tbl_product_usernmcid and A.tbl_product_id =de_114_144 limit 1)),'"'),



				CONCAT(',"121.108":"',if( A.tbl_product_barcode is null,'', A.tbl_product_barcode),'"'),

				CONCAT(',"120.103":"',if( A.tbl_barcodetype_id is null,'', A.tbl_barcodetype_id),'"'),

				CONCAT(',"114.179":"',A.tbl_product_usernmcid,'"'),

				CONCAT(',"121.170":"',if(A.tbl_product_image is null,'',A.tbl_product_image ),'"'),

				CONCAT(',"114.9":"1"'),

				CONCAT(',"121.140":"',if( C.tbl_schedule_starttime is null,'00:00', C.tbl_schedule_starttime),'"'),

				CONCAT(',"121.141":"',if( C.tbl_schedule_endtime is null,'00:00', C.tbl_schedule_endtime),'"'),

				CONCAT(',"120.15":"',if( (select tbl_product_id from dbitems.tbl_productfav where tbl_product_id = de_114_144 and tbl_productfav_nmcid = de_053) is null, 0,1),'"'),

				CONCAT(',"121.100":"',if(D.tbl_condition_termsandConditions is null,'',D.tbl_condition_termsandConditions),'"')

          ) as JSON



	from dbitems.tbl_product as A, 

		dbitems.tbl_productschedule as B,

		dbitems.tbl_schedule as C,

		dbitems.tbl_condition as D,

		dbuser.tbl_merchant as E,

		dbuser.tbl_user as F,

		dbuser.tbl_phone as H

	

	where  A.tbl_product_id = de_114_144

	and    B.tbl_product_id = de_114_144

	and    B.tbl_schedule_id = C.tbl_schedule_id

	and    D.tbl_product_id = de_114_144	

	and	   E.tbl_merchant_nmcId = A.tbl_product_usernmcid

	and	   E.tbl_user_id = F.tbl_user_id

	and	   H.tbl_phone_nmcId = E.tbl_merchant_nmcId

	and    H.tbl_phonetype_id = 4005

	and    A.tbl_productstatus_id = 1001

		

	LIMIT INI,FIN;





	

    
    DROP TABLE TBL_MESSAGE1;

  

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetProductListByUserIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetProductListByUserIdPortal`(PARAM VARCHAR(20000))
BEGIN 











 DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
 DECLARE INI       INT(11)       DEFAULT 1;  
 DECLARE FIN       INT(11)       DEFAULT 0;  
	
 DECLARE de_114_179 INT(11)		 DEFAULT 0; 


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
	
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
 



 SET group_concat_max_len=150000;

 SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

 SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.90');




 
 IF (length(INI) > 0) then 
  SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 ELSE
  set INI = 0;
 END IF;
  
 IF (length(FIN) > 0) then 
  SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
 ELSE
  set FIN = 999999999;
 END IF;
 



		SELECT 
		 CONCAT(
			  GROUP_CONCAT(
				  
					CONCAT(',"120.83":"',if(A.tbl_product_name  is null,'',A.tbl_product_name ),'"'),
					CONCAT(',"122.131":"',if( A.tbl_product_model is null,'',A.tbl_product_model ),'"'),
					CONCAT(',"121.102":"',if( A.tbl_product_sku is null,'',A.tbl_product_sku ),'"'),
					CONCAT(',"121.181":"',if( D.tbl_categorydescription_name is null,'',D.tbl_categorydescription_name ),'"'),
					CONCAT(',"114.143":"',A.tbl_productstatus_id,'"'),
					CONCAT(',"121.31":"',A.tbl_product_dateadded,'"'),
					CONCAT(',"122.158":"',A.tbl_product_regularprice,'"'),
					CONCAT(',"122.75":"',A.tbl_product_saleprice,'"')
			  )
		 )  as JSON
		from tbl_product A, tbl_productcategory B, tbl_category C, tbl_categorydescription D
		where A.tbl_product_id = B.tbl_product_id
		and B.tbl_category_id = C.tbl_category_id 
		and C.tbl_category_id = D.tbl_category_id
		
		LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetProfileLeadByUser010400672` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetProfileLeadByUser010400672`(PARAM VARCHAR(20000))
BEGIN 
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_053 VARCHAR(50) DEFAULT NULL; 
	
-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- -----------------	
-- Set variables --
-- -----------------

	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
    
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
    
-- ---------------		
-- Query of DB --
-- ---------------

				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"39":"','0000','"'),
						CONCAT(',"44":"','Transaction Approved','"'),
						CONCAT(',"53":"',     COALESCE(dbuser.getNMCID(A.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(A.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', if(A.tbl_user_companyName  is null or A.tbl_user_companyName = '',if(A.tbl_user_class in('2A1','3A1'),(select tbl_user_companyName from tbl_user where tbl_user_id = A.tbl_user_parentId),''),A.tbl_user_companyName ),'"'),
						CONCAT(',"123.71":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),(select C.tbl_reseller_taxNumber from dbuser.tbl_reseller as C where C.tbl_user_id = A.tbl_user_id)),''),'"'),
						CONCAT(',"114.7":"',  COALESCE(A.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(A.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(A.tbl_user_last,''),'"'),
						CONCAT(',"114.91":"', COALESCE(A.tbl_user_title,''),'"'),
                        CONCAT(',"AD":[',     COALESCE(dbuser.getNMCAddressByUser(A.tbl_user_id),''),']'),
						CONCAT(',"LO":[',     COALESCE(dbuser.getNMCLocationByUser(A.tbl_user_id),''),']'),
						CONCAT(',"PH":[',     COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']'),
						CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryUser(A.tbl_user_id),''),']'),
						CONCAT(',"AC":{',     COALESCE(dbcards.getNMCCardByUser(A.tbl_user_id),''),'}'),
                        CONCAT(',"PE":[',     COALESCE(dbuser.getNMCPermissionByUser(A.tbl_user_id),''),']'),
                        CONCAT(',"DL":[',     COALESCE(dbuser.getNMCDesignatedLocationsByUser(A.tbl_user_id),''),']'),
						CONCAT(',"114.4":"',  COALESCE(A.tbl_user_middle,''),'"'),
						CONCAT(',"127.10":"', COALESCE(A.tbl_owner_id,''),'"'),
						CONCAT(',"127.66":"', COALESCE(A.tbl_user_information,''),'"'),
						CONCAT(',"114.11":"', COALESCE(A.tbl_gender_type,''),'"'),
						CONCAT(',"127.70":"', COALESCE(A.tbl_company_type,''),'"'),
						CONCAT(',"127.71":"', COALESCE(A.tbl_company_type_other,''),'"'),
						CONCAT(',"122.94":"', COALESCE(A.tbl_user_language,'EN'),'"'),
						CONCAT(',"122.91":"', COALESCE(A.tbl_user_position,''),'"'),
						CONCAT(',"122.92":"', COALESCE(A.tbl_user_department,''),'"'),
						CONCAT(',"114.143":"',COALESCE(A.tbl_userstatus_id,''),'"'),
						CONCAT(',"117.26":"', COALESCE(A.tbl_agent_type_id,''),'"'),
						CONCAT(',"123.34":"', COALESCE(if (A.tbl_user_class in ('2A1','2B1','2C1'),(select B.tbl_user_crc from tbl_user as B where B.tbl_user_id = A.tbl_user_parentId),A.tbl_user_crc),''),'"'),
                        CONCAT(',"114.121":"',COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.17":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.18":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.20":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.21":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
                        CONCAT(',"114.9":"',  (select if ((select A.tbl_user_userTemp_f from tbl_user as A where A.tbl_user_email = de_114_007 and A.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) limit 1) = 1,'true','false')),'"'),
					    
                        CONCAT(',"122.46":"', COALESCE(if((select tbl_permission_ad_create_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        CONCAT(',"122.47":"', COALESCE(if((select tbl_permission_ad_publish_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        
                        CONCAT(',"119.16":"', COALESCE(hex(A.tbl_user_policy),''),'"'),
                        CONCAT(',"120.157":"',COALESCE((SELECT W.tbl_reseller_comments FROM dbuser.tbl_reseller as W where W.tbl_user_id =A.tbl_user_id ),'' ),'"}')
						
						)as JSON
					   
						from tbl_user as A
						where A.tbl_user_id = de_053
						LIMIT INI,FIN;
                        
			
	
	DROP TABLE TBL_MESSAGE1;
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetRandomSecurityQuestionsByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetRandomSecurityQuestionsByConsumerIdMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_053 INT(18) DEFAULT 0;  			

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	SET group_concat_max_len = 150000;
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



 
	SELECT 
        GROUP_CONCAT(           
			CONCAT('{"122.170":"', W.tbl_securityquestions_id,'"'),
			CONCAT(',"114.63":"', W.tbl_securityquestions_name,'"}')
		
        ) as JSON
	from
	(select A.tbl_securityquestions_id,
			A.tbl_securityquestions_name
	from tbl_securityquestions as A
	where A.tbl_securityquestions_id in 
		(select B.tbl_securityquestions_id
		from tbl_securityquestionsanswer as B
		where B.tbl_cardsconsumer_nmcId = de_053)
	order by rand () limit 3) as W;



    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetRecordSetNmcTypePortal010400024` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetRecordSetNmcTypePortal010400024`(PARAM VARCHAR(20000))
BEGIN 








DECLARE SELECCION text; 
DECLARE DESDE text; 
DECLARE FILTRO text; 
DECLARE qr text;
DECLARE CONSULTA text; 
DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET  group_concat_max_len = 1000000;
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



SET SELECCION = " SELECT id,if(name  is null,'',name ),if(type  is null,'',type )"; 
SET DESDE= " FROM ( "; 
SET FILTRO= " ) as tbl order by id"; 
SET qr =  (SELECT GROUP_CONCAT( '(',tbl_nmctype_nameTable, ')' SEPARATOR 'union')  AS RTA from dbuser.tbl_nmctype);
SET @CONSULTA = CONCAT(SELECCION,DESDE,qr,FILTRO); 
PREPARE stmt1 FROM @CONSULTA;
EXECUTE stmt1;


    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetRegisterLink` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetRegisterLink`(IN MSG_IN VARCHAR(20000))
BEGIN




	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_127_09 VARCHAR(32) DEFAULT NULL;       
    DECLARE DELETE_AUX INT DEFAULT 1;
	DECLARE HOUR_AUX INT DEFAULT 24;
    DECLARE de_053 VARCHAR(32);
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
		
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		SET de_127_09 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.9');
		




			SELECT tbl_link_user_id,tbl_link_delete,HOUR(TIMEDIFF(NOW(),tbl_link_date)) into de_053, DELETE_AUX, HOUR_AUX
            FROM tbl_link 
            WHERE tbl_link_link = md5(convert(unhex(de_127_09) using utf8));

			IF (de_053 is null) THEN
                select GROUP_CONCAT(CONCAT('{"39":"2058"'),CONCAT(',"44":"Invalid Request"}')) as JSON;
            ELSEIF (DELETE_AUX = 1) THEN
                select GROUP_CONCAT(CONCAT('{"39":"2059"'),CONCAT(',"44":"Invalid Request"}')) as JSON;
            ELSEIF (HOUR_AUX > 24) THEN
                select GROUP_CONCAT(CONCAT('{"39":"2060"'),CONCAT(',"44":"Invalid Request"}')) as JSON;
			ELSE 
                select GROUP_CONCAT(CONCAT('{"39":"0000","44":"Transaction Approved","53":"',dbuser.GetNMCID(de_053),'"}')) as JSON;
			END IF;
			
	DROP TABLE IF EXISTS TBL_MESSAGE;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetResellerProfile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetResellerProfile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_179 VARCHAR(45) DEFAULT NULL; 
	DECLARE LIST_PHONE_AUX TEXT DEFAULT NULL;
	DECLARE ADDRESS TEXT DEFAULT NULL; 
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 
	DECLARE LIST_PHONE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 
	DECLARE CATEGORY_AUX VARCHAR(300) DEFAULT 0; 
	DECLARE COMPANY_PROVIDER_AUX TEXT DEFAULT NULL; 
	
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	
	
				
			IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
										where B.tbl_user_id = de_114_179
										and B.tbl_user_id = C.tbl_reseller_nmcId
										and C.tbl_reseller_nmcId = A.tbl_phone_nmcId limit 1) IS NULL THEN
									
				SET	LIST_PHONE_AUX = (SELECT  CONCAT('') AS JSON);	
			
			ELSE
			
				SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
									CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
									CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
									CONCAT(',"122.87":"',if(A.tbl_phone_country_id  is null,'',A.tbl_phone_country_id ),'"'),
									CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
									CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
									CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
										),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
										where B.tbl_user_id = de_114_179
										and B.tbl_user_id = C.tbl_reseller_nmcId
										and C.tbl_reseller_nmcId = A.tbl_phone_nmcId) ;
			END IF;
		
	
		
				
					
	IF (SELECT tbl_address_id FROM	tbl_address WHERE	tbl_address_nmcId = de_114_179 limit 1) is not null then
				SELECT  GROUP_CONCAT(',"300.51":{',
						CONCAT('"114.115":"',A.tbl_address_id,'"'),
						CONCAT(',"114.179":"',A.tbl_address_nmcId,'"'),
						CONCAT(',"121.45":"',COALESCE(B.tbl_addresstype_id,''),'"'),
						CONCAT(',"300.62":{',
							CONCAT('"122.87":"' ,COALESCE(C.tbl_country_id,''),'"'),
							CONCAT(',"47.18":"' ,COALESCE(C.tbl_country_name,''),'"'),
							CONCAT(',"114.17":"' ,COALESCE(C.tbl_country_code,''),'"}')
						),
						CONCAT(',"300.64":{',
							CONCAT('"120.13":"' ,COALESCE(D.tbl_state_id,''),'"'),
							CONCAT(',"47.16":"' ,COALESCE(D.tbl_state_name,''),'"'),
							CONCAT(',"122.87":"' ,COALESCE(C.tbl_country_id,''),'"}')
						),
						CONCAT(',"300.65":{',
							CONCAT('"114.14":"' ,COALESCE(E.tbl_city_id,''),'"'),
							CONCAT(',"47.15":"' ,COALESCE(E.tbl_city_name,''),'"'),
							CONCAT(',"120.13":"' ,COALESCE(D.tbl_state_id,''),'"}')
						),
						CONCAT(',"300.66":{',
							CONCAT('"122.107":"' ,COALESCE(F.tbl_zipcode_id,''),'"'),
							CONCAT(',"47.17":"' ,COALESCE(F.tbl_zipcode_name,''),'"'),
							CONCAT(',"114.14":"' ,COALESCE(E.tbl_city_id,''),'"}')
						),
						CONCAT(',"114.12":"',COALESCE(A.tbl_address_first,''),'"'),
						CONCAT(',"114.13":"',COALESCE(A.tbl_address_second,''),'"}')
					)
						AS JSON
						FROM tbl_address AS A,
							 tbl_addresstype AS B,
							 tbl_country AS C,
							 tbl_state AS D,
							 tbl_city AS E,
							 tbl_zipcode AS F
						WHERE A.tbl_address_nmcId = de_114_179
							AND A.tbl_addresstype_id = B.tbl_addresstype_id
							AND A.tbl_address_flag = 1
							AND A.tbl_country_id = C.tbl_country_id
							AND A.tbl_state_id = D.tbl_state_id
							AND A.tbl_city_id = E.tbl_city_id
							AND A.tbl_zipcode_id = F.tbl_zipcode_id 
						INTO ADDRESS;
						
	else
	
			set	ADDRESS	=(SELECT  CONCAT('') AS JSON);
	
	end if;
		
		
	IF(SELECT tbl_reseller_nmcId FROM	tbl_resellerbusinesscategory WHERE tbl_reseller_nmcId = de_114_179 limit 1) is not null then
		set	CATEGORY_AUX = (SELECT  CONCAT(',"300.27":[',GROUP_CONCAT(
									CONCAT('{"122.18":"',COALESCE(B.tbl_category_id,''),'"'),
									CONCAT(',"120.45":"',COALESCE(B.tbl_categorydescription_name,''),'"}')
									),"]")AS JSON FROM tbl_resellerbusinesscategory AS A, dbitems.tbl_categorydescription AS B WHERE
											A.tbl_businesscategory_id = B.tbl_category_id
											AND A.tbl_reseller_nmcId =  de_114_179);
										



		
	ELSE
		set	CATEGORY_AUX	= (SELECT  CONCAT('') AS JSON);
	END IF;
			
			
			
	IF(SELECT tbl_resellercompaniesprovider_id FROM tbl_resellercompaniesprovider WHERE tbl_reseller_nmcId= de_114_179 LIMIT 1)IS NOT NULL	THEN

	
		SET COMPANY_PROVIDER_AUX =(SELECT CONCAT(',"300.16":[',GROUP_CONCAT(
									CONCAT('{"122.108":"',COALESCE(tbl_resellercompaniesprovider_id,''),'"'),
									CONCAT(',"114.179":"',COALESCE(tbl_reseller_nmcId,''),'"'),
									CONCAT(',"114.70":"',COALESCE(tbl_resellercompaniesprovider_companyName,''),'"'),
									CONCAT(',"122.140":"',COALESCE(tbl_resellercompaniesprovider_type,''),'"'),
									CONCAT(',"114.3":"',COALESCE(tbl_resellercompaniesprovider_contactName,''),'"'),
									CONCAT(',"114.7":"',COALESCE(tbl_resellercompaniesprovider_contactEmail,''),'"}')
									),"]") AS JSON FROM tbl_resellercompaniesprovider
									where tbl_reseller_nmcId = de_114_179);
	
	
	
	
	
	ELSE
		SET COMPANY_PROVIDER_AUX = (SELECT  CONCAT('') AS JSON);
	END IF;
	
			
		
			
			
			SELECT 
				  GROUP_CONCAT(   
						CONCAT('{"114.179":"',A.tbl_user_id,'"'),
						CONCAT(',"114.70":"',if(A.tbl_user_companyName  is null,'',A.tbl_user_companyName ),'"'),						
						CONCAT(',"114.123":"',A.tbl_userType_id,'"'),
						CONCAT(',"114.9":"',if(B.tbl_reseller_servicesProvider_f = 1,'true','false'),'"'),
						CONCAT(',"114.3":"',if(A.tbl_user_first  is null,'',tbl_user_first ),'"'),
						CONCAT(',"114.4":"',if(A.tbl_user_middle  is null,'',tbl_user_middle ),'"'),
						CONCAT(',"114.5":"',if(A.tbl_user_last  is null,'',tbl_user_last ),'"'),
						CONCAT(ADDRESS),
						CONCAT(LIST_PHONE_AUX),
						CONCAT(CATEGORY_AUX),
						CONCAT(COMPANY_PROVIDER_AUX),
						CONCAT(',"114.7":"',if(A.tbl_user_email  is null,'',A.tbl_user_email ),'"'),
						CONCAT(',"122.106":"',COALESCE(B.tbl_reseller_clientsNumber,''),'"'),
						CONCAT(',"114.91":"',if(A.tbl_user_title  is null,'',A.tbl_user_title ),'"}')
				  )as JSON
		   
			from tbl_user as A, tbl_reseller AS B
			where A.tbl_user_id = de_114_179
			AND B.tbl_user_id= de_114_179
			
			LIMIT INI,FIN;

	
			
	
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetServiceListByCategoryIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetServiceListByCategoryIdMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
 	DECLARE de_114_093      INT(11)       DEFAULT 0;  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_093 = (select DATA from TBL_MESSAGE1 where CODE = '114.093');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT 
		GROUP_CONCAT(
				CONCAT('{"121.170":"',coalesce(P.tbl_product_image, ' '),'"'),
				CONCAT(',"114.13":"',coalesce(P.tbl_product_name),'"'),
				CONCAT(',"122.158":"',P.tbl_product_regularprice,'"'),
				CONCAT(',"114.144":"',P.tbl_product_id,'"}')
						)  as JSON 
		from tbl_productcategory PC,
			 tbl_product P
		where P.tbl_product_id = PC.tbl_product_id
		and PC.tbl_category_id = de_114_093
		and P.tbl_producttype_id = 22 
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStateandCitybyZipCodeMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStateandCitybyZipCodeMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_122_107 INTEGER(11) DEFAULT 0; 

	DECLARE COUNTRYID_AUX INTEGER(11);
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_122_107 = (select DATA from TBL_MESSAGE1 where CODE = '122.107');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
     CONCAT(
          GROUP_CONCAT(
              
				CONCAT('"47.16":"',if(C.tbl_state_name  is null,'',C.tbl_state_name ),'"'),
				CONCAT(',"47.15":"',if(B.tbl_city_name  is null,'',B.tbl_city_name ),'"')
          )
        )  as JSON
	from tbl_zipcode as A, tbl_city as B, tbl_state as C 
	where A.tbl_zipcode_id = de_122_107
	and A.tbl_city_id = B.tbl_city_id
	and B.tbl_state_id = C.tbl_state_id
	LIMIT INI,FIN;
	
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStateByCountryIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStateByCountryIdPortal`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_122_087 INTEGER(11) DEFAULT 0; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_122_087 = (select DATA from TBL_MESSAGE1 where CODE = '122.87');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT 
      
          GROUP_CONCAT(
            CONCAT('{"120.13":"',tbl_state_id,'"'),
			CONCAT(',"122.87":"',tbl_country_id ,'"'),
			CONCAT(',"47.16":"',if(tbl_state_name  is null,'',tbl_state_name ),'"}')
			) as JSON
	from tbl_state 
	where tbl_country_id = de_122_087 
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStatesByCountryMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStatesByCountryMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_017 VARCHAR(4) DEFAULT 0;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_017 = (select DATA from TBL_MESSAGE1 where CODE = '114.17');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT 
		 CONCAT(
			  GROUP_CONCAT(
				  
					CONCAT('{"120.13":"',A.tbl_state_id,'"'),
					CONCAT(',"47.16":"',if(A.tbl_state_name   is null,'',A.tbl_state_name  ),'"}')
			  )
		    )  as JSON
		from tbl_state as A, tbl_country as B 
	where A.tbl_country_id = B.tbl_country_id
	and B.tbl_country_id = de_114_017
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStoreByLocationMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStoreByLocationMobile`(PARAM VARCHAR(20000))
BEGIN 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET  group_concat_max_len = 1000000;
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');





	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT W.tbl_location_id from (select L.tbl_location_id, 
			min(0.621371192 * (6371 * acos( cos( radians(de_120_038) ) * cos( radians(L.tbl_location_latitude) ) * cos( radians(L.tbl_location_longitude) - radians(de_120_039) ) + sin( radians(de_120_038) ) * sin( radians(L.tbl_location_latitude) ) ))) distance
			from tbl_location as L,
				 dbitems.tbl_productlocation PL,
				 dbitems.tbl_product P
			where L.tbl_location_id = PL.tbl_location_id
			and PL.tbl_product_id = P.tbl_product_id
			and P.tbl_producttype_id > 0
			and P.tbl_productstatus_id = 1001
			and length(P.tbl_product_saleprice)>0
			group by  L.tbl_location_id ) as W
	WHERE W.distance < 2
	ORDER BY W.distance
		
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStoreDataMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStoreDataMobile`(PARAM VARCHAR(20000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Nathaly Salamanca
-- Procedure: GetStoreDataMobile
-- Version: 1
-- last modified: 2013-12-03
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  -- START LIMIT
	DECLARE FIN       INT(11)       DEFAULT 0;  -- END LIMIT
	
	DECLARE de_122_018       INT(11)       DEFAULT 0;  -- id merchant 

	SET  group_concat_max_len = 1000000;
	
	
--            TABLE  TEMPORARY OF IN OUT       --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables  --
-- -----------------

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_122_018 = (select DATA from TBL_MESSAGE1 where CODE = '122.18');

-- ---------------		
-- Page limits  --
-- ---------------
	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	
-- ---------------		
-- Query of DB  --
-- ---------------
SELECT 
		CONCAT(
			GROUP_CONCAT(
			distinct
			CONCAT('"121.170":"',if( A.tbl_merchant_logoimage is null,'', A.tbl_merchant_logoimage),'"'),
			CONCAT(',"114.70":"',if( B.tbl_user_companyName is null,'', B.tbl_user_companyName),'"'),
			CONCAT(',"121.149":"',if( C.tbl_businesscategorydescription_name is null,'', C.tbl_businesscategorydescription_name),'"'),
			CONCAT(',"114.12":"',if( F.tbl_address_first is null,'', F.tbl_address_first),'"'),
			CONCAT(',"114.13":"',if( F.tbl_address_second is null,'', F.tbl_address_second ),'"'),
			CONCAT(',"47.17":"',if( G.tbl_zipcode_name is null,'', G.tbl_zipcode_name),'"'),
			CONCAT(',"47.15":"',if( H.tbl_city_name is null,'', H.tbl_city_name),'"'),
			CONCAT(',"47.16":"',if( I.tbl_state_code is null,'', I.tbl_state_code),'"'),
			CONCAT(',"47.18":"',if( J.tbl_country_name is null,'', J.tbl_country_name),'"'),
			CONCAT(',"97":"',(select GROUP_CONCAT(distinct concat(K.tbl_phone_phoneNumber))from tbl_phone K where K.tbl_phone_nmcId = A.tbl_merchant_nmcId and tbl_phonetype_id =4005),'"'),
			CONCAT(',"120.148":"',if( M.tbl_merchantwebsite_website is null,'', M.tbl_merchantwebsite_website),'"'),
			CONCAT(',"112.162":"',(SELECT GROUP_CONCAT(distinct CONCAT(if(N.tbl_deliverycompany_option  is null,'', N.tbl_deliverycompany_option ))) as JSON
							from dbitems.tbl_deliverycompany N,
							dbitems.tbl_productdelivery O,
							dbitems.tbl_product P
							where N.tbl_deliverycompany_id = O.tbl_deliverycompany_id
							and O.tbl_product_id = P.tbl_product_id
							and P.tbl_product_usernmcid =  de_122_018 ),'"')
							)
			)  as JSON
	from    
			tbl_merchant A, 
			tbl_user B,
			tbl_businesscategorydescription C,
			tbl_businesscategory D,
			tbl_merchantbusinesscategory E,
			tbl_address F,
			tbl_zipcode G,
			tbl_city H,
			tbl_state I,
			tbl_country J,
			tbl_phonetype L,
			tbl_merchantwebsite M

	where A.tbl_merchant_nmcId = de_122_018
	and  A.tbl_user_id = B.tbl_user_id
	and  A.tbl_merchant_nmcId = E.tbl_merchant_nmcId
	and  E.tbl_businesscategory_id = D.tbl_businesscategory_id
	and  D.tbl_businesscategory_id = C.tbl_businesscategory_id
	and  F.tbl_address_nmcId = A.tbl_merchant_nmcId
	and  F.tbl_zipcode_id = G.tbl_zipcode_id
	and  G.tbl_city_id = H.tbl_city_id
	and  H.tbl_state_id = I.tbl_state_id 
	and  I.tbl_country_id = J.tbl_country_id 
	and  A.tbl_merchant_nmcId = M.tbl_merchant_nmcId 
	and F.tbl_address_flag = 1
	LIMIT INI,FIN ;

    -- ELIMINATION OF TEMPORARY TABLE
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStoreDataMobile_2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStoreDataMobile_2`(PARAM VARCHAR(20000))
BEGIN 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  


	DECLARE CATEGORY_AUX VARCHAR(255) DEFAULT NULL;
	DECLARE ADDRESS_FIRST_AUX VARCHAR(255) DEFAULT NULL;
	DECLARE ADDRESS_SECOND_AUX VARCHAR(255) DEFAULT NULL;
	DECLARE WEBSITE_AUX VARCHAR(255) DEFAULT NULL;

	DECLARE de_122_018       INT(11)       DEFAULT 0;  

	SET  group_concat_max_len = 1000000;
	
	
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_122_018 = (select DATA from TBL_MESSAGE1 where CODE = '122.18');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




SET CATEGORY_AUX = (select C.tbl_categorydescription_name from tbl_merchant A, dbitems.tbl_categorydescription C, dbitems.tbl_category D, tbl_merchantbusinesscategory E where A.tbl_merchant_nmcId = de_122_018 and  A.tbl_merchant_nmcId = E.tbl_merchant_nmcId and  E.tbl_businesscategory_id = D.tbl_category_id and  D.tbl_category_id = C.tbl_category_id limit 1);
SET ADDRESS_FIRST_AUX = (select F.tbl_address_first from tbl_merchant A, tbl_address F where  A.tbl_merchant_nmcId = de_122_018 and F.tbl_address_nmcId = A.tbl_merchant_nmcId LIMIT 1);
SET ADDRESS_SECOND_AUX = (select F.tbl_address_second from tbl_merchant A, tbl_address F where  A.tbl_merchant_nmcId = de_122_018 and F.tbl_address_nmcId = A.tbl_merchant_nmcId LIMIT 1);
SET WEBSITE_AUX = (select M.tbl_merchantwebsite_website from tbl_merchant A, tbl_merchantwebsite M where A.tbl_merchant_nmcId = de_122_018 and A.tbl_merchant_nmcId = M.tbl_merchant_nmcId limit 1);

SELECT 
		CONCAT(
			GROUP_CONCAT(
			distinct
			CONCAT('"121.170":"',if( A.tbl_merchant_logoimage is null,'', A.tbl_merchant_logoimage),'"'),
			CONCAT(',"114.70":"',if( B.tbl_user_companyName is null,'', B.tbl_user_companyName),'"'),
			CONCAT(',"121.149":"',if(CATEGORY_AUX is null,'', CATEGORY_AUX),'"'),
			CONCAT(',"114.12":"',if(ADDRESS_FIRST_AUX is null,'', ADDRESS_FIRST_AUX),'"'),
			CONCAT(',"114.13":"',if(ADDRESS_SECOND_AUX is null,'', ADDRESS_SECOND_AUX),'"'),
			CONCAT(',"47.17":"',if( G.tbl_zipcode_name is null,'', G.tbl_zipcode_name),'"'),
			CONCAT(',"47.15":"',if( H.tbl_city_name is null,'', H.tbl_city_name),'"'),
			CONCAT(',"47.16":"',if( I.tbl_state_code is null,'', I.tbl_state_code),'"'),
			CONCAT(',"47.18":"',if( J.tbl_country_name is null,'', J.tbl_country_name),'"'),
			CONCAT(',"97":"',(select K.tbl_phone_phoneNumber from tbl_phone K where K.tbl_phone_nmcId = A.tbl_merchant_nmcId and tbl_phonetype_id = 4005 limit 1),'"'),
			CONCAT(',"120.148":"',if(WEBSITE_AUX is null,'', WEBSITE_AUX),'"'),
			CONCAT(',"112.162":"',(SELECT GROUP_CONCAT(distinct CONCAT(if(N.tbl_deliverycompany_option  is null,'', N.tbl_deliverycompany_option ))) as JSON
							from dbitems.tbl_deliverycompany N,
							dbitems.tbl_productdelivery O,
							dbitems.tbl_product P
							where N.tbl_deliverycompany_id = O.tbl_deliverycompany_id
							and O.tbl_product_id = P.tbl_product_id
							and P.tbl_product_usernmcid =  de_122_018 ),'"')
							)
			)  as JSON
	from    
			tbl_merchant A, 
			tbl_user B,
			tbl_address F,
			tbl_zipcode G,
			tbl_city H,
			tbl_state I,
			tbl_country J,
			tbl_phonetype L
			
	where A.tbl_merchant_nmcId = de_122_018
	and  A.tbl_user_id = B.tbl_user_id
	and  F.tbl_zipcode_id = G.tbl_zipcode_id
	and  F.tbl_city_id = H.tbl_city_id
	and  F.tbl_state_id = I.tbl_state_id 
	and  F.tbl_country_id = J.tbl_country_id 
	and F.tbl_address_flag = 1
	LIMIT INI,FIN ;


    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStoreMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStoreMobile`(PARAM VARCHAR(20000))
BEGIN 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET  group_concat_max_len = 1000000;
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');





	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



select 
	GROUP_CONCAT(
              	CONCAT('{"122.119":"',L.tbl_location_storeNumber,'"'),
				CONCAT(',"121.150":"',coalesce(L.tbl_location_storeName,''),'"}')
          ) as JSON
  	from tbl_location L, dbitems.tbl_productlocation PL, dbitems.tbl_product P
	where L.tbl_location_id = PL.tbl_location_id
	and PL.tbl_product_id = P.tbl_product_id
	and P.tbl_producttype_id > 0
	and P.tbl_productstatus_id = 1001
	and length(P.tbl_product_saleprice)>0
	
	
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStoresMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetStoresMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
 
  DECLARE de_114_112       INT(11)       DEFAULT 0;  
  DECLARE de_114_144       INT(11)       DEFAULT 0;  
 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_144 = (select DATA from TBL_MESSAGE1 where CODE = '114.144');
	SET de_114_112 = (select DATA from TBL_MESSAGE1 where CODE = '114.112');



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	






		if (de_114_112 = 5)then 
	
			SELECT 
					GROUP_CONCAT(
							CONCAT('{"122.119":"',coalesce(A.tbl_address_storeNumber,' '),'"'),
							CONCAT(',"114.179":"',M.tbl_merchant_id,'"'),
							CONCAT(',"114.70":"',if(U.tbl_user_companyName  is null,'',U.tbl_user_companyName ),'"'), 
							CONCAT(',"121.170":"',if(M.tbl_merchant_logoimage  is null,'',M.tbl_merchant_logoimage ),'"'), 
							CONCAT(',"114.12":"',A.tbl_address_first,'"'),
							CONCAT(',"114.13":"',A.tbl_address_second,'"'),
							CONCAT(',"47.15":"',if(CI.tbl_city_name  is null,'',CI.tbl_city_name ),'"'),
							CONCAT(',"47.16":"',S.tbl_state_code,'"'),
							CONCAT(',"47.17":"',if(Z.tbl_zipcode_name  is null,'',Z.tbl_zipcode_name ),'"'),
							CONCAT(',"47.18":"',if(C.tbl_country_name  is null,'',C.tbl_country_name),'"}')
								)  as JSON
				from 
					 tbl_location L,
					 tbl_locationaddress LA,
					 tbl_address A,
					 tbl_country C,
					 tbl_state S,
					 tbl_city CI,
					 tbl_zipcode Z,
					 tbl_merchant M,
					 tbl_user U
				
				where  M.tbl_merchant_nmcId = de_114_144
				  and L.tbl_location_id = LA.tbl_location_id  
				  and A.tbl_address_id = LA.tbl_address_id
				  and A.tbl_zipcode_id = Z.tbl_zipcode_id
				  and Z.tbl_city_id = CI.tbl_city_id
				  and CI.tbl_state_id = S.tbl_state_id
				  and S.tbl_country_id = C.tbl_country_id
				  and L.tbl_location_userId = M.tbl_merchant_nmcId
				  and M.tbl_user_id = U.tbl_user_id
			LIMIT INI,FIN;

		else 
			
			SELECT 
					GROUP_CONCAT(
							CONCAT('{"122.119":"',A.tbl_address_storeNumber,'"'),
							CONCAT(',"114.179":"',M.tbl_merchant_id,'"'),
							CONCAT(',"114.70":"',if(U.tbl_user_companyName  is null,'',U.tbl_user_companyName ),'"'), 
							CONCAT(',"121.170":"',if(M.tbl_merchant_logoimage  is null,'',M.tbl_merchant_logoimage ),'"'), 
							CONCAT(',"114.12":"',A.tbl_address_first,'"'),
							CONCAT(',"114.13":"',A.tbl_address_second,'"'),
							CONCAT(',"47.15":"',if(CI.tbl_city_name  is null,'',CI.tbl_city_name ),'"'),
							CONCAT(',"47.16":"',S.tbl_state_code,'"'),
							CONCAT(',"47.17":"',if(Z.tbl_zipcode_name  is null,'',Z.tbl_zipcode_name ),'"'),
							CONCAT(',"47.18":"',if(C.tbl_country_name  is null,'',C.tbl_country_name),'"}')
								)  as JSON
				from dbitems.tbl_productlocation PL,
					 tbl_location L,
					 tbl_locationaddress LA,
					 tbl_address A,
					 tbl_country C,
					 tbl_state S,
					 tbl_city CI,
					 tbl_zipcode Z,
					 tbl_merchant M,
					 tbl_user U
				  WHERE PL.tbl_product_id = de_114_144
                  and  PL.tbl_location_id = L.tbl_location_id
				  and L.tbl_location_id = LA.tbl_location_id  
				  and A.tbl_address_id = LA.tbl_address_id
				  and A.tbl_zipcode_id = Z.tbl_zipcode_id
				  and Z.tbl_city_id = CI.tbl_city_id
				  and CI.tbl_state_id = S.tbl_state_id
				  and S.tbl_country_id = C.tbl_country_id
				  and L.tbl_location_userId = M.tbl_merchant_nmcId
				  and M.tbl_user_id = U.tbl_user_id
	LIMIT INI,FIN;
	end if ;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetStoresNear010400476` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetStoresNear010400476`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: GetStoresNear010400476
-- Method: 010400476
-- Version: 1.0
-- Last modified: 2015-11-30
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 	   VARCHAR(20) DEFAULT NULL;    -- 53 User Id

	DECLARE de_120_038 VARCHAR(20) DEFAULT 0; 		-- 120.38 latitude
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0; 		-- 120.39 longitude
	
    
    SET  group_concat_max_len = 1000000;
    
-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_053 = (select right(de_053,11));
	
	SET de_120_038 = (select DATA from TBL_MESSAGE1 where CODE = '120.38');
	SET de_120_039 = (select DATA from TBL_MESSAGE1 where CODE = '120.39');

-- ---------------		
-- Query of DB  --
-- ---------------



		select GROUP_CONCAT(
		CONCAT('{"121.170":"',COALESCE(B.tbl_merchant_logoimage,''),'"'),
		CONCAT(',"114.70":"',COALESCE(A.tbl_user_companyName,''),'"'),
        CONCAT(',"127.29":"',COALESCE((select count(*) from dbitems.tbl_product where tbl_product_usernmcId = A.tbl_user_id and tbl_productstatus_id = 1001 and tbl_producttype_id = 21 and tbl_product_dateAdded >= date_sub(NOW(), INTERVAL 7 DAY)),''),'"'),
        CONCAT(',"127.31":"',COALESCE((select count(*) from dbitems.tbl_product where tbl_product_usernmcId = A.tbl_user_id and tbl_productstatus_id = 1001 and tbl_producttype_id = 21 and tbl_product_offer_f = 1),''),'"'),
        CONCAT(',"120.11":"',COALESCE(D.distance,''),'"'),
		CONCAT(',"LO":',dbuser.getNMCLocation(D.tbl_location_id),'}')) as Json

		from dbuser.tbl_user as A, 
		dbuser.tbl_merchant as B, 
		
		(select  W.tbl_location_userId, W.tbl_location_id, W.distance
		from(
			select E.tbl_location_userId,
			E.tbl_location_id ,
			(0.621371192 * (6371 * acos( cos( radians(de_120_038) ) * cos( radians(E.tbl_location_latitude) ) * cos( radians(E.tbl_location_longitude) - radians(de_120_039) ) + sin( radians(de_120_038) ) * sin( radians(E.tbl_location_latitude) ) ))) distance
			-- (0.621371192 * (6371 * acos( cos( radians(38.751970) ) * cos( radians(E.tbl_location_latitude) ) * cos( radians(E.tbl_location_longitude) - radians(-121.287553) ) + sin( radians(38.751970) ) * sin( radians(E.tbl_location_latitude) ) ))) distance

			from dbuser.tbl_location as E
			) as W
			where W.distance < 50) as D

		where A.tbl_user_id = B.tbl_user_id
        and A.tbl_user_id = D.tbl_location_userId
        order by D.distance ASC;
	
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetTerminalListByLocationIdPortal010400175` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`localhost` PROCEDURE `GetTerminalListByLocationIdPortal010400175`(PARAM VARCHAR(4000))
BEGIN 


-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: GetTerminalListByLocationIdPortal010400175
-- Method: 010400175
-- Version: 1.0
-- Last modified: 2016-09-06
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;   -- START LIMIT
	DECLARE FIN       BIGINT	   DEFAULT 0;   -- END LIMIT

	DECLARE de_114_047 INT(11) DEFAULT 0;       -- 114.47 Locagtion Id
	DECLARE de_127_107 INT(11) DEFAULT 0;		-- 127.107 Shuffle Id
	DECLARE de_114_101 INT(11) DEFAULT 0;		-- 114.101 Package Id

-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET  group_concat_max_len = 1000000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1);
	
	SET de_114_047 = (select DATA from TBL_MESSAGE1 where CODE = '114.47');
	SET de_127_107 = (select DATA from TBL_MESSAGE1 where CODE = '127.107');

-- -------------		
-- Limits     --
-- -------------

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;

-- ---------------		
-- Query of DB  --
-- ---------------

	if (length(de_127_107) > 0) then 

		set de_114_101 = (select tbl_package_id from dbitems.tbl_package_shuffle where tbl_shuffle_id = de_127_107 limit 1); 
	
		select 
		GROUP_CONCAT(
			CONCAT('{"114.47":"',COALESCE(W.tbl_location_id ,''),'"') , 
            CONCAT(',"120.69":"',COALESCE(W.tbl_terminal_id,''),'"') , 
            CONCAT(',"122.170":"',COALESCE(W.tbl_terminaltype_id,''),'"') , 
            CONCAT(',"122.123":"',COALESCE(W.tbl_terminal_manofacturer,''),'"') , 
            CONCAT(',"121.183":"',COALESCE(W.tbl_terminal_posTerminalId,''),'"') , 
            CONCAT(',"122.124":"',COALESCE(W.tbl_terminal_provider,''),'"') , 
            CONCAT(',"122.125":"',COALESCE(W.tbl_terminal_posInternalId,''),'"') , 
            CONCAT(',"122.126":"',COALESCE(W.tbl_terminal_reference,''),'"') , 
            CONCAT(',"114.104":"',COALESCE(W.tbl_terminal_qrCode,''),'"') , 
            CONCAT(',"121.141":"',COALESCE(W.tbl_terminal_lastDateActive,''),'"') , 
            CONCAT(',"123.67":"',COALESCE(W.tbl_terminalposition_id,''),'"')  , 
            CONCAT(',"114.9":"',COALESCE(if(W.tbl_terminal_update_f=1,'true','false'),''),'"') , 
            CONCAT(',"118.2":"',COALESCE(W.tbl_terminal_gcm_date,''),'"') , 
            CONCAT(',"118.3":"',COALESCE(W.tbl_terminal_gcm_update,''),'"') , 
            CONCAT(',"117.28":"',COALESCE(W.tbl_terminal_version,''),'"') , 
            CONCAT(',"118.13":"',COALESCE(W.tbl_terminal_date_download,''),'"') , 
            CONCAT(',"118.14":"',COALESCE(W.tbl_terminal_date_campaigns,''),'"') , 
            CONCAT(',"121.46":"',COALESCE(W.tbl_terminal_memory,''),'"') , 
            CONCAT(',"122.32":"',COALESCE(dbuser.GetTerminalErrorCounter(W.tbl_terminal_id),'0'),'"}') 
		)  as JSON
	
		from 
		
			(
            select
			A.tbl_location_id ,
            A.tbl_terminal_id,
            A.tbl_terminaltype_id, 
            A.tbl_terminal_manofacturer,
            A.tbl_terminal_posTerminalId,
            A.tbl_terminal_provider,
            A.tbl_terminal_posInternalId,
            A.tbl_terminal_reference,
            A.tbl_terminal_qrCode,
            A.tbl_terminal_lastDateActive,
            A.tbl_terminalposition_id,
            A.tbl_terminal_update_f,
            A.tbl_terminal_gcm_date,
            A.tbl_terminal_gcm_update,
            A.tbl_terminal_version,
            A.tbl_terminal_date_download,
            A.tbl_terminal_date_campaigns,
            A.tbl_terminal_memory
            from dbuser.tbl_terminal as A 
			left join dbitems.tbl_shuffleterminal as B on A.tbl_terminal_id = B.tbl_terminal_id 
			left join dbitems.tbl_package_shuffle as C on B.tbl_shuffle_id = C.tbl_shuffle_id 
			left join dbitems.tbl_package_layout as D on C.tbl_package_id = D.tbl_package_id
			where A.tbl_location_id = de_114_047
			and C.tbl_package_id = de_114_101
			and A.tbl_terminalposition_id = D.tbl_layout_position
            limit INI,FIN ) as W;

	else
    

		select
        GROUP_CONCAT(
			CONCAT('{"114.47":"',COALESCE(W.tbl_location_id ,''),'"') , 
            CONCAT(',"120.69":"',COALESCE(W.tbl_terminal_id,''),'"') , 
            CONCAT(',"122.170":"',COALESCE(W.tbl_terminaltype_id,''),'"') , 
            CONCAT(',"122.123":"',COALESCE(W.tbl_terminal_manofacturer,''),'"') , 
            CONCAT(',"121.183":"',COALESCE(W.tbl_terminal_posTerminalId,''),'"') , 
            CONCAT(',"122.124":"',COALESCE(W.tbl_terminal_provider,''),'"') , 
            CONCAT(',"122.125":"',COALESCE(W.tbl_terminal_posInternalId,''),'"') , 
            CONCAT(',"122.126":"',COALESCE(W.tbl_terminal_reference,''),'"') , 
            CONCAT(',"114.104":"',COALESCE(W.tbl_terminal_qrCode,''),'"') , 
            CONCAT(',"121.141":"',COALESCE(W.tbl_terminal_lastDateActive,''),'"') , 
            CONCAT(',"123.67":"',COALESCE(W.tbl_terminalposition_id,''),'"')  , 
            CONCAT(',"114.9":"',COALESCE(if(W.tbl_terminal_update_f=1,'true','false'),''),'"') , 
            CONCAT(',"118.2":"',COALESCE(W.tbl_terminal_gcm_date,''),'"') , 
            CONCAT(',"118.3":"',COALESCE(W.tbl_terminal_gcm_update,''),'"') , 
            CONCAT(',"117.28":"',COALESCE(W.tbl_terminal_version,''),'"') , 
            CONCAT(',"118.13":"',COALESCE(W.tbl_terminal_date_download,''),'"') , 
            CONCAT(',"118.14":"',COALESCE(W.tbl_terminal_date_campaigns,''),'"') , 
            CONCAT(',"121.46":"',COALESCE(W.tbl_terminal_memory,''),'"') , 
            CONCAT(',"122.32":"',COALESCE(dbuser.GetTerminalErrorCounter(W.tbl_terminal_id),'0'),'"}') 
		)  as JSON
	
		from 
		
			(
            select
			A.tbl_location_id ,
            A.tbl_terminal_id,
            A.tbl_terminaltype_id, 
            A.tbl_terminal_manofacturer,
            A.tbl_terminal_posTerminalId,
            A.tbl_terminal_provider,
            A.tbl_terminal_posInternalId,
            A.tbl_terminal_reference,
            A.tbl_terminal_qrCode,
            A.tbl_terminal_lastDateActive,
            A.tbl_terminalposition_id,
            A.tbl_terminal_update_f,
            A.tbl_terminal_gcm_date,
            A.tbl_terminal_gcm_update,
            A.tbl_terminal_version,
            A.tbl_terminal_date_download,
            A.tbl_terminal_date_campaigns,
            A.tbl_terminal_memory
            from dbuser.tbl_terminal as A 
			where A.tbl_location_id = de_114_047
			limit INI,FIN ) as W;

	end if;
		
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetTransactionByIDMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetTransactionByIDMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	 
	DECLARE INI INT(11) DEFAULT 1;  
	DECLARE FIN INT(11) DEFAULT 0;  

	DECLARE de_053 INT(18) DEFAULT 0; 
	DECLARE de_114_145 INT(11) DEFAULT 0; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
	
   
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
 




	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	SET de_114_145 = (select DATA from TBL_MESSAGE1 where CODE = '114.145');
	



 
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
	  
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
 




	select 
        GROUP_CONCAT(      
			CONCAT('"114.145":"', A.tbl_invoice_id,'"'),		
			CONCAT(',"114.179":"', A.tbl_merchant_nmcId,'"'),
			CONCAT(',"55.2":"', A.tbl_invoice_tip,'"'),
			CONCAT(',"114.116":"', if (A.tbl_invoice_date is null,'', A.tbl_invoice_date),'"'),
			CONCAT(',"37":"12345"'),
			CONCAT(',"38":"54321"')
        ) as JSON
		
	from tbl_invoice as A
		 
	where A.tbl_consumer_nmcId = de_053
	and A.tbl_invoice_id = de_114_145
	
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetTutorialStepsMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetTutorialStepsMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_121_194 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_121_194 = (select DATA from TBL_MESSAGE1 where CODE = '121.194');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
        GROUP_CONCAT(     
			CONCAT('{"120.83":"',if(A.tbl_help_tutorial_steps_tutorial_title is null,'', A.tbl_help_tutorial_steps_tutorial_title) ,'"'),
			CONCAT(',"121.194":"',tbl_help_tutorial_steps_step_id,'"')	,
			CONCAT(',"122.128":"',if(A.tbl_help_tutorial_steps_step_title is null,'',A.tbl_help_tutorial_steps_step_title ),'"')	,
			CONCAT(',"120.157":"',if(A.tbl_help_tutorial_steps_step_description is null,'',A.tbl_help_tutorial_steps_step_description ),'"}')	
        ) as JSON

	from tbl_help_tutorial_steps as A	
	where A.tbl_help_tutorial_steps_id = de_121_194

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserById` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserById`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_179 VARCHAR(45) DEFAULT NULL; 
	DECLARE LIST_PHONE_AUX TEXT DEFAULT NULL;
	DECLARE ADDRESS TEXT DEFAULT NULL; 
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 
	DECLARE LIST_PHONE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	
	SET USER_TYPE_AUX = (SELECT tbl_userType_id FROM  tbl_user where tbl_user_id = de_114_179 );
	
	IF USER_TYPE_AUX IS NOT NULL THEN
			SET LIST_PHONE_EMPTY_AUX = (SELECT  CONCAT(',"300.28":[]') AS JSON);
			
			
				CASE USER_TYPE_AUX
					
					WHEN 1 THEN 
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_id = de_114_179 
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId limit 1)  IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;			
						
						ELSE
										
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId) ;
						END IF;
				
					WHEN 2 THEN	
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId limit 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
							
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId) ;
						END IF;
				
					WHEN 3 THEN	
				
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId limit 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId) ;
						END IF;
					
					WHEN 4 THEN				
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId) ;
						END IF;

					

					END CASE;						
					
	IF (SELECT tbl_address_id FROM	tbl_address WHERE	tbl_address_nmcId = de_114_179 limit 1) is not null then
				SELECT  GROUP_CONCAT(',"300.51":{',
						CONCAT('"114.115":"',A.tbl_address_id,'"'),
						CONCAT(',"114.179":"',A.tbl_address_nmcId,'"'),
						CONCAT(',"121.45":"',COALESCE(B.tbl_addresstype_id,''),'"'),
						CONCAT(',"300.62":{',
							CONCAT('"122.87":"' ,COALESCE(C.tbl_country_id,''),'"'),
							CONCAT(',"47.18":"' ,COALESCE(C.tbl_country_name,''),'"'),
							CONCAT(',"114.17":"' ,COALESCE(C.tbl_country_code,''),'"}')
						),
						CONCAT(',"300.64":{',
							CONCAT('"120.13":"' ,COALESCE(D.tbl_state_id,''),'"'),
							CONCAT(',"47.16":"' ,COALESCE(D.tbl_state_name,''),'"'),
							CONCAT(',"122.87":"' ,COALESCE(C.tbl_country_id,''),'"}')
						),
						CONCAT(',"300.65":{',
							CONCAT('"114.14":"' ,COALESCE(E.tbl_city_id,''),'"'),
							CONCAT(',"47.15":"' ,COALESCE(E.tbl_city_name,''),'"'),
							CONCAT(',"120.13":"' ,COALESCE(D.tbl_state_id,''),'"}')
						),
						CONCAT(',"300.66":{',
							CONCAT('"122.107":"' ,COALESCE(F.tbl_zipcode_id,''),'"'),
							CONCAT(',"47.17":"' ,COALESCE(F.tbl_zipcode_name,''),'"'),
							CONCAT(',"114.14":"' ,COALESCE(E.tbl_city_id,''),'"}')
						),
						CONCAT(',"114.12":"',COALESCE(A.tbl_address_first,''),'"'),
						CONCAT(',"114.13":"',COALESCE(A.tbl_address_second,''),'"}')
					)
						AS JSON
						FROM tbl_address AS A,
							 tbl_addresstype AS B,
							 tbl_country AS C,
							 tbl_state AS D,
							 tbl_city AS E,
							 tbl_zipcode AS F
						WHERE A.tbl_address_nmcId = de_114_179
							AND A.tbl_addresstype_id = B.tbl_addresstype_id
							AND A.tbl_address_flag = 1
							AND A.tbl_country_id = C.tbl_country_id
							AND A.tbl_state_id = D.tbl_state_id
							AND A.tbl_city_id = E.tbl_city_id
							AND A.tbl_zipcode_id = F.tbl_zipcode_id 
						INTO ADDRESS;
						
	else
	
			set	ADDRESS	=(SELECT  CONCAT(',"300.51":{}') AS JSON);
	
	end if;
		

			
			SELECT 
				  GROUP_CONCAT(   
						CONCAT('{"114.179":"',tbl_user_id,'"'),
						CONCAT(',"114.123":"',tbl_userType_id,'"'),
						CONCAT(',"114.9":"',tbl_user_userTemp_f,'"'),
						CONCAT(',"114.70":"',if(tbl_user_companyName  is null,'',tbl_user_companyName ),'"'),
						CONCAT(',"114.3":"',if(tbl_user_first  is null,'',tbl_user_first ),'"'),
						CONCAT(',"114.5":"',if(tbl_user_last  is null,'',tbl_user_last ),'"'),
						CONCAT(ADDRESS),
						CONCAT(LIST_PHONE_AUX),
						CONCAT(',"114.7":"',if(tbl_user_email  is null,'',tbl_user_email ),'"'),
						CONCAT(',"114.91":"',if(tbl_user_title  is null,'',tbl_user_title ),'"}')
				  )as JSON
		   
			from tbl_user 
			where tbl_user_id = de_114_179
			
			LIMIT INI,FIN;

	ELSE		
		
		SELECT 
				  GROUP_CONCAT(   
						CONCAT('{"39":"','1014','"'),CONCAT(',"44":"','Invalid User','"}') )as JSON;
			
	END IF;
			
	
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserById_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserById_1`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_179 VARCHAR(45) DEFAULT NULL; 
	DECLARE LIST_PHONE_AUX TEXT DEFAULT NULL;
	DECLARE ADDRESS TEXT DEFAULT NULL; 
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 
	DECLARE LIST_PHONE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	
	SET USER_TYPE_AUX = (SELECT tbl_userType_id FROM  tbl_user where tbl_user_id = de_114_179 );
	
	IF USER_TYPE_AUX IS NOT NULL THEN
			SET LIST_PHONE_EMPTY_AUX = (SELECT  CONCAT(',"300.28":[]') AS JSON);
			
			
				CASE USER_TYPE_AUX
					
					WHEN 1 THEN 
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_id = de_114_179 
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId limit 1)  IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;			
						
						ELSE
										
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId) ;
						END IF;
				
					WHEN 2 THEN	
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId limit 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
							
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId) ;
						END IF;
				
					WHEN 3 THEN	
				
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId limit 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"122.87":"',if(A.tbl_phone_country_id  is null,'',A.tbl_phone_country_id ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId) ;
						END IF;
					
					WHEN 4 THEN				
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_id = de_114_179
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId) ;
						END IF;

					

					END CASE;						
					
	IF (SELECT tbl_address_id FROM	tbl_address WHERE	tbl_address_nmcId = de_114_179 limit 1) is not null then
				SELECT  GROUP_CONCAT(',"300.51":{',
						CONCAT('"114.115":"',A.tbl_address_id,'"'),
						CONCAT(',"114.179":"',A.tbl_address_nmcId,'"'),
						CONCAT(',"121.45":"',COALESCE(B.tbl_addresstype_id,''),'"'),
						CONCAT(',"300.62":{',
							CONCAT('"122.87":"' ,COALESCE(C.tbl_country_id,''),'"'),
							CONCAT(',"47.18":"' ,COALESCE(C.tbl_country_name,''),'"'),
							CONCAT(',"114.17":"' ,COALESCE(C.tbl_country_code,''),'"}')
						),
						CONCAT(',"300.64":{',
							CONCAT('"120.13":"' ,COALESCE(D.tbl_state_id,''),'"'),
							CONCAT(',"47.16":"' ,COALESCE(D.tbl_state_name,''),'"'),
							CONCAT(',"122.87":"' ,COALESCE(C.tbl_country_id,''),'"}')
						),
						CONCAT(',"300.65":{',
							CONCAT('"114.14":"' ,COALESCE(E.tbl_city_id,''),'"'),
							CONCAT(',"47.15":"' ,COALESCE(E.tbl_city_name,''),'"'),
							CONCAT(',"120.13":"' ,COALESCE(D.tbl_state_id,''),'"}')
						),
						CONCAT(',"300.66":{',
							CONCAT('"122.107":"' ,COALESCE(F.tbl_zipcode_id,''),'"'),
							CONCAT(',"47.17":"' ,COALESCE(F.tbl_zipcode_name,''),'"'),
							CONCAT(',"114.14":"' ,COALESCE(E.tbl_city_id,''),'"}')
						),
						CONCAT(',"114.12":"',COALESCE(A.tbl_address_first,''),'"'),
						CONCAT(',"114.13":"',COALESCE(A.tbl_address_second,''),'"}')
					)
						AS JSON
						FROM tbl_address AS A,
							 tbl_addresstype AS B,
							 tbl_country AS C,
							 tbl_state AS D,
							 tbl_city AS E,
							 tbl_zipcode AS F
						WHERE A.tbl_address_nmcId = de_114_179
							AND A.tbl_addresstype_id = B.tbl_addresstype_id
							AND A.tbl_address_flag = 1
							AND A.tbl_country_id = C.tbl_country_id
							AND A.tbl_state_id = D.tbl_state_id
							AND A.tbl_city_id = E.tbl_city_id
							AND A.tbl_zipcode_id = F.tbl_zipcode_id 
						INTO ADDRESS;
						
	else
	
			set	ADDRESS	=(SELECT  CONCAT(',"300.51":{}') AS JSON);
	
	end if;
		

			
			SELECT 
				  GROUP_CONCAT(   
						CONCAT('{"114.179":"',tbl_user_id,'"'),
						CONCAT(',"114.123":"',tbl_userType_id,'"'),
						CONCAT(',"114.9":"',tbl_user_userTemp_f,'"'),
						CONCAT(',"114.70":"',if(tbl_user_companyName  is null,'',tbl_user_companyName ),'"'),
						CONCAT(',"114.3":"',if(tbl_user_first  is null,'',tbl_user_first ),'"'),
						CONCAT(',"114.5":"',if(tbl_user_last  is null,'',tbl_user_last ),'"'),
						CONCAT(ADDRESS),
						CONCAT(LIST_PHONE_AUX),
						CONCAT(',"114.7":"',if(tbl_user_email  is null,'',tbl_user_email ),'"'),
						CONCAT(',"114.91":"',if(tbl_user_title  is null,'',tbl_user_title ),'"}')
				  )as JSON
		   
			from tbl_user 
			where tbl_user_id = de_114_179
			
			LIMIT INI,FIN;

	ELSE		
		
		SELECT 
				  GROUP_CONCAT(   
						CONCAT('{"39":"','1014','"'),CONCAT(',"44":"','Invalid User','"}') )as JSON;
			
	END IF;
			
	
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserCreditCardsMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserCreditCardsMobile`(PARAM VARCHAR(20000))
BEGIN 











 DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
 DECLARE INI       INT(11)       DEFAULT 1;  
 DECLARE FIN       INT(11)       DEFAULT 0;  
 DECLARE COUNTER_AUX VARCHAR(20) DEFAULT NULL;
 DECLARE de_053 INT(11)		 DEFAULT 0; 
 DECLARE de_114_009 INT(11)		 DEFAULT 0; 


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
	
   
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
 



 SET group_concat_max_len=150000;

 SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

 SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
 SET de_114_009 = (select DATA from TBL_MESSAGE1 where CODE = '114.9');
 




 
 IF (length(INI) > 0) then 
  SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
 ELSE
  set INI = 0;
 END IF;
  
 IF (length(FIN) > 0) then 
  SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
 ELSE
  set FIN = 999999999;
 END IF;
 



	IF de_114_009 = 0 then
		
		SELECT 
		 CONCAT(
			  GROUP_CONCAT(
				CONCAT('{"120.4":"',if(A.tbl_card_tocken  is null,'',A.tbl_card_tocken),'"'),
				CONCAT(',"120.7":"',if(B.tbl_cardstype_id  is null,'',B.tbl_cardstype_id ),'"'),
				CONCAT(',"48.6":"',if(B.tbl_cardstype_id  is null,'',B.tbl_card_nickname ),'"}')
				)
			)  as JSON
		FROM dbcards.tbl_cardsconsumer as A, dbcards.tbl_card as B
		WHERE A.tbl_cardsconsumer_nmcId = de_053
		and B.tbl_card_tocken = A.tbl_card_tocken
	
		
		LIMIT INI,FIN;
			
	else 
		
		
		SELECT 
		 CONCAT(
			  GROUP_CONCAT(
				CONCAT('{"120.4":"',if(A.tbl_card_tocken  is null,'',A.tbl_card_tocken),'"'),
				CONCAT(',"120.7":"',if(B.tbl_cardstype_id  is null,'',B.tbl_cardstype_id ),'"'),
				CONCAT(',"48.6":"',if(B.tbl_cardstype_id  is null,'',B.tbl_card_nickname ),'"}')
				)
			)  as JSON
		FROM dbcards.tbl_cardsconsumer as A, dbcards.tbl_card as B
		WHERE A.tbl_cardsconsumer_nmcId = de_053
		and B.tbl_card_tocken = A.tbl_card_tocken
	
		
		
		LIMIT INI,FIN;
		
		
		
	END IF;	
		
		
	

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserListByParentPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserListByParentPortal`(PARAM VARCHAR(20000))
BEGIN 















	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;



	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	

 

 

  DECLARE de_114_179       INT(11)       DEFAULT 0; 

  DECLARE de_114_123 	   INT(2)        DEFAULT 0; 

 

	


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

    

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));

	

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	




	SET group_concat_max_len=1500000;



	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');

	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');



	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');

	SET de_114_123 = (select DATA from TBL_MESSAGE1 where CODE = '114.123');

	




	

	IF (length(INI) > 0) then 

		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');

	ELSE

		set INI = 0;

	END IF;

		

	IF (length(FIN) > 0) then 

		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;

	ELSE

		set FIN = 999999999;

	END IF;

	




	 



		select 

			GROUP_CONCAT(

					CONCAT('{"114.179":"',coalesce(tbl_user_id,''),'"'),

					CONCAT(',"114.150":"',coalesce(tbl_user_parentId,''),'"'),

					CONCAT(',"127.10":"',coalesce(tbl_owner_type_id,''),'"'),

					CONCAT(',"114.123":"',coalesce(tbl_userType_id,''),'"'),

					CONCAT(',"114.3":"',coalesce(tbl_user_first,''),'"'),

					CONCAT(',"114.4":"',coalesce(tbl_user_middle,''),'"'),

					CONCAT(',"114.5":"',coalesce(tbl_user_last,''),'"'),

					CONCAT(',"122.91":"',coalesce(tbl_admin_position,''),'"'),

					CONCAT(',"122.92":"',coalesce(tbl_admin_department,''),'"'),

					CONCAT(',"121.145":"',coalesce(tbl_admin_supervisor,''),'"'),				

					CONCAT(',"114.143":"',coalesce(tbl_userstatus_id,''),'"'),

					CONCAT(',"114.70":"',coalesce(tbl_user_companyName,''),'"}')



			  ) as JSON

		from tbl_user 

		where tbl_user_id

		and tbl_user_parentId = de_114_179

		and tbl_userType_id = de_114_123;



	



		

		

		

		

		
		DROP TABLE TBL_MESSAGE1;

	

  

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserListByParentPortal010400022` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserListByParentPortal010400022`(PARAM VARCHAR(20000))
BEGIN 







  




	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
 
	DECLARE de_53       VARCHAR(20)       DEFAULT 0; 
	
 
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=1500000;

	SET de_53 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_53 = (select right(de_53,11));
	



	

		select 
			GROUP_CONCAT(
					CONCAT('{"53":"',coalesce((select dbuser.getnmcid(tbl_user_id)),''),'"'),
					CONCAT(',"114.150":"',coalesce(tbl_user_parentId,''),'"'),
					CONCAT(',"114.3":"',coalesce(tbl_user_first,''),'"'),
					CONCAT(',"114.4":"',coalesce(tbl_user_middle,''),'"'),
					CONCAT(',"114.5":"',coalesce(tbl_user_last,''),'"'),
					CONCAT(',"122.91":"',coalesce(tbl_user_position,''),'"'),
					CONCAT(',"122.92":"',coalesce(tbl_user_department,''),'"'),
					CONCAT(',"121.145":"',coalesce(tbl_user_supervisor,''),'"'),				
					CONCAT(',"114.143":"',coalesce(tbl_userstatus_id,''),'"'),
					CONCAT(',"114.70":"',coalesce(tbl_user_companyName,''),'"}')

			  ) as JSON
		from tbl_user 
		where tbl_user_id
		and tbl_user_parentId = de_53;

		
		DROP TABLE TBL_MESSAGE1;
	
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserPaymentAccountSummaryByIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserPaymentAccountSummaryByIdPortal`(PARAM VARCHAR(20000))
BEGIN 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	

	
	DECLARE de_114_179 VARCHAR(11) DEFAULT 0; 	
	DECLARE de_114_123 VARCHAR(11) DEFAULT 0; 	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	





select 
	GROUP_CONCAT(
              	CONCAT('{"114.179":"',B.tbl_cardsconsumer_nmcId,'"'),
				CONCAT(',"120.7:"',A.tbl_accounttype_id,'"'),
				CONCAT(',"120.16:"',A.tbl_card_tocken,'"'),
				CONCAT(',"48.6:"',A.tbl_card_nickname,'"'),
				CONCAT(',"114.138:"',A.tbl_card_dateAdded,'"'),
				CONCAT(',"114.139:"',A.tbl_card_dateExpire,'"'),
				CONCAT(',"48.2:"',A.tbl_card_chardholderName,'"'),			
				CONCAT(',"114.12:"',(SELECT  IF(
												( SELECT CONCAT(C.tbl_address_first,' ',C.tbl_address_second) FROM dbuser.tbl_address as C where C.tbl_address_nmcId = de_114_179 and C.tbl_address_flag = 1 and C.tbl_addresstype_id = 14 LIMIT 1) IS NULL,
												( SELECT CONCAT(C.tbl_address_first,' ',C.tbl_address_second) FROM dbuser.tbl_address as C where C.tbl_address_nmcId = de_114_179 LIMIT 1),
												(SELECT CONCAT(C.tbl_address_first,' ',C.tbl_address_second) FROM dbuser.tbl_address as C where C.tbl_address_nmcId = de_114_179 and C.tbl_address_flag = 1 and C.tbl_addresstype_id = 14 LIMIT 1))),'"'),
				CONCAT(',"120.107:"',A.tbl_card_datemodified,'"}')
          ) as JSON
  	from dbcards.tbl_card As A, dbcards.tbl_cardsconsumer as B
	where 
	A.tbl_card_tocken = B.tbl_card_tocken
	and B.tbl_cardsconsumer_nmcId= de_114_179

	
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserShippingAddressMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserShippingAddressMobile`(PARAM VARCHAR(20000))
BEGIN 
-- --------------------------------------------------------
-- Autor: Nathaly Salamanca
-- Procedure:GetUserShippingAddressMobile
-- Method:GETSHIPSAD   
-- Version: 1.0
-- last modified: 2013-12-20
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  -- 
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  -- START LIMIT
	DECLARE FIN       INT(11)       DEFAULT 0;  -- END LIMIT
	
 	DECLARE de_114_115      INT(11)       DEFAULT NULL;  -- Address id 
	
--            TABLE  TEMPORARY OF IN OUT       --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables  --
-- -----------------
	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_115 = (select DATA from TBL_MESSAGE1 where CODE = '114.115');

-- ---------------		
-- Page limits  --
-- ---------------
	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	
-- ---------------		
-- Query of DB  --
-- ---------------
	SELECT 
		GROUP_CONCAT(
				CONCAT('"121.45":"',coalesce(ADT.tbl_addresstype_name,' '),'"'),
				CONCAT(',"47.13":"',coalesce(A.tbl_addresstype_id,' '),'"'),
				CONCAT(',"48.6":"',coalesce(A.tbl_address_nickname,' '),'"'),
				CONCAT(',"48.28":"',A.tbl_address_phoneNumber,'"'),  
                CONCAT(',"114.115":"',A.tbl_address_id,'"'), 
				CONCAT(',"114.12":"',coalesce(A.tbl_address_first),'"'),
				CONCAT(',"114.13":"',coalesce(A.tbl_address_second),'"'),
				CONCAT(',"47.15":"',coalesce(Z.tbl_zipcode_name),'"'),
				CONCAT(',"47.16":"',coalesce(CI.tbl_city_name),'"'),
				CONCAT(',"47.17":"',coalesce(S.tbl_state_name),'"'),
				CONCAT(',"47.18":"',coalesce(CO.tbl_country_name),'"')
						)  as JSON 
from tbl_address A,
	 tbl_addresstype ADT,
	 tbl_zipcode Z,
	 tbl_city CI,
	 tbl_state S,
	 tbl_country CO 

where A.tbl_addresstype_id  =ADT.tbl_addresstype_id
and A.tbl_zipcode_id = Z.tbl_zipcode_id
and Z.tbl_city_id = CI.tbl_city_id
and CI.tbl_state_id = S.tbl_state_id
and S.tbl_country_id = CO.tbl_country_id
and A.tbl_addresstype_id = 13
and A.tbl_address_id = de_114_115
	LIMIT INI,FIN;

    -- ELIMINATION OF TEMPORARY TABLE
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetUserShippingAddressMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetUserShippingAddressMobile_1`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
 	DECLARE de_114_115      INT(11)       DEFAULT NULL;  
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_115 = (select DATA from TBL_MESSAGE1 where CODE = '114.115');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	SELECT 
		GROUP_CONCAT(
				CONCAT('"121.45":"',coalesce(ADT.tbl_addresstype_name,' '),'"'),
				CONCAT(',"47.13":"',coalesce(A.tbl_addresstype_id,' '),'"'),
				CONCAT(',"48.6":"',coalesce(A.tbl_address_nickname,' '),'"'),
				CONCAT(',"48.28":"',A.tbl_address_phoneNumber,'"'),  
                CONCAT(',"114.115":"',A.tbl_address_id,'"'), 
				CONCAT(',"114.12":"',coalesce(A.tbl_address_first),'"'),
				CONCAT(',"114.13":"',coalesce(A.tbl_address_second),'"'),
				CONCAT(',"47.17":"',coalesce(Z.tbl_zipcode_name),'"'),
				CONCAT(',"47.15":"',coalesce(CI.tbl_city_name),'"'),
				CONCAT(',"47.16":"',coalesce(S.tbl_state_name),'"'),
				CONCAT(',"47.18":"',coalesce(CO.tbl_country_name),'"')
						)  as JSON 
from tbl_address A,
	 tbl_addresstype ADT,
	 tbl_zipcode Z,
	 tbl_city CI,
	 tbl_state S,
	 tbl_country CO 

where A.tbl_addresstype_id  = ADT.tbl_addresstype_id
and A.tbl_zipcode_id = Z.tbl_zipcode_id
and Z.tbl_city_id = CI.tbl_city_id
and CI.tbl_state_id = S.tbl_state_id
and S.tbl_country_id = CO.tbl_country_id

and A.tbl_address_id = de_114_115
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetZipcodeByCityIdPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetZipcodeByCityIdPortal`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_014 INTEGER(11) DEFAULT 0; 
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_014 = (select DATA from TBL_MESSAGE1 where CODE = '114.14');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	
	SELECT 
     CONCAT(
          GROUP_CONCAT(
            CONCAT('{"122.107":"',tbl_zipcode_id,'","47.17":"',if(tbl_zipcode_name  is null,'',tbl_zipcode_name ),'"}')
			)
        )  as JSON
	from tbl_zipcode
	where tbl_city_id = de_114_014

	LIMIT INI,FIN;
	
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetZipcodesByCityMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetZipcodesByCityMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_094 VARCHAR(11) DEFAULT 0; 


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_094 = (select DATA from TBL_MESSAGE1 where CODE = '114.94');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	
	SELECT 
     CONCAT(
          GROUP_CONCAT(
				CONCAT('{"122.107":"',tbl_zipcode_id,'"'),
				CONCAT(',"47.15":"',if(B.tbl_city_name  is null,'',B.tbl_city_name ),'"'),
				CONCAT(',"47.17":"',if(A.tbl_zipcode_name  is null,'',A.tbl_zipcode_name ),'"}')
          )
       )  as JSON
from tbl_zipcode as A, tbl_city as B
	where A.tbl_city_id = de_114_094
	and A.tbl_city_id = B.tbl_city_id
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `GetZipcodesByCountryMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `GetZipcodesByCountryMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_017 VARCHAR(4) DEFAULT 0; 
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=1500000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_017 = (select DATA from TBL_MESSAGE1 where CODE = '114.17');
	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');




	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	





	SELECT 
          GROUP_CONCAT(
				CONCAT('{"122.107":"', A.tbl_zipcode_id,'"'),
				CONCAT(',"47.17":"',if(A.tbl_zipcode_name    is null,'',A.tbl_zipcode_name   ),'"}')
        )  as JSON

	from tbl_zipcode as A, tbl_city as B, tbl_state as C, tbl_country as D
	where D.tbl_country_id = de_114_017
		and D.tbl_country_id = C.tbl_country_id
		and C.tbl_state_id = B.tbl_state_id
		and B.tbl_city_id = A.tbl_city_id
		and UPPER(A.tbl_zipcode_name) like CONCAT(UPPER(de_114_127),"%")
		
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `josetest` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `josetest`()
BEGIN
DECLARE CADENA_IMAGE VARCHAR(255);
DECLARE de_047_042 VARCHAR(255);

SET CADENA_IMAGE = '2| 3| 4|';

WHILE (LENGTH(CADENA_IMAGE)>0) DO

   SET de_047_042 = (SELECT SUBSTR(CADENA_IMAGE,1,LOCATE('|',CADENA_IMAGE)-1));
   SET CADENA_IMAGE = (SELECT SUBSTR(CADENA_IMAGE,LOCATE('|',CADENA_IMAGE)+1));
   
   SELECT de_047_042;
  
   END WHILE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `jsonTest` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `jsonTest`(IN MSG_IN VARCHAR(20000))
BEGIN

DECLARE pepe VARCHAR(45) default null;

	SET pepe =  (select common_schema.get_option(MSG_IN, 'nombre'));
	
SELECT pepe;

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `KillPhoneforUser020400295` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `KillPhoneforUser020400295`(IN MSG_IN VARCHAR(20000))
BEGIN





	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_057 VARCHAR(75) DEFAULT NULL;  
	DECLARE de_053 VARCHAR(20) DEFAULT NULL;
	DECLARE de_120_157 TEXT DEFAULT NULL;
	DECLARE de_114_143 INT(11) DEFAULT NULL;
	





	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET de_057 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '57');
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	SET de_120_157 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.157');
	SET de_114_143 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.143');

	update tbl_device set tbl_status_id = de_114_143 where tbl_device_udid = de_057;

	if (select tbl_deviceblock_id from tbl_deviceblock where tbl_deviceblock_udid = de_057 limit 1) is null then

		insert into tbl_deviceblock set 
		tbl_deviceblock_udid = de_057,
		tbl_deviceblock_dateModified = NOW(),
		tbl_deviceblock_usernmcid = de_053,
		tbl_deviceblock_comments = COALESCE(convert(unhex(de_120_157) USING UTF8),'');


	else 

		update tbl_deviceblock set 
		tbl_deviceblock_dateModified = NOW(),
		tbl_deviceblock_usernmcid = coalesce(de_053,tbl_deviceblock_usernmcid) ,
		tbl_deviceblock_comments =  COALESCE(convert(unhex(de_120_157) USING UTF8),tbl_deviceblock_comments)
		where tbl_deviceblock_udid = de_057;

	end if;
	

	
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}')) AS JSON;
	
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `kill_sleepers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `kill_sleepers`(IN threshold_seconds INT)
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE v_id BIGINT;
/* 
CALL kill_sleepers(60);

SELECT ID, USER, HOST, DB, COMMAND, TIME, STATE
FROM INFORMATION_SCHEMA.PROCESSLIST
ORDER BY TIME DESC
LIMIT 100;



*/
  DECLARE cur CURSOR FOR
    SELECT ID
    FROM INFORMATION_SCHEMA.PROCESSLIST
    WHERE USER NOT IN ('system user','event_scheduler')
      AND ID <> CONNECTION_ID()
      AND COMMAND='Sleep'
      AND TIME > threshold_seconds;

  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

  OPEN cur;
  read_loop: LOOP
    FETCH cur INTO v_id;
    IF done THEN
      LEAVE read_loop;
    END IF;

    SET @k = CONCAT('KILL ', v_id);
    PREPARE s FROM @k;
    EXECUTE s;
    DEALLOCATE PREPARE s;
  END LOOP;

  CLOSE cur;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `LinkTerminalToLocation020300301` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `LinkTerminalToLocation020300301`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Author: Luis Gerardo Porras 
-- Procedure: LinkTerminalToLocation020300301
-- Method: 030400172
-- Version: 1.0
-- Last modified: 2014-06-16
-- --------------------------------------------------------
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_122_170 VARCHAR(45) DEFAULT NULL; -- 122.170 Terminal Type
	DECLARE de_122_123 VARCHAR(45) DEFAULT NULL; -- 122.123 Terminal Manufacture
	DECLARE de_121_183 VARCHAR(45) DEFAULT NULL; -- 121.183 Pos Terminal ID 
	DECLARE de_122_125 VARCHAR(45) DEFAULT NULL; -- 122.125 Internal Pos Terminal
	DECLARE de_122_124 VARCHAR(45) DEFAULT NULL; -- 122.124 Provider Terminal
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL; -- 122.126 Reference
	DECLARE de_114_047 INTEGER(11) DEFAULT 0;    -- 114.47 Location id
	DECLARE de_114_104 VARCHAR(255) DEFAULT 0;   -- 114.104 QrCode
	DECLARE de_122_012 VARCHAR(255) DEFAULT NULL; -- 122.12 GCM
	DECLARE de_123_067 INTEGER(11) DEFAULT 0;    -- 123.67 Terminal position
    
	DECLARE NICKNAME_AUX VARCHAR(45) DEFAULT NULL; 
	DECLARE SHUFFLE_ID INTEGER(11) DEFAULT 0;   
	
	DECLARE de_SH TEXT DEFAULT NULL;
	DECLARE CADENA_SHUFFLE TEXT DEFAULT NULL;
	DECLARE SHUFFLE_AUX TEXT DEFAULT NULL;
	
-- --------------------
-- Declare auxiliary --
-- --------------------

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE de_120_069 VARCHAR(45) DEFAULT NULL; -- TERMINAL ID
	
-- ---------------
-- Validations --
-- ---------------
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	-- TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
-- -----------------	
-- Set variables --
-- -----------------

	SET de_122_170 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.170');
	SET de_122_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.123');
	SET de_121_183 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.183');
	SET de_122_125 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.125');
	SET de_122_124 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.124');
	SET de_122_126 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.126');
	SET de_114_047 = (SELECT DATA from TBL_MESSAGE WHERE CODE = '114.47');
	SET de_114_104 = (SELECT DATA from TBL_MESSAGE WHERE CODE = '114.104');
	SET de_122_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.12');

	SET de_120_069 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.69');

	SET de_123_067 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '123.67');

	
-- ---------------		
-- Query of DB  --
-- ---------------

	if length(de_120_069)>0 then
		
		set NICKNAME_AUX = (select tbl_terminal_reference from dbuser.tbl_terminal where tbl_terminal_id = de_120_069);
		
		if NICKNAME_AUX != de_122_126 then
			
			set de_SH = (select GROUP_CONCAT(CONCAT('',tbl_shuffle_id,'|'))
						from dbitems.tbl_shuffleterminal 
						where tbl_terminal_id = de_120_069
						);
			
			set CADENA_SHUFFLE = REPLACE(de_SH,'|,','|');	

			WHILE (LENGTH(CADENA_SHUFFLE)>0) DO
				
				SET SHUFFLE_AUX = TRIM((SELECT SUBSTR(CADENA_SHUFFLE,1,LOCATE('|',CADENA_SHUFFLE)-1)));
				SET CADENA_SHUFFLE = (SELECT SUBSTR(CADENA_SHUFFLE,LOCATE('|',CADENA_SHUFFLE)+1));
		 
				if (select count(tbl_terminal_id) from dbitems.tbl_shuffleterminal where tbl_shuffle_id = SHUFFLE_AUX) = 1 then
					
					update dbitems.tbl_package_shuffle set
					tbl_shuffle_published = 0
					where tbl_shuffle_id = SHUFFLE_AUX;
					
					update dbitems.tbl_package set
					tbl_packagestatus_id = 66002
					where tbl_package_id = (select tbl_package_id from dbitems.tbl_package_shuffle where tbl_shuffle_id = SHUFFLE_AUX);
					
				end if;
		 
			END WHILE;

			delete from dbitems.tbl_shuffleterminal where tbl_terminal_id = de_120_069;
			
		end if;
		
		
		
        if (select tbl_location_id from dbuser.tbl_terminal where tbl_terminal_id = de_120_069) != de_114_047 then
		
			set de_SH = (select GROUP_CONCAT(CONCAT('',tbl_shuffle_id,'|'))
						from dbitems.tbl_shuffleterminal 
						where tbl_terminal_id = de_120_069
						);
			
			set CADENA_SHUFFLE = REPLACE(de_SH,'|,','|');	

			WHILE (LENGTH(CADENA_SHUFFLE)>0) DO
				
				SET SHUFFLE_AUX = TRIM((SELECT SUBSTR(CADENA_SHUFFLE,1,LOCATE('|',CADENA_SHUFFLE)-1)));
				SET CADENA_SHUFFLE = (SELECT SUBSTR(CADENA_SHUFFLE,LOCATE('|',CADENA_SHUFFLE)+1));
		 
				if (select count(tbl_terminal_id) from dbitems.tbl_shuffleterminal where tbl_shuffle_id = SHUFFLE_AUX) = 1 then
					
					update dbitems.tbl_package_shuffle set
					tbl_shuffle_published = 0
					where tbl_shuffle_id = SHUFFLE_AUX;
					
					update dbitems.tbl_package set
					tbl_packagestatus_id = 66002
					where tbl_package_id = (select tbl_package_id from dbitems.tbl_package_shuffle where tbl_shuffle_id = SHUFFLE_AUX);
					
				end if;
		 
			END WHILE;
		
			delete from dbitems.tbl_shuffleterminal where tbl_terminal_id = de_120_069;
		
		end if;
        
		UPDATE tbl_terminal SET 
		tbl_location_id = de_114_047,
		tbl_terminal_reference = COALESCE(de_122_126,tbl_terminal_reference),
		tbl_terminal_gcm = COALESCE(de_122_012,tbl_terminal_gcm),
        tbl_terminal_lastDateActive = NOW()
		WHERE tbl_terminal_id = de_120_069;
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('120.69', de_120_069);

	else

		if (length(de_121_183)=0 or upper(de_121_183) = 'NULL') then 
        
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1819'),('44','Invalid terminal');
            
		else
			
			if (select tbl_terminal_id from tbl_terminal where tbl_terminal_posTerminalId = de_121_183 limit 1) is null then  

				insert into tbl_terminal set 
				tbl_location_id = de_114_047,
				tbl_terminaltype_id = COALESCE(de_122_170,2204),
				tbl_terminal_manofacturer = COALESCE(de_122_123,'AIO'),
				tbl_terminal_posTerminalId = de_121_183,
				tbl_terminal_posInternalId = COALESCE(de_122_125,NULL),
				tbl_terminal_provider = COALESCE(de_122_124,NULL),
				tbl_terminal_qrCode = COALESCE(de_114_104,NULL),
				tbl_terminal_reference = COALESCE(de_122_126,NULL),
				tbl_terminal_gcm = COALESCE(de_122_012,NULL),
				tbl_terminal_lastDateActive = NOW(),
				tbl_terminalposition_id = COALESCE(de_123_067,69002),
				tbl_terminal_memory = -1;

				SET de_120_069 = (SELECT LAST_INSERT_ID() FROM tbl_terminal limit 1);
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');

			else 

				SET de_120_069 = (select tbl_terminal_id from tbl_terminal where tbl_terminal_posTerminalId = de_121_183 limit 1);
			
				set NICKNAME_AUX = (select tbl_terminal_reference from dbuser.tbl_terminal where tbl_terminal_id = de_120_069);
		
				if NICKNAME_AUX != de_122_126 then
					delete from dbitems.tbl_shuffleterminal where tbl_terminal_id = de_120_069;
				end if;
			
				if (select tbl_location_id from dbuser.tbl_terminal where tbl_terminal_id = de_120_069) != de_114_047 then
					delete from dbitems.tbl_shuffleterminal where tbl_terminal_id = de_120_069;
				end if;
			
				UPDATE tbl_terminal SET 
				tbl_location_id = de_114_047,
				tbl_terminaltype_id = COALESCE(de_122_170,2204),
				tbl_terminal_reference = COALESCE(de_122_126,tbl_terminal_reference),
				tbl_terminal_manofacturer = COALESCE(de_122_123,'AIO'),
				tbl_terminal_gcm = COALESCE(de_122_012,tbl_terminal_gcm),
				tbl_terminal_lastDateActive = NOW(),
				tbl_terminalposition_id = COALESCE(de_123_067,69002)
				WHERE tbl_terminal_posTerminalId = de_121_183;

				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
			
			end if;

        end if;

	end if;
 
	
    
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"120.69":"',de_120_069,'"}')) AS JSON;
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	end if;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `Loggin010400005` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `Loggin010400005`(IN MSG_IN VARCHAR(20000))
BEGIN






	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
		
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 	
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; 		
	DECLARE de_057 VARCHAR(75) DEFAULT NULL;	    
	



	
	
	DECLARE PASSWORD_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE USERID_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE DEVICE_INI_AUX VARCHAR(40) DEFAULT NULL;
	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL; 
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;
	
	
	
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_72 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_123 VARCHAR(45) DEFAULT NULL;





	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52'); 
	SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57'); 
	
	
	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
	




	SET USERID_AUX = (select tbl_user_id FROM tbl_user where tbl_user_email = de_114_007);
	SET PASSWORD_TEMPORAL_AUX = (select tbl_user_passwordTemp_f FROM tbl_user where tbl_user_email = de_114_007);
	
	SET DEVICE_INI_AUX = (SELECT tbl_status_id FROM tbl_device  where tbl_device_udid = de_057 limit 1);
			
		CASE DEVICE_INI_AUX 
			when 3 then		

				
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','1827'),('44','Blocked Device'); 
					
			when 2 then		

				
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','1827'),('44','Blocked Device'); 
					
			

			else 
	
				IF (SELECT tbl_user_email FROM tbl_user WHERE  tbl_user_email = de_114_007) IS NULL THEN 
	
						
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1014'),('44','Account Not Found'); 	
					
				ELSE
	
					IF(SELECT tbl_userType_id from tbl_user  WHERE  tbl_user_email = de_114_007) != 1 then  
					
					
							
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1824'),('44','Invalid consumer'); 	 
	
					ELSE
	
	
						IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 ) = 34 then 
		
							
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','3001'),('44','Account Not Valid'); 	 
						
						ELSE
	
							IF (SELECT tbl_user_email FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_052) USING utf8 ))) is null then 
	
							
								IF (select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX) is null then 		
				
									insert into tbl_block_account set
									tbl_user_id = USERID_AUX,
									tbl_block_account_numtry = 1,
									tbl_block_account_datelasttry = NOW();
									
										
									insert into TBL_MESSAGE (CODE,DATA)
									values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30'); 
	
								ELSE
									
									SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
									SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
									SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

									IF (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) < 3 then 	
	
										IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		

											set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) +1;
											
											
											SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
											
											update tbl_block_account set 
											tbl_block_account_numtry = PINCODECONT_AUX,
											tbl_block_account_datelasttry = NOW()
											where tbl_user_id = USERID_AUX;
											
											insert into TBL_MESSAGE (CODE,DATA)
											values('39','1825'),('44','Invalid Password'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);
										
										ELSE 
										
											update tbl_block_account set 
											tbl_block_account_numtry = 1,
											tbl_block_account_datelasttry = NOW()
											where tbl_user_id = USERID_AUX;
									
											insert into TBL_MESSAGE (CODE,DATA)
											values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
									
										END IF;
	
									ELSE
					
										IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		
									
											set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) - (NOW()-INTERVAL 30 MINUTE);
									
											insert into TBL_MESSAGE (CODE,DATA)
											values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
							
										ELSE
										
											update tbl_block_account set 
											tbl_block_account_numtry = 1,
											tbl_block_account_datelasttry = NOW()
											where tbl_user_id = USERID_AUX;
									
											insert into TBL_MESSAGE (CODE,DATA)
											values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
									
										END IF;
										
									END IF;
								END IF;
							ELSE 
									
									
								IF(select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX and tbl_block_account_numtry < 3) is null then 
				
								
									SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
									SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
									SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

									IF (LASTTRY_AUX > NOW_30_AUX) then 
									
										insert into TBL_MESSAGE (CODE,DATA)
										values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
										
									ELSE
									
										delete from tbl_block_account where tbl_user_id = USERID_AUX;

								
										case PASSWORD_TEMPORAL_AUX
											when 1 then			
												IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
												
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
												else
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  
												end if;
												
											when 0 then			
													
												IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
												
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
												else
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 
												end if;
										end case;
									
									END IF;
								
								ELSE
									
									delete from tbl_block_account where tbl_user_id = USERID_AUX;
									
									
										case PASSWORD_TEMPORAL_AUX
											when 1 then			
												IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
												
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
												else
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  
												end if;
												
											when 0 then			
													
												IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
												
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
												else
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 
												end if;
										end case;
											
								end if;
							end if;
						end if;
					end if;
				end if;				
		end case;						






	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);
	set RESULT_122_72 = (select DATA from TBL_MESSAGE where CODE = 122.72); 
	set RESULT_114_123 = (select DATA from TBL_MESSAGE where CODE = 114.123); 
	
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74); 
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129); 

	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=5) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"'),CONCAT(',"122.72":"',RESULT_122_72,'"'),CONCAT(',"114.123":"',RESULT_114_123,'"}')) as JSON;

	elseif ((select count(*) from TBL_MESSAGE)=4) then	
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"}'))AS JSON;
		
	end if;


	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `MarkMessagesAsViewed020400586` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `MarkMessagesAsViewed020400586`(IN MSG_IN VARCHAR(20000))
BEGIN


	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 


	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));




	update tbl_help_ticket set
	tbl_help_ticket_read_flag = 1,
    tbl_help_ticke_read_by_user = de_053,
    tbl_help_ticket_read_date = NOW()
	where tbl_help_ticket_receiver = de_053
    and tbl_help_ticket_read_flag = 0;
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `NewRegistrationConsumerPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `NewRegistrationConsumerPortal`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_179 VARCHAR(50) DEFAULT NULL; 
	DECLARE de_121_127 VARCHAR(50) DEFAULT NULL; 
	DECLARE de_114_027 VARCHAR(20) DEFAULT NULL; 

	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	DECLARE CONSUMERID_AUX VARCHAR(50) DEFAULT 0;
	DECLARE DEVICE_AUX VARCHAR(50) DEFAULT 0;
		



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




		
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');
		SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.27');	
	 
		
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		Update tbl_user set 
		tbl_user_userTemp_f = 0,
		tbl_user_passwordTemp_f = 0,
		tbl_user_dateModified = NOW(),
		tbl_user_password = md5(convert(unhex(de_121_127) using utf8)),
		tbl_user_pinCode =  md5(convert(unhex(de_114_027) using utf8))
		where tbl_user_id = de_114_179;


		insert into tbl_consumer set
			tbl_consumer_nmcId = de_114_179,
			tbl_consumer_facebook_f = 0,
			tbl_consumer_twitter_f = 0,
			tbl_consumer_receivePushNotificaton_f = 0,
			tbl_consumer_receiveExpireOffers_f = 0,
			tbl_consumer_deleteExpireOffers_f = 0,
			tbl_user_id = de_114_179;




			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
		
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantByReseller030400398` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `RegisterMerchantByReseller030400398`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;	 
	
    DECLARE de_114_179 VARCHAR(20) DEFAULT NULL;
	
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;      
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;      
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;     
	DECLARE de_114_070 VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;  	      
	DECLARE de_127_010 VARCHAR(4) DEFAULT NULL; 	  
	
	DECLARE de_114_004 VARCHAR(40) DEFAULT NULL; 	  
	DECLARE de_114_091 VARCHAR(40) DEFAULT NULL; 	  

	DECLARE de_120_157 TEXT DEFAULT NULL;  

	DECLARE de_123_071 VARCHAR(45) DEFAULT NULL;    -- Tax Id
	
	
	DECLARE _US_PH TEXT DEFAULT NULL;  	
	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 	
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;

		
	DECLARE _US_AD 	TEXT DEFAULT NULL;
	DECLARE de_121_045_CADENA TEXT DEFAULT NULL; 
	DECLARE de_114_012_CADENA TEXT DEFAULT NULL; 
	DECLARE de_114_013_CADENA TEXT DEFAULT NULL; 
	DECLARE de_122_087_CADENA TEXT DEFAULT NULL; 	
	DECLARE de_120_013_CADENA TEXT DEFAULT NULL; 
	DECLARE de_114_014_CADENA TEXT DEFAULT NULL; 
	DECLARE de_122_107_CADENA TEXT DEFAULT NULL; 

	DECLARE de_121_045 INT(11) DEFAULT NULL;  			
	DECLARE de_114_012 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_114_013 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_122_087 VARCHAR(11) DEFAULT NULL;  			
	DECLARE de_120_013 VARCHAR(11) DEFAULT NULL;  			
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL;  			
	DECLARE de_122_107 VARCHAR(11) DEFAULT NULL;
	
	
    DECLARE _US_AC 	TEXT DEFAULT NULL;
    DECLARE de_048_015_CADENA TEXT DEFAULT NULL; 
	DECLARE de_118_005_CADENA TEXT DEFAULT NULL; 
	DECLARE de_120_007_CADENA TEXT DEFAULT NULL; 
	DECLARE de_121_017_CADENA TEXT DEFAULT NULL; 	
	DECLARE de_048_006_CADENA TEXT DEFAULT NULL; 
	DECLARE de_048_002_CADENA TEXT DEFAULT NULL; 
	DECLARE de_048_004_CADENA TEXT DEFAULT NULL; 
    DECLARE de_002_CADENA TEXT DEFAULT NULL;
	DECLARE de_047_017_CADENA TEXT DEFAULT NULL;
	DECLARE de_122_126_CADENA TEXT DEFAULT NULL; 	-- 122.126 TokenEx Reference Number 
	DECLARE de_121_005_CADENA TEXT DEFAULT NULL; 	-- 121.5  TokenEx Date
	
	DECLARE de_002 VARCHAR(45) DEFAULT NULL;        -- Account number
    DECLARE de_048_015 VARCHAR(45) DEFAULT NULL;    -- Card token
	DECLARE de_118_005 VARCHAR(5) DEFAULT NULL;     -- Card expiration date 
	DECLARE de_120_007 INT(11) DEFAULT 0;           -- Type credit card
    DECLARE de_121_017 VARCHAR(4) DEFAULT NULL;         -- Account number
    DECLARE de_048_006 VARCHAR(45) DEFAULT NULL;    -- Nick name
    DECLARE de_048_002 VARCHAR(99) DEFAULT NULL;    -- Cardholder name
    DECLARE de_048_004 VARCHAR(99) DEFAULT NULL;    -- Card verification number
	DECLARE de_047_017 VARCHAR(45) DEFAULT NULL;    -- Zipcode
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL;
    DECLARE de_121_005 VARCHAR(45) DEFAULT NULL; 
	
	DECLARE de_114_073 VARCHAR(45) DEFAULT NULL;    -- Payment Service Provider
    DECLARE de_114_115 VARCHAR(45) DEFAULT NULL;    -- Billing address

	DECLARE _US_TR 	TEXT DEFAULT NULL;
    DECLARE de_048_015_CADENA2 TEXT DEFAULT NULL; 	
	DECLARE de_055_003_CADENA TEXT DEFAULT NULL; 
	DECLARE de_122_040_CADENA TEXT DEFAULT NULL; 
	DECLARE de_122_041_CADENA TEXT DEFAULT NULL; 
	DECLARE de_122_042_CADENA TEXT DEFAULT NULL; 
    DECLARE de_122_043_CADENA TEXT DEFAULT NULL; 
	
    DECLARE de_048_015_AUX2 VARCHAR(45) DEFAULT NULL; 
    DECLARE de_122_034 INT(11) DEFAULT NULL; 
    DECLARE de_055_003 VARCHAR(20) DEFAULT NULL; 
    DECLARE de_122_040 VARCHAR(255) DEFAULT NULL;
    DECLARE de_122_041 VARCHAR(255) DEFAULT NULL;
    DECLARE de_122_042 VARCHAR(255) DEFAULT NULL;
    DECLARE de_122_043 VARCHAR(255) DEFAULT NULL;
    
    

	DECLARE de_114_121 INT(11) DEFAULT NULL;
	DECLARE de_117_017 INT(11) DEFAULT NULL; 
	DECLARE de_117_018 INT(11) DEFAULT NULL; 
    DECLARE de_117_012 INT(11) DEFAULT NULL; 
    DECLARE de_117_019 INT(11) DEFAULT NULL; 
	
	DECLARE de_117_020 INT(11) DEFAULT NULL; 
	DECLARE de_117_021 INT(11) DEFAULT NULL; 
	DECLARE de_117_022 INT(11) DEFAULT NULL; 
	
    DECLARE de_117_025 VARCHAR(5) DEFAULT NULL;
    DECLARE de_121_036 VARCHAR(5) DEFAULT NULL; 	
    
	DECLARE i INT(4) DEFAULT NULL;
	
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE CRC_AUX VARCHAR(10) DEFAULT NULL; 
	DECLARE USER_NAME	VARCHAR(100) DEFAULT NULL;     
	DECLARE USER_EMAIL  VARCHAR(100) DEFAULT NULL;   
	DECLARE ADDRESSID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;  
    DECLARE PHONEID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL; 
	
	
	DECLARE BILLID_AUX INTEGER(11) DEFAULT NULL; 
    DECLARE ACCOUNTPAYABLEID_AUX INT(11) DEFAULT 0;
	DECLARE CLASS_AUX VARCHAR(1) DEFAULT 0;
	DECLARE OWNER_AUX VARCHAR(3) DEFAULT 0;
	DECLARE DATE_AUX DATETIME DEFAULT 0;
    DECLARE CARD_TOCKEN VARCHAR(45) DEFAULT NULL;	
	DECLARE de_SB VARCHAR(5000) DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION TEXT DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION_AUX TEXT DEFAULT NULL;	
	DECLARE SUBSCRIPTION_AUX VARCHAR(45) DEFAULT NULL;
    DECLARE SUBSCRIPTION_AUX2 VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_TITLE VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_QUANTITY INT(11) DEFAULT NULL;
	DECLARE RESIDUAL_QUANTITY DECIMAL(15,2) DEFAULT NULL;

	DECLARE LATITUDE_AUX VARCHAR(20) DEFAULT 0;			
	DECLARE LONGITUDE_AUX VARCHAR(20) DEFAULT 0;

    DECLARE PARAMET	VARCHAR(100) DEFAULT NULL;
    
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	
	

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
    
    
	SET	de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	
	SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	set de_114_179 = (select right(de_114_179,11));
	
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
    
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
	SET de_114_070 = convert(unhex(de_114_070) using utf8);
    
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_127_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.10');
	
	SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
	
	SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.121');
	SET de_117_017 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.17');
	SET de_117_018 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.18');
    SET de_117_012 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.12');
    SET de_117_019 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.19');
	
	SET de_117_020 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.20');
	SET de_117_021 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.21');
	SET de_117_022 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.22');
	
    SET de_117_025 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.25');
    SET de_121_036 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.36');
    
    SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');
    
    
    
	SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
	SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

	SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
	SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
	SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
	SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
	
    SET _US_PH = REPLACE(_US_PH,'-1','');
    
	SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
	SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
	SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
	SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

	
	SELECT DATA INTO _US_AD FROM TBL_MESSAGE1 WHERE CODE = "AL";
	SET _US_AD = (SELECT CONVERT(unhex(_US_AD) USING utf8 ));
	
	SET _US_AD = REPLACE(_US_AD,'{"1','{"_1');
	SET _US_AD = REPLACE(_US_AD,',"1',',"_1');
	
	SET de_121_045_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_121.45'));
	SET de_114_012_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.12'));
	SET de_114_013_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.13'));
	SET de_122_107_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.107'));
	SET de_114_014_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.14'));
	SET de_120_013_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_120.13'));
	SET de_122_087_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.87'));

	
    
    
    SELECT DATA INTO _US_AC FROM TBL_MESSAGE1 WHERE CODE = "AC";
	SET _US_AC = (SELECT CONVERT(unhex(_US_AC) USING utf8 ));

	SET _US_AC = REPLACE(_US_AC,'{"1','{"_1');
	SET _US_AC = REPLACE(_US_AC,',"1',',"_1');
	SET _US_AC = REPLACE(_US_AC,'{"4','{"_4');
	SET _US_AC = REPLACE(_US_AC,',"4',',"_4');
	SET _US_AC = REPLACE(_US_AC,'{"2','{"_2');
	SET _US_AC = REPLACE(_US_AC,',"2',',"_2');
	
	SET de_002_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_2'));
	SET de_048_015_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.15'));
	SET de_118_005_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_118.5'));
	SET de_120_007_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_119.11'));
	SET de_121_017_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_121.17'));
	SET de_048_006_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.6'));
	SET de_048_002_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.2'));
	SET de_048_004_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.4'));
	SET de_047_017_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_47.17'));
	SET de_122_126_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_122.126'));
	SET de_121_005_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_121.5'));
	
    SET de_114_073 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.73');
    SET de_114_115 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.115');
    

    SELECT DATA INTO _US_TR FROM TBL_MESSAGE1 WHERE CODE = "TR";
	SET _US_TR = (SELECT CONVERT(unhex(_US_TR) USING utf8 ));

	SET _US_TR = REPLACE(_US_TR,'{"1','{"_1');
	SET _US_TR = REPLACE(_US_TR,',"1',',"_1');
	SET _US_TR = REPLACE(_US_TR,'{"4','{"_4');
	SET _US_TR = REPLACE(_US_TR,',"4',',"_4');
    SET _US_TR = REPLACE(_US_TR,'{"5','{"_5');
	SET _US_TR = REPLACE(_US_TR,',"5',',"_5');

	SET de_048_015_CADENA2  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_TR":',_US_TR,'}'),'//_48.15'));
	SET de_055_003_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_TR":',_US_TR,'}'),'//_55.3'));
	SET de_122_040_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_TR":',_US_TR,'}'),'//_122.40'));
	SET de_122_041_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_TR":',_US_TR,'}'),'//_122.41'));
	SET de_122_042_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_TR":',_US_TR,'}'),'//_122.42'));
	SET de_122_043_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_TR":',_US_TR,'}'),'//_122.43'));


    
    
    
    

	
	if length(de_114_179) > 0 then 

	
		-- ---------------------
        -- User and merchant  --
        -- ---------------------
	
		update tbl_user set
		tbl_user_email = COALESCE(de_114_007, tbl_user_email),
		tbl_user_first = COALESCE(de_114_003, tbl_user_first),
		tbl_user_middle =  COALESCE(de_114_004, tbl_user_middle),
		tbl_user_last = COALESCE(de_114_005, tbl_user_last),
		tbl_user_title = COALESCE(de_114_091, tbl_user_title),
		tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName),
		tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),tbl_user_password),
		tbl_user_dateAdded = NOW(),
		tbl_user_dateModified = NOW(),
		tbl_userstatus_id = 37,
        tbl_gender_type = 51,
		tbl_user_multipleshipaddress_f = COALESCE(if(de_117_025='true',1,0), tbl_user_multipleshipaddress_f)
		where tbl_user_id = de_114_179; 
		
		SET USERID_AUX = de_114_179;
		SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
		SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
		SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));
		SET COMPANY_ID =  (select tbl_company_id from tbl_user where tbl_user_id = USERID_AUX);
		
		update tbl_merchant set
		tbl_merchant_taxIdNumber = COALESCE(de_123_071, tbl_merchant_taxIdNumber),
        tbl_merchant_multiple_locations_quantity = COALESCE(de_114_121, tbl_merchant_multiple_locations_quantity),
		tbl_merchant_location_use = COALESCE(de_117_017, tbl_merchant_location_use),
		tbl_merchant_dongles_quantity = COALESCE(de_117_018, tbl_merchant_dongles_quantity),
        -- tbl_merchant_basic_subs = COALESCE(de_117_020, tbl_merchant_basic_subs),
		tbl_merchant_standard_subs = COALESCE(de_117_021, tbl_merchant_standard_subs),
		tbl_merchant_deluxe_subs = COALESCE(de_117_022,tbl_merchant_deluxe_subs),
		tbl_merchant_receivePayment_f = COALESCE(if(de_121_036='true',1,0),tbl_merchant_receivePayment_f)
		where tbl_user_id = de_114_179;

		update tbl_company set
		tbl_company_name = COALESCE(de_114_070 ,tbl_company_name),
		tbl_company_taxId = COALESCE(de_123_071 ,tbl_company_taxId)
		where tbl_company_id = COMPANY_ID;
		
		
		
		
		-- ---------------------
        -- Link               --
        -- ---------------------
		
		if length(de_052) > 0 then 
		
			update tbl_link set
			tbl_link_link = md5(convert(unhex(de_052) using utf8)),
			tbl_link_date = NOW(),
			tbl_link_delete = 0
			where tbl_link_user_id = de_114_179;
		
		end if;
		
		
		
		
		-- ---------------------
        -- Phones             --
        -- ---------------------
		
		if LENGTH(_48_28_CADENA) >0 then
		
			delete from tbl_phone where tbl_phone_nmcId = de_114_179;
		
			while (LENGTH(_48_28_CADENA)>0) DO

				SET _48_28_a = TRIM((SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1)));
				SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

				SET _121_167_a = TRIM((SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1)));
				SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
				
				SET _122_87P_a = TRIM((SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1)));
				SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

			   
				SET _121_62_a = TRIM((SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1)));
				SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

				insert into tbl_phone set
				tbl_company_id 		  = COMPANY_ID,
				tbl_phone_nmcId       = de_114_179,
				tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
				tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
				tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
				tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

				SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);	
				
			end while ; 
			
		end if;
		
		
		
		
		-- ------------------------
		-- Address and Locations --
		-- ------------------------
		
		if (select tbl_address_id from tbl_address where tbl_address_nmcId = de_114_179 limit 1) is not null then
		
			delete from tbl_location_hardware where tbl_user_id = de_114_179;			
			delete from tbl_locationaddress where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
			delete from tbl_locationphone where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
			delete from tbl_location_schedule where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
			delete from tbl_location where tbl_location_userId = de_114_179;			
			delete from tbl_address where tbl_address_nmcId = de_114_179;

		end if;
		
		if LENGTH(de_114_012_CADENA) >0 then

			while (LENGTH(de_114_012_CADENA)>0) DO
			
				SET de_121_045 = TRIM((SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1)));
				SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));

				SET de_114_012 = TRIM((SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1)));
				SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

				SET de_114_013 = TRIM((SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1)));
				SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
				
				SET de_122_107 = TRIM((SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1)));
				SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

				SET de_114_014 = TRIM((SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1)));
				SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
		
				SET de_120_013 = TRIM((SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1)));
				SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

				SET de_122_087 = TRIM((SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1)));
				SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
				
                SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
				SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
                
				
				insert into tbl_address set 
				tbl_company_id = COMPANY_ID,
				tbl_address_nmcId = de_114_179,
				tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
				tbl_address_first = TRIM(de_114_012),
				tbl_address_second = TRIM(de_114_013),
				tbl_address_phoneNumber = null,
				tbl_zipcode_id = TRIM(de_122_107),
				tbl_city_id = TRIM(de_114_014),
				tbl_state_id = TRIM(de_120_013),
				tbl_country_id = TRIM(de_122_087);
				
				SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
					
				INSERT INTO tbl_location SET 
				tbl_company_id = COMPANY_ID,
				tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
				tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
				tbl_location_contactName = COALESCE(USER_NAME,' '), 
				tbl_location_contactEmail = COALESCE(USER_EMAIL,' '), 
				tbl_location_userId = de_114_179,
				tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
				tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
				tbl_location_statusId= 7001;
				
				SET LOCATIONID_AUX= (SELECT last_insert_id() from  tbl_location limit 1);

				INSERT tbl_locationaddress SET
				tbl_location_id = LOCATIONID_AUX, 
				tbl_address_id = ADDRESSID_AUX;
				
				if (select count(tbl_location_id) from tbl_location where tbl_location_userId = de_114_179) = 1 then
				
					INSERT INTO tbl_locationphone SET
					tbl_location_id = LOCATIONID_AUX,
					tbl_phone_id = PHONEID_AUX;

					if LENGTH(de_055_003_CADENA) >0 then
					
						INSERT INTO tbl_location_hardware (
						tbl_company_id,
						tbl_user_id,
						tbl_location_id,
						tbl_hardware_type_id,
						tbl_location_hardware_qty,
						tbl_location_hardware_shipped,
						tbl_shipping_status_id) 
						values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0,73001);
					
					else

						INSERT INTO tbl_location_hardware (
						tbl_company_id,
						tbl_user_id,
						tbl_location_id,
						tbl_hardware_type_id,
						tbl_location_hardware_qty,
						tbl_location_hardware_shipped,
						tbl_shipping_status_id) 
						values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,0,0,73001);
					
					end if;
					
					INSERT INTO tbl_hardware_cart (
					tbl_company_id,
					tbl_user_id,
					tbl_location_id,
					tbl_hardware_type_id,
					tbl_hardware_cart_quantity,
					tbl_hardware_cart_delete
					)
					values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0);
				
				end if;
				
				INSERT INTO tbl_location_schedule (
				tbl_location_id,
				tbl_day_of_the_week,
				tbl_24_hour,
				tbl_closed_flag,
				tbl_hour_open,
				tbl_hour_close) 
				values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');

			end while ;
				
		end if;
		
        
		

        -- ---------------------
		-- Credit Card        --
		-- ---------------------
        
        if LENGTH(de_120_007_CADENA) >0 then

			delete from dbcards.tbl_card where tbl_user_id = de_114_179;
			delete from dbcards.tbl_carduser where tbl_user_nmcId = de_114_179;
		
		
			SET de_002 = TRIM((SELECT SUBSTR(de_002_CADENA,1,LOCATE('|',de_002_CADENA)-1)));
			SET de_002_CADENA = (SELECT SUBSTR(de_002_CADENA,LOCATE('|',de_002_CADENA)+1));
		
			SET de_118_005 = TRIM((SELECT SUBSTR(de_118_005_CADENA,1,LOCATE('|',de_118_005_CADENA)-1)));
			SET de_118_005_CADENA = (SELECT SUBSTR(de_118_005_CADENA,LOCATE('|',de_118_005_CADENA)+1));

			SET de_120_007 = TRIM((SELECT SUBSTR(de_120_007_CADENA,1,LOCATE('|',de_120_007_CADENA)-1)));
			SET de_120_007_CADENA = (SELECT SUBSTR(de_120_007_CADENA,LOCATE('|',de_120_007_CADENA)+1));
			
			SET de_121_017 = TRIM((SELECT SUBSTR(de_121_017_CADENA,1,LOCATE('|',de_121_017_CADENA)-1)));
			SET de_121_017_CADENA = (SELECT SUBSTR(de_121_017_CADENA,LOCATE('|',de_121_017_CADENA)+1));

			SET de_048_006 = TRIM((SELECT SUBSTR(de_048_006_CADENA,1,LOCATE('|',de_048_006_CADENA)-1)));
			SET de_048_006_CADENA = (SELECT SUBSTR(de_048_006_CADENA,LOCATE('|',de_048_006_CADENA)+1));
	
			SET de_048_002 = TRIM((SELECT SUBSTR(de_048_002_CADENA,1,LOCATE('|',de_048_002_CADENA)-1)));
			SET de_048_002_CADENA = (SELECT SUBSTR(de_048_002_CADENA,LOCATE('|',de_048_002_CADENA)+1));
			
			SET de_048_004 = TRIM((SELECT SUBSTR(de_048_004_CADENA,1,LOCATE('|',de_048_004_CADENA)-1)));
			SET de_048_004_CADENA = (SELECT SUBSTR(de_048_004_CADENA,LOCATE('|',de_048_004_CADENA)+1));
			
			SET de_047_017 = TRIM((SELECT SUBSTR(de_047_017_CADENA,1,LOCATE('|',de_047_017_CADENA)-1)));
			SET de_047_017_CADENA = (SELECT SUBSTR(de_047_017_CADENA,LOCATE('|',de_047_017_CADENA)+1));
			
			SET de_122_126 = TRIM((SELECT SUBSTR(de_122_126_CADENA,1,LOCATE('|',de_122_126_CADENA)-1)));
			SET de_122_126_CADENA = (SELECT SUBSTR(de_122_126_CADENA,LOCATE('|',de_122_126_CADENA)+1));
			
			SET de_121_005 = TRIM((SELECT SUBSTR(de_121_005_CADENA,1,LOCATE('|',de_121_005_CADENA)-1)));
			SET de_121_005_CADENA = (SELECT SUBSTR(de_121_005_CADENA,LOCATE('|',de_121_005_CADENA)+1));
			
			
			SET de_048_015 = de_002;
		
			insert into dbcards.tbl_carduser set
			tbl_user_nmcId = de_114_179,
			tbl_card_tocken = de_048_015,
			tbl_paymentnaturetype_id = 35001,
			tbl_carduser_referenceNumber = de_122_126,
			tbl_carduser_date = de_121_005;
			
			insert into dbcards.tbl_card set
			tbl_user_id = de_114_179,
			tbl_card_tocken = de_048_015,
			tbl_card_number = SUBSTRING(de_002, -4),
			tbl_card_dateAdded = NOW(),
			tbl_card_datemodified = NOW(),
			tbl_cardstype_id = de_120_007,
			tbl_cardstatus_id = 51,
			tbl_card_nickname = COALESCE(de_048_006,''),
			tbl_card_chardholderName = COALESCE(de_048_002,''),		
			tbl_card_routingNumber = '',
			tbl_card_issuingBank = '',
			tbl_accounttype_id = 401,
			tbl_bankaccounttype_id = null,	
			tbl_card_dateExpire = COALESCE(de_118_005,''),
			tbl_card_swift_iban_code = COALESCE(de_048_004,''),		
			tbl_country_id = null,
			tbl_zipcode = COALESCE(de_047_017,null),
			tbl_debitaccounttype_id = null,
			tbl_address_id = COALESCE(de_114_115,null),
			tbl_paymentserviceprovider_id = de_114_073;

        end if;
        
        
        
		
		-- ---------------------
		-- Client Keys        --
		-- ---------------------

		if (select client_name from nmc_control.client_key where user_id = USERID_AUX limit 1) is null then
		
			INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
			values  (md5(CONCAT('Terminal',USERID_AUX)),'Terminal',CURDATE(),1,3,USERID_AUX,0),
					(md5(CONCAT('Module OsCommerce',USERID_AUX)),'Module OsCommerce',CURDATE(),1,5,USERID_AUX,0),
					(md5(CONCAT('Widget',USERID_AUX)),'Widget',CURDATE(),1,5,USERID_AUX,0),
					(md5(CONCAT('WidgetCar',USERID_AUX)),'WidgetCar',CURDATE(),1,5,USERID_AUX,0),
					(md5(CONCAT('Tablet',USERID_AUX)),'Tablet',CURDATE(),1,6,USERID_AUX,0);
        
		end if;
		
		
        
		-- ---------------------
		-- Modules            --
		-- ---------------------

		if (select tbl_module_id from dbitems.tbl_module where tbl_user_id = USERID_AUX limit 1) is null then
		
			INSERT INTO dbitems.tbl_module (`tbl_company_id`,`tbl_user_id`, `tbl_module_title`, `tbl_module_order`, `tbl_module_type_id`, `tbl_module_active_f`, `tbl_module_image`, `tbl_module_price`, `tbl_module_item_limit`) 
			values  (COMPANY_ID, USERID_AUX,'Banner sample 1'	, 1, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, USERID_AUX,'Banner sample 2'	, 2, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, USERID_AUX,'Banner sample 3'	, 3, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, USERID_AUX,'Item list sample 1', 4, 1, 1, NULL				, NULL, 10),
					(COMPANY_ID, USERID_AUX,'Item list sample 2', 5, 1, 1, NULL				, NULL, 10),
					(COMPANY_ID, USERID_AUX,'Box sample 1'		, 6, 3, 1, 'logo_box.png'	, NULL, 10),
					(COMPANY_ID, USERID_AUX,'Box sample 2'		, 7, 3, 1, 'logo_box.png'	, NULL, 10);
        
		end if;
		
		
		
        -- ---------------------
        -- Subscription Cart  --
        -- ---------------------
        
        if (select tbl_subscription_id from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 limit 1) is not null then
            delete from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179; 
		end if;     

		
		if de_117_021 > 0 then
			insert into dbitems.tbl_subscriptioncart set 
			tbl_subscription_id = 15,
			tbl_subscriptioncart_user_nmcid = de_114_179,
			tbl_subscriptioncart_quantity = de_117_021;
		end if;
		
		if de_117_022 > 0 then
			insert into dbitems.tbl_subscriptioncart set 
			tbl_subscription_id = 16,
			tbl_subscriptioncart_user_nmcid = de_114_179,
			tbl_subscriptioncart_quantity = de_117_022;
		end if;
        
		
		
		
		-- ---------------------
		-- Commissions        --
		-- ---------------------
        
        if ( select tbl_commission_id from dbcommission.tbl_commission where tbl_commission_agent_nmcId = de_053 and (select MONTH(tbl_commission_date)) = (select MONTH(NOW())) limit 1) is null then
				
			insert into dbcommission.tbl_commission set
			tbl_commission_agent_nmcId = de_053,
			tbl_commission_date = NOW(),
			tbl_commission_refNumber = CONCAT('ref',de_053),
			tbl_commission_status_id = 72001;
			
		end if;
        
        
        
        
        -- ---------------------
		-- Payment            --
		-- ---------------------

		if LENGTH(de_055_003_CADENA) >0 then
		
		
			SET de_048_015_AUX2 = TRIM((SELECT SUBSTR(de_048_015_CADENA2,1,LOCATE('|',de_048_015_CADENA2)-1)));
			SET de_048_015_CADENA2 = (SELECT SUBSTR(de_048_015_CADENA2,LOCATE('|',de_048_015_CADENA2)+1));

			SET de_055_003 = TRIM((SELECT SUBSTR(de_055_003_CADENA,1,LOCATE('|',de_055_003_CADENA)-1)));
			SET de_055_003_CADENA = (SELECT SUBSTR(de_055_003_CADENA,LOCATE('|',de_055_003_CADENA)+1));

			SET de_122_040 = TRIM((SELECT SUBSTR(de_122_040_CADENA,1,LOCATE('|',de_122_040_CADENA)-1)));
			SET de_122_040_CADENA = (SELECT SUBSTR(de_122_040_CADENA,LOCATE('|',de_122_040_CADENA)+1));
			
			SET de_122_041 = TRIM((SELECT SUBSTR(de_122_041_CADENA,1,LOCATE('|',de_122_041_CADENA)-1)));
			SET de_122_041_CADENA = (SELECT SUBSTR(de_122_041_CADENA,LOCATE('|',de_122_041_CADENA)+1));

			SET de_122_042 = TRIM((SELECT SUBSTR(de_122_042_CADENA,1,LOCATE('|',de_122_042_CADENA)-1)));
			SET de_122_042_CADENA = (SELECT SUBSTR(de_122_042_CADENA,LOCATE('|',de_122_042_CADENA)+1));
	
			SET de_122_043 = TRIM((SELECT SUBSTR(de_122_043_CADENA,1,LOCATE('|',de_122_043_CADENA)-1)));
			SET de_122_043_CADENA = (SELECT SUBSTR(de_122_043_CADENA,LOCATE('|',de_122_043_CADENA)+1));

			if LENGTH(de_048_015_AUX2) >0 then
				set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015_AUX2 and tbl_user_nmcId = de_114_179 limit 1);
			else
				set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015 and tbl_user_nmcId = de_114_179 limit 1);
			end if;

			if LENGTH(de_122_034) >0 then 
				
				SET CARD_TOCKEN = (select tbl_card_tocken from dbcards.tbl_carduser where tbl_carduser_id = de_122_034);
				SET DATE_AUX = NOW();

				if (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) is not null then
				   SET BILLID_AUX = (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) +1;
				else
				   SET BILLID_AUX = 1;
				end if;

				-- --------------- --
				-- Bill            --
				-- --------------- --
				
				insert into dbtransaction.tbl_bill set
				tbl_bill_id = BILLID_AUX,
				tbl_bill_number = 1000000 + BILLID_AUX,
				tbl_bill_merchant_nmcId = de_114_179,
				tbl_bill_seller_nmcId = '001', 
				tbl_bill_status = 101,
				tbl_bill_date = DATE_AUX;
				
				-- ------------------ --
				-- Bill Subscription  --
				-- ------------------ --
				
				insert into dbtransaction.tbl_billsubscription (tbl_bill_id,
												  tbl_subscription_id,
												  tbl_billsubscription_quantity,
												  tbl_billsubscription_price,
												  tbl_billsubscription_reseller_nmcId)
				select  BILLID_AUX,
						A.tbl_subscription_id,
						A.tbl_subscriptioncart_quantity,
						B.tbl_subscription_recommended_price,
						null

				from dbitems.tbl_subscriptioncart as A, dbitems.tbl_subscription as B
				where A.tbl_subscriptioncart_user_nmcid = de_114_179
				and A.tbl_subscriptioncart_delete = 0
				and A.tbl_subscription_id = B.tbl_subscription_id;
				
                
				if de_117_018 > 0 then
                
					insert into dbtransaction.tbl_billsubscription set
					tbl_bill_id = BILLID_AUX,
					tbl_hardware_type_id = 75001,
					tbl_billsubscription_quantity = de_117_018,
					tbl_billsubscription_price = 0.00;
                    
                    insert into dbuser.tbl_shipping set
					tbl_user_id = de_114_179,
					tbl_location_id = LOCATIONID_AUX,
					tbl_shipping_dongle_qty = de_117_018,
					tbl_shipping_tablet_qty = 0,
					tbl_shipping_tv_qty = 0,
					tbl_shipping_status_id = 73001,
					tbl_shipping_saleDate = current_date(),
					tbl_shipping_invoiceNumber = BILLID_AUX,
					tbl_shipping_refNumber = 1000000 + BILLID_AUX,
					tbl_shipping_boxes = 0;
                    
                end if;
                
                
				-- ------------------ --
				-- Bil Transaction    --
				-- ------------------ --
				
				insert into dbtransaction.tbl_billtransaction set 
				tbl_bill_id = BILLID_AUX,
				tbl_cardTocken = CARD_TOCKEN,	  	
				tbl_billtransaction_amount = de_055_003,
				tbl_billtransaction_status_id = 75,
				tbl_billtransaction_type_id = 1,
				tbl_billtransaction_date = DATE_AUX;

				
				set de_SB = (select GROUP_CONCAT(CONCAT('',tbl_subscription_id,'|'))
							from dbitems.tbl_subscriptioncart 
							where tbl_subscriptioncart_user_nmcid = de_114_179
							and tbl_subscriptioncart_delete = 0
							);
							
				set CADENA_SUBSCRIPTION = REPLACE(de_SB,'|,','|');	
				set CADENA_SUBSCRIPTION_AUX = REPLACE(de_SB,'|,','|');
				
				WHILE (LENGTH(CADENA_SUBSCRIPTION)>0) DO
								
					SET SUBSCRIPTION_AUX = (SELECT SUBSTR(CADENA_SUBSCRIPTION,1,LOCATE('|',CADENA_SUBSCRIPTION)-1));
					SET CADENA_SUBSCRIPTION = (SELECT SUBSTR(CADENA_SUBSCRIPTION,LOCATE('|',CADENA_SUBSCRIPTION)+1));

					set SUBSCRIPTION_QUANTITY = (select tbl_subscriptioncart_quantity from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) and tbl_subscriptioncart_delete = 0 LIMIT 1);

					if (select tbl_subscription_id from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) is null then
				
						insert into dbitems.tbl_usersubscription set
						tbl_company_id = COMPANY_ID,
						tbl_usersubscription_user_nmcid = de_114_179,
						tbl_subscription_id = TRIM(SUBSCRIPTION_AUX),
						tbl_usersubscription_date_purchase = DATE_AUX,		  
						tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
						tbl_subscriptionstatus_id = 2401;
						
					else
						
						if (select tbl_usersubscription_date_expiration from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) > NOW() then
					
							update dbitems.tbl_usersubscription set
							tbl_usersubscription_date_purchase = DATE_AUX,		  
							tbl_usersubscription_date_expiration = DATE_ADD(tbl_usersubscription_date_expiration, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
							tbl_subscriptionstatus_id = 2401
							where tbl_usersubscription_user_nmcid = de_114_179
							and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
							
						else
					
							update dbitems.tbl_usersubscription set
							tbl_usersubscription_date_purchase = DATE_AUX,		  
							tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
							tbl_subscriptionstatus_id = 2401
							where tbl_usersubscription_user_nmcid = de_114_179
							and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
						
						end if;
						
					end if;
				
				END WHILE;


				-- ------------------------- --
				-- Clean Subscription Cart   --
				-- ------------------------- --

				update dbitems.tbl_subscriptioncart set
				tbl_subscriptioncart_delete = 1
				where tbl_subscriptioncart_user_nmcid = de_114_179
				and tbl_subscriptioncart_delete = 0;
				
				update tbl_hardware_cart set 
				tbl_hardware_cart_delete = 1
				where tbl_user_id = de_114_179
                and tbl_hardware_cart_delete = 0;
				
				update dbuser.tbl_merchant set
				tbl_merchant_receivePayment_f = 1
				where tbl_user_id = de_114_179;
				
				
				-- ------------------------- --
				-- Processor                 --
				-- ------------------------- --

				update dbtransaction.tbl_bill set
				tbl_bill_authorization_code = de_122_040,
				tbl_bill_display_message = de_122_041,
				tbl_bill_result_message = de_122_042,
				tbl_bill_result_code = de_122_043
				where tbl_bill_id = BILLID_AUX;
			
			end if;
		
		end if;
        
        
        
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		

	
	
    
    
    
    
	else

		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1) is null then

			if (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070 limit 1) is null then
				
				-- ---------------------
				-- User and merchant  --
				-- ---------------------
				
				insert into tbl_user set 
				tbl_user_email = de_114_007,
				tbl_user_first = COALESCE(de_114_003,''),
				tbl_user_middle = COALESCE(de_114_004,''),
				tbl_user_last = COALESCE(de_114_005,''),
				tbl_user_title = COALESCE(de_114_091,''),
				tbl_user_companyName = COALESCE(de_114_070,''),
				tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),''),
				tbl_user_parentId = null,
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userstatus_id = 37,
				tbl_user_entity = 20,
				tbl_gender_type = 51,
				tbl_user_class = '2C0',
				tbl_owner_id = '001',
				tbl_user_pinCode =  1234,
                tbl_user_supervisor = de_053,
				tbl_user_multipleshipaddress_f = if(de_117_025='true',1,0);
				
				SET USERID_AUX = last_insert_id();
				SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
				SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
				SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));

				insert into tbl_merchant set
				tbl_user_id = USERID_AUX,
				tbl_merchant_nmcId = USERID_AUX,
				tbl_merchant_taxIdNumber = COALESCE(de_123_071, ''),
				tbl_merchant_multipleLocation_f = 4801,
				tbl_merchant_haveWebsite_f = 0,
				tbl_merchant_haveAccount_f = 0,
				tbl_merchant_logoimage = '',
				tbl_merchant_online_store = '',
				tbl_user_reseller_id = de_053,
				tbl_merchant_multiple_locations_quantity = de_114_121,
				tbl_merchant_location_use = de_117_017,
                tbl_merchant_dongles_quantity = COALESCE(de_117_018,0),
				-- tbl_merchant_basic_subs = COALESCE(de_117_020,0),
				tbl_merchant_standard_subs = COALESCE(de_117_021,0),
				tbl_merchant_deluxe_subs = COALESCE(de_117_022,0),
				tbl_merchant_receivePayment_f = if(de_121_036='true',1,0);
				
				insert into tbl_company set
				tbl_company_name = de_114_070,
				tbl_company_crc = CRC_AUX,
				tbl_company_taxId = de_123_071,
				tbl_company_type_id = 4701,
				tbl_company_status_id = 33,
				tbl_company_dateCreate = NOW();

				set COMPANY_ID = (SELECT last_insert_id() FROM tbl_company limit 1);
				
				update dbuser.tbl_user set 
				tbl_company_id = COMPANY_ID,
				tbl_user_crc = CRC_AUX
				where tbl_user_id = USERID_AUX;
				
				
				INSERT INTO tbl_user_delivery_options set
				tbl_company_id = COMPANY_ID,
				tbl_user_id = USERID_AUX,
				tbl_delivery_company_price = 0.00,
				tbl_delivery_company_service = 'Pick Up',
				tbl_user_delivery_options_tier = 'Pick Up',
				tbl_delivery_company_tracking_code ='',
				tbl_delivery_company_option = 'Pick Up';

				
				

				-- ---------------------
				-- Link               --
				-- ---------------------
				
				if length(de_052) > 0 then 
				
					insert into tbl_link set
					tbl_link_user_id = USERID_AUX,
					tbl_link_link = md5(convert(unhex(de_052) using utf8)),
					tbl_link_date = NOW(),
					tbl_link_delete = 0;
				
				end if;
				
                
                
                
				-- ---------------------
				-- Phones             --
				-- ---------------------
				
				if LENGTH(_48_28_CADENA) >0 then
					while (LENGTH(_48_28_CADENA)>0) DO

						SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
						SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

						SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
						SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
						
						SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
						SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

					   
						SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
						SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

						insert into tbl_phone set
						tbl_company_id 		  = COMPANY_ID,
						tbl_phone_nmcId       = USERID_AUX,
						tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
						tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
						tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
						tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

						SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);	
						
					end while ; 
				end if;

				
				
				
				-- ------------------------
				-- Address and Locations --
				-- ------------------------
				
				if LENGTH(de_114_012_CADENA) >0 then

					while (LENGTH(de_114_012_CADENA)>0) DO
					
						SET de_121_045 = TRIM((SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1)));
						SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));

						SET de_114_012 = TRIM((SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1)));
						SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

						SET de_114_013 = TRIM((SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1)));
						SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
						
						SET de_122_107 = TRIM((SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1)));
						SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

						SET de_114_014 = TRIM((SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1)));
						SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
				
						SET de_120_013 = TRIM((SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1)));
						SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

						SET de_122_087 = TRIM((SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1)));
						SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
						
                        SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
						SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
                

						insert into tbl_address set 
						tbl_company_id = COMPANY_ID,
						tbl_address_nmcId = USERID_AUX,
						tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
						tbl_address_first = TRIM(de_114_012),
						tbl_address_second = TRIM(de_114_013),
						tbl_address_phoneNumber = null,
						tbl_zipcode_id = TRIM(de_122_107),
						tbl_city_id = TRIM(de_114_014),
						tbl_state_id = TRIM(de_120_013),
						tbl_country_id = TRIM(de_122_087);
						
						SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
						
						INSERT INTO tbl_location SET 
						tbl_company_id = COMPANY_ID,
						tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
						tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
						tbl_location_contactName = COALESCE(USER_NAME,' '), 
						tbl_location_contactEmail = COALESCE(USER_EMAIL,' '), 
						tbl_location_userId = USERID_AUX,
						tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
						tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
						tbl_location_statusId= 7001;
						
						SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);

						INSERT tbl_locationaddress SET
						tbl_location_id = LOCATIONID_AUX, 
						tbl_address_id = ADDRESSID_AUX;
						
						if (select count(tbl_location_id) from tbl_location where tbl_location_userId = USERID_AUX) = 1 then
						
							INSERT INTO tbl_locationphone SET
							tbl_location_id = LOCATIONID_AUX,
							tbl_phone_id = PHONEID_AUX;
						
							if LENGTH(de_055_003_CADENA) >0 then
						
								INSERT INTO tbl_location_hardware (
								tbl_company_id,
								tbl_user_id,
								tbl_location_id,
								tbl_hardware_type_id,
								tbl_location_hardware_qty,
								tbl_location_hardware_shipped,
								tbl_shipping_status_id) 
								values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0,73001);
							
							else
							
								INSERT INTO tbl_location_hardware (
								tbl_company_id,
								tbl_user_id,
								tbl_location_id,
								tbl_hardware_type_id,
								tbl_location_hardware_qty,
								tbl_location_hardware_shipped,
								tbl_shipping_status_id) 
								values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,0,0,73001);
							
							end if;
							
							INSERT INTO tbl_hardware_cart (
							tbl_company_id,
							tbl_user_id,
							tbl_location_id,
							tbl_hardware_type_id,
							tbl_hardware_cart_quantity,
							tbl_hardware_cart_delete
							)
							values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0);
					
						end if;
					
						INSERT INTO tbl_location_schedule (
						tbl_location_id,
						tbl_day_of_the_week,
						tbl_24_hour,
						tbl_closed_flag,
						tbl_hour_open,
						tbl_hour_close) 
						values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');
						
					
						
					end while ;
						
				end if;
			
				
				
                
                -- ---------------------
				-- Credit Card        --
				-- ---------------------
				
				if LENGTH(de_120_007_CADENA) >0 then

					delete from dbcards.tbl_card where tbl_user_id = USERID_AUX;
					delete from dbcards.tbl_carduser where tbl_user_nmcId = USERID_AUX;
				
				
					SET de_002 = TRIM((SELECT SUBSTR(de_002_CADENA,1,LOCATE('|',de_002_CADENA)-1)));
					SET de_002_CADENA = (SELECT SUBSTR(de_002_CADENA,LOCATE('|',de_002_CADENA)+1));
				
					SET de_118_005 = TRIM((SELECT SUBSTR(de_118_005_CADENA,1,LOCATE('|',de_118_005_CADENA)-1)));
					SET de_118_005_CADENA = (SELECT SUBSTR(de_118_005_CADENA,LOCATE('|',de_118_005_CADENA)+1));

					SET de_120_007 = TRIM((SELECT SUBSTR(de_120_007_CADENA,1,LOCATE('|',de_120_007_CADENA)-1)));
					SET de_120_007_CADENA = (SELECT SUBSTR(de_120_007_CADENA,LOCATE('|',de_120_007_CADENA)+1));
					
					SET de_121_017 = TRIM((SELECT SUBSTR(de_121_017_CADENA,1,LOCATE('|',de_121_017_CADENA)-1)));
					SET de_121_017_CADENA = (SELECT SUBSTR(de_121_017_CADENA,LOCATE('|',de_121_017_CADENA)+1));

					SET de_048_006 = TRIM((SELECT SUBSTR(de_048_006_CADENA,1,LOCATE('|',de_048_006_CADENA)-1)));
					SET de_048_006_CADENA = (SELECT SUBSTR(de_048_006_CADENA,LOCATE('|',de_048_006_CADENA)+1));
			
					SET de_048_002 = TRIM((SELECT SUBSTR(de_048_002_CADENA,1,LOCATE('|',de_048_002_CADENA)-1)));
					SET de_048_002_CADENA = (SELECT SUBSTR(de_048_002_CADENA,LOCATE('|',de_048_002_CADENA)+1));
					
					SET de_048_004 = TRIM((SELECT SUBSTR(de_048_004_CADENA,1,LOCATE('|',de_048_004_CADENA)-1)));
					SET de_048_004_CADENA = (SELECT SUBSTR(de_048_004_CADENA,LOCATE('|',de_048_004_CADENA)+1));
			
					SET de_047_017 = TRIM((SELECT SUBSTR(de_047_017_CADENA,1,LOCATE('|',de_047_017_CADENA)-1)));
					SET de_047_017_CADENA = (SELECT SUBSTR(de_047_017_CADENA,LOCATE('|',de_047_017_CADENA)+1));
			
					SET de_122_126 = TRIM((SELECT SUBSTR(de_122_126_CADENA,1,LOCATE('|',de_122_126_CADENA)-1)));
					SET de_122_126_CADENA = (SELECT SUBSTR(de_122_126_CADENA,LOCATE('|',de_122_126_CADENA)+1));
					
					SET de_121_005 = TRIM((SELECT SUBSTR(de_121_005_CADENA,1,LOCATE('|',de_121_005_CADENA)-1)));
					SET de_121_005_CADENA = (SELECT SUBSTR(de_121_005_CADENA,LOCATE('|',de_121_005_CADENA)+1));
					
			
					SET de_048_015 = de_002;
				
					insert into dbcards.tbl_carduser set
					tbl_user_nmcId = USERID_AUX,
					tbl_card_tocken = de_048_015,
					tbl_paymentnaturetype_id = 35001,
					tbl_carduser_referenceNumber = de_122_126,
					tbl_carduser_date = de_121_005;
					
					insert into dbcards.tbl_card set
					tbl_user_id = USERID_AUX,
					tbl_card_tocken = de_048_015,
					tbl_card_number = SUBSTRING(de_002, -4),
					tbl_card_dateAdded = NOW(),
					tbl_card_datemodified = NOW(),
					tbl_cardstype_id = de_120_007,
					tbl_cardstatus_id = 51,
					tbl_card_nickname = COALESCE(de_048_006,''),
					tbl_card_chardholderName = COALESCE(de_048_002,''),		
					tbl_card_routingNumber = '',
					tbl_card_issuingBank = '',
					tbl_accounttype_id = 401,
					tbl_bankaccounttype_id = null,	
					tbl_card_dateExpire = COALESCE(de_118_005,''),
					tbl_card_swift_iban_code = COALESCE(de_048_004,''),
					tbl_country_id = null,
					tbl_zipcode = COALESCE(de_047_017,null),
					tbl_debitaccounttype_id = null,
					tbl_address_id = COALESCE(de_114_115,null),
					tbl_paymentserviceprovider_id = de_114_073;

				end if;
                
                

				-- ---------------------
				-- Client Keys        --
				-- ---------------------

				INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
				values  (md5(CONCAT('Terminal',USERID_AUX)),'Terminal',CURDATE(),1,3,USERID_AUX,0),
						(md5(CONCAT('Module OsCommerce',USERID_AUX)),'Module OsCommerce',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Widget',USERID_AUX)),'Widget',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('WidgetCar',USERID_AUX)),'WidgetCar',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Tablet',USERID_AUX)),'Tablet',CURDATE(),1,6,USERID_AUX,0);
				

				
				-- ---------------------
				-- Modules            --
				-- ---------------------

				if (select tbl_module_id from dbitems.tbl_module where tbl_user_id = USERID_AUX limit 1) is null then
				
					INSERT INTO dbitems.tbl_module (`tbl_company_id`, `tbl_user_id`, `tbl_module_title`, `tbl_module_order`, `tbl_module_type_id`, `tbl_module_active_f`, `tbl_module_image`, `tbl_module_price`, `tbl_module_item_limit`) 
					values  (COMPANY_ID, USERID_AUX,'Banner sample 1'	, 1, 2, 1, 'logo_banner.png', NULL, 10),
							(COMPANY_ID, USERID_AUX,'Banner sample 2'	, 2, 2, 1, 'logo_banner.png', NULL, 10),
							(COMPANY_ID, USERID_AUX,'Banner sample 3'	, 3, 2, 1, 'logo_banner.png', NULL, 10),
							(COMPANY_ID, USERID_AUX,'Item list sample 1', 4, 1, 1, NULL				, NULL, 10),
							(COMPANY_ID, USERID_AUX,'Item list sample 2', 5, 1, 1, NULL				, NULL, 10),
							(COMPANY_ID, USERID_AUX,'Box sample 1'		, 6, 3, 1, 'logo_box.png'	, NULL, 10),
							(COMPANY_ID, USERID_AUX,'Box sample 2'		, 7, 3, 1, 'logo_box.png'	, NULL, 10);
				
				end if;
		
		
				
				-- ---------------------
				-- Subscription Cart  --
				-- ---------------------
				
				if de_117_021 > 0 then
					insert into dbitems.tbl_subscriptioncart set 
					tbl_subscription_id = 15,
					tbl_subscriptioncart_user_nmcid = USERID_AUX,
					tbl_subscriptioncart_quantity = de_117_021;
				end if;
				
				if de_117_022 > 0 then
					insert into dbitems.tbl_subscriptioncart set 
					tbl_subscription_id = 16,
					tbl_subscriptioncart_user_nmcid = USERID_AUX,
					tbl_subscriptioncart_quantity = de_117_022;
				end if;
                    



				-- ---------------------
				-- Commissions        --
				-- ---------------------

				if ( select tbl_commission_id from dbcommission.tbl_commission where tbl_commission_agent_nmcId = de_053 and (select MONTH(tbl_commission_date)) = (select MONTH(NOW())) limit 1) is null then
				
					insert into dbcommission.tbl_commission set
					tbl_commission_agent_nmcId = de_053,
					tbl_commission_date = NOW(),
					tbl_commission_refNumber = CONCAT('ref-',de_053,''),
					tbl_commission_status_id = 72001;
					
				end if;



                -- ---------------------
				-- Payment            --
				-- ---------------------
				
                
                if LENGTH(de_055_003_CADENA) >0 then
                
					SET de_048_015_AUX2 = TRIM((SELECT SUBSTR(de_048_015_CADENA2,1,LOCATE('|',de_048_015_CADENA2)-1)));
					SET de_048_015_CADENA2 = (SELECT SUBSTR(de_048_015_CADENA2,LOCATE('|',de_048_015_CADENA2)+1));

					SET de_055_003 = TRIM((SELECT SUBSTR(de_055_003_CADENA,1,LOCATE('|',de_055_003_CADENA)-1)));
					SET de_055_003_CADENA = (SELECT SUBSTR(de_055_003_CADENA,LOCATE('|',de_055_003_CADENA)+1));

					SET de_122_040 = TRIM((SELECT SUBSTR(de_122_040_CADENA,1,LOCATE('|',de_122_040_CADENA)-1)));
					SET de_122_040_CADENA = (SELECT SUBSTR(de_122_040_CADENA,LOCATE('|',de_122_040_CADENA)+1));
					
					SET de_122_041 = TRIM((SELECT SUBSTR(de_122_041_CADENA,1,LOCATE('|',de_122_041_CADENA)-1)));
					SET de_122_041_CADENA = (SELECT SUBSTR(de_122_041_CADENA,LOCATE('|',de_122_041_CADENA)+1));

					SET de_122_042 = TRIM((SELECT SUBSTR(de_122_042_CADENA,1,LOCATE('|',de_122_042_CADENA)-1)));
					SET de_122_042_CADENA = (SELECT SUBSTR(de_122_042_CADENA,LOCATE('|',de_122_042_CADENA)+1));
			
					SET de_122_043 = TRIM((SELECT SUBSTR(de_122_043_CADENA,1,LOCATE('|',de_122_043_CADENA)-1)));
					SET de_122_043_CADENA = (SELECT SUBSTR(de_122_043_CADENA,LOCATE('|',de_122_043_CADENA)+1));

					if LENGTH(de_048_015_AUX2) >0 then
						set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015_AUX2 and tbl_user_nmcId = USERID_AUX limit 1);
                    else
						set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015 and tbl_user_nmcId = USERID_AUX limit 1);
					end if;

					if LENGTH(de_122_034) >0 then 

						SET CARD_TOCKEN = (select tbl_card_tocken from dbcards.tbl_carduser where tbl_carduser_id = de_122_034);
						SET DATE_AUX = NOW();

						if (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) is not null then
						   SET BILLID_AUX = (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) +1;
						else
						   SET BILLID_AUX = 1;
						end if;

						-- --------------- --
						-- Bill            --
						-- --------------- --
						
						insert into dbtransaction.tbl_bill set
						tbl_bill_id = BILLID_AUX,
						tbl_bill_number = 1000000 + BILLID_AUX,
						tbl_bill_merchant_nmcId = USERID_AUX,
						tbl_bill_seller_nmcId = '001', 
						tbl_bill_status = 101,
						tbl_bill_date = DATE_AUX;
						
						-- ------------------ --
						-- Bill Subscription  --
						-- ------------------ --
						
						insert into dbtransaction.tbl_billsubscription (tbl_bill_id,
														  tbl_subscription_id,
														  tbl_billsubscription_quantity,
														  tbl_billsubscription_price,
														  tbl_billsubscription_reseller_nmcId)
						select  BILLID_AUX,
								A.tbl_subscription_id,
								A.tbl_subscriptioncart_quantity,
								B.tbl_subscription_recommended_price,
								null

						from dbitems.tbl_subscriptioncart as A, dbitems.tbl_subscription as B
						where A.tbl_subscriptioncart_user_nmcid = USERID_AUX
						and A.tbl_subscriptioncart_delete = 0
						and A.tbl_subscription_id = B.tbl_subscription_id;
						
						if de_117_018 > 0 then
                        
							insert into dbtransaction.tbl_billsubscription set
							tbl_bill_id = BILLID_AUX,
							tbl_hardware_type_id = 75001,
							tbl_billsubscription_quantity = de_117_018,
							tbl_billsubscription_price = 0.00;
                            
                            insert into dbuser.tbl_shipping set
							tbl_user_id = USERID_AUX,
							tbl_location_id = LOCATIONID_AUX,
							tbl_shipping_dongle_qty = de_117_018,
							tbl_shipping_tablet_qty = 0,
							tbl_shipping_tv_qty = 0,
							tbl_shipping_status_id = 73001,
							tbl_shipping_saleDate = current_date(),
							tbl_shipping_invoiceNumber = BILLID_AUX,
							tbl_shipping_refNumber = 1000000 + BILLID_AUX,
							tbl_shipping_boxes = 0;
                            
						end if;
						
						-- ------------------ --
						-- Bil Transaction    --
						-- ------------------ --
						
						insert into dbtransaction.tbl_billtransaction set 
						tbl_bill_id = BILLID_AUX,
						tbl_cardTocken = CARD_TOCKEN,	  	
						tbl_billtransaction_amount = de_055_003,
						tbl_billtransaction_status_id = 75,
						tbl_billtransaction_type_id = 1,
						tbl_billtransaction_date = DATE_AUX;

						
						set de_SB = (select GROUP_CONCAT(CONCAT('',tbl_subscription_id,'|'))
									from dbitems.tbl_subscriptioncart 
									where tbl_subscriptioncart_user_nmcid = USERID_AUX
									and tbl_subscriptioncart_delete = 0
									);
									
						set CADENA_SUBSCRIPTION = REPLACE(de_SB,'|,','|');	
						set CADENA_SUBSCRIPTION_AUX = REPLACE(de_SB,'|,','|');
						
						WHILE (LENGTH(CADENA_SUBSCRIPTION)>0) DO
										
							SET SUBSCRIPTION_AUX = (SELECT SUBSTR(CADENA_SUBSCRIPTION,1,LOCATE('|',CADENA_SUBSCRIPTION)-1));
							SET CADENA_SUBSCRIPTION = (SELECT SUBSTR(CADENA_SUBSCRIPTION,LOCATE('|',CADENA_SUBSCRIPTION)+1));

							set SUBSCRIPTION_QUANTITY = (select tbl_subscriptioncart_quantity from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) and tbl_subscriptioncart_delete = 0 LIMIT 1);

							if (select tbl_subscription_id from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) is null then
						
								insert into dbitems.tbl_usersubscription set
								tbl_company_id = COMPANY_ID,
								tbl_usersubscription_user_nmcid = USERID_AUX,
								tbl_subscription_id = TRIM(SUBSCRIPTION_AUX),
								tbl_usersubscription_date_purchase = DATE_AUX,		  
								tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
								tbl_subscriptionstatus_id = 2401;
								
							else
								
								if (select tbl_usersubscription_date_expiration from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) > NOW() then
							
									update dbitems.tbl_usersubscription set
									tbl_usersubscription_date_purchase = DATE_AUX,		  
									tbl_usersubscription_date_expiration = DATE_ADD(tbl_usersubscription_date_expiration, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
									tbl_subscriptionstatus_id = 2401
									where tbl_usersubscription_user_nmcid = USERID_AUX
									and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
									
								else
							
									update dbitems.tbl_usersubscription set
									tbl_usersubscription_date_purchase = DATE_AUX,		  
									tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
									tbl_subscriptionstatus_id = 2401
									where tbl_usersubscription_user_nmcid = USERID_AUX
									and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
								
								end if;
								
							end if;
						
						END WHILE;


						-- ------------------------- --
						-- Clean Subscription Cart   --
						-- ------------------------- --

						update dbitems.tbl_subscriptioncart set
						tbl_subscriptioncart_delete = 1
						where tbl_subscriptioncart_user_nmcid = USERID_AUX
						and tbl_subscriptioncart_delete = 0;
						
						update tbl_hardware_cart set 
						tbl_hardware_cart_delete = 1
						where tbl_user_id = de_114_179
						and tbl_hardware_cart_delete = 0;
						
						update dbuser.tbl_merchant set
						tbl_merchant_receivePayment_f = 1
						where tbl_user_id = USERID_AUX;
                        
                        
						-- ------------------------- --
						-- Processor                 --
						-- ------------------------- --
					
						update dbtransaction.tbl_bill set
						tbl_bill_authorization_code = de_122_040,
						tbl_bill_display_message = de_122_041,
						tbl_bill_result_message = de_122_042,
						tbl_bill_result_code = de_122_043
						where tbl_bill_id = BILLID_AUX;
                    
                    end if;
                
                end if;
                
                
                
                
                
                
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
			
			else
			
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','2067'),('44','Duplicated Company Name');
				
			end if;
			
		else 

			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','2053'),('44','Email Already Exists');

		end if;
		
	end if;
	
	

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCId(USERID_AUX)),'"'),CONCAT(',"123.34":"',CRC_AUX,'"}')) as JSON;
	else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
    end if;
    
	DROP TABLE TBL_MESSAGE1;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantNEWWizard030300568` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `RegisterMerchantNEWWizard030300568`(IN MSG_IN VARCHAR(20000))
BEGIN
	
	DECLARE de_114_179 VARCHAR(20) DEFAULT NULL;    -- 114.179 Merchant Id
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;  	    -- 52 Password (temporal) 
	DECLARE de_127_010 VARCHAR(4) DEFAULT NULL; 	-- 127.10 Owner Id
	
	DECLARE de_114_070 VARCHAR(500) DEFAULT NULL;   -- 114.70 Company name
	DECLARE de_123_071 VARCHAR(45) DEFAULT NULL;    -- 123.71 Tax Id Number
	DECLARE de_114_121 INT(11) DEFAULT NULL;		-- 114.121 Multiple location Qty	
	
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;    -- 114.3 Firstname
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;    -- 114.5 Lastname
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;   -- 114.7 Email
	DECLARE de_114_091 VARCHAR(40) DEFAULT NULL;    -- 114.91 Title
	
	DECLARE de_119_016 TEXT DEFAULT NULL;    		-- 119.16 Return Policy
	
	DECLARE de_117_018 INT(11) DEFAULT NULL;		-- 117.18 TV AD Players Qty
	DECLARE de_117_020 INT(11) DEFAULT NULL; 		-- 117.20 Online Subscription Qty
	DECLARE de_117_021 INT(11) DEFAULT NULL;		-- 117.21 Location Subscription Qty
    DECLARE de_055_003 VARCHAR(20) DEFAULT NULL;    -- 55.3 Total Amount
	
	DECLARE _US_PH TEXT DEFAULT NULL;               -- PH Phone Struct	
	DECLARE _48_28_CADENA TEXT DEFAULT NULL;        -- 48.28 Phone number
	DECLARE _121_167_CADENA TEXT DEFAULT NULL;      -- 121.167 Phone Extension
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL;      -- 122.87 Country Id 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 		-- 121.62 Phone Type Id
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;

	DECLARE _US_AD 	TEXT DEFAULT NULL;              -- AD Address Struct
	DECLARE de_121_045_CADENA TEXT DEFAULT NULL; 	-- 121.45 Address Type Id
	DECLARE de_114_012_CADENA TEXT DEFAULT NULL; 	-- 114.12 Address First line
	DECLARE de_114_013_CADENA TEXT DEFAULT NULL; 	-- 114.13 Address Second line
	DECLARE de_122_087_CADENA TEXT DEFAULT NULL; 	-- 122.87 Country Id	
	DECLARE de_120_013_CADENA TEXT DEFAULT NULL; 	-- 120.13 State Id  
	DECLARE de_114_014_CADENA TEXT DEFAULT NULL; 	-- 114.14 City Id 
	DECLARE de_122_107_CADENA TEXT DEFAULT NULL; 	-- 122.107 Zipcode Id
	DECLARE de_048_028_CADENA TEXT DEFAULT NULL;    -- 48.28 Phone number
	DECLARE de_121_167_CADENA TEXT DEFAULT NULL;    -- 121.167 Phone Extension
	DECLARE de_121_045 INT(11) DEFAULT NULL;  			
	DECLARE de_114_012 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_114_013 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_122_087 INT(11) DEFAULT NULL;  			
	DECLARE de_120_013 INT(11) DEFAULT NULL;  			
	DECLARE de_114_014 INT(11) DEFAULT NULL;  			
	DECLARE de_122_107 INT(11) DEFAULT NULL;
	DECLARE de_048_028 VARCHAR(40) DEFAULT NULL;
	DECLARE de_121_167 VARCHAR(40) DEFAULT NULL;
	
	DECLARE de_047_017_CADENA TEXT DEFAULT NULL; 	-- 47.17 Zipcode name
	DECLARE de_047_017 VARCHAR(20) DEFAULT NULL;
	
	
    DECLARE _US_AC 	TEXT DEFAULT NULL;				-- AC Credit Card Struct
    DECLARE de_048_006_CADENA TEXT DEFAULT NULL; 	-- 48.6 Nickname
	DECLARE de_048_002_CADENA TEXT DEFAULT NULL;	-- 48.2 Cardholder name
	DECLARE de_002_CADENA TEXT DEFAULT NULL;		-- 2 Account number
	DECLARE de_118_005_CADENA TEXT DEFAULT NULL; 	-- 118.5 Card expiration date 
	DECLARE de_048_004_CADENA TEXT DEFAULT NULL; 	-- 48.4 Card verification number
	DECLARE de_120_007_CADENA TEXT DEFAULT NULL; 	-- 120.7 Type credit card
	DECLARE de_122_126_CADENA TEXT DEFAULT NULL; 	-- 122.126 TokenEx Reference Number 
	DECLARE de_121_005_CADENA TEXT DEFAULT NULL; 	-- 121.5  TokenEx Date
	DECLARE de_048_006 VARCHAR(45) DEFAULT NULL;   
    DECLARE de_048_002 VARCHAR(99) DEFAULT NULL;   
	DECLARE de_002 VARCHAR(45) DEFAULT NULL;        
    DECLARE de_118_005 VARCHAR(5) DEFAULT NULL;
	DECLARE de_048_004 VARCHAR(45) DEFAULT NULL;
    DECLARE de_048_015 VARCHAR(45) DEFAULT NULL;    
	DECLARE de_120_007 VARCHAR(11) DEFAULT 0;  
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL;
    DECLARE de_121_005 VARCHAR(45) DEFAULT NULL;  
    
	DECLARE _US_CU 	TEXT DEFAULT NULL;              -- CU Category User
	DECLARE de_114_093_CADENA TEXT DEFAULT NULL; 	-- 114.93 Category Id
	DECLARE de_114_093 INT(11) DEFAULT 0; 
	
	DECLARE _US_NT 	TEXT DEFAULT NULL;              -- NT Notes Struct
	DECLARE de_124_131_CADENA TEXT DEFAULT NULL; 	-- 124.131 Notes Type
	DECLARE de_124_132_CADENA TEXT DEFAULT NULL; 	-- 124.132 Notes Date
	DECLARE de_124_133_CADENA TEXT DEFAULT NULL; 	-- 124.133 Notes Comments
	DECLARE de_124_134_CADENA TEXT DEFAULT NULL; 	-- 124.134 Notes Priority Flag
	DECLARE de_124_135_CADENA TEXT DEFAULT NULL; 	-- 124.135 Notes Reminder Flag
	DECLARE de_124_136_CADENA TEXT DEFAULT NULL; 	-- 124.136 Notes Share Flag
	DECLARE de_124_137_CADENA TEXT DEFAULT NULL; 	-- 124.137 Notes Reminder Date
	DECLARE de_124_138_CADENA TEXT DEFAULT NULL; 	-- 124.138 Notes Reminder UserName
	DECLARE de_124_131 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_132 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_133 TEXT DEFAULT NULL; 	
	DECLARE de_124_134 VARCHAR(5) DEFAULT NULL; 	
	DECLARE de_124_135 VARCHAR(5) DEFAULT NULL; 	
	DECLARE de_124_136 VARCHAR(5) DEFAULT NULL; 
	DECLARE de_124_137 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_138 VARCHAR(99) DEFAULT NULL;
	
	DECLARE _US_AT 	TEXT DEFAULT NULL;              -- NT Activity Struct
	DECLARE de_124_141_CADENA TEXT DEFAULT NULL; 	-- 124.141 Activity Type
	DECLARE de_124_142_CADENA TEXT DEFAULT NULL; 	-- 124.142 Activity Date
	DECLARE de_124_143_CADENA TEXT DEFAULT NULL; 	-- 124.143 Activity Comments
	DECLARE de_124_144_CADENA TEXT DEFAULT NULL; 	-- 124.144 Activity Comments
	DECLARE de_124_141 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_142 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_143 TEXT DEFAULT NULL; 
	DECLARE de_124_144 VARCHAR(99) DEFAULT NULL; 
	
	-- Variables auxiliares:
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE USER_NAME	VARCHAR(100) DEFAULT NULL;     
	DECLARE USER_EMAIL  VARCHAR(100) DEFAULT NULL;  
	DECLARE CRC_AUX VARCHAR(10) DEFAULT NULL; 
	
	DECLARE i INT(4) DEFAULT NULL;
	DECLARE ADDRESSID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;  
	DECLARE PHONEID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE BILLID_AUX INTEGER(11) DEFAULT NULL; 
    DECLARE ACCOUNTPAYABLEID_AUX INT(11) DEFAULT 0;
	DECLARE CLASS_AUX VARCHAR(1) DEFAULT 0;
	DECLARE OWNER_AUX VARCHAR(3) DEFAULT 0;
	DECLARE DATE_AUX DATETIME DEFAULT 0;
	DECLARE de_122_034 INT(11) DEFAULT NULL;
    DECLARE CARD_TOCKEN VARCHAR(45) DEFAULT NULL;	
	DECLARE de_SB VARCHAR(5000) DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION TEXT DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION_AUX TEXT DEFAULT NULL;	
	DECLARE SUBSCRIPTION_AUX VARCHAR(45) DEFAULT NULL;
    DECLARE SUBSCRIPTION_AUX2 VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_TITLE VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_QUANTITY INT(11) DEFAULT NULL;
	DECLARE RESIDUAL_QUANTITY DECIMAL(15,2) DEFAULT NULL;
	DECLARE LATITUDE_AUX VARCHAR(20) DEFAULT 0;			
	DECLARE LONGITUDE_AUX VARCHAR(20) DEFAULT 0;
	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL;
	
    DECLARE PARAMET	VARCHAR(100) DEFAULT NULL;
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	
	

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA TEXT NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	
	SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	set de_114_179 = (select right(de_114_179,11));
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_127_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.10');
	
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
    SET de_114_070 = convert(unhex(de_114_070) using utf8);
    
	SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');
	SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.121');
	
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
	
	SET de_119_016 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '119.16');
	
	SET de_117_018 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.18');
	SET de_117_020 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.20');
	SET de_117_021 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.21');
	SET de_055_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '55.3');
	
	SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
	SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));
	SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
	SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
	SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
	SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
	SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
	SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
	SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
	SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

	
	SELECT DATA INTO _US_AD FROM TBL_MESSAGE1 WHERE CODE = "AD";
	SET _US_AD = (SELECT CONVERT(unhex(_US_AD) USING utf8 ));	
	SET _US_AD = REPLACE(_US_AD,'{"1','{"_1');
	SET _US_AD = REPLACE(_US_AD,',"1',',"_1');
	SET _US_AD = REPLACE(_US_AD,'{"4','{"_4');
	SET _US_AD = REPLACE(_US_AD,',"4',',"_4');
	SET de_121_045_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_121.45'));
	SET de_114_012_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.12'));
	SET de_114_013_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.13'));
	SET de_122_107_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.107'));
	SET de_114_014_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.14'));
	SET de_120_013_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_120.13'));
	SET de_122_087_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.87'));
	SET de_048_028_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_48.28'));
	SET de_121_167_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_121.167'));
	SET de_047_017_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_47.17'));
	
	SELECT DATA INTO _US_AC FROM TBL_MESSAGE1 WHERE CODE = "AC";
	SET _US_AC = (SELECT CONVERT(unhex(_US_AC) USING utf8 ));
	SET _US_AC = REPLACE(_US_AC,'{"1','{"_1');
	SET _US_AC = REPLACE(_US_AC,',"1',',"_1');
	SET _US_AC = REPLACE(_US_AC,'{"4','{"_4');
	SET _US_AC = REPLACE(_US_AC,',"4',',"_4');
    SET _US_AC = REPLACE(_US_AC,'{"2','{"_2');
	SET _US_AC = REPLACE(_US_AC,',"2',',"_2');
    SET de_002_CADENA      = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_2'));
	SET de_118_005_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_118.5'));
	SET de_120_007_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_120.7'));
	SET de_048_006_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.6'));
	SET de_048_002_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.2'));
	SET de_048_004_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.4'));
	SET de_122_126_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_122.126'));
	SET de_121_005_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_121.5'));
	
	
	SELECT DATA INTO _US_CU FROM TBL_MESSAGE1 WHERE CODE = "CU";
	SET _US_CU = (SELECT CONVERT(unhex(_US_CU) USING utf8 ));
	SET _US_CU = REPLACE(_US_CU,'{"1','{"_1');
	SET _US_CU = REPLACE(_US_CU,',"1',',"_1');
	SET de_114_093_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_CU":',_US_CU,'}'),'//_114.93'));
	
	
	SELECT DATA INTO _US_NT FROM TBL_MESSAGE1 WHERE CODE = "NT";
	SET _US_NT = (SELECT CONVERT(unhex(_US_NT) USING utf8 ));
	SET _US_NT = REPLACE(_US_NT,'{"1','{"_1');
	SET _US_NT = REPLACE(_US_NT,',"1',',"_1');
	SET de_124_131_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.131'));
	SET de_124_132_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.132'));
	SET de_124_133_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.133'));
	SET de_124_134_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.134'));
	SET de_124_135_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.135'));
	SET de_124_136_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.136'));
	SET de_124_137_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.137'));
	SET de_124_138_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.138'));
	
	SELECT DATA INTO _US_AT FROM TBL_MESSAGE1 WHERE CODE = "AT";
	SET _US_AT = (SELECT CONVERT(unhex(_US_AT) USING utf8 ));
	SET _US_AT = REPLACE(_US_AT,'{"1','{"_1');
	SET _US_AT = REPLACE(_US_AT,',"1',',"_1');
	SET de_124_141_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.141'));
	SET de_124_142_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.142'));
	SET de_124_143_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.143'));	
	SET de_124_144_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.144'));
	
	
	
	
	
	
	
	
	
	if length(de_114_179) > 0 then 

		-- ---------------------
        -- User and merchant  --
        -- ---------------------
		
		update tbl_user set
		tbl_user_email = COALESCE(de_114_007, tbl_user_email),
		tbl_user_first = COALESCE(de_114_003, tbl_user_first),
		tbl_user_last = COALESCE(de_114_005, tbl_user_last),
		tbl_user_title = COALESCE(de_114_091, tbl_user_title),
		tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName),
		tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),tbl_user_password),
		tbl_user_policy = COALESCE(convert(unhex(de_119_016) using utf8),tbl_user_policy),
		tbl_user_dateAdded = NOW(),
		tbl_user_dateModified = NOW(),
		tbl_userstatus_id = 33,
        tbl_user_userTemp_f = 0,
        tbl_gender_type = 51,
		tbl_user_multipleshipaddress_f = 0
		where tbl_user_id = de_114_179; 
		
		SET USERID_AUX = de_114_179;
		SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
		SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
		SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));
		SET COMPANY_ID =  (select tbl_company_id from tbl_user where tbl_user_id= USERID_AUX);

		update tbl_merchant set
		tbl_merchant_taxIdNumber = COALESCE(de_123_071, tbl_merchant_taxIdNumber),
		tbl_merchant_multiple_locations_quantity = COALESCE(de_114_121, tbl_merchant_multiple_locations_quantity),
		tbl_merchant_location_use = COALESCE(de_114_121, tbl_merchant_location_use),
		tbl_merchant_dongles_quantity = COALESCE(de_117_018, tbl_merchant_dongles_quantity),
        -- tbl_merchant_basic_subs = COALESCE(de_117_020, tbl_merchant_basic_subs),
		tbl_merchant_standard_subs = COALESCE(de_117_020, tbl_merchant_standard_subs),
		tbl_merchant_deluxe_subs = COALESCE(de_117_021,tbl_merchant_deluxe_subs),
		tbl_merchant_receivePayment_f = 0
		where tbl_user_id = de_114_179;

		update tbl_company set
		tbl_company_name = COALESCE(de_114_070 ,tbl_company_name),
		tbl_company_taxId = COALESCE(de_123_071 ,tbl_company_taxId),
		tbl_company_policy = COALESCE(convert(unhex(de_119_016) using utf8), tbl_company_policy)
		where tbl_company_id = COMPANY_ID;
		
		

		
		-- ---------------------
        -- Link               --
        -- ---------------------
		
		if length(de_052) > 0 then 
		
			update tbl_link set
			tbl_link_link = md5(convert(unhex(de_052) using utf8)),
			tbl_link_date = NOW(),
			tbl_link_delete = 0
			where tbl_link_user_id = de_114_179;
		
		end if;
		
		
		
		-- ---------------------
        -- Phones             --
        -- ---------------------
		
		if LENGTH(_48_28_CADENA) >0 then
		
			delete from tbl_phone where tbl_phone_nmcId = de_114_179;
		
			while (LENGTH(_48_28_CADENA)>0) DO

				SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
				SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

				SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
				SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
				
				SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
				SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

				SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
				SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

				insert into tbl_phone set
				tbl_company_id 		  = COMPANY_ID,
				tbl_phone_nmcId       = de_114_179,
				tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
				tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
				tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
				tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

				SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);		
				
			end while ; 
			
		end if;
		
		
		
		-- ------------------------
		-- Address and Locations --
		-- ------------------------
		
		if (select tbl_address_id from tbl_address where tbl_address_nmcId = de_114_179 limit 1) is not null then
		
			delete from tbl_location_hardware where tbl_user_id = de_114_179;			
			delete from tbl_locationaddress where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
			delete from tbl_locationphone where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
			delete from tbl_location_schedule where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
			delete from tbl_location where tbl_location_userId = de_114_179;			
			delete from tbl_address where tbl_address_nmcId = de_114_179;
		
		end if;
		
		if LENGTH(de_114_012_CADENA) >0 then

			while (LENGTH(de_114_012_CADENA)>0) DO
			
				SET de_121_045 = TRIM((SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1)));
				SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));

				SET de_114_012 = (SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1));
				SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

				SET de_114_013 = (SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1));
				SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
				
				-- SET de_122_107 = TRIM((SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1)));
				-- SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

				-- SET de_114_014 = TRIM((SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1)));
				-- SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
		
				-- SET de_120_013 = TRIM((SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1)));
				-- SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

				-- SET de_122_087 = TRIM((SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1)));
				-- SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
				
				SET de_048_028 = TRIM((SELECT SUBSTR(de_048_028_CADENA,1,LOCATE('|',de_048_028_CADENA)-1)));
				SET de_048_028_CADENA = (SELECT SUBSTR(de_048_028_CADENA,LOCATE('|',de_048_028_CADENA)+1));

				SET de_121_167 = TRIM((SELECT SUBSTR(de_121_167_CADENA,1,LOCATE('|',de_121_167_CADENA)-1)));
				SET de_121_167_CADENA = (SELECT SUBSTR(de_121_167_CADENA,LOCATE('|',de_121_167_CADENA)+1));
				
				SET de_047_017 = TRIM((SELECT SUBSTR(de_047_017_CADENA,1,LOCATE('|',de_047_017_CADENA)-1)));
				SET de_047_017_CADENA = (SELECT SUBSTR(de_047_017_CADENA,LOCATE('|',de_047_017_CADENA)+1));

				if length(de_047_017) > 0 then
				
					SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
					SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
                
					set de_122_107 = (select tbl_zipcode_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
					set de_114_014 = (select tbl_city_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
					set de_120_013 = (select tbl_state_id from tbl_city where tbl_city_id = de_114_014);
					set de_122_087 = (select tbl_country_id from tbl_state where tbl_state_id = de_120_013);
					
				else
				
					SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
					SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
                
				end if;
				
				insert into tbl_address set 
				tbl_company_id = COMPANY_ID,
				tbl_address_nmcId = de_114_179,
				tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
				tbl_address_first = TRIM(de_114_012),
				tbl_address_second = TRIM(de_114_013),
				tbl_address_phoneNumber = null,
				tbl_zipcode_id = TRIM(de_122_107),
				tbl_city_id = TRIM(de_114_014),
				tbl_state_id = TRIM(de_120_013),
				tbl_country_id = TRIM(de_122_087);
				
				SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
					
				INSERT INTO tbl_location SET
				tbl_company_id = COMPANY_ID,
				tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
				tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
				tbl_location_contactName = COALESCE(USER_NAME,' '), 
				tbl_location_contactEmail = COALESCE(USER_EMAIL,' '), 
				tbl_location_userId = de_114_179,
				tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
				tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
				tbl_location_statusId= 7001;
					
				SET LOCATIONID_AUX= (SELECT last_insert_id() from  tbl_location limit 1);

				INSERT tbl_locationaddress SET
				tbl_location_id = LOCATIONID_AUX, 
				tbl_address_id = ADDRESSID_AUX;
					
				INSERT tbl_phone SET
				tbl_company_id = COMPANY_ID,
				tbl_phone_phoneNumber = de_048_028,
				tbl_phone_extension = de_121_167,
				tbl_phone_country_id = de_122_087,
				tbl_phonetype_id = 4001;
				
				SET PHONEID_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);
				
				INSERT INTO tbl_locationphone SET
				tbl_location_id = LOCATIONID_AUX,
				tbl_phone_id = PHONEID_AUX;
					
				if (select count(tbl_location_id) from tbl_location where tbl_location_userId = de_114_179) = 1 then

					INSERT INTO tbl_hardware_cart (
					tbl_company_id,
                    tbl_user_id,
					tbl_location_id,
                    tbl_hardware_type_id,
                    tbl_hardware_cart_quantity,
                    tbl_hardware_cart_delete
                    )
                    values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0);
                    
				end if;
					
				INSERT INTO tbl_location_hardware (
				tbl_company_id,
				tbl_user_id,
				tbl_location_id,
				tbl_hardware_type_id,
				tbl_location_hardware_qty,
				tbl_location_hardware_shipped,
				tbl_shipping_status_id) 
				values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,0,0,73001);

				INSERT INTO tbl_location_schedule (
				tbl_location_id,
				tbl_day_of_the_week,
				tbl_24_hour,
				tbl_closed_flag,
				tbl_hour_open,
				tbl_hour_close) 
				values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
					   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');
				
			end while ;
			
		end if;
		
		
		
        -- ---------------------
		-- Credit Card        --
		-- ---------------------
        
        if LENGTH(de_002_CADENA) >0 then

			delete from dbcards.tbl_card where tbl_user_id = de_114_179;
			delete from dbcards.tbl_carduser where tbl_user_nmcId = de_114_179;
		
			SET de_002 = TRIM((SELECT SUBSTR(de_002_CADENA,1,LOCATE('|',de_002_CADENA)-1)));
			SET de_002_CADENA = (SELECT SUBSTR(de_002_CADENA,LOCATE('|',de_002_CADENA)+1));
		
			SET de_118_005 = TRIM((SELECT SUBSTR(de_118_005_CADENA,1,LOCATE('|',de_118_005_CADENA)-1)));
			SET de_118_005_CADENA = (SELECT SUBSTR(de_118_005_CADENA,LOCATE('|',de_118_005_CADENA)+1));

			SET de_120_007 = TRIM((SELECT SUBSTR(de_120_007_CADENA,1,LOCATE('|',de_120_007_CADENA)-1)));
			SET de_120_007_CADENA = (SELECT SUBSTR(de_120_007_CADENA,LOCATE('|',de_120_007_CADENA)+1));
			
			SET de_048_006 = TRIM((SELECT SUBSTR(de_048_006_CADENA,1,LOCATE('|',de_048_006_CADENA)-1)));
			SET de_048_006_CADENA = (SELECT SUBSTR(de_048_006_CADENA,LOCATE('|',de_048_006_CADENA)+1));
	
			SET de_048_002 = TRIM((SELECT SUBSTR(de_048_002_CADENA,1,LOCATE('|',de_048_002_CADENA)-1)));
			SET de_048_002_CADENA = (SELECT SUBSTR(de_048_002_CADENA,LOCATE('|',de_048_002_CADENA)+1));
			
			SET de_048_004 = TRIM((SELECT SUBSTR(de_048_004_CADENA,1,LOCATE('|',de_048_004_CADENA)-1)));
			SET de_048_004_CADENA = (SELECT SUBSTR(de_048_004_CADENA,LOCATE('|',de_048_004_CADENA)+1));
			
			SET de_122_126 = TRIM((SELECT SUBSTR(de_122_126_CADENA,1,LOCATE('|',de_122_126_CADENA)-1)));
			SET de_122_126_CADENA = (SELECT SUBSTR(de_122_126_CADENA,LOCATE('|',de_122_126_CADENA)+1));
			
			SET de_121_005 = TRIM((SELECT SUBSTR(de_121_005_CADENA,1,LOCATE('|',de_121_005_CADENA)-1)));
			SET de_121_005_CADENA = (SELECT SUBSTR(de_121_005_CADENA,LOCATE('|',de_121_005_CADENA)+1));
			
			
			SET de_048_015 = de_002;
			
			insert into dbcards.tbl_carduser set
			tbl_user_nmcId = de_114_179,
			tbl_card_tocken = de_048_015,
			tbl_paymentnaturetype_id = 35001,
			tbl_carduser_referenceNumber = de_122_126,
			tbl_carduser_date = de_121_005;
			
			insert into dbcards.tbl_card set
			tbl_user_id = de_114_179,
			tbl_card_tocken = de_048_015,
			tbl_card_number = SUBSTRING(de_002, -4),
			tbl_card_dateAdded = NOW(),
			tbl_card_datemodified = NOW(),
			tbl_cardstype_id = COALESCE(de_120_007,61),
			tbl_cardstatus_id = 51,
			tbl_card_nickname = COALESCE(de_048_006,''),
			tbl_card_chardholderName = COALESCE(de_048_002,''),		
			tbl_card_routingNumber = '',
			tbl_card_issuingBank = '',
			tbl_accounttype_id = null,
			tbl_bankaccounttype_id = null,	
			tbl_card_dateExpire = COALESCE(de_118_005,''),
			tbl_card_swift_iban_code = COALESCE(de_048_004,''),
			tbl_country_id = null,
			tbl_zipcode = null,
			tbl_debitaccounttype_id = null,
			tbl_address_id = null,
			tbl_paymentserviceprovider_id = null;
  
        end if;
        
		
		
		-- ---------------------
		-- Category User      --
		-- ---------------------
		
		if LENGTH(de_114_093_CADENA) >0 then
		
			if (select tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory where tbl_merchant_nmcId = de_114_179 limit 1) is not null then 
				delete from dbuser.tbl_merchantbusinesscategory where tbl_merchant_nmcId = de_114_179;
			end if;
	   
			while (LENGTH(de_114_093_CADENA)>0) DO
	   
				SET de_114_093 = TRIM((SELECT SUBSTR(de_114_093_CADENA,1,LOCATE('|',de_114_093_CADENA)-1)));
				SET de_114_093_CADENA = (SELECT SUBSTR(de_114_093_CADENA,LOCATE('|',de_114_093_CADENA)+1));
				
				if (select tbl_businesscategory_id 
					from dbuser.tbl_merchantbusinesscategory 
					where tbl_merchant_nmcId = de_114_179 
					and tbl_businesscategory_id = de_114_093
					limit 1) is null then 
					
					insert into dbuser.tbl_merchantbusinesscategory set
					tbl_company_id = COMPANY_ID,
					tbl_merchant_nmcId = de_114_179,
					tbl_businesscategory_id = de_114_093;
					
				end if;
				
			end while;
				
		end if;
			
			
			
		-- ---------------------
		-- CRM Notes          --
		-- ---------------------
		
		if LENGTH(de_124_131_CADENA) >0 then
		
			if (select tbl_crm_note_id from dbuser.tbl_crm_note where tbl_user_id = de_114_179 limit 1) is not null then 
				delete from dbuser.tbl_crm_note where tbl_user_id = de_114_179;
			end if;
	   
			while (LENGTH(de_124_131_CADENA)>0) DO
	   
				SET de_124_131 = TRIM((SELECT SUBSTR(de_124_131_CADENA,1,LOCATE('|',de_124_131_CADENA)-1)));
				SET de_124_131_CADENA = (SELECT SUBSTR(de_124_131_CADENA,LOCATE('|',de_124_131_CADENA)+1));
				
				SET de_124_132 = TRIM((SELECT SUBSTR(de_124_132_CADENA,1,LOCATE('|',de_124_132_CADENA)-1)));
				SET de_124_132_CADENA = (SELECT SUBSTR(de_124_132_CADENA,LOCATE('|',de_124_132_CADENA)+1));
				
				SET de_124_133 = TRIM((SELECT SUBSTR(de_124_133_CADENA,1,LOCATE('|',de_124_133_CADENA)-1)));
				SET de_124_133_CADENA = (SELECT SUBSTR(de_124_133_CADENA,LOCATE('|',de_124_133_CADENA)+1));
				
				SET de_124_134 = TRIM((SELECT SUBSTR(de_124_134_CADENA,1,LOCATE('|',de_124_134_CADENA)-1)));
				SET de_124_134_CADENA = (SELECT SUBSTR(de_124_134_CADENA,LOCATE('|',de_124_134_CADENA)+1));
				
				SET de_124_135 = TRIM((SELECT SUBSTR(de_124_135_CADENA,1,LOCATE('|',de_124_135_CADENA)-1)));
				SET de_124_135_CADENA = (SELECT SUBSTR(de_124_135_CADENA,LOCATE('|',de_124_135_CADENA)+1));
				
				SET de_124_136 = TRIM((SELECT SUBSTR(de_124_136_CADENA,1,LOCATE('|',de_124_136_CADENA)-1)));
				SET de_124_136_CADENA = (SELECT SUBSTR(de_124_136_CADENA,LOCATE('|',de_124_136_CADENA)+1));
				
				SET de_124_137 = TRIM((SELECT SUBSTR(de_124_137_CADENA,1,LOCATE('|',de_124_137_CADENA)-1)));
				SET de_124_137_CADENA = (SELECT SUBSTR(de_124_137_CADENA,LOCATE('|',de_124_137_CADENA)+1));
				
				SET de_124_138 = TRIM((SELECT SUBSTR(de_124_138_CADENA,1,LOCATE('|',de_124_138_CADENA)-1)));
				SET de_124_138_CADENA = (SELECT SUBSTR(de_124_138_CADENA,LOCATE('|',de_124_138_CADENA)+1));
				
				
				case de_124_131 
					when 'G'  then set de_124_131 = 'General';
					when 'FU' then set de_124_131 = 'Follow Up';
					when 'RE' then set de_124_131 = 'Refusal';
					when 'SH' then set de_124_131 = 'Share';
					else set de_124_131 = 'General';
				end case;
				
				insert into dbuser.tbl_crm_note set
				tbl_user_id = de_114_179,
				tbl_crm_note_type = de_124_131,
				tbl_crm_note_date = de_124_132,
				tbl_crm_note_comments = CONVERT(unhex(de_124_133) USING UTF8),
				tbl_crm_note_priority_f = if(de_124_134='true',1,0),
				tbl_crm_note_reminder_f = if(de_124_135='true',1,0),
				tbl_crm_note_share_f = if(de_124_136='true',1,0),
				tbl_crm_note_reminder_date = de_124_137,
				tbl_crm_note_username = de_124_138;

			end while;
				
		end if;				
			
			
			
		-- ---------------------
		-- CRM Activities     --
		-- ---------------------
		
		if LENGTH(de_124_141_CADENA) >0 then
		
			if (select tbl_crm_activity_id from dbuser.tbl_crm_activity where tbl_user_id = de_114_179 limit 1) is not null then 
				delete from dbuser.tbl_crm_activity where tbl_user_id = de_114_179;
			end if;
	   
			while (LENGTH(de_124_141_CADENA)>0) DO
	   
				SET de_124_141 = TRIM((SELECT SUBSTR(de_124_141_CADENA,1,LOCATE('|',de_124_141_CADENA)-1)));
				SET de_124_141_CADENA = (SELECT SUBSTR(de_124_141_CADENA,LOCATE('|',de_124_141_CADENA)+1));
				
				SET de_124_142 = TRIM((SELECT SUBSTR(de_124_142_CADENA,1,LOCATE('|',de_124_142_CADENA)-1)));
				SET de_124_142_CADENA = (SELECT SUBSTR(de_124_142_CADENA,LOCATE('|',de_124_142_CADENA)+1));
				
				SET de_124_143 = TRIM((SELECT SUBSTR(de_124_143_CADENA,1,LOCATE('|',de_124_143_CADENA)-1)));
				SET de_124_143_CADENA = (SELECT SUBSTR(de_124_143_CADENA,LOCATE('|',de_124_143_CADENA)+1));
				
				SET de_124_144 = TRIM((SELECT SUBSTR(de_124_144_CADENA,1,LOCATE('|',de_124_144_CADENA)-1)));
				SET de_124_144_CADENA = (SELECT SUBSTR(de_124_144_CADENA,LOCATE('|',de_124_144_CADENA)+1));
				
				
				case de_124_141 
					when 'SL' then set de_124_141 = 'Sales';
					when 'PR' then set de_124_141 = 'Preview';
					when 'CL' then set de_124_141 = 'Close';
					else set de_124_141 = 'Sales';
				end case;
				
				insert into dbuser.tbl_crm_activity set
				tbl_user_id = de_114_179,
				tbl_crm_activity_type = de_124_141,
				tbl_crm_activity_date = de_124_142,
				tbl_crm_activity_comments = CONVERT(unhex(de_124_143) USING UTF8),
				tbl_crm_activity_username = de_124_144;

			end while;
				
		end if;			
		
		
		
		-- ---------------------
		-- Client Keys        --
		-- ---------------------

		if (select client_name from nmc_control.client_key where user_id = USERID_AUX limit 1) is null then
		
			INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
			values  (md5(CONCAT('Terminal',USERID_AUX)),'Terminal',CURDATE(),1,3,USERID_AUX,0),
					(md5(CONCAT('Module OsCommerce',USERID_AUX)),'Module OsCommerce',CURDATE(),1,5,USERID_AUX,0),
					(md5(CONCAT('Widget',USERID_AUX)),'Widget',CURDATE(),1,5,USERID_AUX,0),
					(md5(CONCAT('WidgetCar',USERID_AUX)),'WidgetCar',CURDATE(),1,5,USERID_AUX,0),
					(md5(CONCAT('Tablet',USERID_AUX)),'Tablet',CURDATE(),1,6,USERID_AUX,0);
        
		end if;
		
        
		
		-- ---------------------
		-- Modules            --
		-- ---------------------

		if (select tbl_module_id from dbitems.tbl_module where tbl_user_id = USERID_AUX limit 1) is null then
		
			INSERT INTO dbitems.tbl_module (`tbl_company_id`,`tbl_user_id`, `tbl_module_title`, `tbl_module_order`, `tbl_module_type_id`, `tbl_module_active_f`, `tbl_module_image`, `tbl_module_price`, `tbl_module_item_limit`) 
			values  (COMPANY_ID, USERID_AUX,'Banner sample 1'	, 1, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, USERID_AUX,'Banner sample 2'	, 2, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, USERID_AUX,'Banner sample 3'	, 3, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, USERID_AUX,'Item list sample 1', 4, 1, 1, NULL				, NULL, 10),
					(COMPANY_ID, USERID_AUX,'Item list sample 2', 5, 1, 1, NULL				, NULL, 10),
					(COMPANY_ID, USERID_AUX,'Box sample 1'		, 6, 3, 1, 'logo_box.png'	, NULL, 10),
					(COMPANY_ID, USERID_AUX,'Box sample 2'		, 7, 3, 1, 'logo_box.png'	, NULL, 10);
        
		end if;
		
		
		
        -- ---------------------
        -- Subscription Cart  --
        -- ---------------------
        
        if (select tbl_subscription_id from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 limit 1) is not null then
            delete from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179; 
		end if;     
                
        
		if de_117_020 > 0 then
			insert into dbitems.tbl_subscriptioncart set 
			tbl_subscription_id = 15,
			tbl_subscriptioncart_user_nmcid = de_114_179,
			tbl_subscriptioncart_quantity = de_117_020;
		end if;
		
		if de_117_021 > 0 then
			insert into dbitems.tbl_subscriptioncart set 
			tbl_subscription_id = 16,
			tbl_subscriptioncart_user_nmcid = de_114_179,
			tbl_subscriptioncart_quantity = de_117_021;
		end if;

		

        -- ---------------------
		-- Payment            --
		-- ---------------------

		if LENGTH(de_055_003) >0 then
			
			set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015 and tbl_user_nmcId = de_114_179 limit 1);
			
			if LENGTH(de_122_034) >0 then 
				
				SET CARD_TOCKEN = (select tbl_card_tocken from dbcards.tbl_carduser where tbl_carduser_id = de_122_034);
				SET DATE_AUX = NOW();

				if (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) is not null then
				   SET BILLID_AUX = (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) +1;
				else
				   SET BILLID_AUX = 1;
				end if;

				-- --------------- --
				-- Bill            --
				-- --------------- --
				
				insert into dbtransaction.tbl_bill set
				tbl_bill_id = BILLID_AUX,
				tbl_bill_number = 1000000 + BILLID_AUX,
				tbl_bill_merchant_nmcId = de_114_179,
				tbl_bill_seller_nmcId = '001', 
				tbl_bill_status = 101,
				tbl_bill_date = DATE_AUX;
				
				-- ------------------ --
				-- Bill Subscription  --
				-- ------------------ --
				
				insert into dbtransaction.tbl_billsubscription (tbl_bill_id,
												  tbl_subscription_id,
												  tbl_billsubscription_quantity,
												  tbl_billsubscription_price,
												  tbl_billsubscription_reseller_nmcId)
				select  BILLID_AUX,
						A.tbl_subscription_id,
						A.tbl_subscriptioncart_quantity,
						B.tbl_subscription_recommended_price,
						null

				from dbitems.tbl_subscriptioncart as A, dbitems.tbl_subscription as B
				where A.tbl_subscriptioncart_user_nmcid = de_114_179
				and A.tbl_subscriptioncart_delete = 0
				and A.tbl_subscription_id = B.tbl_subscription_id;
				
                
				if de_117_018 > 0 then
                
					insert into dbtransaction.tbl_billsubscription set
					tbl_bill_id = BILLID_AUX,
					tbl_hardware_type_id = 75001,
					tbl_billsubscription_quantity = de_117_018,
					tbl_billsubscription_price = 200.00;
                    
                    insert into dbuser.tbl_shipping set
					tbl_user_id = de_114_179,
					tbl_location_id = LOCATIONID_AUX,
					tbl_shipping_dongle_qty = de_117_018,
					tbl_shipping_tablet_qty = 0,
					tbl_shipping_tv_qty = 0,
					tbl_shipping_status_id = 73001,
					tbl_shipping_saleDate = current_date(),
					tbl_shipping_invoiceNumber = BILLID_AUX,
					tbl_shipping_refNumber = 1000000 + BILLID_AUX,
					tbl_shipping_boxes = 0;
                    
                end if;
                
                
				-- ------------------ --
				-- Bil Transaction    --
				-- ------------------ --
				
				insert into dbtransaction.tbl_billtransaction set 
				tbl_bill_id = BILLID_AUX,
				tbl_cardTocken = CARD_TOCKEN,	  	
				tbl_billtransaction_amount = de_055_003,
				tbl_billtransaction_status_id = 75,
				tbl_billtransaction_type_id = 1,
				tbl_billtransaction_date = DATE_AUX;

				
				set de_SB = (select GROUP_CONCAT(CONCAT('',tbl_subscription_id,'|'))
							from dbitems.tbl_subscriptioncart 
							where tbl_subscriptioncart_user_nmcid = de_114_179
							and tbl_subscriptioncart_delete = 0
							);
							
				set CADENA_SUBSCRIPTION = REPLACE(de_SB,'|,','|');	
				set CADENA_SUBSCRIPTION_AUX = REPLACE(de_SB,'|,','|');
				
				WHILE (LENGTH(CADENA_SUBSCRIPTION)>0) DO
								
					SET SUBSCRIPTION_AUX = (SELECT SUBSTR(CADENA_SUBSCRIPTION,1,LOCATE('|',CADENA_SUBSCRIPTION)-1));
					SET CADENA_SUBSCRIPTION = (SELECT SUBSTR(CADENA_SUBSCRIPTION,LOCATE('|',CADENA_SUBSCRIPTION)+1));

					set SUBSCRIPTION_QUANTITY = (select tbl_subscriptioncart_quantity from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) and tbl_subscriptioncart_delete = 0 LIMIT 1);

					if (select tbl_subscription_id from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) is null then
				
						insert into dbitems.tbl_usersubscription set
						tbl_company_id = COMPANY_ID,
						tbl_usersubscription_user_nmcid = de_114_179,
						tbl_subscription_id = TRIM(SUBSCRIPTION_AUX),
						tbl_usersubscription_date_purchase = DATE_AUX,		  
						tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
						tbl_subscriptionstatus_id = 2401;
						
					else
						
						if (select tbl_usersubscription_date_expiration from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) > NOW() then
					
							update dbitems.tbl_usersubscription set
							tbl_usersubscription_date_purchase = DATE_AUX,		  
							tbl_usersubscription_date_expiration = DATE_ADD(tbl_usersubscription_date_expiration, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
							tbl_subscriptionstatus_id = 2401
							where tbl_usersubscription_user_nmcid = de_114_179
							and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
							
						else
					
							update dbitems.tbl_usersubscription set
							tbl_usersubscription_date_purchase = DATE_AUX,		  
							tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
							tbl_subscriptionstatus_id = 2401
							where tbl_usersubscription_user_nmcid = de_114_179
							and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
						
						end if;
						
					end if;
				
				END WHILE;


				-- ------------------------- --
				-- Clean Subscription Cart   --
				-- ------------------------- --

				update dbitems.tbl_subscriptioncart set
				tbl_subscriptioncart_delete = 1
				where tbl_subscriptioncart_user_nmcid = de_114_179
				and tbl_subscriptioncart_delete = 0;
				
				update tbl_hardware_cart set 
				tbl_hardware_cart_delete = 1
				where tbl_user_id = de_114_179
                and tbl_hardware_cart_delete = 0;
				
				update dbuser.tbl_merchant set
				tbl_merchant_receivePayment_f = 1
				where tbl_user_id = de_114_179;
				
			
			end if;
		
		end if;


		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		
		

	
	
	
	else

		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1) is null then

			if (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070 limit 1) is null then
				
				-- ---------------------
				-- User and merchant  --
				-- ---------------------

				insert into tbl_user set 
				tbl_user_email = de_114_007,
				tbl_user_first = de_114_003,
				tbl_user_last = de_114_005,
				tbl_user_title = COALESCE(de_114_091,''),
				tbl_user_companyName = COALESCE(de_114_070,''),
				tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),''),
				tbl_user_policy = COALESCE(convert(unhex(de_119_016) using utf8),''),
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userstatus_id = 33,
				tbl_user_userTemp_f = 0,
				tbl_gender_type = 51,
				tbl_user_multipleshipaddress_f = 0,
				tbl_user_parentId = null,
				tbl_user_entity = 20,
				tbl_user_class = '2A0',
				tbl_owner_id = '001',
				tbl_user_pinCode =  1234;
				
				SET USERID_AUX = last_insert_id();
				SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
				SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
				SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));
			
				insert into tbl_merchant set
				tbl_user_id = USERID_AUX,
				tbl_merchant_nmcId = USERID_AUX,
				tbl_merchant_taxIdNumber = COALESCE(de_123_071, ''),
				tbl_merchant_multiple_locations_quantity = de_114_121,
				tbl_merchant_location_use = COALESCE(de_114_121,0),
				tbl_merchant_dongles_quantity = COALESCE(de_117_018,0),				
				-- tbl_merchant_basic_subs = COALESCE(de_117_020,0),
				tbl_merchant_standard_subs = COALESCE(de_117_020,0),
				tbl_merchant_deluxe_subs = COALESCE(de_117_021,0),
				tbl_merchant_multipleLocation_f = 4801,
				tbl_merchant_haveWebsite_f = 0,
				tbl_merchant_haveAccount_f = 0,
				tbl_merchant_logoimage = '',
				tbl_merchant_online_store = '',
                tbl_merchant_receivePayment_f = 0;
			
				insert into tbl_company set
				tbl_company_name = de_114_070,
				tbl_company_crc = CRC_AUX,
				tbl_company_taxId = de_123_071,
				tbl_company_policy = convert(unhex(de_119_016) using utf8),
				tbl_company_type_id = 4701,
				tbl_company_status_id = 33,
				tbl_company_dateCreate = NOW();
				
				set COMPANY_ID = (SELECT last_insert_id() FROM tbl_company limit 1);
				
				update dbuser.tbl_user set 
				tbl_company_id = COMPANY_ID,
				tbl_user_crc = CRC_AUX
				where tbl_user_id = USERID_AUX;
			
			
				INSERT INTO tbl_user_delivery_options set
				tbl_company_id = COMPANY_ID,
				tbl_user_id = USERID_AUX,
				tbl_delivery_company_price = 0.00,
				tbl_delivery_company_service = 'Pick Up',
				tbl_user_delivery_options_tier = 'Pick Up',
				tbl_delivery_company_tracking_code ='',
				tbl_delivery_company_option = 'Pick Up';
				
			

				-- ---------------------
				-- Link               --
				-- ---------------------
				
				if length(de_052) > 0 then 
				
					insert into tbl_link set
					tbl_link_user_id = USERID_AUX,
					tbl_link_link = md5(convert(unhex(de_052) using utf8)),
					tbl_link_date = NOW(),
					tbl_link_delete = 0;
				
				end if;
				
                
                
				-- ---------------------
				-- Phones             --
				-- ---------------------
						
				if LENGTH(_48_28_CADENA) >0 then
				
					while (LENGTH(_48_28_CADENA)>0) DO

						SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
						SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

						SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
						SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
						
						SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
						SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

						SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
						SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

						insert into tbl_phone set
						tbl_company_id 		  = COMPANY_ID,
						tbl_phone_nmcId       = USERID_AUX,
						tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
						tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
						tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
						tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

						SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);	
						
					end while ; 
					
				end if;
				
				
				
				-- ------------------------
				-- Address and Locations --
				-- ------------------------
				
				if LENGTH(de_114_012_CADENA) >0 then

					while (LENGTH(de_114_012_CADENA)>0) DO
					
						SET de_121_045 = (SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1));
						SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));

						SET de_114_012 = (SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1));
						SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

						SET de_114_013 = (SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1));
						SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
						
						-- SET de_122_107 = TRIM((SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1)));
						-- SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

						-- SET de_114_014 = TRIM((SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1)));
						-- SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
				
						-- SET de_120_013 = TRIM((SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1)));
						-- SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

						-- SET de_122_087 = TRIM((SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1)));
						-- SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
				
						
						SET de_048_028 = TRIM((SELECT SUBSTR(de_048_028_CADENA,1,LOCATE('|',de_048_028_CADENA)-1)));
						SET de_048_028_CADENA = (SELECT SUBSTR(de_048_028_CADENA,LOCATE('|',de_048_028_CADENA)+1));

						SET de_121_167 = TRIM((SELECT SUBSTR(de_121_167_CADENA,1,LOCATE('|',de_121_167_CADENA)-1)));
						SET de_121_167_CADENA = (SELECT SUBSTR(de_121_167_CADENA,LOCATE('|',de_121_167_CADENA)+1));
						
                        SET de_047_017 = TRIM((SELECT SUBSTR(de_047_017_CADENA,1,LOCATE('|',de_047_017_CADENA)-1)));
						SET de_047_017_CADENA = (SELECT SUBSTR(de_047_017_CADENA,LOCATE('|',de_047_017_CADENA)+1));

						if length(de_047_017) > 0 then
						
							SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
							SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
						
							set de_122_107 = (select tbl_zipcode_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
							set de_114_014 = (select tbl_city_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
							set de_120_013 = (select tbl_state_id from tbl_city where tbl_city_id = de_114_014);
							set de_122_087 = (select tbl_country_id from tbl_state where tbl_state_id = de_120_013);
							
						else
						
							SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
							SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
						
						end if;
                     
						insert into tbl_address set 
						tbl_company_id = COMPANY_ID,
						tbl_address_nmcId = USERID_AUX,
						tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
						tbl_address_first = TRIM(de_114_012),
						tbl_address_second = TRIM(de_114_013),
						tbl_address_phoneNumber = null,
						tbl_zipcode_id = TRIM(de_122_107),
						tbl_city_id = TRIM(de_114_014),
						tbl_state_id = TRIM(de_120_013),
						tbl_country_id = TRIM(de_122_087);
							
						SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
							
						INSERT INTO tbl_location SET 
						tbl_company_id = COMPANY_ID,
						tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
						tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
						tbl_location_contactName = COALESCE(USER_NAME,' '), 
						tbl_location_contactEmail = COALESCE(USER_EMAIL,' '), 
						tbl_location_userId = USERID_AUX,
						tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
						tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
						tbl_location_statusId= 7001;
						
						SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);

						INSERT tbl_locationaddress SET
						tbl_location_id = LOCATIONID_AUX, 
						tbl_address_id = ADDRESSID_AUX;
						
						INSERT tbl_phone SET
						tbl_company_id = COMPANY_ID,
						tbl_phone_phoneNumber = de_048_028,
						tbl_phone_extension = de_121_167,
						tbl_phone_country_id = de_122_087,
						tbl_phonetype_id = 4001;
						
						SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);
						
						INSERT INTO tbl_locationphone SET
						tbl_location_id = LOCATIONID_AUX,
						tbl_phone_id = PHONEID_AUX;
						
						if (select count(tbl_location_id) from tbl_location where tbl_location_userId = USERID_AUX) = 1 then
						
							INSERT INTO tbl_hardware_cart (
							tbl_company_id,
							tbl_user_id,
							tbl_location_id,
							tbl_hardware_type_id,
							tbl_hardware_cart_quantity,
							tbl_hardware_cart_delete
							)
							values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0);
							
						end if;
							
							
						INSERT INTO tbl_location_hardware (
						tbl_company_id,
						tbl_user_id,
						tbl_location_id,
						tbl_hardware_type_id,
						tbl_location_hardware_qty,
						tbl_location_hardware_shipped,
						tbl_shipping_status_id) 
						values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,0,0,73001);
							
							
                        
						INSERT INTO tbl_location_schedule (
						tbl_location_id,
						tbl_day_of_the_week,
						tbl_24_hour,
						tbl_closed_flag,
						tbl_hour_open,
						tbl_hour_close) 
						values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');

					end while ;
				
				end if;
				
				
                
                -- ---------------------
				-- Credit Card        --
				-- ---------------------
				
				if LENGTH(de_002_CADENA) >0 then

					SET de_002 = TRIM((SELECT SUBSTR(de_002_CADENA,1,LOCATE('|',de_002_CADENA)-1)));
					SET de_002_CADENA = (SELECT SUBSTR(de_002_CADENA,LOCATE('|',de_002_CADENA)+1));
				
					SET de_118_005 = TRIM((SELECT SUBSTR(de_118_005_CADENA,1,LOCATE('|',de_118_005_CADENA)-1)));
					SET de_118_005_CADENA = (SELECT SUBSTR(de_118_005_CADENA,LOCATE('|',de_118_005_CADENA)+1));

					SET de_120_007 = TRIM((SELECT SUBSTR(de_120_007_CADENA,1,LOCATE('|',de_120_007_CADENA)-1)));
					SET de_120_007_CADENA = (SELECT SUBSTR(de_120_007_CADENA,LOCATE('|',de_120_007_CADENA)+1));
					
					SET de_048_006 = TRIM((SELECT SUBSTR(de_048_006_CADENA,1,LOCATE('|',de_048_006_CADENA)-1)));
					SET de_048_006_CADENA = (SELECT SUBSTR(de_048_006_CADENA,LOCATE('|',de_048_006_CADENA)+1));
			
					SET de_048_002 = TRIM((SELECT SUBSTR(de_048_002_CADENA,1,LOCATE('|',de_048_002_CADENA)-1)));
					SET de_048_002_CADENA = (SELECT SUBSTR(de_048_002_CADENA,LOCATE('|',de_048_002_CADENA)+1));
					
					SET de_048_004 = TRIM((SELECT SUBSTR(de_048_004_CADENA,1,LOCATE('|',de_048_004_CADENA)-1)));
					SET de_048_004_CADENA = (SELECT SUBSTR(de_048_004_CADENA,LOCATE('|',de_048_004_CADENA)+1));
			
					SET de_122_126 = TRIM((SELECT SUBSTR(de_122_126_CADENA,1,LOCATE('|',de_122_126_CADENA)-1)));
					SET de_122_126_CADENA = (SELECT SUBSTR(de_122_126_CADENA,LOCATE('|',de_122_126_CADENA)+1));
					
					SET de_121_005 = TRIM((SELECT SUBSTR(de_121_005_CADENA,1,LOCATE('|',de_121_005_CADENA)-1)));
					SET de_121_005_CADENA = (SELECT SUBSTR(de_121_005_CADENA,LOCATE('|',de_121_005_CADENA)+1));
					
			
					SET de_048_015 = de_002;
				
					insert into dbcards.tbl_carduser set
					tbl_user_nmcId = USERID_AUX,
					tbl_card_tocken = de_048_015,
					tbl_paymentnaturetype_id = 35001,
					tbl_carduser_referenceNumber = de_122_126,
					tbl_carduser_date = de_121_005;
					
					insert into dbcards.tbl_card set
					tbl_user_id = USERID_AUX,
					tbl_card_tocken = de_048_015,
					tbl_card_number = SUBSTRING(de_002, -4),
					tbl_card_dateAdded = NOW(),
					tbl_card_datemodified = NOW(),
					tbl_cardstype_id = COALESCE(de_120_007,61),
					tbl_cardstatus_id = 51,
					tbl_card_nickname = COALESCE(de_048_006,''),
					tbl_card_chardholderName = COALESCE(de_048_002,''),		
					tbl_card_routingNumber = '',
					tbl_card_issuingBank = '',
					tbl_accounttype_id = null,
					tbl_bankaccounttype_id = null,	
					tbl_card_dateExpire = COALESCE(de_118_005,''),
					tbl_card_swift_iban_code = COALESCE(de_048_004,''),	
					tbl_country_id = null,
					tbl_zipcode = null,
					tbl_debitaccounttype_id = null,
					tbl_address_id = null,
					tbl_paymentserviceprovider_id = null;
					
				end if;
                
                
				
				-- ---------------------
				-- Category User      --
				-- ---------------------
				
				if LENGTH(de_114_093_CADENA) >0 then

					while (LENGTH(de_114_093_CADENA)>0) DO
				
						SET de_114_093 = TRIM((SELECT SUBSTR(de_114_093_CADENA,1,LOCATE('|',de_114_093_CADENA)-1)));
						SET de_114_093_CADENA = (SELECT SUBSTR(de_114_093_CADENA,LOCATE('|',de_114_093_CADENA)+1));
						
						if (select tbl_businesscategory_id 
							from dbuser.tbl_merchantbusinesscategory 
							where tbl_merchant_nmcId = USERID_AUX 
							and tbl_businesscategory_id = de_114_093
							limit 1) is null then 
							
							insert into dbuser.tbl_merchantbusinesscategory set
							tbl_company_id = COMPANY_ID,
							tbl_merchant_nmcId = USERID_AUX,
							tbl_businesscategory_id = de_114_093;
							
						end if;
					
					end while;
					
				end if;
				

				
				-- ---------------------
				-- CRM Notes          --
				-- ---------------------
				
				if LENGTH(de_124_131_CADENA) >0 then
				
					if (select tbl_crm_note_id from dbuser.tbl_crm_note where tbl_user_id = USERID_AUX limit 1) is not null then 
						delete from dbuser.tbl_crm_note where tbl_user_id = USERID_AUX;
					end if;
			   
					while (LENGTH(de_124_131_CADENA)>0) DO
			   
						SET de_124_131 = TRIM((SELECT SUBSTR(de_124_131_CADENA,1,LOCATE('|',de_124_131_CADENA)-1)));
						SET de_124_131_CADENA = (SELECT SUBSTR(de_124_131_CADENA,LOCATE('|',de_124_131_CADENA)+1));
						
						SET de_124_132 = TRIM((SELECT SUBSTR(de_124_132_CADENA,1,LOCATE('|',de_124_132_CADENA)-1)));
						SET de_124_132_CADENA = (SELECT SUBSTR(de_124_132_CADENA,LOCATE('|',de_124_132_CADENA)+1));
						
						SET de_124_133 = TRIM((SELECT SUBSTR(de_124_133_CADENA,1,LOCATE('|',de_124_133_CADENA)-1)));
						SET de_124_133_CADENA = (SELECT SUBSTR(de_124_133_CADENA,LOCATE('|',de_124_133_CADENA)+1));
						
						SET de_124_134 = TRIM((SELECT SUBSTR(de_124_134_CADENA,1,LOCATE('|',de_124_134_CADENA)-1)));
						SET de_124_134_CADENA = (SELECT SUBSTR(de_124_134_CADENA,LOCATE('|',de_124_134_CADENA)+1));
						
						SET de_124_135 = TRIM((SELECT SUBSTR(de_124_135_CADENA,1,LOCATE('|',de_124_135_CADENA)-1)));
						SET de_124_135_CADENA = (SELECT SUBSTR(de_124_135_CADENA,LOCATE('|',de_124_135_CADENA)+1));
						
						SET de_124_136 = TRIM((SELECT SUBSTR(de_124_136_CADENA,1,LOCATE('|',de_124_136_CADENA)-1)));
						SET de_124_136_CADENA = (SELECT SUBSTR(de_124_136_CADENA,LOCATE('|',de_124_136_CADENA)+1));
						
						SET de_124_137 = TRIM((SELECT SUBSTR(de_124_137_CADENA,1,LOCATE('|',de_124_137_CADENA)-1)));
						SET de_124_137_CADENA = (SELECT SUBSTR(de_124_137_CADENA,LOCATE('|',de_124_137_CADENA)+1));
						
						SET de_124_138 = TRIM((SELECT SUBSTR(de_124_138_CADENA,1,LOCATE('|',de_124_138_CADENA)-1)));
						SET de_124_138_CADENA = (SELECT SUBSTR(de_124_138_CADENA,LOCATE('|',de_124_138_CADENA)+1));
						
						
						case de_124_131 
							when 'G'  then set de_124_131 = 'General';
							when 'FU' then set de_124_131 = 'Follow Up';
							when 'RE' then set de_124_131 = 'Refusal';
							when 'SH' then set de_124_131 = 'Share';
							else set de_124_131 = 'General';
						end case;
						
						insert into dbuser.tbl_crm_note set
						tbl_user_id = USERID_AUX,
						tbl_crm_note_type = de_124_131,
						tbl_crm_note_date = de_124_132,
						tbl_crm_note_comments = CONVERT(unhex(de_124_133) USING UTF8),
						tbl_crm_note_priority_f = if(de_124_134='true',1,0),
						tbl_crm_note_reminder_f = if(de_124_135='true',1,0),
						tbl_crm_note_share_f = if(de_124_136='true',1,0),
						tbl_crm_note_reminder_date = de_124_137,
						tbl_crm_note_username = de_124_138;

					end while;
						
				end if;				
					
					
					
				-- ---------------------
				-- CRM Activities     --
				-- ---------------------
				
				if LENGTH(de_124_141_CADENA) >0 then
				
					if (select tbl_crm_activity_id from dbuser.tbl_crm_activity where tbl_user_id = USERID_AUX limit 1) is not null then 
						delete from dbuser.tbl_crm_activity where tbl_user_id = USERID_AUX;
					end if;
			   
					while (LENGTH(de_124_141_CADENA)>0) DO
			   
						SET de_124_141 = TRIM((SELECT SUBSTR(de_124_141_CADENA,1,LOCATE('|',de_124_141_CADENA)-1)));
						SET de_124_141_CADENA = (SELECT SUBSTR(de_124_141_CADENA,LOCATE('|',de_124_141_CADENA)+1));
						
						SET de_124_142 = TRIM((SELECT SUBSTR(de_124_142_CADENA,1,LOCATE('|',de_124_142_CADENA)-1)));
						SET de_124_142_CADENA = (SELECT SUBSTR(de_124_142_CADENA,LOCATE('|',de_124_142_CADENA)+1));
						
						SET de_124_143 = TRIM((SELECT SUBSTR(de_124_143_CADENA,1,LOCATE('|',de_124_143_CADENA)-1)));
						SET de_124_143_CADENA = (SELECT SUBSTR(de_124_143_CADENA,LOCATE('|',de_124_143_CADENA)+1));
						
						SET de_124_144 = TRIM((SELECT SUBSTR(de_124_144_CADENA,1,LOCATE('|',de_124_144_CADENA)-1)));
						SET de_124_144_CADENA = (SELECT SUBSTR(de_124_144_CADENA,LOCATE('|',de_124_144_CADENA)+1));
				
						
						case de_124_141 
							when 'SL' then set de_124_141 = 'Sales';
							when 'PR' then set de_124_141 = 'Preview';
							when 'CL' then set de_124_141 = 'Close';
							else set de_124_141 = 'Sales';
						end case;
						
						insert into dbuser.tbl_crm_activity set
						tbl_user_id = USERID_AUX,
						tbl_crm_activity_type = de_124_141,
						tbl_crm_activity_date = de_124_142,
						tbl_crm_activity_comments = CONVERT(unhex(de_124_143) USING UTF8),
						tbl_crm_activity_username = de_124_144;

					end while;
						
				end if;			
		
		
				
				-- ---------------------
				-- Client Keys        --
				-- ---------------------

				INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
				values  (md5(CONCAT('Terminal',USERID_AUX)),'Terminal',CURDATE(),1,3,USERID_AUX,0),
						(md5(CONCAT('Module OsCommerce',USERID_AUX)),'Module OsCommerce',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Widget',USERID_AUX)),'Widget',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('WidgetCar',USERID_AUX)),'WidgetCar',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Tablet',USERID_AUX)),'Tablet',CURDATE(),1,6,USERID_AUX,0);
				

				
				-- ---------------------
				-- Modules            --
				-- ---------------------

				if (select tbl_module_id from dbitems.tbl_module where tbl_user_id = USERID_AUX limit 1) is null then
				
					INSERT INTO dbitems.tbl_module (`tbl_company_id`, `tbl_user_id`, `tbl_module_title`, `tbl_module_order`, `tbl_module_type_id`, `tbl_module_active_f`, `tbl_module_image`, `tbl_module_price`, `tbl_module_item_limit`) 
					values  (COMPANY_ID, USERID_AUX,'Banner sample 1'	, 1, 2, 1, 'logo_banner.png', NULL, 10),
							(COMPANY_ID, USERID_AUX,'Banner sample 2'	, 2, 2, 1, 'logo_banner.png', NULL, 10),
							(COMPANY_ID, USERID_AUX,'Banner sample 3'	, 3, 2, 1, 'logo_banner.png', NULL, 10),
							(COMPANY_ID, USERID_AUX,'Item list sample 1', 4, 1, 1, NULL				, NULL, 10),
							(COMPANY_ID, USERID_AUX,'Item list sample 2', 5, 1, 1, NULL				, NULL, 10),
							(COMPANY_ID, USERID_AUX,'Box sample 1'		, 6, 3, 1, 'logo_box.png'	, NULL, 10),
							(COMPANY_ID, USERID_AUX,'Box sample 2'		, 7, 3, 1, 'logo_box.png'	, NULL, 10);
				
				end if;
				


				-- ---------------------
				-- Subscription Cart  --
				-- ---------------------

				if de_117_020 > 0 then
					insert into dbitems.tbl_subscriptioncart set 
					tbl_subscription_id = 15,
					tbl_subscriptioncart_user_nmcid = USERID_AUX,
					tbl_subscriptioncart_quantity = de_117_020;
				end if;
				
				if de_117_021 > 0 then
					insert into dbitems.tbl_subscriptioncart set 
					tbl_subscription_id = 16,
					tbl_subscriptioncart_user_nmcid = USERID_AUX,
					tbl_subscriptioncart_quantity = de_117_021;
				end if;
				
				

				-- ---------------------
				-- Payment            --
				-- ---------------------
				
                if LENGTH(de_055_003) >0 then
                
					set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015 and tbl_user_nmcId = USERID_AUX limit 1);
				
					if LENGTH(de_122_034) >0 then 

						SET CARD_TOCKEN = (select tbl_card_tocken from dbcards.tbl_carduser where tbl_carduser_id = de_122_034);
						SET DATE_AUX = NOW();

						if (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) is not null then
						   SET BILLID_AUX = (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) +1;
						else
						   SET BILLID_AUX = 1;
						end if;

						-- --------------- --
						-- Bill            --
						-- --------------- --
						
						insert into dbtransaction.tbl_bill set
						tbl_bill_id = BILLID_AUX,
						tbl_bill_number = 1000000 + BILLID_AUX,
						tbl_bill_merchant_nmcId = USERID_AUX,
						tbl_bill_seller_nmcId = '001', 
						tbl_bill_status = 101,
						tbl_bill_date = DATE_AUX;
						
						-- ------------------ --
						-- Bill Subscription  --
						-- ------------------ --
						
						insert into dbtransaction.tbl_billsubscription (tbl_bill_id,
														  tbl_subscription_id,
														  tbl_billsubscription_quantity,
														  tbl_billsubscription_price,
														  tbl_billsubscription_reseller_nmcId)
						select  BILLID_AUX,
								A.tbl_subscription_id,
								A.tbl_subscriptioncart_quantity,
								B.tbl_subscription_recommended_price,
								null

						from dbitems.tbl_subscriptioncart as A, dbitems.tbl_subscription as B
						where A.tbl_subscriptioncart_user_nmcid = USERID_AUX
						and A.tbl_subscriptioncart_delete = 0
						and A.tbl_subscription_id = B.tbl_subscription_id;
						
						if de_117_018 > 0 then
                        
							insert into dbtransaction.tbl_billsubscription set
							tbl_bill_id = BILLID_AUX,
							tbl_hardware_type_id = 75001,
							tbl_billsubscription_quantity = de_117_018,
							tbl_billsubscription_price = 0.00;
                            
                            insert into dbuser.tbl_shipping set
							tbl_user_id = USERID_AUX,
							tbl_location_id = LOCATIONID_AUX,
							tbl_shipping_dongle_qty = de_117_018,
							tbl_shipping_tablet_qty = 0,
							tbl_shipping_tv_qty = 0,
							tbl_shipping_status_id = 73001,
							tbl_shipping_saleDate = current_date(),
							tbl_shipping_invoiceNumber = BILLID_AUX,
							tbl_shipping_refNumber = 1000000 + BILLID_AUX,
							tbl_shipping_boxes = 0;
                            
						end if;
						
						-- ------------------ --
						-- Bil Transaction    --
						-- ------------------ --
						
						insert into dbtransaction.tbl_billtransaction set 
						tbl_bill_id = BILLID_AUX,
						tbl_cardTocken = CARD_TOCKEN,	  	
						tbl_billtransaction_amount = de_055_003,
						tbl_billtransaction_status_id = 75,
						tbl_billtransaction_type_id = 1,
						tbl_billtransaction_date = DATE_AUX;

						
						set de_SB = (select GROUP_CONCAT(CONCAT('',tbl_subscription_id,'|'))
									from dbitems.tbl_subscriptioncart 
									where tbl_subscriptioncart_user_nmcid = USERID_AUX
									and tbl_subscriptioncart_delete = 0
									);
									
						set CADENA_SUBSCRIPTION = REPLACE(de_SB,'|,','|');	
						set CADENA_SUBSCRIPTION_AUX = REPLACE(de_SB,'|,','|');
						
						WHILE (LENGTH(CADENA_SUBSCRIPTION)>0) DO
										
							SET SUBSCRIPTION_AUX = (SELECT SUBSTR(CADENA_SUBSCRIPTION,1,LOCATE('|',CADENA_SUBSCRIPTION)-1));
							SET CADENA_SUBSCRIPTION = (SELECT SUBSTR(CADENA_SUBSCRIPTION,LOCATE('|',CADENA_SUBSCRIPTION)+1));

							set SUBSCRIPTION_QUANTITY = (select tbl_subscriptioncart_quantity from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) and tbl_subscriptioncart_delete = 0 LIMIT 1);

							if (select tbl_subscription_id from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) is null then
						
								insert into dbitems.tbl_usersubscription set
								tbl_company_id = COMPANY_ID,
								tbl_usersubscription_user_nmcid = USERID_AUX,
								tbl_subscription_id = TRIM(SUBSCRIPTION_AUX),
								tbl_usersubscription_date_purchase = DATE_AUX,		  
								tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
								tbl_subscriptionstatus_id = 2401;
								
							else
								
								if (select tbl_usersubscription_date_expiration from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) > NOW() then
							
									update dbitems.tbl_usersubscription set
									tbl_usersubscription_date_purchase = DATE_AUX,		  
									tbl_usersubscription_date_expiration = DATE_ADD(tbl_usersubscription_date_expiration, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
									tbl_subscriptionstatus_id = 2401
									where tbl_usersubscription_user_nmcid = USERID_AUX
									and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
									
								else
							
									update dbitems.tbl_usersubscription set
									tbl_usersubscription_date_purchase = DATE_AUX,		  
									tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
									tbl_subscriptionstatus_id = 2401
									where tbl_usersubscription_user_nmcid = USERID_AUX
									and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
								
								end if;
								
							end if;
						
						END WHILE;


						-- ------------------------- --
						-- Clean Subscription Cart   --
						-- ------------------------- --

						update dbitems.tbl_subscriptioncart set
						tbl_subscriptioncart_delete = 1
						where tbl_subscriptioncart_user_nmcid = USERID_AUX
						and tbl_subscriptioncart_delete = 0;
						
						update tbl_hardware_cart set 
						tbl_hardware_cart_delete = 1
						where tbl_user_id = de_114_179
						and tbl_hardware_cart_delete = 0;
						
						update dbuser.tbl_merchant set
						tbl_merchant_receivePayment_f = 1
						where tbl_user_id = USERID_AUX;

                    end if;
                
                end if;

				
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
			
			else
			
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','2067'),('44','Duplicated Company Name');
				
			end if;
			
		else 

			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','2053'),('44','Email Already Exists');

		end if;
		
	end if;
	
	

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCId(USERID_AUX)),'"'),CONCAT(',"123.34":"',CRC_AUX,'"}')) as JSON;
	else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
    end if;
    
	DROP TABLE TBL_MESSAGE1;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantNEWWizardLeads030300663` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `RegisterMerchantNEWWizardLeads030300663`(IN MSG_IN VARCHAR(20000))
BEGIN
	
    DECLARE de_053 VARCHAR(20) DEFAULT NULL;	 		   -- 53 Agent id 
    DECLARE de_53 VARCHAR(20) DEFAULT NULL;	 		   -- 53 Agent id 
	DECLARE de_114_179 VARCHAR(20) DEFAULT NULL;    -- 114.179 Merchant Id
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;  	       -- 52 Password (temporal) 
	DECLARE de_127_010 VARCHAR(4) DEFAULT NULL; 	   -- 127.10 Owner Id
	
	DECLARE de_114_070 VARCHAR(500) DEFAULT NULL;   -- 114.70 Company name
	DECLARE de_123_071 VARCHAR(45) DEFAULT NULL;    -- 123.71 Tax Id Number
	DECLARE de_114_121 INT(11) DEFAULT NULL;				   -- 114.121 Multiple location Qty	
	
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;    -- 114.3 Firstname
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;    -- 114.5 Lastname
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;   -- 114.7 Email
	DECLARE de_114_091 VARCHAR(40) DEFAULT NULL;    -- 114.91 Title
	
	DECLARE de_119_016 TEXT DEFAULT NULL;    		-- 119.16 Return Policy
	
	DECLARE de_117_018 INT(11) DEFAULT NULL;		-- 117.18 TV AD Players Qty
	DECLARE de_117_020 INT(11) DEFAULT NULL; 		-- 117.20 Online Subscription Qty
	DECLARE de_117_021 INT(11) DEFAULT NULL;		-- 117.21 Location Subscription Qty
    DECLARE de_055_003 VARCHAR(20) DEFAULT NULL;    -- 55.3 Total Amount
	
	DECLARE _US_PH TEXT DEFAULT NULL;               -- PH Phone Struct	
	DECLARE _48_28_CADENA TEXT DEFAULT NULL;        -- 48.28 Phone number
	DECLARE _121_167_CADENA TEXT DEFAULT NULL;      -- 121.167 Phone Extension
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL;      -- 122.87 Country Id 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 		-- 121.62 Phone Type Id
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;

	DECLARE _US_AD 	TEXT DEFAULT NULL;              -- AD Address Struct
	DECLARE de_121_045_CADENA TEXT DEFAULT NULL; 	-- 121.45 Address Type Id
	DECLARE de_114_012_CADENA TEXT DEFAULT NULL; 	-- 114.12 Address First line
	DECLARE de_114_013_CADENA TEXT DEFAULT NULL; 	-- 114.13 Address Second line
	DECLARE de_122_087_CADENA TEXT DEFAULT NULL; 	-- 122.87 Country Id	
	DECLARE de_120_013_CADENA TEXT DEFAULT NULL; 	-- 120.13 State Id  
	DECLARE de_114_014_CADENA TEXT DEFAULT NULL; 	-- 114.14 City Id 
	DECLARE de_122_107_CADENA TEXT DEFAULT NULL; 	-- 122.107 Zipcode Id
	DECLARE de_048_028_CADENA TEXT DEFAULT NULL;    -- 48.28 Phone number
	DECLARE de_121_167_CADENA TEXT DEFAULT NULL;    -- 121.167 Phone Extension
	DECLARE de_121_045 INT(11) DEFAULT NULL;  			
	DECLARE de_114_012 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_114_013 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_122_087 INT(11) DEFAULT NULL;  			
	DECLARE de_120_013 INT(11) DEFAULT NULL;  			
	DECLARE de_114_014 INT(11) DEFAULT NULL;  			
	DECLARE de_122_107 INT(11) DEFAULT NULL;
	DECLARE de_048_028 VARCHAR(40) DEFAULT NULL;
	DECLARE de_121_167 VARCHAR(40) DEFAULT NULL;
	
	DECLARE de_047_017_CADENA TEXT DEFAULT NULL; 	-- 47.17 Zipcode name
	DECLARE de_047_017 VARCHAR(20) DEFAULT NULL;
	
	
    DECLARE _US_AC 	TEXT DEFAULT NULL;				-- AC Credit Card Struct
    DECLARE de_048_006_CADENA TEXT DEFAULT NULL; 	-- 48.6 Nickname
	DECLARE de_048_002_CADENA TEXT DEFAULT NULL;	-- 48.2 Cardholder name
	DECLARE de_002_CADENA TEXT DEFAULT NULL;		-- 2 Account number
	DECLARE de_118_005_CADENA TEXT DEFAULT NULL; 	-- 118.5 Card expiration date 
	DECLARE de_048_004_CADENA TEXT DEFAULT NULL; 	-- 48.4 Card verification number
	DECLARE de_120_007_CADENA TEXT DEFAULT NULL; 	-- 120.7 Type credit card
	DECLARE de_122_126_CADENA TEXT DEFAULT NULL; 	-- 122.126 TokenEx Reference Number 
	DECLARE de_121_005_CADENA TEXT DEFAULT NULL; 	-- 121.5  TokenEx Date
	DECLARE de_048_006 VARCHAR(45) DEFAULT NULL;   
    DECLARE de_048_002 VARCHAR(99) DEFAULT NULL;   
	DECLARE de_002 VARCHAR(45) DEFAULT NULL;        
    DECLARE de_118_005 VARCHAR(5) DEFAULT NULL;
	DECLARE de_048_004 VARCHAR(45) DEFAULT NULL;
    DECLARE de_048_015 VARCHAR(45) DEFAULT NULL;    
	DECLARE de_120_007 VARCHAR(11) DEFAULT 0;  
	DECLARE de_122_126 VARCHAR(45) DEFAULT NULL;
    DECLARE de_121_005 VARCHAR(45) DEFAULT NULL;  
    
	DECLARE _US_CU 	TEXT DEFAULT NULL;              -- CU Category User
	DECLARE de_114_093_CADENA TEXT DEFAULT NULL; 	-- 114.93 Category Id
	DECLARE de_114_093 INT(11) DEFAULT 0; 
	
	DECLARE _US_NT 	TEXT DEFAULT NULL;              -- NT Notes Struct
	DECLARE de_124_131_CADENA TEXT DEFAULT NULL; 	-- 124.131 Notes Type
	DECLARE de_124_132_CADENA TEXT DEFAULT NULL; 	-- 124.132 Notes Date
	DECLARE de_124_133_CADENA TEXT DEFAULT NULL; 	-- 124.133 Notes Comments
	DECLARE de_124_134_CADENA TEXT DEFAULT NULL; 	-- 124.134 Notes Priority Flag
	DECLARE de_124_135_CADENA TEXT DEFAULT NULL; 	-- 124.135 Notes Reminder Flag
	DECLARE de_124_136_CADENA TEXT DEFAULT NULL; 	-- 124.136 Notes Share Flag
	DECLARE de_124_137_CADENA TEXT DEFAULT NULL; 	-- 124.137 Notes Reminder Date
	DECLARE de_124_138_CADENA TEXT DEFAULT NULL; 	-- 124.138 Notes Reminder UserName
	DECLARE de_124_131 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_132 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_133 TEXT DEFAULT NULL; 	
	DECLARE de_124_134 VARCHAR(5) DEFAULT NULL; 	
	DECLARE de_124_135 VARCHAR(5) DEFAULT NULL; 	
	DECLARE de_124_136 VARCHAR(5) DEFAULT NULL; 
	DECLARE de_124_137 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_138 VARCHAR(99) DEFAULT NULL;
	
	DECLARE _US_AT 	TEXT DEFAULT NULL;              -- NT Activity Struct
	DECLARE de_124_141_CADENA TEXT DEFAULT NULL; 	-- 124.141 Activity Type
	DECLARE de_124_142_CADENA TEXT DEFAULT NULL; 	-- 124.142 Activity Date
	DECLARE de_124_143_CADENA TEXT DEFAULT NULL; 	-- 124.143 Activity Comments
	DECLARE de_124_144_CADENA TEXT DEFAULT NULL; 	-- 124.144 Activity Comments
	DECLARE de_124_141 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_142 VARCHAR(45) DEFAULT NULL; 	
	DECLARE de_124_143 TEXT DEFAULT NULL; 
	DECLARE de_124_144 VARCHAR(99) DEFAULT NULL; 
	
	-- Variables auxiliares:
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE USER_NAME	VARCHAR(100) DEFAULT NULL;     
	DECLARE USER_EMAIL  VARCHAR(100) DEFAULT NULL;  
	DECLARE CRC_AUX VARCHAR(10) DEFAULT NULL; 
	
	DECLARE i INT(4) DEFAULT NULL;
	DECLARE ADDRESSID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;  
	DECLARE PHONEID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE BILLID_AUX INTEGER(11) DEFAULT NULL; 
    DECLARE ACCOUNTPAYABLEID_AUX INT(11) DEFAULT 0;
	DECLARE CLASS_AUX VARCHAR(1) DEFAULT 0;
	DECLARE OWNER_AUX VARCHAR(3) DEFAULT 0;
	DECLARE DATE_AUX DATETIME DEFAULT 0;
	DECLARE de_122_034 INT(11) DEFAULT NULL;
    DECLARE CARD_TOCKEN VARCHAR(45) DEFAULT NULL;	
	DECLARE de_SB VARCHAR(5000) DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION TEXT DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION_AUX TEXT DEFAULT NULL;	
	DECLARE SUBSCRIPTION_AUX VARCHAR(45) DEFAULT NULL;
    DECLARE SUBSCRIPTION_AUX2 VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_TITLE VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_QUANTITY INT(11) DEFAULT NULL;
	DECLARE RESIDUAL_QUANTITY DECIMAL(15,2) DEFAULT NULL;
	DECLARE LATITUDE_AUX VARCHAR(20) DEFAULT 0;			
	DECLARE LONGITUDE_AUX VARCHAR(20) DEFAULT 0;
	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL;
	
    DECLARE PARAMET	VARCHAR(100) DEFAULT NULL;
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	
	

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA TEXT NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	SET	de_53 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_53,11));
	
	SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	set de_114_179 = (select right(de_114_179,11));
    
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_127_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.10');
	
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
    SET de_114_070 = convert(unhex(de_114_070) using utf8);
    
	SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');
	SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.121');
	
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
	
	SET de_119_016 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '119.16');
	
	SET de_117_018 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.18');
	SET de_117_020 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.20');
	SET de_117_021 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.21');
	SET de_055_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '55.3');
	
	SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
	SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));
	SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
	SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
	SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
	SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
    
    SET _US_PH = REPLACE(_US_PH,'-1','');
    
	SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
	SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
	SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
	SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

	
	SELECT DATA INTO _US_AD FROM TBL_MESSAGE1 WHERE CODE = "AD";
	SET _US_AD = (SELECT CONVERT(unhex(_US_AD) USING utf8 ));	
	SET _US_AD = REPLACE(_US_AD,'{"1','{"_1');
	SET _US_AD = REPLACE(_US_AD,',"1',',"_1');
	SET _US_AD = REPLACE(_US_AD,'{"4','{"_4');
	SET _US_AD = REPLACE(_US_AD,',"4',',"_4');
	SET de_121_045_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_121.45'));
	SET de_114_012_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.12'));
	SET de_114_013_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.13'));
	SET de_122_107_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.107'));
	SET de_114_014_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.14'));
	SET de_120_013_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_120.13'));
	SET de_122_087_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.87'));
	SET de_048_028_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_48.28'));
	SET de_121_167_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_121.167'));
	SET de_047_017_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_47.17'));
	
	SELECT DATA INTO _US_AC FROM TBL_MESSAGE1 WHERE CODE = "AC";
	SET _US_AC = (SELECT CONVERT(unhex(_US_AC) USING utf8 ));
	SET _US_AC = REPLACE(_US_AC,'{"1','{"_1');
	SET _US_AC = REPLACE(_US_AC,',"1',',"_1');
	SET _US_AC = REPLACE(_US_AC,'{"4','{"_4');
	SET _US_AC = REPLACE(_US_AC,',"4',',"_4');
    SET _US_AC = REPLACE(_US_AC,'{"2','{"_2');
	SET _US_AC = REPLACE(_US_AC,',"2',',"_2');
    SET de_002_CADENA      = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_2'));
	SET de_118_005_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_118.5'));
	SET de_120_007_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_120.7'));
	SET de_048_006_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.6'));
	SET de_048_002_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.2'));
	SET de_048_004_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_48.4'));
	SET de_122_126_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_122.126'));
	SET de_121_005_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AC":',_US_AC,'}'),'//_121.5'));
	
	
	SELECT DATA INTO _US_CU FROM TBL_MESSAGE1 WHERE CODE = "CU";
	SET _US_CU = (SELECT CONVERT(unhex(_US_CU) USING utf8 ));
	SET _US_CU = REPLACE(_US_CU,'{"1','{"_1');
	SET _US_CU = REPLACE(_US_CU,',"1',',"_1');
	SET de_114_093_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_CU":',_US_CU,'}'),'//_114.93'));
	
	
	SELECT DATA INTO _US_NT FROM TBL_MESSAGE1 WHERE CODE = "NT";
	SET _US_NT = (SELECT CONVERT(unhex(_US_NT) USING utf8 ));
	SET _US_NT = REPLACE(_US_NT,'{"1','{"_1');
	SET _US_NT = REPLACE(_US_NT,',"1',',"_1');
	SET de_124_131_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.131'));
	SET de_124_132_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.132'));
	SET de_124_133_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.133'));
	SET de_124_134_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.134'));
	SET de_124_135_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.135'));
	SET de_124_136_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.136'));
	SET de_124_137_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.137'));
	SET de_124_138_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_NT":',_US_NT,'}'),'//_124.138'));
	
	SELECT DATA INTO _US_AT FROM TBL_MESSAGE1 WHERE CODE = "AT";
	SET _US_AT = (SELECT CONVERT(unhex(_US_AT) USING utf8 ));
	SET _US_AT = REPLACE(_US_AT,'{"1','{"_1');
	SET _US_AT = REPLACE(_US_AT,',"1',',"_1');
	SET de_124_141_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.141'));
	SET de_124_142_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.142'));
	SET de_124_143_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.143'));	
	SET de_124_144_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AT":',_US_AT,'}'),'//_124.144'));
	
	
	
	
	
	
	
	if (select substring(de_53,5,2) = '20') then

		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','1015'),('44','Invalid Request');
	
    else
        
		if length(de_114_179) > 0 then 

			-- ---------------------
			-- User and merchant  --
			-- ---------------------
			
			update tbl_user set
			tbl_user_email = COALESCE(de_114_007, tbl_user_email),
			tbl_user_first = COALESCE(de_114_003, tbl_user_first),
			tbl_user_last = COALESCE(de_114_005, tbl_user_last),
			tbl_user_title = COALESCE(de_114_091, tbl_user_title),
			tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName),
			tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),tbl_user_password),
			tbl_user_policy = COALESCE(convert(unhex(de_119_016) using utf8),tbl_user_policy),
			tbl_user_dateAdded = NOW(),
			tbl_user_dateModified = NOW(),
			tbl_user_entity = 25,
			tbl_userstatus_id = 37,
			tbl_user_userTemp_f = 1,
            tbl_user_department = 61316,
			tbl_gender_type = 51,
			tbl_user_multipleshipaddress_f = 0,
            tbl_user_supervisor = if(length(de_053)>0,if(de_053!= de_114_179, de_053, tbl_user_supervisor), tbl_user_supervisor),
			tbl_user_modifiedBy = if(length(de_053)>0,if(de_053!= de_114_179, de_053, tbl_user_modifiedBy), tbl_user_modifiedBy)
			where tbl_user_id = de_114_179; 
			
			SET USERID_AUX = de_114_179;
			SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
			SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
			SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));
			SET COMPANY_ID =  (select tbl_company_id from tbl_user where tbl_user_id= USERID_AUX);

			update tbl_merchant set
			tbl_merchant_taxIdNumber = COALESCE(de_123_071, tbl_merchant_taxIdNumber),
			tbl_merchant_multiple_locations_quantity = COALESCE(de_114_121, tbl_merchant_multiple_locations_quantity),
			tbl_merchant_location_use = COALESCE(de_114_121, tbl_merchant_location_use),
			tbl_merchant_dongles_quantity = COALESCE(de_117_018, tbl_merchant_dongles_quantity),
			-- tbl_merchant_basic_subs = COALESCE(de_117_020, tbl_merchant_basic_subs),
			tbl_merchant_standard_subs = COALESCE(de_117_020, tbl_merchant_standard_subs),
			tbl_merchant_deluxe_subs = COALESCE(de_117_021,tbl_merchant_deluxe_subs),
			tbl_merchant_receivePayment_f = 0,
            tbl_user_reseller_id = if(length(de_053)>0,if(de_053!= de_114_179, de_053, tbl_user_reseller_id), tbl_user_reseller_id),
			tbl_user_modifiedBy = if(length(de_053)>0,if(de_053!= de_114_179, de_053, tbl_user_modifiedBy), tbl_user_modifiedBy)
			where tbl_user_id = de_114_179;

			update tbl_company set
			tbl_company_name = COALESCE(de_114_070 ,tbl_company_name),
			tbl_company_taxId = COALESCE(de_123_071 ,tbl_company_taxId),
			tbl_company_policy = COALESCE(convert(unhex(de_119_016) using utf8), tbl_company_policy)
			where tbl_company_id = COMPANY_ID;
			
			

			
			-- ---------------------
			-- Link               --
			-- ---------------------
			
			if length(de_052) > 0 then 
			
				update tbl_link set
				tbl_link_link = md5(convert(unhex(de_052) using utf8)),
				tbl_link_date = NOW(),
				tbl_link_delete = 0
				where tbl_link_user_id = de_114_179;
			
			end if;
			
			
			
			-- ---------------------
			-- Phones             --
			-- ---------------------
			
			if LENGTH(_48_28_CADENA) >0 then
			
				delete from tbl_phone where tbl_phone_nmcId = de_114_179;
			
				while (LENGTH(_48_28_CADENA)>0) DO

					SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
					SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

					SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
					SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
					
					SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
					SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

					SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
					SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

					insert into tbl_phone set
					tbl_company_id 		  = COMPANY_ID,
					tbl_phone_nmcId       = de_114_179,
					tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
					tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

					SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);		
					
				end while ; 
				
			end if;
			
			
			
			-- ------------------------
			-- Address and Locations --
			-- ------------------------
			
			if (select tbl_address_id from tbl_address where tbl_address_nmcId = de_114_179 limit 1) is not null then
			
				delete from tbl_location_hardware where tbl_user_id = de_114_179;			
				delete from tbl_locationaddress where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
				delete from tbl_locationphone where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
				delete from tbl_location_schedule where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
				delete from tbl_location where tbl_location_userId = de_114_179;			
				delete from tbl_address where tbl_address_nmcId = de_114_179;
			
			end if;
			
			if LENGTH(de_114_012_CADENA) >0 then

				while (LENGTH(de_114_012_CADENA)>0) DO
				
					SET de_121_045 = TRIM((SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1)));
					SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));

					SET de_114_012 = (SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1));
					SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

					SET de_114_013 = (SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1));
					SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
					
					SET de_122_107 = TRIM((SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1)));
					SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

					SET de_114_014 = TRIM((SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1)));
					SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
			
					SET de_120_013 = TRIM((SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1)));
					SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

					SET de_122_087 = TRIM((SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1)));
					SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
					
					SET de_048_028 = TRIM((SELECT SUBSTR(de_048_028_CADENA,1,LOCATE('|',de_048_028_CADENA)-1)));
					SET de_048_028_CADENA = (SELECT SUBSTR(de_048_028_CADENA,LOCATE('|',de_048_028_CADENA)+1));

					SET de_121_167 = TRIM((SELECT SUBSTR(de_121_167_CADENA,1,LOCATE('|',de_121_167_CADENA)-1)));
					SET de_121_167_CADENA = (SELECT SUBSTR(de_121_167_CADENA,LOCATE('|',de_121_167_CADENA)+1));
					
					SET de_047_017 = TRIM((SELECT SUBSTR(de_047_017_CADENA,1,LOCATE('|',de_047_017_CADENA)-1)));
					SET de_047_017_CADENA = (SELECT SUBSTR(de_047_017_CADENA,LOCATE('|',de_047_017_CADENA)+1));

					if length(de_047_017) > 0 then
					
						SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
						SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
					
						set de_122_107 = (select tbl_zipcode_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
						set de_114_014 = (select tbl_city_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
						set de_120_013 = (select tbl_state_id from tbl_city where tbl_city_id = de_114_014);
						set de_122_087 = (select tbl_country_id from tbl_state where tbl_state_id = de_120_013);
						
					else
					
						SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
						SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
					
					end if;
					
					insert into tbl_address set 
					tbl_company_id = COMPANY_ID,
					tbl_address_nmcId = de_114_179,
					-- tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
                    tbl_addresstype_id = 11,
					tbl_address_first = TRIM(de_114_012),
					tbl_address_second = TRIM(de_114_013),
					tbl_address_phoneNumber = null,
					tbl_zipcode_id = TRIM(de_122_107),
					tbl_city_id = TRIM(de_114_014),
					tbl_state_id = TRIM(de_120_013),
					tbl_country_id = TRIM(de_122_087);
					
					SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
						
					INSERT INTO tbl_location SET
					tbl_company_id = COMPANY_ID,
					tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
					tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
					tbl_location_contactName = COALESCE(USER_NAME,' '), 
					tbl_location_contactEmail = COALESCE(USER_EMAIL,' '), 
					tbl_location_userId = de_114_179,
					tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
					tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
					tbl_location_statusId= 7001;
						
					SET LOCATIONID_AUX= (SELECT last_insert_id() from  tbl_location limit 1);

					INSERT tbl_locationaddress SET
					tbl_location_id = LOCATIONID_AUX, 
					tbl_address_id = ADDRESSID_AUX;
						
					INSERT tbl_phone SET
					tbl_company_id = COMPANY_ID,
					tbl_phone_phoneNumber = de_048_028,
					tbl_phone_extension = de_121_167,
					tbl_phone_country_id = de_122_087,
					tbl_phonetype_id = 4001;
					
					SET PHONEID_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);
					
					INSERT INTO tbl_locationphone SET
					tbl_location_id = LOCATIONID_AUX,
					tbl_phone_id = PHONEID_AUX;
						
					if (select count(tbl_location_id) from tbl_location where tbl_location_userId = de_114_179) = 1 then

						INSERT INTO tbl_hardware_cart (
						tbl_company_id,
						tbl_user_id,
						tbl_location_id,
						tbl_hardware_type_id,
						tbl_hardware_cart_quantity,
						tbl_hardware_cart_delete
						)
						values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0);
						
					end if;
						
					INSERT INTO tbl_location_hardware (
					tbl_company_id,
					tbl_user_id,
					tbl_location_id,
					tbl_hardware_type_id,
					tbl_location_hardware_qty,
					tbl_location_hardware_shipped,
					tbl_shipping_status_id) 
					values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,0,0,73001);

					INSERT INTO tbl_location_schedule (
					tbl_location_id,
					tbl_day_of_the_week,
					tbl_24_hour,
					tbl_closed_flag,
					tbl_hour_open,
					tbl_hour_close) 
					values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
						   (LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
						   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
						   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
						   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
						   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
						   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');
					
				end while ;
				
			end if;
			
			
			
			-- ---------------------
			-- Credit Card        --
			-- ---------------------
			
			if LENGTH(de_002_CADENA) >0 then

				delete from dbcards.tbl_card where tbl_user_id = de_114_179;
				delete from dbcards.tbl_carduser where tbl_user_nmcId = de_114_179;
			
				SET de_002 = TRIM((SELECT SUBSTR(de_002_CADENA,1,LOCATE('|',de_002_CADENA)-1)));
				SET de_002_CADENA = (SELECT SUBSTR(de_002_CADENA,LOCATE('|',de_002_CADENA)+1));
			
				SET de_118_005 = TRIM((SELECT SUBSTR(de_118_005_CADENA,1,LOCATE('|',de_118_005_CADENA)-1)));
				SET de_118_005_CADENA = (SELECT SUBSTR(de_118_005_CADENA,LOCATE('|',de_118_005_CADENA)+1));

				SET de_120_007 = TRIM((SELECT SUBSTR(de_120_007_CADENA,1,LOCATE('|',de_120_007_CADENA)-1)));
				SET de_120_007_CADENA = (SELECT SUBSTR(de_120_007_CADENA,LOCATE('|',de_120_007_CADENA)+1));
				
				SET de_048_006 = TRIM((SELECT SUBSTR(de_048_006_CADENA,1,LOCATE('|',de_048_006_CADENA)-1)));
				SET de_048_006_CADENA = (SELECT SUBSTR(de_048_006_CADENA,LOCATE('|',de_048_006_CADENA)+1));
		
				SET de_048_002 = TRIM((SELECT SUBSTR(de_048_002_CADENA,1,LOCATE('|',de_048_002_CADENA)-1)));
				SET de_048_002_CADENA = (SELECT SUBSTR(de_048_002_CADENA,LOCATE('|',de_048_002_CADENA)+1));
				
				SET de_048_004 = TRIM((SELECT SUBSTR(de_048_004_CADENA,1,LOCATE('|',de_048_004_CADENA)-1)));
				SET de_048_004_CADENA = (SELECT SUBSTR(de_048_004_CADENA,LOCATE('|',de_048_004_CADENA)+1));
				
				SET de_122_126 = TRIM((SELECT SUBSTR(de_122_126_CADENA,1,LOCATE('|',de_122_126_CADENA)-1)));
				SET de_122_126_CADENA = (SELECT SUBSTR(de_122_126_CADENA,LOCATE('|',de_122_126_CADENA)+1));
				
				SET de_121_005 = TRIM((SELECT SUBSTR(de_121_005_CADENA,1,LOCATE('|',de_121_005_CADENA)-1)));
				SET de_121_005_CADENA = (SELECT SUBSTR(de_121_005_CADENA,LOCATE('|',de_121_005_CADENA)+1));
				
				
				SET de_048_015 = de_002;
				
				insert into dbcards.tbl_carduser set
				tbl_user_nmcId = de_114_179,
				tbl_card_tocken = de_048_015,
				tbl_paymentnaturetype_id = 35001,
				tbl_carduser_referenceNumber = de_122_126,
				tbl_carduser_date = de_121_005;
				
				insert into dbcards.tbl_card set
				tbl_user_id = de_114_179,
				tbl_card_tocken = de_048_015,
				tbl_card_number = SUBSTRING(de_002, -4),
				tbl_card_dateAdded = NOW(),
				tbl_card_datemodified = NOW(),
				tbl_cardstype_id = COALESCE(de_120_007,61),
				tbl_cardstatus_id = 51,
				tbl_card_nickname = COALESCE(de_048_006,''),
				tbl_card_chardholderName = COALESCE(de_048_002,''),		
				tbl_card_routingNumber = '',
				tbl_card_issuingBank = '',
				tbl_accounttype_id = null,
				tbl_bankaccounttype_id = null,	
				tbl_card_dateExpire = COALESCE(de_118_005,''),
				tbl_card_swift_iban_code = COALESCE(de_048_004,''),
				tbl_country_id = null,
				tbl_zipcode = null,
				tbl_debitaccounttype_id = null,
				tbl_address_id = null,
				tbl_paymentserviceprovider_id = null;
	  
			end if;
			
			
			
			-- ---------------------
			-- Category User      --
			-- ---------------------
			
			if LENGTH(de_114_093_CADENA) >0 then
			
				if (select tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory where tbl_merchant_nmcId = de_114_179 limit 1) is not null then 
					delete from dbuser.tbl_merchantbusinesscategory where tbl_merchant_nmcId = de_114_179;
				end if;
		   
				while (LENGTH(de_114_093_CADENA)>0) DO
		   
					SET de_114_093 = TRIM((SELECT SUBSTR(de_114_093_CADENA,1,LOCATE('|',de_114_093_CADENA)-1)));
					SET de_114_093_CADENA = (SELECT SUBSTR(de_114_093_CADENA,LOCATE('|',de_114_093_CADENA)+1));
					
					if (select tbl_businesscategory_id 
						from dbuser.tbl_merchantbusinesscategory 
						where tbl_merchant_nmcId = de_114_179 
						and tbl_businesscategory_id = de_114_093
						limit 1) is null then 
						
						insert into dbuser.tbl_merchantbusinesscategory set
						tbl_company_id = COMPANY_ID,
						tbl_merchant_nmcId = de_114_179,
						tbl_businesscategory_id = de_114_093;
						
					end if;
					
				end while;
					
			end if;
				
			
			delete from dbuser.tbl_merchantbusinesscategory
			where tbl_businesscategory_id in (select tbl_category_id 
																	from dbitems.tbl_category 
																	where tbl_category_level < 2 
																	and tbl_category_active = 1 
																	and tbl_category_deleted = 0)
			and tbl_merchant_nmcId in (select tbl_user_id 
														  from dbuser.tbl_user 
														  where tbl_user_entity = 25 );
				
				
			-- ---------------------
			-- CRM Notes          --
			-- ---------------------
			
			if LENGTH(de_124_131_CADENA) >0 then
			
				if (select tbl_crm_note_id from dbuser.tbl_crm_note where tbl_user_id = de_114_179 limit 1) is not null then 
					delete from dbuser.tbl_crm_note where tbl_user_id = de_114_179;
				end if;
		   
				while (LENGTH(de_124_131_CADENA)>0) DO
		   
					SET de_124_131 = TRIM((SELECT SUBSTR(de_124_131_CADENA,1,LOCATE('|',de_124_131_CADENA)-1)));
					SET de_124_131_CADENA = (SELECT SUBSTR(de_124_131_CADENA,LOCATE('|',de_124_131_CADENA)+1));
					
					SET de_124_132 = TRIM((SELECT SUBSTR(de_124_132_CADENA,1,LOCATE('|',de_124_132_CADENA)-1)));
					SET de_124_132_CADENA = (SELECT SUBSTR(de_124_132_CADENA,LOCATE('|',de_124_132_CADENA)+1));
					
					SET de_124_133 = TRIM((SELECT SUBSTR(de_124_133_CADENA,1,LOCATE('|',de_124_133_CADENA)-1)));
					SET de_124_133_CADENA = (SELECT SUBSTR(de_124_133_CADENA,LOCATE('|',de_124_133_CADENA)+1));
					
					SET de_124_134 = TRIM((SELECT SUBSTR(de_124_134_CADENA,1,LOCATE('|',de_124_134_CADENA)-1)));
					SET de_124_134_CADENA = (SELECT SUBSTR(de_124_134_CADENA,LOCATE('|',de_124_134_CADENA)+1));
					
					SET de_124_135 = TRIM((SELECT SUBSTR(de_124_135_CADENA,1,LOCATE('|',de_124_135_CADENA)-1)));
					SET de_124_135_CADENA = (SELECT SUBSTR(de_124_135_CADENA,LOCATE('|',de_124_135_CADENA)+1));
					
					SET de_124_136 = TRIM((SELECT SUBSTR(de_124_136_CADENA,1,LOCATE('|',de_124_136_CADENA)-1)));
					SET de_124_136_CADENA = (SELECT SUBSTR(de_124_136_CADENA,LOCATE('|',de_124_136_CADENA)+1));
					
					SET de_124_137 = TRIM((SELECT SUBSTR(de_124_137_CADENA,1,LOCATE('|',de_124_137_CADENA)-1)));
					SET de_124_137_CADENA = (SELECT SUBSTR(de_124_137_CADENA,LOCATE('|',de_124_137_CADENA)+1));
					
					SET de_124_138 = TRIM((SELECT SUBSTR(de_124_138_CADENA,1,LOCATE('|',de_124_138_CADENA)-1)));
					SET de_124_138_CADENA = (SELECT SUBSTR(de_124_138_CADENA,LOCATE('|',de_124_138_CADENA)+1));
					
					
					case de_124_131 
						when 'G'  then set de_124_131 = 'General';
						when 'FU' then set de_124_131 = 'Follow Up';
						when 'RE' then set de_124_131 = 'Refusal';
						when 'SH' then set de_124_131 = 'Share';
						else set de_124_131 = 'General';
					end case;
					
					insert into dbuser.tbl_crm_note set
					tbl_user_id = de_114_179,
					tbl_crm_note_type = de_124_131,
					tbl_crm_note_date = de_124_132,
					tbl_crm_note_comments = CONVERT(unhex(de_124_133) USING UTF8),
					tbl_crm_note_priority_f = if(de_124_134='true',1,0),
					tbl_crm_note_reminder_f = if(de_124_135='true',1,0),
					tbl_crm_note_share_f = if(de_124_136='true',1,0),
					tbl_crm_note_reminder_date = de_124_137,
					tbl_crm_note_username = de_124_138;

				end while;
					
			end if;				
				
				
				
			-- ---------------------
			-- CRM Activities     --
			-- ---------------------
			
			if LENGTH(de_124_141_CADENA) >0 then
			
				if (select tbl_crm_activity_id from dbuser.tbl_crm_activity where tbl_user_id = de_114_179 limit 1) is not null then 
					delete from dbuser.tbl_crm_activity where tbl_user_id = de_114_179;
				end if;
		   
				while (LENGTH(de_124_141_CADENA)>0) DO
		   
					SET de_124_141 = TRIM((SELECT SUBSTR(de_124_141_CADENA,1,LOCATE('|',de_124_141_CADENA)-1)));
					SET de_124_141_CADENA = (SELECT SUBSTR(de_124_141_CADENA,LOCATE('|',de_124_141_CADENA)+1));
					
					SET de_124_142 = TRIM((SELECT SUBSTR(de_124_142_CADENA,1,LOCATE('|',de_124_142_CADENA)-1)));
					SET de_124_142_CADENA = (SELECT SUBSTR(de_124_142_CADENA,LOCATE('|',de_124_142_CADENA)+1));
					
					SET de_124_143 = TRIM((SELECT SUBSTR(de_124_143_CADENA,1,LOCATE('|',de_124_143_CADENA)-1)));
					SET de_124_143_CADENA = (SELECT SUBSTR(de_124_143_CADENA,LOCATE('|',de_124_143_CADENA)+1));
					
					SET de_124_144 = TRIM((SELECT SUBSTR(de_124_144_CADENA,1,LOCATE('|',de_124_144_CADENA)-1)));
					SET de_124_144_CADENA = (SELECT SUBSTR(de_124_144_CADENA,LOCATE('|',de_124_144_CADENA)+1));
					
					
					case de_124_141 
						when 'SL' then set de_124_141 = 'Sales';
						when 'PR' then set de_124_141 = 'Preview';
						when 'CL' then set de_124_141 = 'Close';
						else set de_124_141 = 'Sales';
					end case;
					
					insert into dbuser.tbl_crm_activity set
					tbl_user_id = de_114_179,
					tbl_crm_activity_type = de_124_141,
					tbl_crm_activity_date = de_124_142,
					tbl_crm_activity_comments = CONVERT(unhex(de_124_143) USING UTF8),
					tbl_crm_activity_username = de_124_144;

				end while;
					
			end if;			
			
			
			
			-- ---------------------
			-- Client Keys        --
			-- ---------------------

			if (select client_name from nmc_control.client_key where user_id = USERID_AUX limit 1) is null then
			
				INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
				values  (md5(CONCAT('Terminal',USERID_AUX)),'Terminal',CURDATE(),1,3,USERID_AUX,0),
						(md5(CONCAT('Module OsCommerce',USERID_AUX)),'Module OsCommerce',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Widget',USERID_AUX)),'Widget',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('WidgetCar',USERID_AUX)),'WidgetCar',CURDATE(),1,5,USERID_AUX,0),
						(md5(CONCAT('Tablet',USERID_AUX)),'Tablet',CURDATE(),1,6,USERID_AUX,0);
			
			end if;
			
			
			
			-- ---------------------
			-- Modules            --
			-- ---------------------

			if (select tbl_module_id from dbitems.tbl_module where tbl_user_id = USERID_AUX limit 1) is null then
			
				INSERT INTO dbitems.tbl_module (`tbl_company_id`,`tbl_user_id`, `tbl_module_title`, `tbl_module_order`, `tbl_module_type_id`, `tbl_module_active_f`, `tbl_module_image`, `tbl_module_price`, `tbl_module_item_limit`) 
				values  (COMPANY_ID, USERID_AUX,'Banner sample 1'	, 1, 2, 1, 'logo_banner.png', NULL, 10),
						(COMPANY_ID, USERID_AUX,'Banner sample 2'	, 2, 2, 1, 'logo_banner.png', NULL, 10),
						(COMPANY_ID, USERID_AUX,'Banner sample 3'	, 3, 2, 1, 'logo_banner.png', NULL, 10),
						(COMPANY_ID, USERID_AUX,'Item list sample 1', 4, 1, 1, NULL				, NULL, 10),
						(COMPANY_ID, USERID_AUX,'Item list sample 2', 5, 1, 1, NULL				, NULL, 10),
						(COMPANY_ID, USERID_AUX,'Box sample 1'		, 6, 3, 1, 'logo_box.png'	, NULL, 10),
						(COMPANY_ID, USERID_AUX,'Box sample 2'		, 7, 3, 1, 'logo_box.png'	, NULL, 10);
			
			end if;
			
			
			
			-- ---------------------
			-- Subscription Cart  --
			-- ---------------------
			
			if (select tbl_subscription_id from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 limit 1) is not null then
				delete from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179; 
			end if;     
					
			
			if de_117_020 > 0 then
				insert into dbitems.tbl_subscriptioncart set 
				tbl_subscription_id = 15,
				tbl_subscriptioncart_user_nmcid = de_114_179,
				tbl_subscriptioncart_quantity = de_117_020;
			end if;
			
			if de_117_021 > 0 then
				insert into dbitems.tbl_subscriptioncart set 
				tbl_subscription_id = 16,
				tbl_subscriptioncart_user_nmcid = de_114_179,
				tbl_subscriptioncart_quantity = de_117_021;
			end if;

			

			-- ---------------------
			-- Payment            --
			-- ---------------------

			if LENGTH(de_055_003) >0 then
				
				set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015 and tbl_user_nmcId = de_114_179 limit 1);
				
				if LENGTH(de_122_034) >0 then 
					
					SET CARD_TOCKEN = (select tbl_card_tocken from dbcards.tbl_carduser where tbl_carduser_id = de_122_034);
					SET DATE_AUX = NOW();

					if (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) is not null then
					   SET BILLID_AUX = (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) +1;
					else
					   SET BILLID_AUX = 1;
					end if;

					-- --------------- --
					-- Bill            --
					-- --------------- --
					
					insert into dbtransaction.tbl_bill set
					tbl_bill_id = BILLID_AUX,
					tbl_bill_number = 1000000 + BILLID_AUX,
					tbl_bill_merchant_nmcId = de_114_179,
					tbl_bill_seller_nmcId = '001', 
					tbl_bill_status = 101,
					tbl_bill_date = DATE_AUX;
					
					-- ------------------ --
					-- Bill Subscription  --
					-- ------------------ --
					
					insert into dbtransaction.tbl_billsubscription (tbl_bill_id,
													  tbl_subscription_id,
													  tbl_billsubscription_quantity,
													  tbl_billsubscription_price,
													  tbl_billsubscription_reseller_nmcId)
					select  BILLID_AUX,
							A.tbl_subscription_id,
							A.tbl_subscriptioncart_quantity,
							B.tbl_subscription_recommended_price,
							null

					from dbitems.tbl_subscriptioncart as A, dbitems.tbl_subscription as B
					where A.tbl_subscriptioncart_user_nmcid = de_114_179
					and A.tbl_subscriptioncart_delete = 0
					and A.tbl_subscription_id = B.tbl_subscription_id;
					
					
					if de_117_018 > 0 then
					
						insert into dbtransaction.tbl_billsubscription set
						tbl_bill_id = BILLID_AUX,
						tbl_hardware_type_id = 75001,
						tbl_billsubscription_quantity = de_117_018,
						tbl_billsubscription_price = 200.00;
						
						insert into dbuser.tbl_shipping set
						tbl_user_id = de_114_179,
						tbl_location_id = LOCATIONID_AUX,
						tbl_shipping_dongle_qty = de_117_018,
						tbl_shipping_tablet_qty = 0,
						tbl_shipping_tv_qty = 0,
						tbl_shipping_status_id = 73001,
						tbl_shipping_saleDate = current_date(),
						tbl_shipping_invoiceNumber = BILLID_AUX,
						tbl_shipping_refNumber = 1000000 + BILLID_AUX,
						tbl_shipping_boxes = 0;
						
					end if;
					
					
					-- ------------------ --
					-- Bil Transaction    --
					-- ------------------ --
					
					insert into dbtransaction.tbl_billtransaction set 
					tbl_bill_id = BILLID_AUX,
					tbl_cardTocken = CARD_TOCKEN,	  	
					tbl_billtransaction_amount = de_055_003,
					tbl_billtransaction_status_id = 75,
					tbl_billtransaction_type_id = 1,
					tbl_billtransaction_date = DATE_AUX;

					
					set de_SB = (select GROUP_CONCAT(CONCAT('',tbl_subscription_id,'|'))
								from dbitems.tbl_subscriptioncart 
								where tbl_subscriptioncart_user_nmcid = de_114_179
								and tbl_subscriptioncart_delete = 0
								);
								
					set CADENA_SUBSCRIPTION = REPLACE(de_SB,'|,','|');	
					set CADENA_SUBSCRIPTION_AUX = REPLACE(de_SB,'|,','|');
					
					WHILE (LENGTH(CADENA_SUBSCRIPTION)>0) DO
									
						SET SUBSCRIPTION_AUX = (SELECT SUBSTR(CADENA_SUBSCRIPTION,1,LOCATE('|',CADENA_SUBSCRIPTION)-1));
						SET CADENA_SUBSCRIPTION = (SELECT SUBSTR(CADENA_SUBSCRIPTION,LOCATE('|',CADENA_SUBSCRIPTION)+1));

						set SUBSCRIPTION_QUANTITY = (select tbl_subscriptioncart_quantity from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) and tbl_subscriptioncart_delete = 0 LIMIT 1);

						if (select tbl_subscription_id from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) is null then
					
							insert into dbitems.tbl_usersubscription set
							tbl_company_id = COMPANY_ID,
							tbl_usersubscription_user_nmcid = de_114_179,
							tbl_subscription_id = TRIM(SUBSCRIPTION_AUX),
							tbl_usersubscription_date_purchase = DATE_AUX,		  
							tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
							tbl_subscriptionstatus_id = 2401;
							
						else
							
							if (select tbl_usersubscription_date_expiration from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = de_114_179 and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) > NOW() then
						
								update dbitems.tbl_usersubscription set
								tbl_usersubscription_date_purchase = DATE_AUX,		  
								tbl_usersubscription_date_expiration = DATE_ADD(tbl_usersubscription_date_expiration, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
								tbl_subscriptionstatus_id = 2401
								where tbl_usersubscription_user_nmcid = de_114_179
								and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
								
							else
						
								update dbitems.tbl_usersubscription set
								tbl_usersubscription_date_purchase = DATE_AUX,		  
								tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
								tbl_subscriptionstatus_id = 2401
								where tbl_usersubscription_user_nmcid = de_114_179
								and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
							
							end if;
							
						end if;
					
					END WHILE;


					-- ------------------------- --
					-- Clean Subscription Cart   --
					-- ------------------------- --

					update dbitems.tbl_subscriptioncart set
					tbl_subscriptioncart_delete = 1
					where tbl_subscriptioncart_user_nmcid = de_114_179
					and tbl_subscriptioncart_delete = 0;
					
					update tbl_hardware_cart set 
					tbl_hardware_cart_delete = 1
					where tbl_user_id = de_114_179
					and tbl_hardware_cart_delete = 0;
					
					update dbuser.tbl_merchant set
					tbl_merchant_receivePayment_f = 1
					where tbl_user_id = de_114_179;
					
				
				end if;
			
			end if;


			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
			
			

		
		
		
		else

			-- if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1) is null then

				if (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070 limit 1) is null then
					
					-- ---------------------
					-- User and merchant  --
					-- ---------------------

					insert into tbl_user set 
					tbl_user_email = de_114_007,
					tbl_user_first = de_114_003,
					tbl_user_last = de_114_005,
					tbl_user_title = COALESCE(de_114_091,''),
					tbl_user_companyName = COALESCE(de_114_070,''),
					tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),''),
					tbl_user_policy = COALESCE(convert(unhex(de_119_016) using utf8),''),
					tbl_user_dateAdded = NOW(),
					tbl_user_dateModified = NOW(),
					tbl_userstatus_id = 37,
					tbl_user_userTemp_f = 1,
					tbl_gender_type = 51,
					tbl_user_multipleshipaddress_f = 0,
					tbl_user_parentId = NULL,
					tbl_user_entity = 25,
					tbl_user_class = '2A0',
					tbl_owner_id = '001',
					tbl_user_pinCode =  1234,
                    tbl_user_department = 61316,
                    tbl_user_supervisor = de_053,
                    tbl_user_modifiedBy = de_053;
					
					SET USERID_AUX = last_insert_id();
					SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
					SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
					SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));
				
					insert into tbl_merchant set
					tbl_user_id = USERID_AUX,
					tbl_merchant_nmcId = USERID_AUX,
					tbl_merchant_taxIdNumber = COALESCE(de_123_071, ''),
					tbl_merchant_multiple_locations_quantity = de_114_121,
					tbl_merchant_location_use = COALESCE(de_114_121,0),
					tbl_merchant_dongles_quantity = COALESCE(de_117_018,0),				
					-- tbl_merchant_basic_subs = COALESCE(de_117_020,0),
					tbl_merchant_standard_subs = COALESCE(de_117_020,0),
					tbl_merchant_deluxe_subs = COALESCE(de_117_021,0),
					tbl_merchant_multipleLocation_f = 4801,
					tbl_merchant_haveWebsite_f = 0,
					tbl_merchant_haveAccount_f = 0,
					tbl_merchant_logoimage = '',
					tbl_merchant_online_store = '',
					tbl_merchant_receivePayment_f = 0,
                    tbl_user_reseller_id = de_053,
                    tbl_user_modifiedBy = de_053;
				
					insert into tbl_company set
					tbl_company_name = de_114_070,
					tbl_company_crc = CRC_AUX,
					tbl_company_taxId = de_123_071,
					tbl_company_policy = convert(unhex(de_119_016) using utf8),
					tbl_company_type_id = 4701,
					tbl_company_status_id = 33,
					tbl_company_dateCreate = NOW();
					
					set COMPANY_ID = (SELECT last_insert_id() FROM tbl_company limit 1);
					
					update dbuser.tbl_user set 
					tbl_company_id = COMPANY_ID,
					tbl_user_crc = CRC_AUX
					where tbl_user_id = USERID_AUX;
				
				
					INSERT INTO tbl_user_delivery_options set
					tbl_company_id = COMPANY_ID,
					tbl_user_id = USERID_AUX,
					tbl_delivery_company_price = 0.00,
					tbl_delivery_company_service = 'Pick Up',
					tbl_user_delivery_options_tier = 'Pick Up',
					tbl_delivery_company_tracking_code ='',
					tbl_delivery_company_option = 'Pick Up';
					
                    if length(de_114_007) > 0 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_053,
						tbl_user_id = USERID_AUX,
						tbl_activity_field = 'Email',
						tbl_activity_value_new = de_114_007,
						tbl_activity_date = NOW();
					end if;
                    
					if length(de_114_003) > 0 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_053,
						tbl_user_id = USERID_AUX,
						tbl_activity_field = 'First name',
						tbl_activity_value_new = de_114_003,
						tbl_activity_date = NOW();
					end if;

					if length(de_114_005) > 0 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_053,
						tbl_user_id = USERID_AUX,
						tbl_activity_field = 'Last name',
						tbl_activity_value_new = de_114_005,
						tbl_activity_date = NOW();
					end if;

					if length(de_114_070) > 0 then
						insert into dbuser.tbl_crm_activity set
						tbl_editor_id = de_053,
						tbl_user_id = USERID_AUX,
						tbl_activity_field = 'Company name',
						tbl_activity_value_new = de_114_070,
						tbl_activity_date = NOW();
					end if;
					

					-- ---------------------
					-- Link               --
					-- ---------------------
					
					if length(de_052) > 0 then 
					
						insert into tbl_link set
						tbl_link_user_id = USERID_AUX,
						tbl_link_link = md5(convert(unhex(de_052) using utf8)),
						tbl_link_date = NOW(),
						tbl_link_delete = 0;
					
					end if;
					
					
					
					-- ---------------------
					-- Phones             --
					-- ---------------------
							
					if LENGTH(_48_28_CADENA) >0 then
					
						while (LENGTH(_48_28_CADENA)>0) DO

							SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
							SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

							SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
							SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
							
							SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
							SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

							SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
							SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

							insert into tbl_phone set
							tbl_company_id 		  = COMPANY_ID,
							tbl_phone_nmcId       = USERID_AUX,
							tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
							tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
							tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
							tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

							SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);	
							
						end while ; 
						
					end if;
					
					
					
					-- ------------------------
					-- Address and Locations --
					-- ------------------------
					
					if LENGTH(de_114_012_CADENA) >0 then

						while (LENGTH(de_114_012_CADENA)>0) DO
						
							SET de_121_045 = (SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1));
							SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));

							SET de_114_012 = (SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1));
							SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

							SET de_114_013 = (SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1));
							SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
							
							SET de_122_107 = TRIM((SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1)));
							SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

							SET de_114_014 = TRIM((SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1)));
							SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
					
							SET de_120_013 = TRIM((SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1)));
							SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

							SET de_122_087 = TRIM((SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1)));
							SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
					
							
							SET de_048_028 = TRIM((SELECT SUBSTR(de_048_028_CADENA,1,LOCATE('|',de_048_028_CADENA)-1)));
							SET de_048_028_CADENA = (SELECT SUBSTR(de_048_028_CADENA,LOCATE('|',de_048_028_CADENA)+1));

							SET de_121_167 = TRIM((SELECT SUBSTR(de_121_167_CADENA,1,LOCATE('|',de_121_167_CADENA)-1)));
							SET de_121_167_CADENA = (SELECT SUBSTR(de_121_167_CADENA,LOCATE('|',de_121_167_CADENA)+1));
							
							SET de_047_017 = TRIM((SELECT SUBSTR(de_047_017_CADENA,1,LOCATE('|',de_047_017_CADENA)-1)));
							SET de_047_017_CADENA = (SELECT SUBSTR(de_047_017_CADENA,LOCATE('|',de_047_017_CADENA)+1));

							if length(de_047_017) > 0 then
							
								SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
								SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_name = de_047_017);
							
								set de_122_107 = (select tbl_zipcode_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
								set de_114_014 = (select tbl_city_id from tbl_zipcode where tbl_zipcode_name = de_047_017);
								set de_120_013 = (select tbl_state_id from tbl_city where tbl_city_id = de_114_014);
								set de_122_087 = (select tbl_country_id from tbl_state where tbl_state_id = de_120_013);
								
							else
							
								SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
								SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = de_122_107);
							
							end if;
						 
							insert into tbl_address set 
							tbl_company_id = COMPANY_ID,
							tbl_address_nmcId = USERID_AUX,
							-- tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
							tbl_addresstype_id = 11,
							tbl_address_first = TRIM(de_114_012),
							tbl_address_second = TRIM(de_114_013),
							tbl_address_phoneNumber = null,
							tbl_zipcode_id = TRIM(de_122_107),
							tbl_city_id = TRIM(de_114_014),
							tbl_state_id = TRIM(de_120_013),
							tbl_country_id = TRIM(de_122_087);
								
							SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
								
							INSERT INTO tbl_location SET 
							tbl_company_id = COMPANY_ID,
							tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
							tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
							tbl_location_contactName = COALESCE(USER_NAME,' '), 
							tbl_location_contactEmail = COALESCE(USER_EMAIL,' '), 
							tbl_location_userId = USERID_AUX,
							tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
							tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
							tbl_location_statusId= 7001;
							
							SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);

							INSERT tbl_locationaddress SET
							tbl_location_id = LOCATIONID_AUX, 
							tbl_address_id = ADDRESSID_AUX;
							
							INSERT tbl_phone SET
							tbl_company_id = COMPANY_ID,
							tbl_phone_phoneNumber = de_048_028,
							tbl_phone_extension = de_121_167,
							tbl_phone_country_id = de_122_087,
							tbl_phonetype_id = 4001;
							
							SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);
							
							INSERT INTO tbl_locationphone SET
							tbl_location_id = LOCATIONID_AUX,
							tbl_phone_id = PHONEID_AUX;
							
							if (select count(tbl_location_id) from tbl_location where tbl_location_userId = USERID_AUX) = 1 then
							
								INSERT INTO tbl_hardware_cart (
								tbl_company_id,
								tbl_user_id,
								tbl_location_id,
								tbl_hardware_type_id,
								tbl_hardware_cart_quantity,
								tbl_hardware_cart_delete
								)
								values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,COALESCE(de_117_018,0),0);
								
							end if;
								
								
							INSERT INTO tbl_location_hardware (
							tbl_company_id,
							tbl_user_id,
							tbl_location_id,
							tbl_hardware_type_id,
							tbl_location_hardware_qty,
							tbl_location_hardware_shipped,
							tbl_shipping_status_id) 
							values (COMPANY_ID,USERID_AUX,LOCATIONID_AUX,75001,0,0,73001);
								
								
							
							INSERT INTO tbl_location_schedule (
							tbl_location_id,
							tbl_day_of_the_week,
							tbl_24_hour,
							tbl_closed_flag,
							tbl_hour_open,
							tbl_hour_close) 
							values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');

						end while ;
					
					end if;
					
					
					
					-- ---------------------
					-- Credit Card        --
					-- ---------------------
					
					if LENGTH(de_002_CADENA) >0 then

						SET de_002 = TRIM((SELECT SUBSTR(de_002_CADENA,1,LOCATE('|',de_002_CADENA)-1)));
						SET de_002_CADENA = (SELECT SUBSTR(de_002_CADENA,LOCATE('|',de_002_CADENA)+1));
					
						SET de_118_005 = TRIM((SELECT SUBSTR(de_118_005_CADENA,1,LOCATE('|',de_118_005_CADENA)-1)));
						SET de_118_005_CADENA = (SELECT SUBSTR(de_118_005_CADENA,LOCATE('|',de_118_005_CADENA)+1));

						SET de_120_007 = TRIM((SELECT SUBSTR(de_120_007_CADENA,1,LOCATE('|',de_120_007_CADENA)-1)));
						SET de_120_007_CADENA = (SELECT SUBSTR(de_120_007_CADENA,LOCATE('|',de_120_007_CADENA)+1));
						
						SET de_048_006 = TRIM((SELECT SUBSTR(de_048_006_CADENA,1,LOCATE('|',de_048_006_CADENA)-1)));
						SET de_048_006_CADENA = (SELECT SUBSTR(de_048_006_CADENA,LOCATE('|',de_048_006_CADENA)+1));
				
						SET de_048_002 = TRIM((SELECT SUBSTR(de_048_002_CADENA,1,LOCATE('|',de_048_002_CADENA)-1)));
						SET de_048_002_CADENA = (SELECT SUBSTR(de_048_002_CADENA,LOCATE('|',de_048_002_CADENA)+1));
						
						SET de_048_004 = TRIM((SELECT SUBSTR(de_048_004_CADENA,1,LOCATE('|',de_048_004_CADENA)-1)));
						SET de_048_004_CADENA = (SELECT SUBSTR(de_048_004_CADENA,LOCATE('|',de_048_004_CADENA)+1));
				
						SET de_122_126 = TRIM((SELECT SUBSTR(de_122_126_CADENA,1,LOCATE('|',de_122_126_CADENA)-1)));
						SET de_122_126_CADENA = (SELECT SUBSTR(de_122_126_CADENA,LOCATE('|',de_122_126_CADENA)+1));
						
						SET de_121_005 = TRIM((SELECT SUBSTR(de_121_005_CADENA,1,LOCATE('|',de_121_005_CADENA)-1)));
						SET de_121_005_CADENA = (SELECT SUBSTR(de_121_005_CADENA,LOCATE('|',de_121_005_CADENA)+1));
						
				
						SET de_048_015 = de_002;
					
						insert into dbcards.tbl_carduser set
						tbl_user_nmcId = USERID_AUX,
						tbl_card_tocken = de_048_015,
						tbl_paymentnaturetype_id = 35001,
						tbl_carduser_referenceNumber = de_122_126,
						tbl_carduser_date = de_121_005;
						
						insert into dbcards.tbl_card set
						tbl_user_id = USERID_AUX,
						tbl_card_tocken = de_048_015,
						tbl_card_number = SUBSTRING(de_002, -4),
						tbl_card_dateAdded = NOW(),
						tbl_card_datemodified = NOW(),
						tbl_cardstype_id = COALESCE(de_120_007,61),
						tbl_cardstatus_id = 51,
						tbl_card_nickname = COALESCE(de_048_006,''),
						tbl_card_chardholderName = COALESCE(de_048_002,''),		
						tbl_card_routingNumber = '',
						tbl_card_issuingBank = '',
						tbl_accounttype_id = null,
						tbl_bankaccounttype_id = null,	
						tbl_card_dateExpire = COALESCE(de_118_005,''),
						tbl_card_swift_iban_code = COALESCE(de_048_004,''),	
						tbl_country_id = null,
						tbl_zipcode = null,
						tbl_debitaccounttype_id = null,
						tbl_address_id = null,
						tbl_paymentserviceprovider_id = null;
						
					end if;
					
					
					
					-- ---------------------
					-- Category User      --
					-- ---------------------
					
					if LENGTH(de_114_093_CADENA) >0 then

						while (LENGTH(de_114_093_CADENA)>0) DO
					
							SET de_114_093 = TRIM((SELECT SUBSTR(de_114_093_CADENA,1,LOCATE('|',de_114_093_CADENA)-1)));
							SET de_114_093_CADENA = (SELECT SUBSTR(de_114_093_CADENA,LOCATE('|',de_114_093_CADENA)+1));
							
							if (select tbl_businesscategory_id 
								from dbuser.tbl_merchantbusinesscategory 
								where tbl_merchant_nmcId = USERID_AUX 
								and tbl_businesscategory_id = de_114_093
								limit 1) is null then 
								
								insert into dbuser.tbl_merchantbusinesscategory set
								tbl_company_id = COMPANY_ID,
								tbl_merchant_nmcId = USERID_AUX,
								tbl_businesscategory_id = de_114_093;
								
							end if;
						
						end while;
						
					end if;
					
					delete from dbuser.tbl_merchantbusinesscategory
					where tbl_businesscategory_id in (select tbl_category_id 
																			from dbitems.tbl_category 
																			where tbl_category_level < 2 
																			and tbl_category_active = 1 
																			and tbl_category_deleted = 0)
					and tbl_merchant_nmcId in (select tbl_user_id 
																 from dbuser.tbl_user 
																 where tbl_user_entity = 25 );
					
					-- ---------------------
					-- CRM Notes          --
					-- ---------------------
					
					if LENGTH(de_124_131_CADENA) >0 then
					
						if (select tbl_crm_note_id from dbuser.tbl_crm_note where tbl_user_id = USERID_AUX limit 1) is not null then 
							delete from dbuser.tbl_crm_note where tbl_user_id = USERID_AUX;
						end if;
				   
						while (LENGTH(de_124_131_CADENA)>0) DO
				   
							SET de_124_131 = TRIM((SELECT SUBSTR(de_124_131_CADENA,1,LOCATE('|',de_124_131_CADENA)-1)));
							SET de_124_131_CADENA = (SELECT SUBSTR(de_124_131_CADENA,LOCATE('|',de_124_131_CADENA)+1));
							
							SET de_124_132 = TRIM((SELECT SUBSTR(de_124_132_CADENA,1,LOCATE('|',de_124_132_CADENA)-1)));
							SET de_124_132_CADENA = (SELECT SUBSTR(de_124_132_CADENA,LOCATE('|',de_124_132_CADENA)+1));
							
							SET de_124_133 = TRIM((SELECT SUBSTR(de_124_133_CADENA,1,LOCATE('|',de_124_133_CADENA)-1)));
							SET de_124_133_CADENA = (SELECT SUBSTR(de_124_133_CADENA,LOCATE('|',de_124_133_CADENA)+1));
							
							SET de_124_134 = TRIM((SELECT SUBSTR(de_124_134_CADENA,1,LOCATE('|',de_124_134_CADENA)-1)));
							SET de_124_134_CADENA = (SELECT SUBSTR(de_124_134_CADENA,LOCATE('|',de_124_134_CADENA)+1));
							
							SET de_124_135 = TRIM((SELECT SUBSTR(de_124_135_CADENA,1,LOCATE('|',de_124_135_CADENA)-1)));
							SET de_124_135_CADENA = (SELECT SUBSTR(de_124_135_CADENA,LOCATE('|',de_124_135_CADENA)+1));
							
							SET de_124_136 = TRIM((SELECT SUBSTR(de_124_136_CADENA,1,LOCATE('|',de_124_136_CADENA)-1)));
							SET de_124_136_CADENA = (SELECT SUBSTR(de_124_136_CADENA,LOCATE('|',de_124_136_CADENA)+1));
							
							SET de_124_137 = TRIM((SELECT SUBSTR(de_124_137_CADENA,1,LOCATE('|',de_124_137_CADENA)-1)));
							SET de_124_137_CADENA = (SELECT SUBSTR(de_124_137_CADENA,LOCATE('|',de_124_137_CADENA)+1));
							
							SET de_124_138 = TRIM((SELECT SUBSTR(de_124_138_CADENA,1,LOCATE('|',de_124_138_CADENA)-1)));
							SET de_124_138_CADENA = (SELECT SUBSTR(de_124_138_CADENA,LOCATE('|',de_124_138_CADENA)+1));
							
							
							case de_124_131 
								when 'G'  then set de_124_131 = 'General';
								when 'FU' then set de_124_131 = 'Follow Up';
								when 'RE' then set de_124_131 = 'Refusal';
								when 'SH' then set de_124_131 = 'Share';
								else set de_124_131 = 'General';
							end case;
							
							insert into dbuser.tbl_crm_note set
							tbl_user_id = USERID_AUX,
							tbl_crm_note_type = de_124_131,
							tbl_crm_note_date = de_124_132,
							tbl_crm_note_comments = CONVERT(unhex(de_124_133) USING UTF8),
							tbl_crm_note_priority_f = if(de_124_134='true',1,0),
							tbl_crm_note_reminder_f = if(de_124_135='true',1,0),
							tbl_crm_note_share_f = if(de_124_136='true',1,0),
							tbl_crm_note_reminder_date = de_124_137,
							tbl_crm_note_username = de_124_138;

						end while;
							
					end if;				
						
						
						
					-- ---------------------
					-- CRM Activities     --
					-- ---------------------
					
					if LENGTH(de_124_141_CADENA) >0 then
					
						if (select tbl_crm_activity_id from dbuser.tbl_crm_activity where tbl_user_id = USERID_AUX limit 1) is not null then 
							delete from dbuser.tbl_crm_activity where tbl_user_id = USERID_AUX;
						end if;
				   
						while (LENGTH(de_124_141_CADENA)>0) DO
				   
							SET de_124_141 = TRIM((SELECT SUBSTR(de_124_141_CADENA,1,LOCATE('|',de_124_141_CADENA)-1)));
							SET de_124_141_CADENA = (SELECT SUBSTR(de_124_141_CADENA,LOCATE('|',de_124_141_CADENA)+1));
							
							SET de_124_142 = TRIM((SELECT SUBSTR(de_124_142_CADENA,1,LOCATE('|',de_124_142_CADENA)-1)));
							SET de_124_142_CADENA = (SELECT SUBSTR(de_124_142_CADENA,LOCATE('|',de_124_142_CADENA)+1));
							
							SET de_124_143 = TRIM((SELECT SUBSTR(de_124_143_CADENA,1,LOCATE('|',de_124_143_CADENA)-1)));
							SET de_124_143_CADENA = (SELECT SUBSTR(de_124_143_CADENA,LOCATE('|',de_124_143_CADENA)+1));
							
							SET de_124_144 = TRIM((SELECT SUBSTR(de_124_144_CADENA,1,LOCATE('|',de_124_144_CADENA)-1)));
							SET de_124_144_CADENA = (SELECT SUBSTR(de_124_144_CADENA,LOCATE('|',de_124_144_CADENA)+1));
					
							
							case de_124_141 
								when 'SL' then set de_124_141 = 'Sales';
								when 'PR' then set de_124_141 = 'Preview';
								when 'CL' then set de_124_141 = 'Close';
								else set de_124_141 = 'Sales';
							end case;
							
							insert into dbuser.tbl_crm_activity set
							tbl_user_id = USERID_AUX,
							tbl_crm_activity_type = de_124_141,
							tbl_crm_activity_date = de_124_142,
							tbl_crm_activity_comments = CONVERT(unhex(de_124_143) USING UTF8),
							tbl_crm_activity_username = de_124_144;

						end while;
							
					end if;			
			
			
					
					-- ---------------------
					-- Client Keys        --
					-- ---------------------

					INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
					values  (md5(CONCAT('Terminal',USERID_AUX)),'Terminal',CURDATE(),1,3,USERID_AUX,0),
							(md5(CONCAT('Module OsCommerce',USERID_AUX)),'Module OsCommerce',CURDATE(),1,5,USERID_AUX,0),
							(md5(CONCAT('Widget',USERID_AUX)),'Widget',CURDATE(),1,5,USERID_AUX,0),
							(md5(CONCAT('WidgetCar',USERID_AUX)),'WidgetCar',CURDATE(),1,5,USERID_AUX,0),
							(md5(CONCAT('Tablet',USERID_AUX)),'Tablet',CURDATE(),1,6,USERID_AUX,0);
					

					
					-- ---------------------
					-- Modules            --
					-- ---------------------

					if (select tbl_module_id from dbitems.tbl_module where tbl_user_id = USERID_AUX limit 1) is null then
					
						INSERT INTO dbitems.tbl_module (`tbl_company_id`, `tbl_user_id`, `tbl_module_title`, `tbl_module_order`, `tbl_module_type_id`, `tbl_module_active_f`, `tbl_module_image`, `tbl_module_price`, `tbl_module_item_limit`) 
						values  (COMPANY_ID, USERID_AUX,'Banner sample 1'	, 1, 2, 1, 'logo_banner.png', NULL, 10),
								(COMPANY_ID, USERID_AUX,'Banner sample 2'	, 2, 2, 1, 'logo_banner.png', NULL, 10),
								(COMPANY_ID, USERID_AUX,'Banner sample 3'	, 3, 2, 1, 'logo_banner.png', NULL, 10),
								(COMPANY_ID, USERID_AUX,'Item list sample 1', 4, 1, 1, NULL				, NULL, 10),
								(COMPANY_ID, USERID_AUX,'Item list sample 2', 5, 1, 1, NULL				, NULL, 10),
								(COMPANY_ID, USERID_AUX,'Box sample 1'		, 6, 3, 1, 'logo_box.png'	, NULL, 10),
								(COMPANY_ID, USERID_AUX,'Box sample 2'		, 7, 3, 1, 'logo_box.png'	, NULL, 10);
					
					end if;
					


					-- ---------------------
					-- Subscription Cart  --
					-- ---------------------

					if de_117_020 > 0 then
						insert into dbitems.tbl_subscriptioncart set 
						tbl_subscription_id = 15,
						tbl_subscriptioncart_user_nmcid = USERID_AUX,
						tbl_subscriptioncart_quantity = de_117_020;
					end if;
					
					if de_117_021 > 0 then
						insert into dbitems.tbl_subscriptioncart set 
						tbl_subscription_id = 16,
						tbl_subscriptioncart_user_nmcid = USERID_AUX,
						tbl_subscriptioncart_quantity = de_117_021;
					end if;
					
					
					
					
					-- ---------------------
					-- Commissions        --
					-- ---------------------

					if ( select tbl_commission_id from dbcommission.tbl_commission where tbl_commission_agent_nmcId = de_053 and (select MONTH(tbl_commission_date)) = (select MONTH(NOW())) limit 1) is null then
					
						insert into dbcommission.tbl_commission set
						tbl_commission_agent_nmcId = de_053,
						tbl_commission_date = NOW(),
						tbl_commission_refNumber = CONCAT('ref-',de_053,''),
						tbl_commission_status_id = 72001;
						
					end if;
					
					
					
					
					-- ---------------------
					-- Payment            --
					-- ---------------------
					
					if LENGTH(de_055_003) >0 then
					
						set de_122_034 = (select tbl_carduser_id from dbcards.tbl_carduser where tbl_card_tocken = de_048_015 and tbl_user_nmcId = USERID_AUX limit 1);
					
						if LENGTH(de_122_034) >0 then 

							SET CARD_TOCKEN = (select tbl_card_tocken from dbcards.tbl_carduser where tbl_carduser_id = de_122_034);
							SET DATE_AUX = NOW();

							if (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) is not null then
							   SET BILLID_AUX = (SELECT tbl_bill_id FROM dbtransaction.tbl_bill ORDER BY tbl_bill_id DESC LIMIT 1) +1;
							else
							   SET BILLID_AUX = 1;
							end if;

							-- --------------- --
							-- Bill            --
							-- --------------- --
							
							insert into dbtransaction.tbl_bill set
							tbl_bill_id = BILLID_AUX,
							tbl_bill_number = 1000000 + BILLID_AUX,
							tbl_bill_merchant_nmcId = USERID_AUX,
							tbl_bill_seller_nmcId = '001', 
							tbl_bill_status = 101,
							tbl_bill_date = DATE_AUX;
							
							-- ------------------ --
							-- Bill Subscription  --
							-- ------------------ --
							
							insert into dbtransaction.tbl_billsubscription (tbl_bill_id,
															  tbl_subscription_id,
															  tbl_billsubscription_quantity,
															  tbl_billsubscription_price,
															  tbl_billsubscription_reseller_nmcId)
							select  BILLID_AUX,
									A.tbl_subscription_id,
									A.tbl_subscriptioncart_quantity,
									B.tbl_subscription_recommended_price,
									null

							from dbitems.tbl_subscriptioncart as A, dbitems.tbl_subscription as B
							where A.tbl_subscriptioncart_user_nmcid = USERID_AUX
							and A.tbl_subscriptioncart_delete = 0
							and A.tbl_subscription_id = B.tbl_subscription_id;
							
							if de_117_018 > 0 then
							
								insert into dbtransaction.tbl_billsubscription set
								tbl_bill_id = BILLID_AUX,
								tbl_hardware_type_id = 75001,
								tbl_billsubscription_quantity = de_117_018,
								tbl_billsubscription_price = 0.00;
								
								insert into dbuser.tbl_shipping set
								tbl_user_id = USERID_AUX,
								tbl_location_id = LOCATIONID_AUX,
								tbl_shipping_dongle_qty = de_117_018,
								tbl_shipping_tablet_qty = 0,
								tbl_shipping_tv_qty = 0,
								tbl_shipping_status_id = 73001,
								tbl_shipping_saleDate = current_date(),
								tbl_shipping_invoiceNumber = BILLID_AUX,
								tbl_shipping_refNumber = 1000000 + BILLID_AUX,
								tbl_shipping_boxes = 0;
								
							end if;
							
							-- ------------------ --
							-- Bil Transaction    --
							-- ------------------ --
							
							insert into dbtransaction.tbl_billtransaction set 
							tbl_bill_id = BILLID_AUX,
							tbl_cardTocken = CARD_TOCKEN,	  	
							tbl_billtransaction_amount = de_055_003,
							tbl_billtransaction_status_id = 75,
							tbl_billtransaction_type_id = 1,
							tbl_billtransaction_date = DATE_AUX;

							
							set de_SB = (select GROUP_CONCAT(CONCAT('',tbl_subscription_id,'|'))
										from dbitems.tbl_subscriptioncart 
										where tbl_subscriptioncart_user_nmcid = USERID_AUX
										and tbl_subscriptioncart_delete = 0
										);
										
							set CADENA_SUBSCRIPTION = REPLACE(de_SB,'|,','|');	
							set CADENA_SUBSCRIPTION_AUX = REPLACE(de_SB,'|,','|');
							
							WHILE (LENGTH(CADENA_SUBSCRIPTION)>0) DO
											
								SET SUBSCRIPTION_AUX = (SELECT SUBSTR(CADENA_SUBSCRIPTION,1,LOCATE('|',CADENA_SUBSCRIPTION)-1));
								SET CADENA_SUBSCRIPTION = (SELECT SUBSTR(CADENA_SUBSCRIPTION,LOCATE('|',CADENA_SUBSCRIPTION)+1));

								set SUBSCRIPTION_QUANTITY = (select tbl_subscriptioncart_quantity from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) and tbl_subscriptioncart_delete = 0 LIMIT 1);

								if (select tbl_subscription_id from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) is null then
							
									insert into dbitems.tbl_usersubscription set
									tbl_company_id = COMPANY_ID,
									tbl_usersubscription_user_nmcid = USERID_AUX,
									tbl_subscription_id = TRIM(SUBSCRIPTION_AUX),
									tbl_usersubscription_date_purchase = DATE_AUX,		  
									tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
									tbl_subscriptionstatus_id = 2401;
									
								else
									
									if (select tbl_usersubscription_date_expiration from dbitems.tbl_usersubscription where tbl_usersubscription_user_nmcid = USERID_AUX and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX) ) > NOW() then
								
										update dbitems.tbl_usersubscription set
										tbl_usersubscription_date_purchase = DATE_AUX,		  
										tbl_usersubscription_date_expiration = DATE_ADD(tbl_usersubscription_date_expiration, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
										tbl_subscriptionstatus_id = 2401
										where tbl_usersubscription_user_nmcid = USERID_AUX
										and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
										
									else
								
										update dbitems.tbl_usersubscription set
										tbl_usersubscription_date_purchase = DATE_AUX,		  
										tbl_usersubscription_date_expiration = DATE_ADD(DATE_AUX, INTERVAL SUBSCRIPTION_QUANTITY MONTH),
										tbl_subscriptionstatus_id = 2401
										where tbl_usersubscription_user_nmcid = USERID_AUX
										and tbl_subscription_id = TRIM(SUBSCRIPTION_AUX);
									
									end if;
									
								end if;
							
							END WHILE;


							-- ------------------------- --
							-- Clean Subscription Cart   --
							-- ------------------------- --

							update dbitems.tbl_subscriptioncart set
							tbl_subscriptioncart_delete = 1
							where tbl_subscriptioncart_user_nmcid = USERID_AUX
							and tbl_subscriptioncart_delete = 0;
							
							update tbl_hardware_cart set 
							tbl_hardware_cart_delete = 1
							where tbl_user_id = de_114_179
							and tbl_hardware_cart_delete = 0;
							
							update dbuser.tbl_merchant set
							tbl_merchant_receivePayment_f = 1
							where tbl_user_id = USERID_AUX;

						end if;
					
					end if;

					
					insert into TBL_MESSAGE1 (CODE,DATA)
					values('39','0000'),('44','Transaction Approved');
				
				else
				
					insert into TBL_MESSAGE1 (CODE,DATA)
					values('39','2067'),('44','Duplicated Company Name');
					
				end if;
				
			-- else 

				-- insert into TBL_MESSAGE1 (CODE,DATA)
				-- values('39','2053'),('44','Email Already Exists');

			-- end if;
			
		end if;
	
    end if;

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCId(USERID_AUX)),'"'),CONCAT(',"123.34":"',CRC_AUX,'"}')) as JSON;
	else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
    end if;
    
	DROP TABLE TBL_MESSAGE1;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantPhoneAddress030400161` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterMerchantPhoneAddress030400161`(IN MSG_IN VARCHAR(20000))
BEGIN











 	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;       
	DECLARE de_120_038 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_120_039 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_114_012 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_114_013 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_122_087 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_120_013 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_114_014 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_122_107 VARCHAR(300) DEFAULT NULL;  

	
	DECLARE _US_PH TEXT DEFAULT NULL; 
	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;
	
	
	DECLARE USER_NAME	VARCHAR(20) DEFAULT NULL;     
	DECLARE USER_EMAIL  VARCHAR(100) DEFAULT NULL;    
	DECLARE PHONEID_AUX		VARCHAR(20) DEFAULT NULL; 
	DECLARE ADDRESSID_AUX	VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;  
	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	SET de_120_038 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.38');
	SET de_120_039 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.39');
	SET de_114_012 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.12');
	SET de_114_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.13');
	SET de_122_087  = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.87');
	SET de_120_013  = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.13');
	SET de_114_014  = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.14');
	SET de_122_107  = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.107');

	SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
		SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

		SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
		SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
		SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
		SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
		
		SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
		SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
		SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
		SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

	SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= de_053 limit 1);
	SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id= de_053 limit 1);





	INSERT INTO tbl_location SET 
    tbl_location_storeNumber= 1 ,
    tbl_location_storeName= 'Main' ,

    tbl_location_contactName = USER_NAME, 
	tbl_location_contactEmail = USER_EMAIL, 
    tbl_location_userId = de_053,
    tbl_location_latitude = coalesce(de_120_038,''),
    tbl_location_longitude= coalesce(de_120_039,''),
    tbl_location_statusId= 7001;
    
    SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);
    
    INSERT tbl_address SET
	tbl_address_nmcId = de_053,
    tbl_address_first = de_114_012,
    tbl_address_second = de_114_013,
    tbl_country_id = de_122_087,
    tbl_state_id = de_120_013,
    tbl_city_id = de_114_014,
    tbl_zipcode_id = 8920,
	tbl_address_phoneNumber = de_048_028,
    tbl_address_name ='Main Address',
    tbl_addresstype_id= 12;
    
    SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);
 
    INSERT tbl_locationaddress SET
    tbl_location_id = LOCATIONID_AUX, 
    tbl_address_id = ADDRESSID_AUX;
 
 delete from tbl_phone where tbl_phone_nmcId  = de_053;
	while (LENGTH(_48_28_CADENA)>0) DO

		SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
		SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

		SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
		SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
					
		SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
		SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));
				   
		SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
		SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

		insert into tbl_phone set
		tbl_phone_nmcId       = de_053,
		tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
		tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
		tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
		tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

	end while ; 

 
    SET PHONEID_AUX= (SELECT last_insert_id() FROM tbl_phone limit 1);
	
	UPDATE tbl_address SET 
	tbl_address_phoneNumber = PHONEID_AUX
	WHERE tbl_address_id= ADDRESSID_AUX;
	
    



	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.47":"',LOCATIONID_AUX,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterMerchantPortal`(IN MSG_IN VARCHAR(20000))
BEGIN

	















	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;



	DECLARE de_39 VARCHAR(4) DEFAULT NULL;

	DECLARE de_44 VARCHAR(25) DEFAULT NULL;

	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	

	
	



	DECLARE de_114_179 VARCHAR(50) DEFAULT NULL;  
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;      


	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_122_091 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  


	DECLARE de_114_131 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL;   
	

	
	

	DECLARE ORIGINAL   VARCHAR(20000) DEFAULT NULL;

	DECLARE AUX VARCHAR(20000) DEFAULT NULL;

    DECLARE AUX1 VARCHAR(20000) DEFAULT NULL;

	

	DECLARE _300_51    TEXT DEFAULT NULL;

	DECLARE _300_62    VARCHAR(500) DEFAULT NULL;

    DECLARE _300_64    VARCHAR(500) DEFAULT NULL;

	DECLARE _300_65    VARCHAR(500) DEFAULT NULL;

    DECLARE _300_66    VARCHAR(500) DEFAULT NULL;

	DECLARE de_121_045 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_122_087 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_120_013 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_122_107 INTEGER(11) DEFAULT NULL;  
	

	
	

	DECLARE _300_28 	TEXT DEFAULT NULL;

	DECLARE _122_88 	VARCHAR(500) DEFAULT NULL; 	
    DECLARE _122_88_a 	VARCHAR(500) DEFAULT NULL;

	DECLARE _48_28 		VARCHAR(500) DEFAULT NULL; 	
    DECLARE _48_28_a 	VARCHAR(500) DEFAULT NULL; 

	DECLARE _122_87P 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_87P_a 	VARCHAR(500) DEFAULT NULL;

	DECLARE _121_167 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_167_a 	VARCHAR(500) DEFAULT NULL; 

	DECLARE _121_62 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_62_a 	VARCHAR(500) DEFAULT NULL; 

	

	
	

	DECLARE _300_27 	TEXT DEFAULT NULL;

	DECLARE _122_18 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_18a 	VARCHAR(500) DEFAULT NULL; 	

	

	
	

	DECLARE PHONEID_AUX		 VARCHAR(20) DEFAULT NULL;       	

	DECLARE INDICATIVE_AUX	 VARCHAR(20) DEFAULT NULL;       	

	DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL; 

	

	DECLARE _300_75 	TEXT DEFAULT NULL;

	DECLARE _114_75ec  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _114_75eca  VARCHAR(300) DEFAULT NULL;  
	DECLARE _121_150  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _121_150a  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _122_181  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _122_181a 	VARCHAR(300) DEFAULT NULL;  
	DECLARE _114_7  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _114_7a  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _300_84 	VARCHAR(300) DEFAULT NULL;  
	DECLARE _300_84a	VARCHAR(300) DEFAULT NULL;  
	

	
	

	DECLARE ORIGINAL2 VARCHAR(20000) DEFAULT NULL;

	DECLARE AUX2 VARCHAR(20000) DEFAULT NULL;



	DECLARE _300_5 	TEXT DEFAULT NULL;

	DECLARE _300_20 TEXT DEFAULT NULL;

	DECLARE _300_21 TEXT DEFAULT NULL;

	

	DECLARE _122_120m  	VARCHAR(300) DEFAULT NULL;

	DECLARE _122_121m  	VARCHAR(300) DEFAULT NULL;

	DECLARE _114_7m  	VARCHAR(300) DEFAULT NULL;

	DECLARE _300_84m  	VARCHAR(300) DEFAULT NULL;

	

	DECLARE _122_120ma  VARCHAR(300) DEFAULT NULL;

	DECLARE _122_121ma  VARCHAR(300) DEFAULT NULL;

	DECLARE _114_7ma  	VARCHAR(300) DEFAULT NULL;

	DECLARE _300_84ma  	VARCHAR(300) DEFAULT NULL;

	

	DECLARE PHONEID_AUX2      VARCHAR(20) DEFAULT NULL;       	

	DECLARE INDICATIVE_AUX2	  VARCHAR(20) DEFAULT NULL;       	

	DECLARE PHONE_NUMBER_AUX2 VARCHAR(20) DEFAULT NULL; 

	

	
	

	DECLARE _121_184p  	VARCHAR(300) DEFAULT NULL;

	DECLARE _121_186p  	VARCHAR(300) DEFAULT NULL;

	DECLARE _114_7p  	VARCHAR(300) DEFAULT NULL;

	DECLARE _300_84p  	VARCHAR(300) DEFAULT NULL;

	

	DECLARE _121_184pa  VARCHAR(300) DEFAULT NULL;

	DECLARE _121_186pa  VARCHAR(300) DEFAULT NULL;

	DECLARE _114_7pa 	VARCHAR(300) DEFAULT NULL;

	DECLARE _300_84pa  	VARCHAR(300) DEFAULT NULL;

	

	DECLARE PHONEID_AUX3	  VARCHAR(20) DEFAULT NULL;       	

	DECLARE INDICATIVE_AUX3	  VARCHAR(20) DEFAULT NULL;       	

	DECLARE PHONE_NUMBER_AUX3 VARCHAR(20) DEFAULT NULL; 

	






	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	



		




	

	
	DECLARE exit HANDLER FOR 1292 

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1050

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1064

	BEGIN

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1264

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

	

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	

	
	set flag_validation = FALSE;

	

	IF flag_validation = FALSE THEN






		

		
		

		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');

		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');



		SET de_122_091 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "122.91");

		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');

		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.3");

		SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.4");

		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.5");

		

		SET de_114_131 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.131");

		SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.9");

		

		

		

		
		

		SELECT DATA INTO ORIGINAL FROM TBL_MESSAGE WHERE CODE = "300.51";

		

		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',1) INTO _300_51;

		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',-1) INTO AUX;

		SELECT SUBSTRING_INDEX(AUX,'300.64',1) INTO _300_62;

		SELECT SUBSTRING_INDEX(AUX,'300.64',-1) INTO AUX;

		SELECT SUBSTRING_INDEX(AUX,'300.65',1) INTO _300_64;

		SELECT SUBSTRING_INDEX(AUX,'300.65',-1) INTO AUX;

		SELECT SUBSTRING_INDEX(AUX,'300.66',1) INTO _300_65;

		SELECT SUBSTRING_INDEX(AUX,'114.12',-1) INTO AUX1;

		SELECT SUBSTRING_INDEX(AUX,'114.12',1) INTO _300_66;

		SELECT SUBSTRING_INDEX(_300_66,'300.66',-1) INTO _300_66;

		SELECT SUBSTRING_INDEX(_300_66,'121.45',1) INTO _300_66;



		UPDATE TBL_MESSAGE SET DATA = CONCAT(_300_51,'114.12',AUX1) WHERE CODE = "300.51";

		SELECT DATA INTO _300_51 FROM TBL_MESSAGE WHERE CODE = "300.51";

		INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES

		('300.62',SUBSTRING(_300_62,3,LENGTH(_300_62)-4)),

		('300.64',SUBSTRING(_300_64,3,LENGTH(_300_64)-4)),

		('300.65',SUBSTRING(_300_65,3,LENGTH(_300_65)-4)),

		('300.66',SUBSTRING(_300_66,3,LENGTH(_300_66)-4));



		SELECT DATA INTO _300_62 FROM TBL_MESSAGE WHERE CODE = "300.62";

		SELECT DATA INTO _300_64 FROM TBL_MESSAGE WHERE CODE = "300.64";

		SELECT DATA INTO _300_65 FROM TBL_MESSAGE WHERE CODE = "300.65";

		SELECT DATA INTO _300_66 FROM TBL_MESSAGE WHERE CODE = "300.66";



		SET de_114_012 	= common_schema.get_option(_300_51,"114.12");

		SET de_114_013 	= common_schema.get_option(_300_51,"114.13");

		SET de_121_045 	= common_schema.get_option(_300_51,"121.45");

		SET de_122_087 	= common_schema.get_option(_300_62,"122.87");

		SET de_120_013 	= common_schema.get_option(_300_64,"120.13");

		SET de_114_014 	= common_schema.get_option(_300_65,"114.14");

		SET de_122_107 	= common_schema.get_option(_300_66,"122.107");

		

		
		

		SELECT DATA INTO _300_28 FROM TBL_MESSAGE WHERE CODE = "300.28";

		

		SET _300_28 = REPLACE(_300_28,'{"1','{"_1');

		SET _300_28 = REPLACE(_300_28,',"1',',"_1');

		SET _300_28 = REPLACE(_300_28,'{"4','{"_4');

		SET _300_28 = REPLACE(_300_28,',"4',',"_4');

		

		SET _122_88  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.88'));

		SET _48_28   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));

		SET _121_167 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));

		SET _122_87P = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));

		SET _121_62  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));



		INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES

		('122.88',_122_88),

		('48.28',_48_28), 

		('121.167',_121_167), 

		('122.87',_122_87P),

		('121.62',_121_62);

		

		

		

		
	

		SELECT DATA INTO _300_27 FROM TBL_MESSAGE WHERE CODE = "300.27";

		

		SET _300_27 = REPLACE(_300_27,'{"1','{"_1');

		SET _300_27 = REPLACE(_300_27,',"1',',"_1');

		SET _122_18 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_27,'}'),'//_122.18'));

		



		

		
		

		SELECT DATA INTO _300_75 FROM TBL_MESSAGE WHERE CODE = "300.75";



		SET _300_75 = REPLACE(_300_75,'{"1','{"_1');

		SET _300_75 = REPLACE(_300_75,',"1',',"_1');

		SET _300_75 = REPLACE(_300_75,',"48',',"_48');

		SET _300_75 = REPLACE(_300_75,',"300',',"_300');

		SET _114_75ec = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.75'));

		SET _121_150  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_121.150'));

		SET _122_181  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_122.181'));

		SET _114_7    = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.7'));

		SET _300_84   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_300.84'));



		
				

		SELECT DATA INTO ORIGINAL2 FROM TBL_MESSAGE WHERE CODE = "300.5";

		

		SELECT SUBSTRING_INDEX(ORIGINAL2,'300.20',1) INTO _300_5;

		SELECT SUBSTRING_INDEX(ORIGINAL2,'300.20',-1) INTO AUX2;

		SELECT SUBSTRING_INDEX(AUX2,'300.21',1) INTO _300_20;

		SELECT SUBSTRING_INDEX(AUX2,'300.21',-1) INTO AUX2;

		SELECT SUBSTRING_INDEX(AUX2,'],"114.179":"00000000000"',1) INTO _300_21;

		

		set _300_20 = SUBSTRING(_300_20,4,LENGTH(_300_20)-6);

		set _300_21 = SUBSTRING(_300_21,4);



		SET _300_20 = REPLACE(_300_20,'{"1','{"_1');

		SET _300_20 = REPLACE(_300_20,',"1',',"_1');

		SET _300_20 = REPLACE(_300_20,',"4',',"_4');

		SET _300_20 = REPLACE(_300_20,',"300',',"_300');



		SET _122_120m = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_122.120'));

		SET _122_121m = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_122.121'));

		SET _114_7m   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_114.7'));

		SET _300_84m = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_300.84'));



		

		

		
		

		SET _300_21 = REPLACE(_300_21,'{"1','{"_1');

		SET _300_21 = REPLACE(_300_21,',"1',',"_1');

		SET _300_21 = REPLACE(_300_21,',"4',',"_4');

		SET _300_21 = REPLACE(_300_21,',"300',',"_300');



		SET _121_184p = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_121.184'));

		SET _121_186p = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_121.186'));

		SET _114_7p   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_114.7'));

		SET _300_84p  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_300.84'));



		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;



		

		

		




	



		
	

		update tbl_user set

		tbl_user_userTemp_f     = 0,

		tbl_user_passwordTemp_f = 0,

		tbl_user_dateModified   = NOW(),

		tbl_user_password       = CONVERT(unhex(de_052) using utf8),

		tbl_user_title          = COALESCE(de_122_091, tbl_user_title) ,

		tbl_user_companyName 	= COALESCE(de_114_070, tbl_user_companyName) ,           

		tbl_user_first 			= COALESCE(de_114_003, tbl_user_first),

		tbl_user_middle 		= COALESCE(de_114_004, tbl_user_middle),

		tbl_user_last  			= COALESCE(de_114_005, tbl_user_last)

		where tbl_user_id = de_114_179;

		

		insert into tbl_merchant set

		tbl_user_id                     = de_114_179,

		tbl_merchant_nmcId              = de_114_179,

		tbl_merchant_taxIdNumber        = COALESCE(de_114_131, tbl_merchant_taxIdNumber),

		tbl_merchant_multipleLocation_f = if(de_114_009 = 'true',1,0),

		tbl_merchant_haveWebsite_f      = 0,

		tbl_merchant_haveAccount_f      = 0;

		

		

		

		
		

		insert into tbl_address set

		tbl_address_nmcId   	= de_114_179,

		tbl_address_first 		= COALESCE(de_114_012, tbl_address_first),

		tbl_address_second 		= COALESCE(de_114_013, tbl_address_second),

        tbl_addresstype_id 		= 11,

		tbl_country_id 			= COALESCE(de_122_087, tbl_country_id),

		tbl_state_id 			= COALESCE(de_120_013, tbl_state_id),

		tbl_city_id 			= COALESCE(de_114_014, tbl_city_id),

		tbl_zipcode_id 			= COALESCE(de_122_107, tbl_zipcode_id),

		tbl_address_phoneNumber = 0,

		tbl_address_flag        = 1;

		

		

		

		
		

		while (LENGTH(_122_88)>0) DO



			SET _122_88_a = (SELECT SUBSTR(_122_88,1,LOCATE('|',_122_88)-1));

		    SET _122_88 = (SELECT SUBSTR(_122_88,LOCATE('|',_122_88)+1));



		    SET _122_87P_a = (SELECT SUBSTR(_122_87P,1,LOCATE('|',_122_87P)-1));

		    SET _122_87P = (SELECT SUBSTR(_122_87P,LOCATE('|',_122_87P)+1));



		    SET _48_28_a = (SELECT SUBSTR(_48_28,1,LOCATE('|',_48_28)-1));

		    SET _48_28 = (SELECT SUBSTR(_48_28,LOCATE('|',_48_28)+1));



		    SET _121_167_a = (SELECT SUBSTR(_121_167,1,LOCATE('|',_121_167)-1));

		    SET _121_167 = (SELECT SUBSTR(_121_167,LOCATE('|',_121_167)+1));

		   

		    SET _121_62_a = (SELECT SUBSTR(_121_62,1,LOCATE('|',_121_62)-1));

		    SET _121_62 = (SELECT SUBSTR(_121_62,LOCATE('|',_121_62)+1));



			insert into tbl_phone set

			tbl_phone_nmcId       = de_114_179,

			tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),

			tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),

			tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),

			tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);



	    end while ;

		

		

		

		
		

		while (LENGTH(_122_18)>0) DO



			SET _122_18a = (SELECT SUBSTR(_122_18,1,LOCATE('|',_122_18)-1));

		    SET _122_18 = (SELECT SUBSTR(_122_18,LOCATE('|',_122_18)+1));

			

			insert into tbl_merchantbusinesscategory set

			tbl_merchant_nmcId      = de_114_179,

			tbl_businesscategory_id = _122_18a;

			

		end while ;

		

		

		

		
		

		while (LENGTH(_114_75ec)>0) DO

		

			SET _114_75eca = (SELECT SUBSTR(_114_75ec,1,LOCATE('|',_114_75ec)-1));

			SET _114_75ec  = (SELECT SUBSTR(_114_75ec,LOCATE('|',_114_75ec)+1));

			

			SET _121_150a = (SELECT SUBSTR(_121_150,1,LOCATE('|',_121_150)-1));

			SET _121_150  = (SELECT SUBSTR(_121_150,LOCATE('|',_121_150)+1));

			

			SET _122_181a = (SELECT SUBSTR(_122_181,1,LOCATE('|',_122_181)-1));

			SET _122_181  = (SELECT SUBSTR(_122_181,LOCATE('|',_122_181)+1));

			

			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));

			SET _114_7  = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));

			

			SET _300_84a = (SELECT SUBSTR(_300_84,1,LOCATE('|',_300_84)-1));

			SET _300_84  = (SELECT SUBSTR(_300_84,LOCATE('|',_300_84)+1));



			SET PHONE_NUMBER_AUX = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84a,'}'),'//_48.28'));

			SET INDICATIVE_AUX   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84a,'}'),'//_121.167'));

			

			

	

			insert into tbl_merchantwebsite set

			tbl_merchant_nmcId                    = de_114_179,

			tbl_merchantwebsite_website           = _114_75eca,

			tbl_merchantwebsite_ecommerceProvider = _121_150a,

			tbl_merchantwebsite_ecommerceName     = _122_181a,

			tbl_merchantwebsite_ecommerceMail     = _114_7a,

			tbl_merchantwebsite_ecommercePhone    = 1;

			

			update tbl_merchant set 

			tbl_merchant_haveWebsite_f = 1  

			where tbl_merchant_nmcId = de_114_179;

			

		end while;

		

		

		

		
		

		while (LENGTH(_122_120m)>0) DO

		

			SET _122_120ma = (SELECT SUBSTR(_122_120m,1,LOCATE('|',_122_120m)-1));

			SET _122_120m  = (SELECT SUBSTR(_122_120m,LOCATE('|',_122_120m)+1));

			

			SET _122_121ma = (SELECT SUBSTR(_122_121m,1,LOCATE('|',_122_121m)-1));

			SET _122_121m  = (SELECT SUBSTR(_122_121m,LOCATE('|',_122_121m)+1));



			SET _114_7ma = (SELECT SUBSTR(_114_7m,1,LOCATE('|',_114_7m)-1));

			SET _114_7m  = (SELECT SUBSTR(_114_7m,LOCATE('|',_114_7m)+1));

			

			SET _300_84ma = (SELECT SUBSTR(_300_84m,1,LOCATE('|',_300_84m)-1));

			SET _300_84m  = (SELECT SUBSTR(_300_84m,LOCATE('|',_300_84m)+1));

		

			insert into tbl_merchantaccount set

			tbl_merchant_nmcId 				   = de_114_179,

			tbl_merchantaccount_contacProvider = _122_120ma,

			tbl_merchantaccount_contactName    = _122_121ma,

			tbl_merchantaccount_contactMail    = _114_7ma;

			

			update tbl_merchant set 

			tbl_merchant_haveAccount_f = 1  

			where tbl_merchant_nmcId = de_114_179;

			

		end while;

		

		

		

		
		

		while (LENGTH(_121_184p)>0) DO

		

			SET _121_184pa = (SELECT SUBSTR(_121_184p,1,LOCATE('|',_121_184p)-1));

			SET _121_184p  = (SELECT SUBSTR(_121_184p,LOCATE('|',_121_184p)+1));

			

			SET _121_186pa = (SELECT SUBSTR(_121_186p,1,LOCATE('|',_121_186p)-1));

			SET _121_186p  = (SELECT SUBSTR(_121_186p,LOCATE('|',_121_186p)+1));



			SET _114_7pa = (SELECT SUBSTR(_114_7p,1,LOCATE('|',_114_7p)-1));

			SET _114_7p  = (SELECT SUBSTR(_114_7p,LOCATE('|',_114_7p)+1));

			

			SET _300_84pa = (SELECT SUBSTR(_300_84p,1,LOCATE('|',_300_84p)-1));

			SET _300_84p  = (SELECT SUBSTR(_300_84p,LOCATE('|',_300_84p)+1));

			

			SET PHONE_NUMBER_AUX3 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84pa,'}'),'//_48.28'));

			SET INDICATIVE_AUX3   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84pa,'}'),'//_121.167'));

			

			

			

			insert into tbl_merchantpos set

			tbl_merchant_nmcId 			    = de_114_179,

			tbl_merchantpos_contacProvider  = _121_184pa,

			tbl_merchantpos_contacName      = _121_186pa,

			tbl_merchantpos_contacMail      = _114_7pa,

			tbl_merchantpos_contacPhone     = 1;



			

		end while;

		

		

		

		

		



		

		
		
		
		insert into TBL_MESSAGE (CODE,DATA)

		values('39','0000'),('44','Transaction Approved');

		



	ELSE

	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		

		
		INSERT INTO TBL_MESSAGE(CODE, DATA)

		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	

	END IF;

	

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);

	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

		

	

	
	SELECT 

     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;

	

	


	DROP TABLE TBL_MESSAGE;

 

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantPortal_2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterMerchantPortal_2`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	
	

	DECLARE de_114_179 VARCHAR(50) DEFAULT NULL;  
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;      

	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_122_091 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  

	DECLARE de_114_131 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL;   
	
	
	DECLARE de_300_067 VARCHAR(4000) DEFAULT 0; 		
	DECLARE de_047_042 VARCHAR(45) DEFAULT NULL; 		
	
	
	
	DECLARE ORIGINAL   VARCHAR(20000) DEFAULT NULL;
	DECLARE AUX VARCHAR(20000) DEFAULT NULL;
    DECLARE AUX1 VARCHAR(20000) DEFAULT NULL;
	
	DECLARE _300_51    TEXT DEFAULT NULL;
	DECLARE _300_62    VARCHAR(500) DEFAULT NULL;
    DECLARE _300_64    VARCHAR(500) DEFAULT NULL;
	DECLARE _300_65    VARCHAR(500) DEFAULT NULL;
    DECLARE _300_66    VARCHAR(500) DEFAULT NULL;
	DECLARE de_121_045 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_122_087 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_120_013 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_122_107 INTEGER(11) DEFAULT NULL;  
	
	
	
	DECLARE _300_28 	TEXT DEFAULT NULL;
	DECLARE _122_88 	VARCHAR(500) DEFAULT NULL; 	
    DECLARE _122_88_a 	VARCHAR(500) DEFAULT NULL;
	DECLARE _48_28 		VARCHAR(500) DEFAULT NULL; 	
    DECLARE _48_28_a 	VARCHAR(500) DEFAULT NULL; 
	DECLARE _122_87P 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_87P_a 	VARCHAR(500) DEFAULT NULL;
	DECLARE _121_167 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_167_a 	VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_62 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_62_a 	VARCHAR(500) DEFAULT NULL; 
	
	
	
	DECLARE _300_27 	TEXT DEFAULT NULL;
	DECLARE _122_18 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_18a 	VARCHAR(500) DEFAULT NULL; 	
	
	
	
	DECLARE PHONEID_AUX		 VARCHAR(20) DEFAULT NULL;       	
	DECLARE INDICATIVE_AUX	 VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL; 
	
	DECLARE _300_75 	TEXT DEFAULT NULL;
	DECLARE _114_75ec  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _114_75eca  VARCHAR(300) DEFAULT NULL;  
	DECLARE _121_150  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _121_150a  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _122_181  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _122_181a 	VARCHAR(300) DEFAULT NULL;  
	DECLARE _114_7  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _114_7a  	VARCHAR(300) DEFAULT NULL;  
	DECLARE _300_84 	VARCHAR(300) DEFAULT NULL;  
	DECLARE _300_84a	VARCHAR(300) DEFAULT NULL;  
	
	
	
	DECLARE ORIGINAL2 VARCHAR(20000) DEFAULT NULL;
	DECLARE AUX2 VARCHAR(20000) DEFAULT NULL;

	DECLARE _300_5 	TEXT DEFAULT NULL;
	DECLARE _300_20 TEXT DEFAULT NULL;
	DECLARE _300_21 TEXT DEFAULT NULL;
	
	DECLARE _122_120m  	VARCHAR(300) DEFAULT NULL;
	DECLARE _122_121m  	VARCHAR(300) DEFAULT NULL;
	DECLARE _114_7m  	VARCHAR(300) DEFAULT NULL;
	DECLARE _300_84m  	VARCHAR(300) DEFAULT NULL;
	
	DECLARE _122_120ma  VARCHAR(300) DEFAULT NULL;
	DECLARE _122_121ma  VARCHAR(300) DEFAULT NULL;
	DECLARE _114_7ma  	VARCHAR(300) DEFAULT NULL;
	DECLARE _300_84ma  	VARCHAR(300) DEFAULT NULL;
	
	DECLARE PHONEID_AUX2      VARCHAR(20) DEFAULT NULL;       	
	DECLARE INDICATIVE_AUX2	  VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX2 VARCHAR(20) DEFAULT NULL; 
	
	
	
	DECLARE _121_184p  	VARCHAR(300) DEFAULT NULL;
	DECLARE _121_186p  	VARCHAR(300) DEFAULT NULL;
	DECLARE _114_7p  	VARCHAR(300) DEFAULT NULL;
	DECLARE _300_84p  	VARCHAR(300) DEFAULT NULL;
	
	DECLARE _121_184pa  VARCHAR(300) DEFAULT NULL;
	DECLARE _121_186pa  VARCHAR(300) DEFAULT NULL;
	DECLARE _114_7pa 	VARCHAR(300) DEFAULT NULL;
	DECLARE _300_84pa  	VARCHAR(300) DEFAULT NULL;
	
	DECLARE PHONEID_AUX3	  VARCHAR(20) DEFAULT NULL;       	
	DECLARE INDICATIVE_AUX3	  VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX3 VARCHAR(20) DEFAULT NULL; 
	




	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	

		



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	
	IF flag_validation = FALSE THEN




		
		
		
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');

		SET de_122_091 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "122.91");
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.3");
		SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.4");
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.5");
		
		SET de_114_131 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.131");
		SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.9");
		
		
		SET de_300_067 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.67');
		SET de_047_042 = common_schema.get_option( de_300_067, "47.42" );
		
		
		
		SELECT DATA INTO ORIGINAL FROM TBL_MESSAGE WHERE CODE = "300.51";
		
		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',1) INTO _300_51;
		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.64',1) INTO _300_62;
		SELECT SUBSTRING_INDEX(AUX,'300.64',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.65',1) INTO _300_64;
		SELECT SUBSTRING_INDEX(AUX,'300.65',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.66',1) INTO _300_65;
		SELECT SUBSTRING_INDEX(AUX,'114.12',-1) INTO AUX1;
		SELECT SUBSTRING_INDEX(AUX,'114.12',1) INTO _300_66;
		SELECT SUBSTRING_INDEX(_300_66,'300.66',-1) INTO _300_66;
		SELECT SUBSTRING_INDEX(_300_66,'121.45',1) INTO _300_66;

		UPDATE TBL_MESSAGE SET DATA = CONCAT(_300_51,'114.12',AUX1) WHERE CODE = "300.51";
		SELECT DATA INTO _300_51 FROM TBL_MESSAGE WHERE CODE = "300.51";
		INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES
		('300.62',SUBSTRING(_300_62,3,LENGTH(_300_62)-4)),
		('300.64',SUBSTRING(_300_64,3,LENGTH(_300_64)-4)),
		('300.65',SUBSTRING(_300_65,3,LENGTH(_300_65)-4)),
		('300.66',SUBSTRING(_300_66,3,LENGTH(_300_66)-4));

		SELECT DATA INTO _300_62 FROM TBL_MESSAGE WHERE CODE = "300.62";
		SELECT DATA INTO _300_64 FROM TBL_MESSAGE WHERE CODE = "300.64";
		SELECT DATA INTO _300_65 FROM TBL_MESSAGE WHERE CODE = "300.65";
		SELECT DATA INTO _300_66 FROM TBL_MESSAGE WHERE CODE = "300.66";

		SET de_114_012 	= common_schema.get_option(_300_51,"114.12");
		SET de_114_013 	= common_schema.get_option(_300_51,"114.13");
		SET de_121_045 	= common_schema.get_option(_300_51,"121.45");
		SET de_122_087 	= common_schema.get_option(_300_62,"122.87");
		SET de_120_013 	= common_schema.get_option(_300_64,"120.13");
		SET de_114_014 	= common_schema.get_option(_300_65,"114.14");
		SET de_122_107 	= common_schema.get_option(_300_66,"122.107");
		
		
		
		SELECT DATA INTO _300_28 FROM TBL_MESSAGE WHERE CODE = "300.28";
		
		SET _300_28 = REPLACE(_300_28,'{"1','{"_1');
		SET _300_28 = REPLACE(_300_28,',"1',',"_1');
		SET _300_28 = REPLACE(_300_28,'{"4','{"_4');
		SET _300_28 = REPLACE(_300_28,',"4',',"_4');
		
		SET _122_88  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.88'));
		SET _48_28   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));
		SET _121_167 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));
		SET _122_87P = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));
		SET _121_62  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));

		INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES
		('122.88',_122_88),
		('48.28',_48_28), 
		('121.167',_121_167), 
		('122.87',_122_87P),
		('121.62',_121_62);
		
		
		
		
	
		SELECT DATA INTO _300_27 FROM TBL_MESSAGE WHERE CODE = "300.27";
		
		SET _300_27 = REPLACE(_300_27,'{"1','{"_1');
		SET _300_27 = REPLACE(_300_27,',"1',',"_1');
		SET _122_18 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_27,'}'),'//_122.18'));
		

		
		
		
		SELECT DATA INTO _300_75 FROM TBL_MESSAGE WHERE CODE = "300.75";

		SET _300_75 = REPLACE(_300_75,'{"1','{"_1');
		SET _300_75 = REPLACE(_300_75,',"1',',"_1');
		SET _300_75 = REPLACE(_300_75,',"48',',"_48');
		SET _300_75 = REPLACE(_300_75,',"300',',"_300');
		SET _114_75ec = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.75'));
		SET _121_150  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_121.150'));
		SET _122_181  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_122.181'));
		SET _114_7    = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_114.7'));
		SET _300_84   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_75,'}'),'//_300.84'));

		
				
		SELECT DATA INTO ORIGINAL2 FROM TBL_MESSAGE WHERE CODE = "300.5";
		
		SELECT SUBSTRING_INDEX(ORIGINAL2,'300.20',1) INTO _300_5;
		SELECT SUBSTRING_INDEX(ORIGINAL2,'300.20',-1) INTO AUX2;
		SELECT SUBSTRING_INDEX(AUX2,'300.21',1) INTO _300_20;
		SELECT SUBSTRING_INDEX(AUX2,'300.21',-1) INTO AUX2;
		SELECT SUBSTRING_INDEX(AUX2,'],"114.179":"00000000000"',1) INTO _300_21;
		
		set _300_20 = SUBSTRING(_300_20,4,LENGTH(_300_20)-6);
		set _300_21 = SUBSTRING(_300_21,4);

		SET _300_20 = REPLACE(_300_20,'{"1','{"_1');
		SET _300_20 = REPLACE(_300_20,',"1',',"_1');
		SET _300_20 = REPLACE(_300_20,',"4',',"_4');
		SET _300_20 = REPLACE(_300_20,',"300',',"_300');

		SET _122_120m = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_122.120'));
		SET _122_121m = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_122.121'));
		SET _114_7m   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_114.7'));
		SET _300_84m = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_20,'}'),'//_300.84'));

		
		
		
		
		SET _300_21 = REPLACE(_300_21,'{"1','{"_1');
		SET _300_21 = REPLACE(_300_21,',"1',',"_1');
		SET _300_21 = REPLACE(_300_21,',"4',',"_4');
		SET _300_21 = REPLACE(_300_21,',"300',',"_300');

		SET _121_184p = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_121.184'));
		SET _121_186p = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_121.186'));
		SET _114_7p   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_114.7'));
		SET _300_84p  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_21,'}'),'//_300.84'));

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		
		
		



	

		
	
		update tbl_user set
		tbl_user_userTemp_f     = 0,
		tbl_user_passwordTemp_f = 0,
		tbl_user_dateModified   = NOW(),
		tbl_user_password       = COALESCE(md5((CONVERT(unhex(de_052) using utf8))),tbl_user_password),
		tbl_user_title          = COALESCE(de_122_091, tbl_user_title) ,
		tbl_user_companyName 	= COALESCE(de_114_070, tbl_user_companyName) ,           
		tbl_user_first 			= COALESCE(de_114_003, tbl_user_first),
		tbl_user_middle 		= COALESCE(de_114_004, tbl_user_middle),
		tbl_user_last  			= COALESCE(de_114_005, tbl_user_last)
		where tbl_user_id = de_114_179;
		
		insert into tbl_merchant set
		tbl_user_id                     = de_114_179,
		tbl_merchant_nmcId              = de_114_179,
		tbl_merchant_taxIdNumber        = COALESCE(de_114_131, tbl_merchant_taxIdNumber),
		tbl_merchant_multipleLocation_f = if(de_114_009 = 'true',1,0),
		tbl_merchant_haveWebsite_f      = 0,
		tbl_merchant_haveAccount_f      = 0,
		tbl_merchant_logoimage 			= de_047_042;
		
		
		
		
		
		insert into tbl_address set
		tbl_address_nmcId   	= de_114_179,
		tbl_address_first 		= COALESCE(de_114_012, tbl_address_first),
		tbl_address_second 		= COALESCE(de_114_013, tbl_address_second),
        tbl_addresstype_id 		= 11,
		tbl_country_id 			= COALESCE(de_122_087, tbl_country_id),
		tbl_state_id 			= COALESCE(de_120_013, tbl_state_id),
		tbl_city_id 			= COALESCE(de_114_014, tbl_city_id),
		tbl_zipcode_id 			= COALESCE(de_122_107, tbl_zipcode_id),
		tbl_address_phoneNumber = 0,
		tbl_address_flag        = 1;
		
		
		
		
		
		while (LENGTH(_122_88)>0) DO

			SET _122_88_a = (SELECT SUBSTR(_122_88,1,LOCATE('|',_122_88)-1));
		    SET _122_88 = (SELECT SUBSTR(_122_88,LOCATE('|',_122_88)+1));

		    SET _122_87P_a = (SELECT SUBSTR(_122_87P,1,LOCATE('|',_122_87P)-1));
		    SET _122_87P = (SELECT SUBSTR(_122_87P,LOCATE('|',_122_87P)+1));

		    SET _48_28_a = (SELECT SUBSTR(_48_28,1,LOCATE('|',_48_28)-1));
		    SET _48_28 = (SELECT SUBSTR(_48_28,LOCATE('|',_48_28)+1));

		    SET _121_167_a = (SELECT SUBSTR(_121_167,1,LOCATE('|',_121_167)-1));
		    SET _121_167 = (SELECT SUBSTR(_121_167,LOCATE('|',_121_167)+1));
		   
		    SET _121_62_a = (SELECT SUBSTR(_121_62,1,LOCATE('|',_121_62)-1));
		    SET _121_62 = (SELECT SUBSTR(_121_62,LOCATE('|',_121_62)+1));

			insert into tbl_phone set
			tbl_phone_nmcId       = de_114_179,
			tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
			tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
			tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
			tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

	    end while ;
		
		
		
		
		
		while (LENGTH(_122_18)>0) DO

			SET _122_18a = (SELECT SUBSTR(_122_18,1,LOCATE('|',_122_18)-1));
		    SET _122_18 = (SELECT SUBSTR(_122_18,LOCATE('|',_122_18)+1));
			
			insert into tbl_merchantbusinesscategory set
			tbl_merchant_nmcId      = de_114_179,
			tbl_businesscategory_id = _122_18a;
			
		end while ;
		
		
		
		
		
		while (LENGTH(_114_75ec)>0) DO
		
			SET _114_75eca = (SELECT SUBSTR(_114_75ec,1,LOCATE('|',_114_75ec)-1));
			SET _114_75ec  = (SELECT SUBSTR(_114_75ec,LOCATE('|',_114_75ec)+1));
			
			SET _121_150a = (SELECT SUBSTR(_121_150,1,LOCATE('|',_121_150)-1));
			SET _121_150  = (SELECT SUBSTR(_121_150,LOCATE('|',_121_150)+1));
			
			SET _122_181a = (SELECT SUBSTR(_122_181,1,LOCATE('|',_122_181)-1));
			SET _122_181  = (SELECT SUBSTR(_122_181,LOCATE('|',_122_181)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7  = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
			
			SET _300_84a = (SELECT SUBSTR(_300_84,1,LOCATE('|',_300_84)-1));
			SET _300_84  = (SELECT SUBSTR(_300_84,LOCATE('|',_300_84)+1));

			SET PHONE_NUMBER_AUX = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84a,'}'),'//_48.28'));
			SET INDICATIVE_AUX   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84a,'}'),'//_121.167'));
			
			
	
			insert into tbl_merchantwebsite set
			tbl_merchant_nmcId                    = de_114_179,
			tbl_merchantwebsite_website           = _114_75eca,
			tbl_merchantwebsite_ecommerceProvider = _121_150a,
			tbl_merchantwebsite_ecommerceName     = _122_181a,
			tbl_merchantwebsite_ecommerceMail     = _114_7a,
			tbl_merchantwebsite_ecommercePhone    = 1;
			
			update tbl_merchant set 
			tbl_merchant_haveWebsite_f = 1  
			where tbl_merchant_nmcId = de_114_179;
			
		end while;
		
		
		
		
		
		while (LENGTH(_122_120m)>0) DO
		
			SET _122_120ma = (SELECT SUBSTR(_122_120m,1,LOCATE('|',_122_120m)-1));
			SET _122_120m  = (SELECT SUBSTR(_122_120m,LOCATE('|',_122_120m)+1));
			
			SET _122_121ma = (SELECT SUBSTR(_122_121m,1,LOCATE('|',_122_121m)-1));
			SET _122_121m  = (SELECT SUBSTR(_122_121m,LOCATE('|',_122_121m)+1));

			SET _114_7ma = (SELECT SUBSTR(_114_7m,1,LOCATE('|',_114_7m)-1));
			SET _114_7m  = (SELECT SUBSTR(_114_7m,LOCATE('|',_114_7m)+1));
			
			SET _300_84ma = (SELECT SUBSTR(_300_84m,1,LOCATE('|',_300_84m)-1));
			SET _300_84m  = (SELECT SUBSTR(_300_84m,LOCATE('|',_300_84m)+1));
		
			insert into tbl_merchantaccount set
			tbl_merchant_nmcId 				   = de_114_179,
			tbl_merchantaccount_contacProvider = _122_120ma,
			tbl_merchantaccount_contactName    = _122_121ma,
			tbl_merchantaccount_contactMail    = _114_7ma;
			
			update tbl_merchant set 
			tbl_merchant_haveAccount_f = 1  
			where tbl_merchant_nmcId = de_114_179;
			
		end while;
		
		
		
		
		
		while (LENGTH(_121_184p)>0) DO
		
			SET _121_184pa = (SELECT SUBSTR(_121_184p,1,LOCATE('|',_121_184p)-1));
			SET _121_184p  = (SELECT SUBSTR(_121_184p,LOCATE('|',_121_184p)+1));
			
			SET _121_186pa = (SELECT SUBSTR(_121_186p,1,LOCATE('|',_121_186p)-1));
			SET _121_186p  = (SELECT SUBSTR(_121_186p,LOCATE('|',_121_186p)+1));

			SET _114_7pa = (SELECT SUBSTR(_114_7p,1,LOCATE('|',_114_7p)-1));
			SET _114_7p  = (SELECT SUBSTR(_114_7p,LOCATE('|',_114_7p)+1));
			
			SET _300_84pa = (SELECT SUBSTR(_300_84p,1,LOCATE('|',_300_84p)-1));
			SET _300_84p  = (SELECT SUBSTR(_300_84p,LOCATE('|',_300_84p)+1));
			
			SET PHONE_NUMBER_AUX3 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84pa,'}'),'//_48.28'));
			SET INDICATIVE_AUX3   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_84pa,'}'),'//_121.167'));
			
			
			
			insert into tbl_merchantpos set
			tbl_merchant_nmcId 			    = de_114_179,
			tbl_merchantpos_contacProvider  = _121_184pa,
			tbl_merchantpos_contacName      = _121_186pa,
			tbl_merchantpos_contacMail      = _114_7pa,
			tbl_merchantpos_contacPhone     = 1;

			
		end while;
		
		
		
		
		

		
		
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
		
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantPosInfo030400152` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterMerchantPosInfo030400152`(IN MSG_IN VARCHAR(20000))
BEGIN
	










	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_053 VARCHAR(20) DEFAULT 0; 				
	DECLARE _DS_PS TEXT DEFAULT NULL;					
	
	DECLARE de_121_184 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_121_184_a TEXT DEFAULT 0;  		    	
	
	DECLARE de_121_186 VARCHAR(45) DEFAULT 0;  		    
	DECLARE de_121_186_a TEXT DEFAULT 0;  		   		 
	
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT 0;  		
	DECLARE de_114_007_a TEXT DEFAULT 0;  				
	
	
	DECLARE DS_PH VARCHAR(5000) DEFAULT 0;  			
	DECLARE DS_PH_a VARCHAR(5000) DEFAULT 0;  			
	DECLARE de_114_047 VARCHAR(30) DEFAULT NULL;  		
	DECLARE de_048_028 VARCHAR(30) DEFAULT 0;  			
	DECLARE de_121_167 VARCHAR(15) DEFAULT 0;  			
	DECLARE de_122_87P VARCHAR(15) DEFAULT 0;  			



 
	DECLARE POSID_AUX VARCHAR(15) DEFAULT NULL;
	
	DECLARE PHONEID_AUX VARCHAR(15) DEFAULT NULL;
	DECLARE INDICATIVE_AUX VARCHAR(20) DEFAULT NULL;       	
	DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL;  
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_120_097 VARCHAR(15) DEFAULT NULL;



	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
		
		
		SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.47');
		
		SELECT DATA INTO _DS_PS FROM TBL_MESSAGE1 WHERE CODE = "PS";
		SET _DS_PS = (SELECT CONVERT(unhex(_DS_PS) USING utf8 ));
		
		SET _DS_PS = REPLACE(_DS_PS,'{"1','{"_1');
		SET _DS_PS = REPLACE(_DS_PS,',"1',',"_1');
		
		SET _DS_PS = REPLACE(_DS_PS,'{"5','{"_5');
		SET _DS_PS = REPLACE(_DS_PS,',"5',',"_5');
		
		SET _DS_PS = REPLACE(_DS_PS,',"48',',"_48');
		SET _DS_PS = REPLACE(_DS_PS,'{"48','{"_48');
		
		SET de_121_184_a = (SELECT common_schema.extract_json_value_nmc(concat('{"_DS_PS":',_DS_PS,'}'),'//_121.184'));
		SET de_121_186_a = (SELECT common_schema.extract_json_value_nmc(concat('{"_DS_PS":',_DS_PS,'}'),'//_121.186'));
		SET de_114_007_a = (SELECT common_schema.extract_json_value_nmc(concat('{"_DS_PS":',_DS_PS,'}'),'//_114.7'));
			
		SET DS_PH = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.60');
		
		
		DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;




		
	if (select de_114_047) is null then 
			set de_114_047=(select tbl_location_id from tbl_location where tbl_location_userid= de_053 limit 1);
	end if;
	
	WHILE (LENGTH(de_121_184_a)>0) DO
	
			SET de_121_184 = (SELECT SUBSTR(de_121_184_a,1,LOCATE('|',de_121_184_a)-1));
			SET de_121_184_a = (SELECT SUBSTR(de_121_184_a,LOCATE('|',de_121_184_a)+1));
			
			SET de_121_186 = (SELECT SUBSTR(de_121_186_a,1,LOCATE('|',de_121_186_a)-1));
			SET de_121_186_a = (SELECT SUBSTR(de_121_186_a,LOCATE('|',de_121_186_a)+1));
			
			SET de_114_007 = (SELECT SUBSTR(de_114_007_a,1,LOCATE('|',de_114_007_a)-1));
			SET de_114_007_a = (SELECT SUBSTR(de_114_007_a,LOCATE('|',de_114_007_a)+1));
			
			
			SET DS_PH_a = (SELECT SUBSTR(DS_PH,1,LOCATE('|',DS_PH)-1)); 
			SET DS_PH = (SELECT SUBSTR(DS_PH,LOCATE('|',DS_PH)+1));

			SET INDICATIVE_AUX = (SELECT SUBSTRING_INDEX(DS_PH_a,';',1) );
			SET PHONE_NUMBER_AUX = (SELECT SUBSTR(DS_PH_a,LOCATE(';',DS_PH_a)+1));
			
	
	
			INSERT INTO tbl_merchantpos SET 
			tbl_merchantpos_contacProvider= de_121_184,
			tbl_merchantpos_contacName=  de_121_186,
			tbl_merchantpos_contacMail = de_114_007, 
			tbl_merchant_nmcId = de_053;
		
			SET POSID_AUX= (SELECT LAST_INSERT_ID() FROM tbl_merchantpos limit 1);
				
			INSERT dbuser.tbl_phone SET
			tbl_phone_phoneNumber = TRIM(PHONE_NUMBER_AUX),
			tbl_phone_extension = '',
			
			tbl_phone_country_id = TRIM(INDICATIVE_AUX),
			tbl_phonetype_id = 4001;
	
			SET PHONEID_AUX= (SELECT LAST_INSERT_ID() FROM tbl_phone limit 1);
				
			INSERT tbl_merchantposphone SET
			tbl_merchantpos_id = POSID_AUX,
			tbl_phone_id = PHONEID_AUX;

			INSERT tbl_locationpos set 
			tbl_location_id = de_114_047,
			tbl_merchantpos_id = POSID_AUX;
	end while;



	
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
				
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	
	
	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterMerchantWizardSignUp030400457` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `RegisterMerchantWizardSignUp030400457`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;	 
	DECLARE de_114_179 VARCHAR(20) DEFAULT NULL;	
    DECLARE de_055_003 VARCHAR(20) DEFAULT NULL;    
    
	DECLARE de_117_021 INT(11) DEFAULT NULL; 
	DECLARE de_117_022 INT(11) DEFAULT NULL; 
    DECLARE de_117_018 INT(11) DEFAULT NULL; 
    DECLARE de_114_009 VARCHAR(5) DEFAULT NULL; 
    DECLARE de_122_034 INT(11) DEFAULT NULL; 	
	DECLARE de_114_115 VARCHAR(45) DEFAULT NULL;   

	DECLARE i INT(4) DEFAULT NULL;
	
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE CRC_AUX VARCHAR(10) DEFAULT NULL; 
	DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX INTEGER(11) DEFAULT NULL;
    DECLARE DATE_AUX DATETIME DEFAULT 0;
    DECLARE CARD_TOCKEN VARCHAR(45) DEFAULT NULL;	
	DECLARE BILLID_AUX INTEGER(11) DEFAULT NULL; 
    
    DECLARE ACCOUNTPAYABLEID_AUX INT(11) DEFAULT 0;
	DECLARE CLASS_AUX VARCHAR(1) DEFAULT 0;
	DECLARE OWNER_AUX VARCHAR(3) DEFAULT 0;
	
	DECLARE de_SB VARCHAR(5000) DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION TEXT DEFAULT NULL;
	DECLARE CADENA_SUBSCRIPTION_AUX TEXT DEFAULT NULL;	
	DECLARE SUBSCRIPTION_AUX VARCHAR(45) DEFAULT NULL;
    DECLARE SUBSCRIPTION_AUX2 VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_TITLE VARCHAR(45) DEFAULT NULL;
	DECLARE SUBSCRIPTION_QUANTITY INT(11) DEFAULT NULL;
	DECLARE RESIDUAL_QUANTITY DECIMAL(15,2) DEFAULT NULL;

    DECLARE PARAMET	VARCHAR(100) DEFAULT NULL;
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	
	

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	SET	de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	
	SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	set de_114_179 = (select right(de_114_179,11));
	
    SET de_055_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '55.3');
    
    SET de_117_021 = (SELECT tbl_merchant_standard_subs FROM tbl_merchant WHERE tbl_user_id = de_114_179);
	SET de_117_022 = (SELECT tbl_merchant_deluxe_subs FROM tbl_merchant WHERE tbl_user_id = de_114_179);
    SET de_117_018 = (SELECT tbl_merchant_dongles_quantity FROM tbl_merchant WHERE tbl_user_id = de_114_179);
    SET de_114_009 = (SELECT tbl_merchant_insurance_f FROM tbl_merchant WHERE tbl_user_id = de_114_179);
    SET de_122_034 = (SELECT tbl_carduser_id FROM dbcards.tbl_carduser WHERE tbl_user_nmcId = de_114_179 and tbl_card_tocken is not null limit 1);
    SET de_114_115 = (SELECT tbl_address_id FROM tbl_address WHERE tbl_address_nmcId = de_114_179 and tbl_addresstype_id = 14);
    
    if de_114_115 is null then
		SET de_114_115 = (SELECT tbl_address_id FROM tbl_address WHERE tbl_address_nmcId = de_114_179 and tbl_addresstype_id = 11);
    end if;
    
    SET USERID_AUX = de_114_179;
	SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(de_114_179)),10,0));
	SET COMPANY_ID =  (select tbl_company_id from tbl_user where tbl_user_id = de_114_179);
    SET LOCATIONID_AUX = (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179 limit 1); 
    SET CARD_TOCKEN = (select tbl_card_tocken from dbcards.tbl_carduser where tbl_carduser_id = de_122_034);
	SET DATE_AUX = NOW();
    

		-- ---------------------
        -- User and merchant  --
        -- ---------------------
		update tbl_user set
		tbl_user_dateModified = NOW(),
		tbl_userstatus_id = 33,
        tbl_user_userTemp_f = 0
		where tbl_user_id = de_114_179; 
		
		
        -- ------------------------
        -- Delivery options --
        -- ------------------------
        update tbl_user_delivery_options set
        tbl_company_id = COMPANY_ID
		where tbl_user_id = de_114_179;
        

		-- ---------------------
		-- Client Keys        --
		-- ---------------------
		if (select client_name from nmc_control.client_key where user_id = de_114_179 limit 1) is null then
		
			INSERT INTO nmc_control.client_key (`key`, `client_name`, `activation_date`, `owner`, `type`, `user_id`, `test_mode`) 
			values  (md5(CONCAT('Terminal',de_114_179)),'Terminal',CURDATE(),1,3,de_114_179,0),
					(md5(CONCAT('Module OsCommerce',de_114_179)),'Module OsCommerce',CURDATE(),1,5,de_114_179,0),
					(md5(CONCAT('Widget',de_114_179)),'Widget',CURDATE(),1,5,de_114_179,0),
					(md5(CONCAT('WidgetCar',de_114_179)),'WidgetCar',CURDATE(),1,5,de_114_179,0),
					(md5(CONCAT('Tablet',de_114_179)),'Tablet',CURDATE(),1,6,de_114_179,0);
        
		end if;
		
        
        
		-- ---------------------
		-- Modules            --
		-- ---------------------
		if (select tbl_module_id from dbitems.tbl_module where tbl_user_id = de_114_179 limit 1) is null then
		
			INSERT INTO dbitems.tbl_module (`tbl_company_id`,`tbl_user_id`, `tbl_module_title`, `tbl_module_order`, `tbl_module_type_id`, `tbl_module_active_f`, `tbl_module_image`, `tbl_module_price`, `tbl_module_item_limit`) 
			values  (COMPANY_ID, de_114_179,'Banner sample 1'	, 1, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, de_114_179,'Banner sample 2'	, 2, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, de_114_179,'Banner sample 3'	, 3, 2, 1, 'logo_banner.png', NULL, 10),
					(COMPANY_ID, de_114_179,'Item list sample 1', 4, 1, 1, NULL				, NULL, 10),
					(COMPANY_ID, de_114_179,'Item list sample 2', 5, 1, 1, NULL				, NULL, 10),
					(COMPANY_ID, de_114_179,'Box sample 1'		, 6, 3, 1, 'logo_box.png'	, NULL, 10),
					(COMPANY_ID, de_114_179,'Box sample 2'		, 7, 3, 1, 'logo_box.png'	, NULL, 10);
        
		end if;
        
		
		-- ------------------------- --
		-- Clean Subscription Cart   --
		-- ------------------------- --

		update dbitems.tbl_subscriptioncart set
		tbl_subscriptioncart_delete = 1
		where tbl_subscriptioncart_user_nmcid = de_114_179
		and tbl_subscriptioncart_delete = 0;
							
		update tbl_hardware_cart set 
		tbl_hardware_cart_delete = 1
		where tbl_user_id = de_114_179
		and tbl_hardware_cart_delete = 0;
							
		update dbuser.tbl_merchant set
		tbl_merchant_receivePayment_f = 1
		where tbl_user_id = de_114_179;
        
		
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCId(USERID_AUX)),'"'),CONCAT(',"123.34":"',CRC_AUX,'"}')) as JSON;
    else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
    end if;
    
	DROP TABLE TBL_MESSAGE1;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterResellerCompaniesProvider030400184` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterResellerCompaniesProvider030400184`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  
	DECLARE _US_CP 		TEXT DEFAULT NULL;
	DECLARE _114_70 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_70a 	VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE _122_140 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_140a 	VARCHAR(500) DEFAULT NULL; 	 
	
	DECLARE _114_3 		VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_3a 	VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE _114_7 		VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_7a 	VARCHAR(500) DEFAULT NULL; 	
	
	 DECLARE _US_PLa TEXT DEFAULT NULL;  
	 DECLARE _US_PL TEXT DEFAULT NULL; 
	 DECLARE PHONEID_AUX	VARCHAR(20) DEFAULT NULL;       	
	 DECLARE INDICATIVE_AUX VARCHAR(20) DEFAULT NULL;       	
	 DECLARE PHONE_NUMBER_AUX VARCHAR(20) DEFAULT NULL; 



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	SELECT DATA INTO _US_CP FROM TBL_MESSAGE1 WHERE CODE = "CP";
	
	SET _US_CP = (SELECT CONVERT(unhex(_US_CP) USING utf8 ));

	SET _US_CP = REPLACE(_US_CP,'{"1','{"_1');
	SET _US_CP = REPLACE(_US_CP,',"1',',"_1');
	SET _US_CP = REPLACE(_US_CP,',"48',',"_48');
	SELECT DATA INTO _US_PL FROM TBL_MESSAGE1 WHERE CODE = "127.60";
	SET _114_70 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_CP":',_US_CP,'}'),'//_114.70'));
	SET _122_140 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_CP":',_US_CP,'}'),'//_122.140'));
	SET _114_3 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_CP":',_US_CP,'}'),'//_114.3'));
	SET _114_7 = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_CP":',_US_CP,'}'),'//_114.7'));
	
	
	DELETE FROM TBL_MESSAGE1 WHERE CODE IN ('24','25') OR CODE>44;





	delete from tbl_resellercompaniesprovider where tbl_reseller_nmcId= de_053 ;

	update tbl_reseller set tbl_reseller_servicesProvider_f=0  where tbl_reseller_nmcId=de_053;
		WHILE (LENGTH(_114_70)>0) DO
		
			SET _114_70a = (SELECT SUBSTR(_114_70,1,LOCATE('|',_114_70)-1));
			SET _114_70  = (SELECT SUBSTR(_114_70,LOCATE('|',_114_70)+1));

			SET _122_140a = (SELECT SUBSTR(_122_140,1,LOCATE('|',_122_140)-1));
			SET _122_140  = (SELECT SUBSTR(_122_140,LOCATE('|',_122_140)+1));

			SET _114_3a = (SELECT SUBSTR(_114_3,1,LOCATE('|',_114_3)-1));
			SET _114_3  = (SELECT SUBSTR(_114_3,LOCATE('|',_114_3)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7  = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
			
			SET _US_PLa = (SELECT SUBSTR(_US_PL,1,LOCATE('|',_US_PL)-1)); 
			SET _US_PL = (SELECT SUBSTR(_US_PL,LOCATE('|',_US_PL)+1));

			SET INDICATIVE_AUX = (SELECT SUBSTRING_INDEX(_US_PLa,';',1) );
			SET PHONE_NUMBER_AUX = (SELECT SUBSTR(_US_PLa,LOCATE(';',_US_PLa)+1));

			
	
			INSERT dbuser.tbl_phone SET
				tbl_phone_phoneNumber = TRIM(PHONE_NUMBER_AUX),
				tbl_phone_extension = '',
				
				tbl_phone_country_id = TRIM(INDICATIVE_AUX),
				tbl_phonetype_id = 4001;
	
				SET PHONEID_AUX=  LAST_INSERT_ID();
			
			INSERT INTO dbuser.tbl_resellercompaniesprovider set
			tbl_resellercompaniesprovider_companyName= TRIM(_114_70a),
			tbl_resellercompaniesprovider_type= TRIM(_122_140a),
			tbl_resellercompaniesprovider_contactName=TRIM(_114_3a) ,
			tbl_resellercompaniesprovider_contactEmail=TRIM(_114_7a ),
			 tbl_phone_id = PHONEID_AUX,
			tbl_reseller_nmcId= de_053;
			
	update tbl_reseller set tbl_reseller_servicesProvider_f=1  where tbl_reseller_nmcId=de_053;
			
		END WHILE;



	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterResellerPortal_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterResellerPortal_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	
	

	DECLARE de_114_179 VARCHAR(50) DEFAULT NULL;  
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;      

	DECLARE de_114_070 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_122_091 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_003 VARCHAR(60) DEFAULT NULL;  
	DECLARE de_114_004 VARCHAR(60) DEFAULT NULL;  
    DECLARE de_114_005 VARCHAR(60) DEFAULT NULL;  

	DECLARE de_122_106 INTEGER(11) DEFAULT 0;   
	DECLARE de_114_027 VARCHAR(11) DEFAULT 0;   
	DECLARE de_114_009 VARCHAR(11) DEFAULT NULL;   
	
	
	
	
	DECLARE ORIGINAL   VARCHAR(20000) DEFAULT NULL;
	DECLARE AUX VARCHAR(20000) DEFAULT NULL;
    DECLARE AUX1 VARCHAR(20000) DEFAULT NULL;
	
	DECLARE _300_51    TEXT DEFAULT NULL;
	DECLARE _300_62    VARCHAR(500) DEFAULT NULL;
    DECLARE _300_64    VARCHAR(500) DEFAULT NULL;
	DECLARE _300_65    VARCHAR(500) DEFAULT NULL;
    DECLARE _300_66    VARCHAR(500) DEFAULT NULL;
	DECLARE de_121_045 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_012 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_013 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_122_087 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_120_013 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL;  
	DECLARE de_122_107 INTEGER(11) DEFAULT NULL;  
	
	
	
	DECLARE _300_28 	TEXT DEFAULT NULL;
	DECLARE _122_88 	VARCHAR(500) DEFAULT NULL; 	
    DECLARE _122_88_a 	VARCHAR(500) DEFAULT NULL;
	DECLARE _48_28 		VARCHAR(500) DEFAULT NULL; 	
    DECLARE _48_28_a 	VARCHAR(500) DEFAULT NULL; 
	DECLARE _122_87P 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_87P_a 	VARCHAR(500) DEFAULT NULL;
	DECLARE _121_167 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_167_a 	VARCHAR(500) DEFAULT NULL; 
	DECLARE _121_62 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _121_62_a 	VARCHAR(500) DEFAULT NULL; 
	
	
	
	DECLARE _300_27 	TEXT DEFAULT NULL;
	DECLARE _122_18 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_18a 	VARCHAR(500) DEFAULT NULL; 	
	
	
	DECLARE _300_16 	TEXT DEFAULT NULL;
	DECLARE _114_70 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_70a 	VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE _122_140 	VARCHAR(500) DEFAULT NULL; 	
	DECLARE _122_140a 	VARCHAR(500) DEFAULT NULL; 	 
	
	DECLARE _114_3 		VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_3a 	VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE _114_7 		VARCHAR(500) DEFAULT NULL; 	
	DECLARE _114_7a 	VARCHAR(500) DEFAULT NULL; 	
	
	




	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	

		



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = FALSE;
	
	IF flag_validation = FALSE THEN




		
		
		
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');

		SET de_122_091 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "122.91");
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.3");
		SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.4");
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.5");
			
		SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "122.106");
		SET de_114_027 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.27");
		SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = "114.9");
		
		
		
		SELECT DATA INTO ORIGINAL FROM TBL_MESSAGE WHERE CODE = "300.51";
		
		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',1) INTO _300_51;
		SELECT SUBSTRING_INDEX(ORIGINAL,'300.62',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.64',1) INTO _300_62;
		SELECT SUBSTRING_INDEX(AUX,'300.64',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.65',1) INTO _300_64;
		SELECT SUBSTRING_INDEX(AUX,'300.65',-1) INTO AUX;
		SELECT SUBSTRING_INDEX(AUX,'300.66',1) INTO _300_65;
		SELECT SUBSTRING_INDEX(AUX,'114.12',-1) INTO AUX1;
		SELECT SUBSTRING_INDEX(AUX,'114.12',1) INTO _300_66;
		SELECT SUBSTRING_INDEX(_300_66,'300.66',-1) INTO _300_66;
		SELECT SUBSTRING_INDEX(_300_66,'121.45',1) INTO _300_66;

		UPDATE TBL_MESSAGE SET DATA = CONCAT(_300_51,'114.12',AUX1) WHERE CODE = "300.51";
		SELECT DATA INTO _300_51 FROM TBL_MESSAGE WHERE CODE = "300.51";
		INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES
		('300.62',SUBSTRING(_300_62,3,LENGTH(_300_62)-4)),
		('300.64',SUBSTRING(_300_64,3,LENGTH(_300_64)-4)),
		('300.65',SUBSTRING(_300_65,3,LENGTH(_300_65)-4)),
		('300.66',SUBSTRING(_300_66,3,LENGTH(_300_66)-4));

		SELECT DATA INTO _300_62 FROM TBL_MESSAGE WHERE CODE = "300.62";
		SELECT DATA INTO _300_64 FROM TBL_MESSAGE WHERE CODE = "300.64";
		SELECT DATA INTO _300_65 FROM TBL_MESSAGE WHERE CODE = "300.65";
		SELECT DATA INTO _300_66 FROM TBL_MESSAGE WHERE CODE = "300.66";

		SET de_114_012 	= common_schema.get_option(_300_51,"114.12");
		SET de_114_013 	= common_schema.get_option(_300_51,"114.13");
		SET de_121_045 	= common_schema.get_option(_300_51,"121.45");
		SET de_122_087 	= common_schema.get_option(_300_62,"122.87");
		SET de_120_013 	= common_schema.get_option(_300_64,"120.13");
		SET de_114_014 	= common_schema.get_option(_300_65,"114.14");
		SET de_122_107 	= common_schema.get_option(_300_66,"122.107");
		
		
		
		SELECT DATA INTO _300_28 FROM TBL_MESSAGE WHERE CODE = "300.28";
		
		SET _300_28 = REPLACE(_300_28,'{"1','{"_1');
		SET _300_28 = REPLACE(_300_28,',"1',',"_1');
		SET _300_28 = REPLACE(_300_28,'{"4','{"_4');
		SET _300_28 = REPLACE(_300_28,',"4',',"_4');
		
		SET _122_88  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.88'));
		SET _48_28   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));
		SET _121_167 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));
		SET _122_87P = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));
		SET _121_62  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));

	
		
		
	
		SELECT DATA INTO _300_27 FROM TBL_MESSAGE WHERE CODE = "300.27";
		
		SET _300_27 = REPLACE(_300_27,'{"1','{"_1');
		SET _300_27 = REPLACE(_300_27,',"1',',"_1');
		SET _122_18 = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_27,'}'),'//_122.18'));
		

		
		
		
		SELECT DATA INTO _300_16 FROM TBL_MESSAGE WHERE CODE = "300.16";

		SET _300_16 = REPLACE(_300_16,'{"1','{"_1');
		SET _300_16 = REPLACE(_300_16,',"1',',"_1');
		
		SET _300_16   = REPLACE(_300_16,',"300',',"_300');
		SET _114_70   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_114.70'));
		SET _122_140  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_122.140'));
		SET _114_3    = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_114.3'));
		SET _114_7    = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_16,'}'),'//_114.7'));		
		

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		
		
		



	

		
	
		update tbl_user set
		tbl_user_userTemp_f     = 0,
		tbl_user_passwordTemp_f = 0,
		tbl_user_pinCode 		= md5(de_114_027),
		tbl_user_dateModified   = NOW(),
		tbl_user_password       = md5(CONVERT(unhex(de_052) using utf8)),
		tbl_user_title          = COALESCE(de_122_091, tbl_user_title) ,
		tbl_user_companyName 	= COALESCE(de_114_070, tbl_user_companyName) ,           
		tbl_user_first 			= COALESCE(de_114_003, tbl_user_first),
		tbl_user_middle 		= COALESCE(de_114_004, tbl_user_middle),
		tbl_user_last  			= COALESCE(de_114_005, tbl_user_last)
		where tbl_user_id = de_114_179;
		
		update tbl_reseller SET
		tbl_reseller_servicesProvider_f =  if(de_114_009 = 'true',1,0),
		tbl_reseller_clientsNumber	 	= de_122_106,
		tbl_reseller_admin_approval 	= 1
		WHERE tbl_user_id 				= de_114_179  ;
	
		
		
		insert into tbl_address set
		tbl_address_nmcId   	= de_114_179,
		tbl_address_first 		= COALESCE(de_114_012, tbl_address_first),
		tbl_address_second 		= COALESCE(de_114_013, tbl_address_second),
        tbl_addresstype_id 		= 11,
		tbl_country_id 			= COALESCE(de_122_087, tbl_country_id),
		tbl_state_id 			= COALESCE(de_120_013, tbl_state_id),
		tbl_city_id 			= COALESCE(de_114_014, tbl_city_id),
		tbl_zipcode_id 			= COALESCE(de_122_107, tbl_zipcode_id),
		tbl_address_phoneNumber = 0,
		tbl_address_flag        = 1;
		
		
		
		
		delete from tbl_phone where tbl_phone_nmcId = de_114_179;
		while (LENGTH(_122_88)>0) DO

			SET _122_88_a = (SELECT SUBSTR(_122_88,1,LOCATE('|',_122_88)-1));
		    SET _122_88 = (SELECT SUBSTR(_122_88,LOCATE('|',_122_88)+1));

		    SET _122_87P_a = (SELECT SUBSTR(_122_87P,1,LOCATE('|',_122_87P)-1));
		    SET _122_87P = (SELECT SUBSTR(_122_87P,LOCATE('|',_122_87P)+1));

		    SET _48_28_a = (SELECT SUBSTR(_48_28,1,LOCATE('|',_48_28)-1));
		    SET _48_28 = (SELECT SUBSTR(_48_28,LOCATE('|',_48_28)+1));

		    SET _121_167_a = (SELECT SUBSTR(_121_167,1,LOCATE('|',_121_167)-1));
		    SET _121_167 = (SELECT SUBSTR(_121_167,LOCATE('|',_121_167)+1));
		   
		    SET _121_62_a = (SELECT SUBSTR(_121_62,1,LOCATE('|',_121_62)-1));
		    SET _121_62 = (SELECT SUBSTR(_121_62,LOCATE('|',_121_62)+1));

			insert into tbl_phone set
			tbl_phone_nmcId       = de_114_179,
			tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
			tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
			tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
			tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);
		
	    end while ;
		
		
		
		
		
		while (LENGTH(_122_18)>0) DO

			SET _122_18a = (SELECT SUBSTR(_122_18,1,LOCATE('|',_122_18)-1));
		    SET _122_18 = (SELECT SUBSTR(_122_18,LOCATE('|',_122_18)+1));
			
			insert into tbl_resellerbusinesscategory set
			tbl_reseller_nmcId      = de_114_179,
			tbl_businesscategory_id = _122_18a;
			
		end while ;
		
		
	
		
		
		while (LENGTH(_114_70)>0) DO
		
			SET _114_70a = (SELECT SUBSTR(_114_70,1,LOCATE('|',_114_70)-1));
			SET _114_70  = (SELECT SUBSTR(_114_70,LOCATE('|',_114_70)+1));
			
			SET _122_140a = (SELECT SUBSTR(_122_140,1,LOCATE('|',_122_140)-1));
			SET _122_140  = (SELECT SUBSTR(_122_140,LOCATE('|',_122_140)+1));

			SET _114_3a = (SELECT SUBSTR(_114_3,1,LOCATE('|',_114_3)-1));
			SET _114_3  = (SELECT SUBSTR(_114_3,LOCATE('|',_114_3)+1));
			
			SET _114_7a = (SELECT SUBSTR(_114_7,1,LOCATE('|',_114_7)-1));
			SET _114_7  = (SELECT SUBSTR(_114_7,LOCATE('|',_114_7)+1));
		
			
			INSERT INTO dbuser.tbl_resellercompaniesprovider set
			tbl_resellercompaniesprovider_companyName= TRIM(_114_70a),
			tbl_resellercompaniesprovider_type= TRIM(_122_140a),
			tbl_resellercompaniesprovider_contactName=TRIM(_114_3a) ,
			tbl_resellercompaniesprovider_contactEmail=TRIM(_114_7a) ,
			tbl_reseller_nmcId= TRIM(de_114_179);
		end while;
		
	
		
		
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
		
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterTemporalUser030300120` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `RegisterTemporalUser030300120`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;      
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;      
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;     
		
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;  		  
	DECLARE de_055  VARCHAR(2) DEFAULT NULL; 	      
    DECLARE de_056 VARCHAR(3) DEFAULT NULL; 	      
	DECLARE de_127_010 VARCHAR(4) DEFAULT NULL; 	  
	DECLARE de_114_011 INT(20) DEFAULT NULL; 		  
	DECLARE _US_PH TEXT DEFAULT NULL;  				  
	DECLARE de_120_157 TEXT DEFAULT NULL;             
		
	DECLARE de_114_004 VARCHAR(40) DEFAULT NULL; 	  
	DECLARE de_114_091 VARCHAR(40) DEFAULT NULL; 	  
	DECLARE de_114_070 VARCHAR(500) DEFAULT NULL; 	  

	



	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 
	
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;

	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;





	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_055  = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '55');
	SET de_056 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '56');
	SET de_127_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.10');
	SET de_114_011 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.11');
	SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
    
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
	SET de_114_070 = convert(unhex(de_114_070) using utf8);
    
	SET de_120_157 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.157');
	
	SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
	SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

	SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
	SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
	SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
	SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
	
	SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
	SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
	SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
	SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

	if length(de_055) > 0 then
		set de_055 = de_055;
	else
		set de_055 = '10';
    end if;


	IF(select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity = de_055 and tbl_userstatus_id = 37 limit 1) is not null then 

		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','2013'),('44','Temporal User Forgot Password');
	
	ELSE

		if de_055 = '10' then
     
			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity = de_055 limit 1) is not null then
        
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','2053'),('44','Email Already Exists');
                
			else
    
				insert into tbl_user set 
				tbl_user_email = de_114_007,
				tbl_user_first = de_114_003,
				tbl_user_middle = COALESCE(de_114_004,''),
				tbl_user_last = de_114_005,
				tbl_user_title = COALESCE(de_114_091,''),
				tbl_user_companyName = COALESCE(de_114_070,''),
				tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),''),
				tbl_user_parentId = null,
				tbl_user_dateAdded = NOW(),
				tbl_userstatus_id = 37,
                tbl_owner_id = '001',
				tbl_user_dateModified = NOW(),
				tbl_user_entity = COALESCE(de_055 ,'10'),
				tbl_gender_type = COALESCE(de_114_011,'51'),
				tbl_user_class = COALESCE(de_056,'100'),
				tbl_user_pinCode =  1234;
				
                SET USERID_AUX = last_insert_id();
                
				insert into tbl_consumer set
                tbl_user_id = USERID_AUX,
                tbl_consumer_nmcId = USERID_AUX,
                tbl_consumer_facebook_f = 0,
                tbl_consumer_twitter_f = 0,
                tbl_consumer_alertStartingHours = '08:00:00',
                tbl_consumer_alertClosingHours = '20:00:00',
                tbl_consumer_receivePushNotificaton_f = 1,
                tbl_consumer_receiveExpireOffers_f = 1,
                tbl_consumer_deleteExpireOffers_f = 1,
                tbl_consumer_notificationSettings = 1,
                tbl_consumer_priorityNotices_f = 1;
            
				insert into tbl_link set
				tbl_link_user_id = USERID_AUX,
				tbl_link_link = md5(convert(unhex(de_052) using utf8)),
				tbl_link_date = NOW(),
				tbl_link_delete = 0;
            
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
            
            end if;
            
        else

			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and de_055 != '10' limit 1) is not null then

                insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','2053'),('44','Email Already Exists');
                
			else
            
				IF (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070 limit 1) is not null then
					
                    insert into TBL_MESSAGE1 (CODE,DATA)
					values('39','2067'),('44','Duplicated Company Name');
                    
				else 
                
					insert into tbl_user set 
					tbl_user_email = de_114_007,
					tbl_user_first = de_114_003,
					tbl_user_middle = COALESCE(de_114_004,''),
					tbl_user_last = de_114_005,
					tbl_user_title = COALESCE(de_114_091,''),
					tbl_user_companyName = COALESCE(de_114_070,''),
					tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),''),
					tbl_user_parentId = null,
					tbl_user_dateAdded = NOW(),
					tbl_userstatus_id = 37,
					tbl_user_dateModified = NOW(),
					tbl_user_entity = COALESCE(de_055 ,'10'),
					tbl_gender_type = COALESCE(de_114_011,'51'),
					tbl_user_class = COALESCE(de_056,'100'),
					tbl_owner_id = de_127_010,
					tbl_user_pinCode =  1234;
					
					SET USERID_AUX = last_insert_id();
						
					insert into tbl_link set
					tbl_link_user_id = USERID_AUX,
					tbl_link_link = md5(convert(unhex(de_052) using utf8)),
					tbl_link_date = NOW(),
					tbl_link_delete = 0;
					
					if substring(de_055 ,1,1) = '2' then

						update dbuser.tbl_user set 
						tbl_user_crc = LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0)
						where tbl_user_id = USERID_AUX;
								
						insert into tbl_merchant set
						tbl_user_id = USERID_AUX,
						tbl_merchant_nmcId = USERID_AUX,
						tbl_merchant_taxIdNumber = '',
						tbl_merchant_multipleLocation_f = 4801,
						tbl_merchant_multiple_locations_quantity = 0,
						tbl_merchant_haveWebsite_f = 0,
						tbl_merchant_haveAccount_f = 0,
						tbl_merchant_logoimage = '',
						tbl_merchant_online_store = '';

						INSERT INTO tbl_user_delivery_options set
						tbl_user_id = USERID_AUX,
						tbl_delivery_company_price = 0.00,
						tbl_delivery_company_service = 'Pick Up',
						tbl_user_delivery_options_tier = 'Pick Up',
						tbl_delivery_company_tracking_code ='',
						tbl_delivery_company_option = 'Pick Up';
					
					end if;
					
					
					if LENGTH(_48_28_CADENA) >0 then
						
						while (LENGTH(_48_28_CADENA)>0) DO

							SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
							SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

							SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
							SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
								
							SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
							SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

							SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
							SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

							insert into tbl_phone set
							tbl_phone_nmcId       = USERID_AUX,
							tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
							tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
							tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
							tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

						end while ; 
					end if;
					
					

					if substring(de_055 ,1,1) = '3' then

						update dbuser.tbl_user set 
						tbl_userstatus_id = 35
						where tbl_user_id = USERID_AUX;
							
						insert into tbl_reseller set 
						tbl_reseller_nmcId= USERID_AUX,
						tbl_reseller_servicesProvider_f= 0,
						tbl_reseller_clientsNumber=0,
						tbl_user_id = USERID_AUX,
						tbl_reseller_comments=de_120_157,
						tbl_reseller_admin_approval= 0;
							
					end if;
					
					
					if substring(de_055 ,1,1) = '8' then
			
							INSERT INTO dbuser.tbl_advertiser SET
							tbl_advertiser_contactname = CONCAT(de_114_003,' ',de_114_004,' ',de_114_005),
							tbl_usernmcid = USERID_AUX,
							tbl_advertiser_logo = NULL;
                            
					end if;
					
					insert into TBL_MESSAGE1 (CODE,DATA)
					values('39','0000'),('44','Transaction Approved');
				
				END IF;
				
			end if;
		
        end if;
        
	END IF;
		
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',dbuser.GetNMCID(USERID_AUX),'"}')) as JSON;
    else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	end if;
		
	DROP TABLE TBL_MESSAGE1;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterTemporalUserMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterTemporalUserMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;       
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;       
	
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;   
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;   
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_114_123 INTEGER(2) DEFAULT NULL;    





	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
		
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.3');
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.5');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_114_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.123');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if de_114_123 = 01 then 

			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007) is null then
		
				if (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) is not null then
				   SET USERID_AUX = (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) +1;
				else
				   SET USERID_AUX = 1;
				end if;
		
				insert into tbl_user set 
				tbl_user_id = USERID_AUX,
				tbl_user_first = de_114_003, 
				tbl_user_last = de_114_005,
				tbl_user_email = de_114_007,
				
				tbl_user_password = 'nmc45678',
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userType_id = de_114_123,
				tbl_user_pinCode =  1111;
				
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			else 
			
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1015'),('44','Invalid Email');

			end if;
			
		else
		
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid UserType');
			
		end if;
	 
			
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterTemporalUserMobileBEFORE` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterTemporalUserMobileBEFORE`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;       
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;       
	
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;   
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;   
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_114_123 INTEGER(2) DEFAULT NULL;    





	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
		
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.3');
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.5');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_114_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.123');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if de_114_123 = 01 then 

			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007) is null then
		
				if (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) is not null then
				   SET USERID_AUX = (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) +1;
				else
				   SET USERID_AUX = 1;
				end if;
		
				insert into tbl_user set 
				tbl_user_id = USERID_AUX,
				tbl_user_first = de_114_003, 
				tbl_user_last = de_114_005,
				tbl_user_email = de_114_007,
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userType_id = de_114_123,
				tbl_user_pinCode =  md5(1111);
				
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			else 
			
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1015'),('44','Invalid Email');

			end if;
			
		else
		
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid UserType');
			
		end if;
	 
			
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterTemporalUserMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterTemporalUserMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;       
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;       
	
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;   
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;   
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_114_123 INTEGER(2) DEFAULT NULL;    





	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
		
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = false;
	IF flag_validation = FALSE THEN




	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.3');
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.5');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_114_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.123');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if de_114_123 = 01 then 

			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1) is null then
		
				if (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) is not null then
				   SET USERID_AUX = (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) +1;
				else
				   SET USERID_AUX = 1;
				end if;
		
				insert into tbl_user set 
				tbl_user_id = USERID_AUX,
				tbl_user_first = de_114_003, 
				tbl_user_last = de_114_005,
				tbl_user_email = de_114_007,
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userType_id = de_114_123,
				tbl_user_pinCode =  md5(1111);
				
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');
				
			else 
			
				
				
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1015'),('44','Invalid Email');

			end if;
			
		else
		
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid UserType');
			
		end if;
	 
			
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUser020400186` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterUser020400186`(IN MSG_IN VARCHAR(20000))
BEGIN
	







 




	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_052 VARCHAR(32) DEFAULT NULL; 
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_004 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_091 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_051 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_070 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_123 VARCHAR(2) DEFAULT NULL;
	DECLARE de_120_157 TEXT DEFAULT NULL;
	DECLARE _US_PH TEXT DEFAULT NULL;  
	DECLARE de_127_061 INT(20) DEFAULT NULL;		
	DECLARE de_055 VARCHAR(2) DEFAULT '10'; 
    DECLARE de_056 VARCHAR(3) DEFAULT '100'; 





	
	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
		SET de_055 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '55');
		SET de_056 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '56');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
		SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
		SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
		SET de_114_051 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.51');
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
		SET de_114_123 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.123');
		SET de_120_157 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.157');
		SET	de_127_061 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.61'); 
		SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "PH";
		SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

		SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
		SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
		SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
		SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
		
		SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
		SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
		SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
		SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));
		
		





		if (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) is not null then
			SET USERID_AUX = (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) +1;
		else
			SET USERID_AUX = 1;
		end if;

		
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1 ) is not null then 
		

			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','3001'),('44','Invalid Email'),('53','0');
			
		else 
		
			insert into tbl_user set 
			tbl_user_id = USERID_AUX, 
			tbl_user_email = de_114_007,
			tbl_user_first = de_114_003,
			tbl_user_middle = de_114_004,
			tbl_user_last = de_114_005,
			tbl_user_title = de_114_091,
			tbl_user_companyName = de_114_070,
			tbl_user_password = md5(convert(unhex(de_052) using utf8)),
			tbl_user_dateAdded = NOW(),
			tbl_user_dateModified = NOW(),
			tbl_user_entity = de_055,
			tbl_user_class = de_056,
			tbl_user_pay_nmcId = md5(convert(unhex(de_127_061) using utf8)),
			tbl_user_pinCode =  md5(1111);

			if de_055 = '30' then

				while (LENGTH(_48_28_CADENA)>0) DO

					SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
					SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

					SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
					SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
					
					SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
					SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

					
				   
					SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
					SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

					insert into tbl_phone set
					tbl_phone_nmcId       = USERID_AUX,
					tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
					tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

				end while ; 
				
				insert into tbl_reseller set 
				tbl_reseller_nmcId= USERID_AUX,
				tbl_reseller_servicesProvider_f= 0,
				tbl_reseller_clientsNumber=0,
				tbl_user_id = USERID_AUX,
				tbl_reseller_comments=de_120_157,
				tbl_reseller_admin_approval= 0;
				
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('53', LPAD((SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1),11,'0'));
			
			
			ELSE
				insert into tbl_user set 
				tbl_user_id = USERID_AUX, 
				tbl_user_email = de_114_007,
				tbl_user_first = de_114_003,
				tbl_user_middle = de_114_004,
				tbl_user_last = de_114_005,
				tbl_user_companyName = de_114_070,
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_user_entity = de_055,
				tbl_user_class = de_056,
				tbl_user_pay_nmcId = md5(convert(unhex(de_127_061) using utf8)),
				tbl_user_pinCode =  md5(1111);
				
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('53', LPAD((SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1),11,'0'));
			END IF;

		end if;




	
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE1 where CODE = 53);
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.getNMCID(RESULT_53)),'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUser030300042` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `RegisterUser030300042`(IN MSG_IN VARCHAR(20000))
BEGIN


	DECLARE de_53 VARCHAR(20) DEFAULT NULL;	            
	
    
	DECLARE de_122_106 INTEGER(11) DEFAULT 0;    
	DECLARE de_127_072 VARCHAR(11) DEFAULT NULL; 
	
	
	DECLARE de_121_170 TEXT DEFAULT NULL; 
	DECLARE de_114_075 VARCHAR(100) DEFAULT NULL;   
	DECLARE de_123_071 VARCHAR(100) DEFAULT NULL;   
	DECLARE de_127_066 TEXT DEFAULT NULL;  
	
	DECLARE de_127_068 INTEGER(11) DEFAULT 0;  
	DECLARE de_117_013 VARCHAR(11) DEFAULT NULL;        
	DECLARE de_122_089 VARCHAR(11) DEFAULT NULL;        
	DECLARE de_127_070 INT(11) DEFAULT NULL;  		
	DECLARE de_127_071 VARCHAR(99) DEFAULT NULL;  		




	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE ENTITY_AUX INTEGER(2) DEFAULT NULL; 
	DECLARE CLASS_AUX VARCHAR(3) DEFAULT NULL; 

	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;




	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET	de_53 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');

	set USERID_AUX = (select right(de_53,11));
	set ENTITY_AUX = (select substr(de_53,5,2));
    set CLASS_AUX = (select substr(de_53,7,3));

	
	
	SET de_121_170 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.170');
	SET de_114_075 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.75');
	SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');
	SET de_127_066 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.66');
	SET de_127_068 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.68');
	SET de_117_013 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.13');
	SET de_122_089 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.89');
	SET	de_127_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.70'); 
	SET	de_127_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.71'); 

	
	
	SET de_122_106 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.106');
	SET de_127_072 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.72');
		





	

		if ENTITY_AUX = 10 then
		
			if (select tbl_consumer_nmcId from tbl_consumer where tbl_consumer_nmcId = USERID_AUX) is null then
				
				insert into tbl_consumer set
				tbl_consumer_nmcId = USERID_AUX,
				tbl_consumer_facebook_f = 0,
				tbl_consumer_twitter_f = 0,
				tbl_consumer_receivePushNotificaton_f = 0,
				tbl_consumer_receiveExpireOffers_f = 0,
				tbl_consumer_deleteExpireOffers_f = 0,
				tbl_user_id = USERID_AUX;

			end if;

			update tbl_user set 
			tbl_user_userTemp_f = 0,
            tbl_user_information = coalesce(de_127_066,tbl_user_information),
			tbl_user_accept_tips = coalesce(de_127_068,tbl_user_accept_tips),
			tbl_gender_type = 51
			where tbl_user_id = USERID_AUX;
		
		elseif ENTITY_AUX between 20 and 24  then
		
			if (select tbl_merchant_nmcId from tbl_merchant where tbl_merchant_nmcId = USERID_AUX) is null then
			
				insert into tbl_merchant set
				tbl_user_id = USERID_AUX,
				tbl_merchant_nmcId = USERID_AUX,
				tbl_merchant_taxIdNumber = COALESCE(de_123_071, ''),
				tbl_merchant_multipleLocation_f = coalesce(de_117_013,4801),
				tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,0),
				tbl_merchant_haveWebsite_f = 0,
				tbl_merchant_haveAccount_f = 0,
				tbl_merchant_logoimage = COALESCE(de_121_170,''),
				tbl_merchant_online_store = COALESCE(de_114_075,'');
			else		
				update tbl_merchant set 
				tbl_merchant_multipleLocation_f = coalesce(de_117_013,tbl_merchant_multipleLocation_f),
				tbl_merchant_multiple_locations_quantity = coalesce(de_122_089,tbl_merchant_multiple_locations_quantity),
				tbl_merchant_logoimage = COALESCE(de_121_170,tbl_merchant_logoimage),
				tbl_merchant_online_store = COALESCE(de_114_075,tbl_merchant_online_store)
				where tbl_merchant_nmcId = USERID_AUX;
			end if;
		
			update tbl_user set 
			tbl_user_userTemp_f = 0,
			tbl_user_information = coalesce(de_127_066,tbl_user_information,''),
			tbl_user_accept_tips = coalesce(de_127_068,tbl_user_accept_tips,''),
			tbl_company_type = COALESCE(de_127_070,tbl_company_type),
			tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other),
			tbl_gender_type = 51
			where tbl_user_id = USERID_AUX;
            
            if CLASS_AUX = '2C0' then
				
                update tbl_user set 
				tbl_user_userTemp_f = 1
				where tbl_user_id = USERID_AUX;
                
			end if;
            
		elseif ENTITY_AUX = 30 then
		
			if (select tbl_user_id from tbl_reseller where tbl_user_id = USERID_AUX) is null then
				
				insert into tbl_reseller set 
					tbl_reseller_nmcId= USERID_AUX,
					tbl_reseller_admin_approval = 1,
					tbl_reseller_servicesProvider_f =  if(de_127_072 = 'true',1,0),
					tbl_reseller_clientsNumber = COALESCE(de_122_106,0),
                    tbl_reseller_taxNumber = COALESCE(de_123_071,tbl_reseller_taxNumber),
					tbl_user_id = USERID_AUX; 
					 
					update tbl_user set 
					tbl_user_userTemp_f = 0,
					tbl_user_information = coalesce(de_127_066,tbl_user_information),
					tbl_user_accept_tips = coalesce(de_127_068,tbl_user_accept_tips),
					tbl_company_type = COALESCE(de_127_070,tbl_company_type),
					tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other),
                    tbl_agent_type_id = 74001,
					tbl_gender_type = 51
					where tbl_user_id = USERID_AUX;
	
			else
				update tbl_reseller set
				tbl_reseller_admin_approval = 1,
				tbl_reseller_servicesProvider_f =  if(de_127_072 = 'true',1,0),
				tbl_reseller_clientsNumber = COALESCE(de_122_106,tbl_reseller_clientsNumber),
                tbl_reseller_taxNumber = COALESCE(de_123_071,tbl_reseller_taxNumber)
				where tbl_user_id = USERID_AUX;

				update tbl_user set 
				tbl_user_userTemp_f = 0,
				tbl_user_information = coalesce(de_127_066,tbl_user_information),
				tbl_user_accept_tips = coalesce(de_127_068,tbl_user_accept_tips),
				tbl_company_type = COALESCE(de_127_070,tbl_company_type),
				tbl_company_type_other = COALESCE(de_127_071,tbl_company_type_other),
                tbl_agent_type_id = 74001,
				tbl_gender_type = 51
				where tbl_user_id = USERID_AUX;
			end if;


		elseif ENTITY_AUX = 44 then 
			
			if (select tbl_admin_nmcId from tbl_admin where tbl_admin_nmcId = USERID_AUX) is null then
				
				insert into tbl_admin set
				tbl_admin_nmcId = USERID_AUX,
				tbl_user_id = USERID_AUX;
			
			end if;

			update tbl_user set 
			tbl_user_userTemp_f = 0,
			tbl_gender_type = 51
			where tbl_user_id = USERID_AUX;
				
		end if;	
		
		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		
	
		
	
	
		
	
	
	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
	

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',GetNMCID(USERID_AUX),'"}')) as JSON;
	else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;	
	end if;

	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUserMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterUserMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;       
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;       
	DECLARE de_064 INTEGER(4) DEFAULT NULL;        
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_121_127 VARCHAR(16) DEFAULT NULL;   




	
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_password = convert(unhex(de_121_127) using utf8) and tbl_user_userTemp_f = 1) is not null then
		
			set USERID_AUX = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007);

			update tbl_user set 
			tbl_user_password = convert(unhex(de_052) using utf8),
			tbl_user_pinCode =  de_064,
			tbl_user_userTemp_f = 0,
			tbl_user_passwordTemp_f = 0
			where tbl_user_email = de_114_007
			and tbl_user_password = convert(unhex(de_121_127) using utf8);

			insert into tbl_consumer set
			tbl_consumer_nmcId = USERID_AUX,
			tbl_consumer_facebook_f = 0,
			tbl_consumer_twitter_f = 0,
			tbl_consumer_receivePushNotificaton_f = 0,
			tbl_consumer_receiveExpireOffers_f = 0,
			tbl_consumer_deleteExpireOffers_f = 0,
			tbl_user_id = USERID_AUX;
				
			insert into tbl_device set 
		    tbl_device_nickName = '',
		    tbl_device_udid = de_057,
		    tbl_status_id = 1,
		    tbl_devicetype_id = 1,
		    tbl_consumer_nmcId = USERID_AUX;
			
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('53',USERID_AUX);
			
		else
		
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid Data'),('53','0');
			
		end if;

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"')) as JSON;

		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUserMobile030300042` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterUserMobile030300042`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_052 VARCHAR(32) DEFAULT NULL;       
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;       
	DECLARE de_064 INT(8) DEFAULT NULL;        
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_121_127 VARCHAR(16) DEFAULT NULL;   
    DECLARE de_127_10 VARCHAR(4) DEFAULT '0000'; 
    DECLARE de_055 VARCHAR(2) DEFAULT '10'; 
    DECLARE de_056 VARCHAR(3) DEFAULT '100'; 
	DECLARE de_127_061 INT(20) DEFAULT NULL; 



	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;




	

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_055 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '55');
		SET de_056 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '56');
		SET de_127_10 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.10');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');
		SET	de_127_061 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.61'); 




		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(convert(unhex(de_121_127) using utf8)) and tbl_user_userTemp_f = 1) is not null then
		
			set USERID_AUX = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007);

			update tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8)),
			tbl_user_pinCode =  md5(de_064),
			tbl_user_userTemp_f = 0,
            tbl_owner_id = de_127_10,
			tbl_user_entity = de_055,
            tbl_user_class = de_056,
			
			tbl_user_pay_nmcId = de_127_061
			where tbl_user_email = de_114_007
			and tbl_user_password = md5(convert(unhex(de_121_127) using utf8));

			insert into tbl_consumer set
			tbl_consumer_nmcId = USERID_AUX,
			tbl_consumer_facebook_f = 0,
			tbl_consumer_twitter_f = 0,
			tbl_consumer_receivePushNotificaton_f = 0,
			tbl_consumer_receiveExpireOffers_f = 0,
			tbl_consumer_deleteExpireOffers_f = 0,
			tbl_user_id = USERID_AUX;
				
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('53',USERID_AUX);
			
		else
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid Request'),('53','0');
			
		end if;

	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select LPAD(DATA, 11, '0') DATA from TBL_MESSAGE where CODE = 53);


	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',CONCAT(de_127_10,de_055,de_056,RESULT_53),'"}')) as JSON;

		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUserMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterUserMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL;       
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;       
	DECLARE de_064 INTEGER(4) DEFAULT NULL;        
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_121_127 VARCHAR(16) DEFAULT NULL;   




	
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_password = convert(unhex(de_121_127) using utf8) and tbl_user_userTemp_f = 1) is not null then
		
			set USERID_AUX = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007);

			update tbl_user set 
			tbl_user_password = md5(convert(unhex(de_052) using utf8)),
			tbl_user_pinCode =  md5(de_064),
			tbl_user_userTemp_f = 0,
			tbl_user_passwordTemp_f = 0
			where tbl_user_email = de_114_007
			and tbl_user_password = md5(convert(unhex(de_121_127) using utf8));

			insert into tbl_consumer set
			tbl_consumer_nmcId = USERID_AUX,
			tbl_consumer_facebook_f = 0,
			tbl_consumer_twitter_f = 0,
			tbl_consumer_receivePushNotificaton_f = 0,
			tbl_consumer_receiveExpireOffers_f = 0,
			tbl_consumer_deleteExpireOffers_f = 0,
			tbl_user_id = USERID_AUX;
				
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('53',USERID_AUX);
			
		else
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid Data'),('53','0');
			
		end if;

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"')) as JSON;

		
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUserMobile_1_030400042` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterUserMobile_1_030400042`(IN MSG_IN VARCHAR(20000))
BEGIN

	








 






	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;



	DECLARE de_39 VARCHAR(4) DEFAULT NULL;

	DECLARE de_44 VARCHAR(25) DEFAULT NULL;

	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	

	DECLARE de_052 VARCHAR(16) DEFAULT NULL;       
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;       
	DECLARE de_064 INTEGER(4) DEFAULT NULL;        
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;  
	DECLARE de_121_127 VARCHAR(16) DEFAULT NULL;   





	

	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 

	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;






	

	
	DECLARE exit HANDLER FOR 1292 

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1050

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1064

	BEGIN

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1264

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

	

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	

	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);

	

	IF flag_validation = FALSE THEN






	

		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');

		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');

		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');

		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');

		SET de_121_127 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.127');

		

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;






		

		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_password = convert(unhex(de_121_127) using utf8) and tbl_user_userTemp_f = 1) is not null then

		

			set USERID_AUX = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007);



			update tbl_user set 

			tbl_user_password = md5(convert(unhex(de_052) using utf8)),

			tbl_user_pinCode =  md5(de_064),

			tbl_user_userTemp_f = 0,

			tbl_user_passwordTemp_f = 0

			where tbl_user_email = de_114_007

			and tbl_user_password = md5(convert(unhex(de_121_127) using utf8));



			insert into tbl_consumer set

			tbl_consumer_nmcId = USERID_AUX,

			tbl_consumer_facebook_f = 0,

			tbl_consumer_twitter_f = 0,

			tbl_consumer_receivePushNotificaton_f = 0,

			tbl_consumer_receiveExpireOffers_f = 0,

			tbl_consumer_deleteExpireOffers_f = 0,

			tbl_user_id = USERID_AUX;

				

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)

			values('39','0000'),('44','Transaction Approved'),('53',USERID_AUX);

			

		else

			
			
			
			insert into TBL_MESSAGE (CODE,DATA)

			values('39','1015'),('44','Invalid Data'),('53','0');

			

		end if;



	ELSE

	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		

		
		INSERT INTO TBL_MESSAGE(CODE, DATA)

		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	

	END IF;

	

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);

	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);



	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"}')) as JSON;



		

	DROP TABLE TBL_MESSAGE;

 

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUserPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterUserPortal`(IN MSG_IN VARCHAR(20000))
BEGIN

	















	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;



	DECLARE de_39 VARCHAR(4) DEFAULT NULL;

	DECLARE de_44 VARCHAR(25) DEFAULT NULL;

	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	

	DECLARE de_052 VARCHAR(16) DEFAULT NULL; 

	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL; 

	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL; 

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 

	DECLARE de_114_051 VARCHAR(300) DEFAULT NULL; 

	DECLARE de_114_070 VARCHAR(300) DEFAULT NULL; 

	DECLARE de_114_123 VARCHAR(2) DEFAULT NULL; 








	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 

	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_114_179 VARCHAR(45) DEFAULT NULL;

	




	

	
	DECLARE exit HANDLER FOR 1292 

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1050

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1064

	BEGIN

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1264

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

	

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	

	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);

	

	IF flag_validation = FALSE THEN






	

		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');

		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.3');

		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.5');

		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');

		SET de_114_051 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.51');

		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');

		SET de_114_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.123');

		

		

		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;








		if (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) is not null then

			SET USERID_AUX = (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) +1;

		else

			SET USERID_AUX = 1;

		end if;



		

		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1 ) is not null then 

		



			insert into TBL_MESSAGE (CODE,DATA)

			values('39','3001'),('44','Invalid Email'),('114.179','0');

			

		else 

		

			insert into tbl_user set 

			tbl_user_id = USERID_AUX, 

			tbl_user_email = de_114_007,

			tbl_user_first = de_114_003,

			tbl_user_last = de_114_005,

			tbl_user_companyName = de_114_070,

			tbl_user_password = convert(unhex(de_052) using utf8),

			tbl_user_dateAdded = NOW(),

			tbl_user_dateModified = NOW(),

			tbl_userType_id = de_114_123,

			tbl_user_pinCode =  1111;

			

			insert into TBL_MESSAGE (CODE,DATA)

			values('39','0000'),('44','Transaction Approved'),('114.179', LPAD((SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1),11,'0'));



		end if;



	ELSE

	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		

		
		INSERT INTO TBL_MESSAGE(CODE, DATA)

		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	

	END IF;






	

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);

	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	set RESULT_114_179 = (select DATA from TBL_MESSAGE where CODE = 114.179);

	

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"114.179":"',RESULT_114_179,'"}')) as JSON;

	

	

	DROP TABLE TBL_MESSAGE;

 

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RegisterUserPortal_2` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RegisterUserPortal_2`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL; 
	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_004 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_091 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL; 
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_051 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_070 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_114_123 VARCHAR(2) DEFAULT NULL;
	DECLARE de_120_157 TEXT DEFAULT NULL;
	DECLARE _300_28 TEXT DEFAULT NULL;  




	
	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 
	
	
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;
	
	
	
	
	
	
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_179 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	SET flag_validation = FALSE;
	IF flag_validation = FALSE THEN




	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.3');
		SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.4');
		SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.91');
		SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.5');
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_114_051 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.51');
		SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.70');
		SET de_114_123 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.123');
		SET de_120_157 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.157');
		SET _300_28 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.28');
		
		SET _300_28 = REPLACE(_300_28,'{"1','{"_1');
		SET _300_28 = REPLACE(_300_28,',"1',',"_1');
		SET _300_28 = REPLACE(_300_28,'{"4','{"_4');
		SET _300_28 = REPLACE(_300_28,',"4',',"_4');
		
		
		SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_48.28'));
		SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.167'));
		SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_122.87'));
		SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_300":',_300_28,'}'),'//_121.62'));
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		if (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) is not null then
			SET USERID_AUX = (SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1) +1;
		else
			SET USERID_AUX = 1;
		end if;

		
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1 ) is not null then 
		

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','3001'),('44','Invalid Email'),('114.179','0');
			
		else 
		
			IF de_114_123 = '03' THEN
				insert into tbl_user set 
				tbl_user_id = USERID_AUX, 
				tbl_user_email = de_114_007,
				tbl_user_first = de_114_003,
				tbl_user_last = de_114_005,
				tbl_user_middle =  de_114_004,
				tbl_user_title = de_114_091,
				tbl_user_companyName = de_114_070,
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userType_id = de_114_123,
				tbl_user_pinCode =  md5(1111);
				
				
				while (LENGTH(_48_28_CADENA)>0) DO

					SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
					SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));

					SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
					SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
					
					SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
					SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

					
				   
					SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
					SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

					insert into tbl_phone set
					tbl_phone_nmcId       = USERID_AUX,
					tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
					tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);

				end while ; 
				
				INSERT INTO tbl_reseller set 
				tbl_reseller_nmcId= USERID_AUX,
				tbl_reseller_servicesProvider_f= 0,
				tbl_reseller_clientsNumber=0,
				tbl_user_id = USERID_AUX,
				tbl_reseller_comments=de_120_157,
				tbl_reseller_admin_approval= 0;
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('114.179', LPAD((SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1),11,'0'));
			
			
			ELSE
				insert into tbl_user set 
				tbl_user_id = USERID_AUX, 
				tbl_user_email = de_114_007,
				tbl_user_first = de_114_003,
				tbl_user_last = de_114_005,
				tbl_user_middle =  de_114_004,
				tbl_user_companyName = de_114_070,
				tbl_user_password = md5(convert(unhex(de_052) using utf8)),
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userType_id = de_114_123,
				tbl_user_pinCode =  md5(1111);
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'),('114.179', LPAD((SELECT tbl_user_id FROM tbl_user ORDER BY tbl_user_id DESC LIMIT 1),11,'0'));
			END IF;

		end if;

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;




	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_114_179 = (select DATA from TBL_MESSAGE where CODE = 114.179);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"299":{"114.179":"',RESULT_114_179,'"}')) as JSON;
	
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveAddressConsumerByAddressIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RemoveAddressConsumerByAddressIdMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_114_115 INT(11)     DEFAULT 0; 
	DECLARE de_053 INT(18)         DEFAULT 0; 




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;





	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN





	SET de_114_115= (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.115');
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			if(select tbl_consumer_id from tbl_consumer  where tbl_consumer_id = de_053 )is not null then 
			   if(select tbl_address_id from tbl_address  where tbl_address_id = de_114_115  and tbl_address_nmcId = de_053)is not null then 
							
							delete from tbl_address 
							where tbl_address_nmcId = de_053 
							and tbl_address_id = de_114_115;
										
										

							insert into TBL_MESSAGE (CODE,DATA)
							values('39','0000'),('44','Transaction Approved'); 
							
							else 

							insert into TBL_MESSAGE (CODE,DATA)
							values('39','1014'),('44','	Account Not Found ');
				end if;
			end if ;

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18);
	
	END IF;

		set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
		set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
		
	SELECT 
     CONCAT(
          GROUP_CONCAT(
               CONCAT('"39":"',RESULT_39,'"'),
               CONCAT(',"44":"',RESULT_44,'"')
          )
      ) as JSON;
	
	
	
    
    
    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveAddressConsumerByAddressIdMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RemoveAddressConsumerByAddressIdMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_114_115 INT(11)     DEFAULT 0; 
	DECLARE de_053 INT(18)         DEFAULT 0; 




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;





	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN





	SET de_114_115= (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.115');
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		   if(select tbl_address_id from tbl_address  where tbl_address_id = de_114_115  and tbl_address_nmcId = de_053)is not null then 
				
				if (select tbl_address_id from dbtransaction.tbl_invoiceshippingaddress where tbl_address_id = de_114_115 )is null then 
		
					delete from tbl_address 
					where tbl_address_nmcId = de_053 
					and tbl_address_id = de_114_115;

					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Transaction Approved'); 

				else 

					insert into TBL_MESSAGE (CODE,DATA)
					values('39','2037'),('44','This address cannot be deleted because it is in use');
					
				end if;
	
			else 

				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1014'),('44','	Account Not Found ');

			end if;


	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18);
	
	END IF;

		set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
		set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
		
	SELECT 
     CONCAT(
          GROUP_CONCAT(
               CONCAT('"39":"',RESULT_39,'"'),
               CONCAT(',"44":"',RESULT_44,'"')
          )
      ) as JSON;
	
	
	
    
    
    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveAIODevice020400425` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RemoveAIODevice020400425`(IN MSG_IN VARCHAR(20000))
BEGIN

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_122_013 INT(11) DEFAULT NULL; 
	
-- --------------------
-- Declare auxiliary --
-- --------------------	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
-- ---------------
-- Validations  --
-- ---------------
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables  --
-- -----------------

	SET de_122_013 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.13');		
		
-- ---------------		
-- Query of DB  --
-- ---------------	

	delete from dbuser.tbl_aio_device 
	where tbl_aio_device_id = de_122_013;
	
	
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveFavoriteLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RemoveFavoriteLocation`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DECLARE de_114_47 INT(11) DEFAULT NULL; 
	DECLARE de_53     INT(18) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
		SET de_114_47 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');		
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;





		delete from tbl_favorite_location where
		tbl_favorite_location_user_id = de_53 and
		tbl_favorite_location_location_id = de_114_47;
	
		
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveFavoriteLocation040400088` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RemoveFavoriteLocation040400088`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DECLARE de_114_47 INT(11) DEFAULT NULL; 
	DECLARE de_53     VARCHAR(20) DEFAULT NULL; 



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		SET de_114_47 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');		
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_53 = (select right(de_53,11));
		



		delete from tbl_favorite_location where
		tbl_favorite_location_user_id = de_53 and
		tbl_favorite_location_location_id = de_114_47;
	
		
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveFavoriteMerchant` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RemoveFavoriteMerchant`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DECLARE de_127_56 INT(11) DEFAULT NULL; 
	DECLARE de_53     INT(18) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
		SET de_127_56 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.56');		
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			delete from  tbl_merchantfav where
			tbl_consumer_nmcid = de_53 and
			tbl_merchant_nmcid = de_127_56;
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveFavoriteMerchant040400096` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `RemoveFavoriteMerchant040400096`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;


	DECLARE de_127_56 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_53    VARCHAR(20) DEFAULT NULL; 



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		SET de_127_56 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.56');	
		set de_127_56 = (select right(de_127_56,11));
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_53 = (select right(de_53,11));



			delete from  tbl_merchantfav where
			tbl_consumer_nmcid = de_53 and
			tbl_merchant_nmcid = de_127_56;
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `RemoveHardwareTypefromCart020400466` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `RemoveHardwareTypefromCart020400466`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE de_53  VARCHAR(20) DEFAULT NULL;    	
	DECLARE de_127_088 INT(11) DEFAULT NULL; 	
    -- DECLARE de_114_047 INT(11) DEFAULT NULL;   
    
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_53 = (select right(de_53,11));
	SET de_127_088 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.88');
	-- SET de_114_047 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.47');
	
    
    
    
	delete from dbuser.tbl_hardware_cart 
	where tbl_user_id = de_53
   --  and tbl_location_id = de_114_047
	and tbl_hardware_type_id = de_127_088
	and tbl_hardware_cart_delete = 0;




	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
			

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

	
	
	
    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ReplyRating020400277` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ReplyRating020400277`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 	
	DECLARE de_114_179 VARCHAR(20) DEFAULT NULL; 	
	DECLARE de_114_144 INT(11) DEFAULT NULL;    
	DECLARE de_121_080 INT(11) DEFAULT NULL;    
	DECLARE de_122_005 TEXT DEFAULT NULL;    
	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	
	
	DECLARE	CATEGORYAUX INT(11) DEFAULT NULL;




	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_053 = (select right(de_053,11));
		SET de_114_179 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.179');	
		set de_114_179 = (select right(de_114_179,11));
		SET de_114_144 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.144');	
		SET de_121_080 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.80');
		SET de_122_005 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.5');		
		



	IF 	de_114_144 IS NOT NULL THEN


		UPDATE dbitems.tbl_review SET
		tbl_review_reply = de_122_005,
		tbl_review_replier = de_114_179,
		tbl_review_lastModified = NOW(),
		tbl_review_read=1
		WHERE tbl_reviewid = de_121_080;
	
	
	ELSE
	
	
		UPDATE dbuser.tbl_rating_user SET
		tbl_rating_reply = de_122_005,
		tbl_rating_replier = de_114_179,
		tbl_rating_date_last_modified = NOW(),
		tbl_rating_read=1
		WHERE tbl_rating_id = de_121_080;
	

	END IF;

	

		
	SELECT 
     CONCAT(
          GROUP_CONCAT(
               CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}'))) as JSON;
	 

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveDongleVersionUpdates030400547` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`localhost` PROCEDURE `SaveDongleVersionUpdates030400547`(IN MSG_IN VARCHAR(20000))
BEGIN

-- ----------
-- Declare --
-- ----------

	DECLARE de_053 	   VARCHAR(20) DEFAULT NULL;        -- 53 User Id
	
	DECLARE de_117_028 VARCHAR(45) DEFAULT NULL;  		-- 117.28 Dongle version
	DECLARE de_117_029 VARCHAR(45) DEFAULT NULL;  		-- 117.28 Dongle version

	DECLARE de_117_031 VARCHAR(45) DEFAULT NULL;  		-- 117.31 Dongle APK name
	DECLARE de_117_032 VARCHAR(45) DEFAULT NULL;  		-- 117.32 Mobile APK name
	
    DECLARE de_121_046 INTEGER(11) DEFAULT NULL;        -- 121.46 Dongle Size
    
	-- ---------------------	
	-- Auxiliares		  --
	-- ---------------------
	
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- ----------
-- Set     --
-- ----------

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_053 = (select right(de_053,11));

	SET de_117_028 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.28');
	SET de_117_029 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.29');
	
	SET de_117_031 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.31');
	SET de_117_032 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '117.32');
	
    SET de_121_046 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '121.46');

-- ----------
-- Query   --
-- ----------

	update nmc_control.version set
	version_dongle = COALESCE(de_117_028, version_dongle),
    version_mobile = COALESCE(de_117_029, version_mobile)
	where version_id = 1;
	

	insert into nmc_control.version_update set 
	tbl_user_id = de_053,	
	version_dongle = de_117_028,
    version_mobile = de_117_029,
	version_dongle_name = de_117_031,
	version_mobile_name = de_117_032,
    version_dongle_size = de_121_046,
	version_date = NOW();

	
	update nmc_control.parameter set
	value = de_117_031
	where param = 'DONGLE_APK_NAME';
	
	
	update nmc_control.parameter set
	value = de_117_032
	where param = 'MOBILE_APK_NAME';
	
	
	insert into TBL_MESSAGE (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

-- -----------
-- Response --
-- -----------

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	SELECT GROUP_CONCAT( CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}') ) AS JSON; 
	
	DROP TABLE TBL_MESSAGE;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveLanguageMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SaveLanguageMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	









	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	


	DECLARE de_122_045 INT(11) DEFAULT 0; 				
	DECLARE de_053 INT(18) DEFAULT 0; 				





	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;




	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
	set flag_validation = false;
	IF flag_validation = FALSE THEN




		
		SET	de_122_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.45');
		SET	de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			if(select tbl_consumer_nmcId from tbl_languagescreenlock where tbl_consumer_nmcId = de_053) is null then 
					insert into tbl_languagescreenlock set 
					tbl_consumer_nmcId = de_053,
					tbl_language_idApp = de_122_045,
					tbl_language_idWebsite = de_122_045;
			else 
					update tbl_languagescreenlock set 
					tbl_consumer_nmcId = de_053,
					tbl_language_idApp = de_122_045
					where tbl_consumer_nmcId = de_053;
			
			end if ;
			
			
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

			
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),();
	
	END IF;
	

	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
	 SELECT 
     GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
	
	
     
     
	
	
	
    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveLeadToAIO030300669` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SaveLeadToAIO030300669`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  	   
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;  	       -- 52 Password (temporal) 
    
    DECLARE USER_EMAIL VARCHAR(255) DEFAULT NULL;
	DECLARE USER_NAME VARCHAR(255) DEFAULT NULL;
     
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;


	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	
    SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
    
    SET USER_EMAIL = (select tbl_user_email from tbl_user where tbl_user_id = de_053);
    SET USER_NAME = (select CONCAT(tbl_user_first,' ',tbl_user_last) from tbl_user where tbl_user_id= de_053);	
    
    
	update tbl_user set
    tbl_user_entity = 20,
    tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),tbl_user_password),
	tbl_user_dateModified = NOW()
	where tbl_user_id = de_053;
		
	

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
        
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
	GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.7":"',USER_EMAIL,'"'),CONCAT(',"114.53":"',USER_NAME,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveLicenseDataMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SaveLicenseDataMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 INT(18) DEFAULT NULL; 
	DECLARE de_114_193 VARCHAR(45) DEFAULT NULL; 

	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');	
		SET de_114_193 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.193');

	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




	
		insert into tbl_driverlicense set 
		tbl_driverlicense_number = de_114_193,
		tbl_cardsconsumer_nmcId = de_053;

		
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
					

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveMerchantByReseller030400420` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `SaveMerchantByReseller030400420`(IN MSG_IN VARCHAR(20000))
BEGIN


	DECLARE de_053 VARCHAR(20) DEFAULT NULL;
	DECLARE de_114_179 VARCHAR(20) DEFAULT NULL;

	DECLARE de_114_003 VARCHAR(40) DEFAULT NULL;      
	DECLARE de_114_005 VARCHAR(40) DEFAULT NULL;      
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;     
	DECLARE de_114_070 VARCHAR(500) DEFAULT NULL; 	
	
	DECLARE de_052 VARCHAR(50) DEFAULT NULL;  	      
	DECLARE de_127_010 VARCHAR(4) DEFAULT NULL; 	  
	
	DECLARE de_114_004 VARCHAR(40) DEFAULT NULL; 	  
	DECLARE de_114_091 VARCHAR(40) DEFAULT NULL; 	  

	DECLARE de_120_157 TEXT DEFAULT NULL;  
	
		
	DECLARE _US_PH TEXT DEFAULT NULL;  	
	DECLARE _48_28_CADENA TEXT DEFAULT NULL; 
	DECLARE _121_167_CADENA TEXT DEFAULT NULL; 
	DECLARE _122_87_CADENA  TEXT DEFAULT NULL; 
	DECLARE _121_62_CADENA  TEXT DEFAULT NULL; 	
	DECLARE _48_28_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_167_a VARCHAR(40) DEFAULT NULL;
	DECLARE _122_87P_a VARCHAR(40) DEFAULT NULL;
	DECLARE _121_62_a VARCHAR(40) DEFAULT NULL;

	
	
	DECLARE _US_AD 	TEXT DEFAULT NULL;
	DECLARE de_121_045_CADENA TEXT DEFAULT NULL; 
	DECLARE de_114_012_CADENA TEXT DEFAULT NULL; 
	DECLARE de_114_013_CADENA TEXT DEFAULT NULL; 
	DECLARE de_122_087_CADENA TEXT DEFAULT NULL; 	
	DECLARE de_120_013_CADENA TEXT DEFAULT NULL; 
	DECLARE de_114_014_CADENA TEXT DEFAULT NULL; 
	DECLARE de_122_107_CADENA TEXT DEFAULT NULL; 

	DECLARE de_121_045 VARCHAR(11) DEFAULT NULL;  			
	DECLARE de_114_012 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_114_013 VARCHAR(300) DEFAULT NULL;  		
	DECLARE de_122_087 VARCHAR(11) DEFAULT NULL;  			
	DECLARE de_120_013 VARCHAR(11) DEFAULT NULL;  			
	DECLARE de_114_014 VARCHAR(11) DEFAULT NULL;  			
	DECLARE de_122_107 VARCHAR(11) DEFAULT NULL; 
	

    DECLARE de_114_073 VARCHAR(45) DEFAULT NULL;    -- Payment Service Provider
    DECLARE de_114_115 VARCHAR(45) DEFAULT NULL;    -- Billing address
	
	
	DECLARE de_114_121 INT(11) DEFAULT NULL; 
	DECLARE de_117_017 INT(11) DEFAULT NULL; 
	DECLARE de_117_018 INT(11) DEFAULT NULL; 
	DECLARE de_117_012 INT(11) DEFAULT NULL; 
    DECLARE de_117_019 INT(11) DEFAULT NULL; 
    DECLARE de_114_009 VARCHAR(5) DEFAULT NULL; 
    DECLARE de_121_007 VARCHAR(45) DEFAULT NULL;   
    
	DECLARE de_117_020 INT(11) DEFAULT NULL; 
	DECLARE de_117_021 INT(11) DEFAULT NULL; 
	DECLARE de_117_022 INT(11) DEFAULT NULL; 
	
    DECLARE de_117_025 VARCHAR(5) DEFAULT NULL;
    DECLARE de_121_036 VARCHAR(5) DEFAULT NULL; 
    
    DECLARE de_123_071 VARCHAR(100) DEFAULT NULL; 
    
	DECLARE i INT(4) DEFAULT NULL;
	
	DECLARE USERID_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE CRC_AUX VARCHAR(10) DEFAULT NULL; 
	DECLARE USER_NAME VARCHAR(100) DEFAULT NULL;     
	DECLARE USER_EMAIL VARCHAR(100) DEFAULT NULL;   
	DECLARE ADDRESSID_AUX VARCHAR(20) DEFAULT NULL; 
	DECLARE LOCATIONID_AUX VARCHAR(20) DEFAULT NULL;
    DECLARE PHONEID_AUX	VARCHAR(20) DEFAULT NULL; 
    DECLARE COMPANY_ID INTEGER(11) DEFAULT NULL; 
	
    DECLARE LATITUDE_AUX VARCHAR(20) DEFAULT 0;			
	DECLARE LONGITUDE_AUX VARCHAR(20) DEFAULT 0;
	
    DECLARE AGENT_ID INTEGER(11) DEFAULT NULL; 
    
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	
	

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	SET	de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	
	SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	set de_114_179 = (select right(de_114_179,11));
	
	SET de_114_003 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.3');
	SET de_114_005 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.5');
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
    
	SET de_114_070 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.70');
	SET de_114_070 = convert(unhex(de_114_070) using utf8);
    
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	SET de_127_010 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.10');
	
	SET de_114_004 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.4');
	SET de_114_091 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.91');

	SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.121');
	SET de_117_017 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.17');
	SET de_117_018 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.18');
	SET de_117_012 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.12');
    SET de_117_019 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.19');
    SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.9');
    SET de_121_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.7');
    
	SET de_117_020 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.20');
	SET de_117_021 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.21');
	SET de_117_022 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.22');
	
    SET de_117_025 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.25');
    SET de_121_036 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.36');
    
    
    
    SELECT DATA INTO _US_PH FROM TBL_MESSAGE1 WHERE CODE = "121.3";
	SET _US_PH = (SELECT CONVERT(unhex(_US_PH) USING utf8 ));

	SET _US_PH = REPLACE(_US_PH,'{"1','{"_1');
	SET _US_PH = REPLACE(_US_PH,',"1',',"_1');
	SET _US_PH = REPLACE(_US_PH,'{"4','{"_4');
	SET _US_PH = REPLACE(_US_PH,',"4',',"_4');
	
    SET _US_PH = REPLACE(_US_PH,'-1','');
    
	SET _48_28_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_48.28'));
	SET _121_167_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.167'));
	SET _122_87_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_122.87'));
	SET _121_62_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_PH":',_US_PH,'}'),'//_121.62'));

	
    
	SELECT DATA INTO _US_AD FROM TBL_MESSAGE1 WHERE CODE = "AL";
	SET _US_AD = (SELECT CONVERT(unhex(_US_AD) USING utf8 ));
	
	SET _US_AD = REPLACE(_US_AD,'{"1','{"_1');
	SET _US_AD = REPLACE(_US_AD,',"1',',"_1');
	
	SET de_121_045_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_121.45'));
	SET de_114_012_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.12'));
	SET de_114_013_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.13'));
	SET de_122_107_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.107'));
	SET de_114_014_CADENA   = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_114.14'));
	SET de_120_013_CADENA = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_120.13'));
	SET de_122_087_CADENA  = (SELECT common_schema.extract_json_value_nmc(concat('{"_US_AD":',_US_AD,'}'),'//_122.87'));
	
    SET de_114_073 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.73');
    SET de_114_115 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.115');

    SET de_123_071 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.71');

	



	if length(de_114_179) > 0 then 
	
		SET AGENT_ID = (select tbl_user_reseller_id from dbuser.tbl_merchant where tbl_user_id = de_114_179);
		
		-- ---------------------
		-- User and merchant  --
		-- ---------------------
		if (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070 and tbl_user_id != de_114_179 limit 1) is not null then
		
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','2067'),('44','Duplicated Company Name');
			
		else
			
			update tbl_user set
			tbl_user_email = COALESCE(de_114_007, tbl_user_email),
			tbl_user_first = COALESCE(de_114_003, tbl_user_first),
			tbl_user_middle =  COALESCE(de_114_004, tbl_user_middle),
			tbl_user_last = COALESCE(de_114_005, tbl_user_last),
			tbl_user_title = COALESCE(de_114_091, tbl_user_title),
			tbl_user_companyName = COALESCE(de_114_070, tbl_user_companyName),
			tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),tbl_user_password),
			tbl_user_dateAdded = NOW(),
			tbl_user_dateModified = NOW(),
			tbl_gender_type = 51,
			tbl_user_department = 61316,
			tbl_user_multipleshipaddress_f = COALESCE(if(de_117_025='true',1,0), tbl_user_multipleshipaddress_f),
			tbl_user_supervisor = if(length(de_053)>0,if(de_053!= de_114_179, de_053, AGENT_ID), tbl_user_supervisor),
			tbl_user_modifiedBy = if(length(de_053)>0,if(de_053!= de_114_179, de_053, AGENT_ID), tbl_user_modifiedBy)
			where tbl_user_id = de_114_179; 
				
			SET USERID_AUX = de_114_179;
			SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
			SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
			SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));
				
			update tbl_merchant set
			tbl_merchant_taxIdNumber = COALESCE(de_123_071,tbl_merchant_taxIdNumber),
			tbl_merchant_multiple_locations_quantity = COALESCE(de_114_121, tbl_merchant_multiple_locations_quantity),
			tbl_merchant_location_use = COALESCE(de_117_017, tbl_merchant_location_use),
			tbl_merchant_dongles_quantity = COALESCE(de_117_018, tbl_merchant_dongles_quantity),
			tbl_merchant_insurance_f = COALESCE(if(de_114_009='true',1,0), tbl_merchant_insurance_f),
			tbl_merchant_insurance_price = COALESCE(de_121_007, tbl_merchant_dongles_quantity),
			-- tbl_merchant_basic_subs = COALESCE(de_117_020, tbl_merchant_basic_subs),
			tbl_merchant_standard_subs = COALESCE(de_117_021, tbl_merchant_standard_subs),
			tbl_merchant_deluxe_subs = COALESCE(de_117_022,tbl_merchant_deluxe_subs),
			tbl_merchant_receivePayment_f = COALESCE(if(de_121_036='true',1,0),tbl_merchant_receivePayment_f),
			tbl_user_reseller_id = if(length(de_053)>0,if(de_053!= de_114_179, de_053, AGENT_ID), tbl_user_reseller_id),
			tbl_user_modifiedBy = if(length(de_053)>0,if(de_053!= de_114_179, de_053, AGENT_ID), tbl_user_modifiedBy)
			where tbl_user_id = de_114_179;

			if (select tbl_company_id from tbl_user where tbl_user_id = USERID_AUX) is not null then
				
				SET COMPANY_ID =  (select tbl_company_id from tbl_user where tbl_user_id = USERID_AUX);
				
				update tbl_company set
				tbl_company_name = COALESCE(de_114_070 ,tbl_company_name),
				tbl_company_taxId = COALESCE(de_123_071 ,tbl_company_taxId)
				where tbl_company_id = COMPANY_ID;
				
			else
				
				insert into tbl_company set
				tbl_company_name = COALESCE(de_114_070,''),
				tbl_company_crc = COALESCE(CRC_AUX,''),
				tbl_company_taxId = COALESCE(de_123_071,''),
				tbl_company_type_id = 4701,
				tbl_company_status_id = 33,
				tbl_company_dateCreate = NOW();
				
				set COMPANY_ID = (SELECT last_insert_id() FROM tbl_company limit 1);
				
			end if;
				
			update dbuser.tbl_user set 
			tbl_company_id = COMPANY_ID,
			tbl_user_crc = CRC_AUX
			where tbl_user_id = USERID_AUX;
				
				
			-- ---------------------
			-- Link               --
			-- ---------------------
				
			if length(de_052) > 0 then 
				
				update tbl_link set
				tbl_link_link = md5(convert(unhex(de_052) using utf8)),
				tbl_link_date = NOW(),
				tbl_link_delete = 0
				where tbl_link_user_id = de_114_179;
				
			end if;
				
				
				
				
			-- ---------------------
			-- Phones             --
			-- ---------------------
				
			if LENGTH(_48_28_CADENA) >0 then
				
				delete from tbl_phone where tbl_phone_nmcId = de_114_179;
				
				while (LENGTH(_48_28_CADENA)>0) DO

					SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
					SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));
					
					SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
					SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
					
					SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
					SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

					SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
					SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

					insert into tbl_phone set
					tbl_company_id 		  = COMPANY_ID,
					tbl_phone_nmcId       = de_114_179,
					tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
					tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
					tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
					tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);
						
					SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);	

				end while ; 
					
			end if;
				
				

			-- ---------------------------------
			-- Address and Locations --
			-- ---------------------------------
				
			if (select tbl_address_id from tbl_address where tbl_address_nmcId = de_114_179 limit 1) is not null then
				
				delete from tbl_location_hardware where tbl_user_id = de_114_179;			
				delete from tbl_locationaddress where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
				delete from tbl_locationphone where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
				delete from tbl_location_schedule where tbl_location_id in (select tbl_location_id from tbl_location where tbl_location_userId = de_114_179);			
				delete from tbl_location where tbl_location_userId = de_114_179;			
				delete from tbl_address where tbl_address_nmcId = de_114_179;
				
			end if;
				
			if LENGTH(de_114_012_CADENA) >0 then
				
				while (LENGTH(de_114_012_CADENA)>0) DO
					
					SET de_121_045 = (SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1));
					SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));
					
					SET de_114_012 = (SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1));
					SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

					SET de_114_013 = (SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1));
					SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
						
					SET de_122_107 = (SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1));
					SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

					SET de_114_014 = (SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1));
					SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
				
					SET de_120_013 = (SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1));
					SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

					SET de_122_087 = (SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1));
					SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
						
					SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
					SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
						
						
					insert into tbl_address set 
					tbl_company_id = COMPANY_ID,
					tbl_address_nmcId = de_114_179,
					tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
					tbl_address_first = TRIM(de_114_012),
					tbl_address_second = TRIM(de_114_013),
					tbl_address_phoneNumber = null,
					tbl_zipcode_id = TRIM(de_122_107),
					tbl_city_id = TRIM(de_114_014),
					tbl_state_id = TRIM(de_120_013),
					tbl_country_id = TRIM(de_122_087);
						
					SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
						
					INSERT INTO tbl_location SET 
					tbl_company_id = COMPANY_ID,
					tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
					tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
					tbl_location_contactName = USER_NAME, 
					tbl_location_contactEmail = USER_EMAIL, 
					tbl_location_userId = de_114_179,
					tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
					tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
					tbl_location_statusId= 7001;
						
					SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);

					INSERT tbl_locationaddress SET
					tbl_location_id = LOCATIONID_AUX, 
					tbl_address_id = ADDRESSID_AUX;
						
					if length(PHONEID_AUX) > 0 and length(LOCATIONID_AUX)> 0 then
						if (select count(tbl_location_id) from tbl_location where tbl_location_userId = de_114_179) = 1 then
							INSERT INTO tbl_locationphone SET
							tbl_location_id = LOCATIONID_AUX,
							tbl_phone_id = PHONEID_AUX;
						end if;
					end if;
						
					INSERT INTO tbl_location_hardware (
					tbl_company_id,
					tbl_user_id,
					tbl_location_id,
					tbl_hardware_type_id,
					tbl_location_hardware_qty,
					tbl_location_hardware_shipped,
					tbl_shipping_status_id) 
					values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,0,0,73001);
							   
					INSERT INTO tbl_location_schedule (
					tbl_location_id,
					tbl_day_of_the_week,
					tbl_24_hour,
					tbl_closed_flag,
					tbl_hour_open,
					tbl_hour_close) 
					values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
								(LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
							   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');
						
				end while ;
						
			end if;


			-- --------------------------
			-- Subscription Cart  --
			-- ---------------------------
			
			if (select tbl_subscription_id from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 limit 1) is not null then
				delete from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179; 
			end if;     
		   
			if de_117_021 > 0 then
				insert into dbitems.tbl_subscriptioncart set 
				tbl_subscription_id = 15,
				tbl_subscriptioncart_user_nmcid = de_114_179,
				tbl_subscriptioncart_quantity = de_117_021;
			end if;
			
			if de_117_022 > 0 then
				insert into dbitems.tbl_subscriptioncart set 
				tbl_subscription_id = 16,
				tbl_subscriptioncart_user_nmcid = de_114_179,
				tbl_subscriptioncart_quantity = de_117_022;
			end if;
			
			
			
			-- ------------------------
			-- Hardware Cart   --
			-- ------------------------

			if de_117_018 > 0 then
			
				if (select tbl_company_id from dbuser.tbl_hardware_cart where tbl_user_id = de_114_179 limit 1) is not null then
					delete from dbuser.tbl_hardware_cart where tbl_user_id = de_114_179;
				end if;
				
				insert into dbuser.tbl_hardware_cart set
				tbl_company_id = COMPANY_ID,
				tbl_user_id = de_114_179,
				tbl_hardware_type_id = 75001,
				tbl_hardware_cart_quantity = de_117_018,
				tbl_hardware_cart_delete = 0,
				tbl_hardware_cart_insurance_f = if(de_114_009='true',1,0);
						
			end if;
	   
	   
			
			-- ----------------------
			-- Commissions  --
			-- ----------------------
			if length(de_053) > 0 then
				if (select tbl_user_id from dbuser.tbl_user where tbl_user_id = de_053 and tbl_user_entity in (30,60)) is not null then
					if ( select tbl_commission_id from dbcommission.tbl_commission where tbl_commission_agent_nmcId = de_053 and (select MONTH(tbl_commission_date)) = (select MONTH(NOW())) limit 1) is null then
								
						insert into dbcommission.tbl_commission set
						tbl_commission_agent_nmcId = de_053,
						tbl_commission_date = NOW(),
						tbl_commission_refNumber = CONCAT('ref-',de_053,''),
						tbl_commission_status_id = 72001;
								
					end if;
				end if;
			end if;

			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
			
		end if;
		
	
    
    
    
    
    
    else
    
    
    
    
    
    
		
        if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 limit 1) is not null then
        
			insert into TBL_MESSAGE1 (CODE,DATA)
			values('39','2053'),('44','Email Already Exists');
            
		else
        
			if (select tbl_user_companyName from tbl_user where tbl_user_companyName = de_114_070) is not null then
			
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','2067'),('44','Duplicated Company Name');
				
			else
            
				-- -----------------------------
				-- User and merchant  --
				-- -----------------------------
				insert into tbl_user set 
				tbl_user_email = de_114_007,
				tbl_user_first = COALESCE(de_114_003,''),
				tbl_user_middle = COALESCE(de_114_004,''),
				tbl_user_last = COALESCE(de_114_005,''),
				tbl_user_title = COALESCE(de_114_091,''),
				tbl_user_companyName = COALESCE(de_114_070,''),
				tbl_user_password = COALESCE(md5(convert(unhex(de_052) using utf8)),''),
				tbl_user_parentId = null,
				tbl_user_dateAdded = NOW(),
				tbl_user_dateModified = NOW(),
				tbl_userstatus_id = 37,
				tbl_user_entity = 20,
				tbl_gender_type = 51,
                tbl_user_department = 61316,
				tbl_user_class = '2C0',
				tbl_owner_id = '001',
				tbl_user_pinCode =  1234,
                tbl_user_supervisor = de_053,
                tbl_user_modifiedBy = de_053,
				tbl_user_multipleshipaddress_f = if(de_117_025='true',1,0);

				SET USERID_AUX = last_insert_id();
                set de_114_179 = USERID_AUX;
				SET USER_NAME = (SELECT CONCAT(tbl_user_first,' ',tbl_user_last) FROM tbl_user WHERE tbl_user_id= USERID_AUX limit 1);	
				SET USER_EMAIL = (SELECT tbl_user_email FROM tbl_user WHERE tbl_user_id = USERID_AUX limit 1);
				SET CRC_AUX = (select LPAD(crc32(dbuser.GetNMCId(USERID_AUX)),10,0));

				insert into tbl_merchant set
				tbl_user_id = USERID_AUX,
				tbl_merchant_nmcId = USERID_AUX,
                tbl_user_reseller_id = de_053,
                tbl_user_modifiedBy = de_053,
				tbl_merchant_taxIdNumber = COALESCE(de_123_071, ''),
				tbl_merchant_multiple_locations_quantity = COALESCE(de_114_121, 0),
				tbl_merchant_location_use = COALESCE(de_117_017, 0),
                tbl_merchant_dongles_quantity = COALESCE(de_117_018,0),
                tbl_merchant_insurance_f = COALESCE(if(de_114_009='true',1,0), 0),
				tbl_merchant_insurance_price = COALESCE(de_121_007, '0.00'),
				tbl_merchant_standard_subs = COALESCE(de_117_021,0),
				tbl_merchant_deluxe_subs = COALESCE(de_117_022,0),
				tbl_merchant_receivePayment_f = if(de_121_036='true',1,0),
                tbl_merchant_multipleLocation_f = 4801,
				tbl_merchant_haveWebsite_f = 0,
				tbl_merchant_haveAccount_f = 0,
				tbl_merchant_logoimage = '',
				tbl_merchant_online_store = '';
				
				insert into tbl_company set
				tbl_company_name = de_114_070,
				tbl_company_crc = CRC_AUX,
				tbl_company_taxId = COALESCE(de_123_071, ''),
				tbl_company_type_id = 4701,
				tbl_company_status_id = 33,
				tbl_company_dateCreate = NOW();

				set COMPANY_ID = (SELECT last_insert_id() FROM tbl_company limit 1);
				
				update dbuser.tbl_user set 
				tbl_company_id = COMPANY_ID,
				tbl_user_crc = CRC_AUX
				where tbl_user_id = USERID_AUX;
				
				
                -- ---------------------
				-- Delivery          --
				-- ---------------------
				INSERT INTO tbl_user_delivery_options set
				tbl_company_id = COMPANY_ID,
				tbl_user_id = USERID_AUX,
				tbl_delivery_company_price = 0.00,
				tbl_delivery_company_service = 'Pick Up',
				tbl_user_delivery_options_tier = 'Pick Up',
				tbl_delivery_company_tracking_code ='',
				tbl_delivery_company_option = 'Pick Up';
                
                
                -- ---------------------
				-- Link                --
				-- ---------------------
				if length(de_052) > 0 then 
				
					insert into tbl_link set
					tbl_link_user_id = USERID_AUX,
					tbl_link_link = md5(convert(unhex(de_052) using utf8)),
					tbl_link_date = NOW(),
					tbl_link_delete = 0;
				
				end if;
                
                
                -- ---------------------
				-- Phones             --
				-- ---------------------
					
				if LENGTH(_48_28_CADENA) >0 then
					
					while (LENGTH(_48_28_CADENA)>0) DO

						SET _48_28_a = (SELECT SUBSTR(_48_28_CADENA,1,LOCATE('|',_48_28_CADENA)-1));
						SET _48_28_CADENA = (SELECT SUBSTR(_48_28_CADENA,LOCATE('|',_48_28_CADENA)+1));
						
						SET _121_167_a = (SELECT SUBSTR(_121_167_CADENA,1,LOCATE('|',_121_167_CADENA)-1));
						SET _121_167_CADENA = (SELECT SUBSTR(_121_167_CADENA,LOCATE('|',_121_167_CADENA)+1));
						
						SET _122_87P_a = (SELECT SUBSTR(_122_87_CADENA,1,LOCATE('|',_122_87_CADENA)-1));
						SET _122_87_CADENA = (SELECT SUBSTR(_122_87_CADENA,LOCATE('|',_122_87_CADENA)+1));

						SET _121_62_a = (SELECT SUBSTR(_121_62_CADENA,1,LOCATE('|',_121_62_CADENA)-1));
						SET _121_62_CADENA = (SELECT SUBSTR(_121_62_CADENA,LOCATE('|',_121_62_CADENA)+1));

						insert into tbl_phone set
						tbl_company_id 		  = COMPANY_ID,
						tbl_phone_nmcId       = de_114_179,
						tbl_phone_phoneNumber = COALESCE(TRIM(_48_28_a),tbl_phone_phoneNumber),
						tbl_phone_extension   = COALESCE(TRIM(_121_167_a),tbl_phone_extension),
						tbl_phone_country_id  = COALESCE(TRIM(_122_87P_a),tbl_phone_country_id),
						tbl_phonetype_id      = COALESCE(TRIM(_121_62_a),tbl_phonetype_id);
							
						SET PHONEID_AUX = (SELECT last_insert_id() FROM tbl_phone limit 1);	

					end while ; 
						
				end if;
                
                
                -- ---------------------------------
				-- Address and Locations --
				-- ---------------------------------
					
				if LENGTH(de_114_012_CADENA) >0 then
					
					while (LENGTH(de_114_012_CADENA)>0) DO
						
						SET de_121_045 = (SELECT SUBSTR(de_121_045_CADENA,1,LOCATE('|',de_121_045_CADENA)-1));
						SET de_121_045_CADENA = (SELECT SUBSTR(de_121_045_CADENA,LOCATE('|',de_121_045_CADENA)+1));
						
						SET de_114_012 = (SELECT SUBSTR(de_114_012_CADENA,1,LOCATE('|',de_114_012_CADENA)-1));
						SET de_114_012_CADENA = (SELECT SUBSTR(de_114_012_CADENA,LOCATE('|',de_114_012_CADENA)+1));

						SET de_114_013 = (SELECT SUBSTR(de_114_013_CADENA,1,LOCATE('|',de_114_013_CADENA)-1));
						SET de_114_013_CADENA = (SELECT SUBSTR(de_114_013_CADENA,LOCATE('|',de_114_013_CADENA)+1));
							
						SET de_122_107 = (SELECT SUBSTR(de_122_107_CADENA,1,LOCATE('|',de_122_107_CADENA)-1));
						SET de_122_107_CADENA = (SELECT SUBSTR(de_122_107_CADENA,LOCATE('|',de_122_107_CADENA)+1));

						SET de_114_014 = (SELECT SUBSTR(de_114_014_CADENA,1,LOCATE('|',de_114_014_CADENA)-1));
						SET de_114_014_CADENA = (SELECT SUBSTR(de_114_014_CADENA,LOCATE('|',de_114_014_CADENA)+1));
					
						SET de_120_013 = (SELECT SUBSTR(de_120_013_CADENA,1,LOCATE('|',de_120_013_CADENA)-1));
						SET de_120_013_CADENA = (SELECT SUBSTR(de_120_013_CADENA,LOCATE('|',de_120_013_CADENA)+1));

						SET de_122_087 = (SELECT SUBSTR(de_122_087_CADENA,1,LOCATE('|',de_122_087_CADENA)-1));
						SET de_122_087_CADENA = (SELECT SUBSTR(de_122_087_CADENA,LOCATE('|',de_122_087_CADENA)+1));
							
						SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
						SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = TRIM(de_122_107));
							
							
						insert into tbl_address set 
						tbl_company_id = COMPANY_ID,
						tbl_address_nmcId = de_114_179,
						tbl_addresstype_id = TRIM(if(de_121_045=0,11,de_121_045)),
						tbl_address_first = TRIM(de_114_012),
						tbl_address_second = TRIM(de_114_013),
						tbl_address_phoneNumber = null,
						tbl_zipcode_id = TRIM(de_122_107),
						tbl_city_id = TRIM(de_114_014),
						tbl_state_id = TRIM(de_120_013),
						tbl_country_id = TRIM(de_122_087);
							
						SET ADDRESSID_AUX= (SELECT last_insert_id() FROM tbl_address limit 1);	
							
						INSERT INTO tbl_location SET 
						tbl_company_id = COMPANY_ID,
						tbl_location_storeNumber= 1000000 + ADDRESSID_AUX ,
						tbl_location_storeName= CONCAT('Location ',ADDRESSID_AUX),
						tbl_location_contactName = USER_NAME, 
						tbl_location_contactEmail = USER_EMAIL, 
						tbl_location_userId = de_114_179,
						tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
						tbl_location_longitude= COALESCE(LONGITUDE_AUX,''),
						tbl_location_statusId= 7001;
							
						SET LOCATIONID_AUX= (SELECT last_insert_id()  from  tbl_location limit 1);

						INSERT tbl_locationaddress SET
						tbl_location_id = LOCATIONID_AUX, 
						tbl_address_id = ADDRESSID_AUX;
							
						if length(PHONEID_AUX) > 0 and length(LOCATIONID_AUX)> 0 then
							if (select count(tbl_location_id) from tbl_location where tbl_location_userId = de_114_179) = 1 then
								INSERT INTO tbl_locationphone SET
								tbl_location_id = LOCATIONID_AUX,
								tbl_phone_id = PHONEID_AUX;
							end if;
						end if;
							
						INSERT INTO tbl_location_hardware (
						tbl_company_id,
						tbl_user_id,
						tbl_location_id,
						tbl_hardware_type_id,
						tbl_location_hardware_qty,
						tbl_location_hardware_shipped,
						tbl_shipping_status_id) 
						values (COMPANY_ID,de_114_179,LOCATIONID_AUX,75001,0,0,73001);
								   
						INSERT INTO tbl_location_schedule (
						tbl_location_id,
						tbl_day_of_the_week,
						tbl_24_hour,
						tbl_closed_flag,
						tbl_hour_open,
						tbl_hour_close) 
						values (LOCATIONID_AUX,0,1,0,'00:00:00','23:59:59'),
									(LOCATIONID_AUX,1,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,2,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,3,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,4,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,5,1,0,'00:00:00','23:59:59'),
								   (LOCATIONID_AUX,6,1,0,'00:00:00','23:59:59');
							
					end while ;
							
				end if;
                
                
                -- --------------------------
				-- Subscription Cart  --
				-- ---------------------------
				
				if (select tbl_subscription_id from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179 limit 1) is not null then
					delete from dbitems.tbl_subscriptioncart where tbl_subscriptioncart_user_nmcid = de_114_179; 
				end if;     
			   
				if de_117_021 > 0 then
					insert into dbitems.tbl_subscriptioncart set 
					tbl_subscription_id = 15,
					tbl_subscriptioncart_user_nmcid = de_114_179,
					tbl_subscriptioncart_quantity = de_117_021;
				end if;
				
				if de_117_022 > 0 then
					insert into dbitems.tbl_subscriptioncart set 
					tbl_subscription_id = 16,
					tbl_subscriptioncart_user_nmcid = de_114_179,
					tbl_subscriptioncart_quantity = de_117_022;
				end if;


				-- ------------------------
				-- Hardware Cart   --
				-- ------------------------

				if de_117_018 > 0 then
				
					if (select tbl_company_id from dbuser.tbl_hardware_cart where tbl_user_id = de_114_179 limit 1) is not null then
						delete from dbuser.tbl_hardware_cart where tbl_user_id = de_114_179;
					end if;
					
					insert into dbuser.tbl_hardware_cart set
					tbl_company_id = COMPANY_ID,
					tbl_user_id = de_114_179,
					tbl_hardware_type_id = 75001,
					tbl_hardware_cart_quantity = de_117_018,
					tbl_hardware_cart_delete = 0,
					tbl_hardware_cart_insurance_f = if(de_114_009='true',1,0);
							
				end if;


				-- ----------------------
				-- Commissions  --
				-- ----------------------
				if length(de_053) > 0 then
					if (select tbl_user_id from dbuser.tbl_user where tbl_user_id = de_053 and tbl_user_entity in (30,60)) is not null then
						if ( select tbl_commission_id from dbcommission.tbl_commission where tbl_commission_agent_nmcId = de_053 and (select MONTH(tbl_commission_date)) = (select MONTH(NOW())) limit 1) is null then
									
							insert into dbcommission.tbl_commission set
							tbl_commission_agent_nmcId = de_053,
							tbl_commission_date = NOW(),
							tbl_commission_refNumber = CONCAT('ref-',de_053,''),
							tbl_commission_status_id = 72001;
									
						end if;
					end if;
				end if;
                
				insert into TBL_MESSAGE1 (CODE,DATA)
				values('39','0000'),('44','Transaction Approved');

			
			end if;
    
		end if;
    
    
    
    end if;
	
	

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if length(de_114_115)>0 then
		set de_114_115 = de_114_115;
	else
		set de_114_115 = (select tbl_address_id from dbuser.tbl_address where tbl_address_nmcId = USERID_AUX and tbl_addresstype_id = 11 limit 1);
	end if;
	
	if RESULT_39 = '0000' then
		if length(de_114_115)>0 then
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.115":"',de_114_115,'"'),CONCAT(',"53":"',(select dbuser.GetNMCId(USERID_AUX)),'"'),CONCAT(',"123.34":"',CRC_AUX,'"}')) as JSON;
		else
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCId(USERID_AUX)),'"'),CONCAT(',"123.34":"',CRC_AUX,'"}')) as JSON;
		end if;
	else 
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
    end if;
    
	DROP TABLE TBL_MESSAGE1;
 
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveNicknameDeviceMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SaveNicknameDeviceMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	DECLARE de_053 INT(18) DEFAULT NULL; 
	DECLARE de_057 VARCHAR(50) DEFAULT NULL; 
	DECLARE de_048_006 VARCHAR(20) DEFAULT NULL; 

	
	




	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;





	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
		SET de_048_006 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '48.6');	
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




		
			IF(SELECT A.tbl_device_udid FROM tbl_device as A, tbl_consumer as B WHERE 
										A.tbl_device_udid = de_057 AND 
										A.tbl_consumer_nmcId = B.tbl_consumer_nmcId AND	
										B.tbl_consumer_nmcId = de_053) IS NOT NULL THEN
										
								UPDATE tbl_device SET 
								tbl_device_nickName = de_048_006
								WHERE tbl_device_udid = de_057	
								AND tbl_consumer_nmcId = de_053;
				
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'); 			
										
			ELSE			
						INSERT INTO tbl_device set 
						tbl_device_udid = de_057,
						tbl_device_nickName = de_048_006,
						tbl_status_id = 1,
						tbl_devicetype_id = 1,
						tbl_consumer_nmcId = de_053;
				
						
						
						
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','0000'),('44','Transaction Approved'); 
			END IF;
	
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18);
	
	END IF;

		set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
		set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
		
	SELECT 
     CONCAT(
          GROUP_CONCAT(
               CONCAT('"39":"',RESULT_39,'"'),
               CONCAT(',"44":"',RESULT_44,'"')
          )
      ) as JSON;
	
	
	
    
    
    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveNicknameDeviceMobile030400008` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SaveNicknameDeviceMobile030400008`(IN MSG_IN VARCHAR(20000))
BEGIN
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_057 VARCHAR(255) DEFAULT NULL;  
	DECLARE de_048_006 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_064 INT(20) DEFAULT NULL; 
	DECLARE de_127_088 INT(20) DEFAULT NULL; 
	DECLARE de_122_012 VARCHAR(255) DEFAULT NULL; -- 122.12 GCM

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;



	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	 
	 
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
    
	SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57');
	SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');	
	SET de_048_006 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '48.6');
	SET de_127_088 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '127.88');	
	SET de_122_012 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.12');



			
	IF(SELECT tbl_consumer_nmcId FROM tbl_device WHERE tbl_consumer_nmcId = de_053 AND tbl_device_nickName = de_048_006 and tbl_device_udid != de_057 limit 1) IS NULL THEN 

		IF(SELECT A.tbl_device_udid FROM tbl_device as A, tbl_user as B WHERE  
								A.tbl_device_udid = de_057 AND 
								A.tbl_consumer_nmcId = B.tbl_user_id AND	
								B.tbl_user_id = de_053) IS NOT NULL THEN
								
			UPDATE tbl_device SET 
			tbl_device_nickName = de_048_006,
            tbl_device_gcm = COALESCE(de_122_012,tbl_device_gcm)
			WHERE tbl_device_udid = de_057	
			AND tbl_consumer_nmcId = de_053;
			
            /*
			Update tbl_user set 
			tbl_user_userTemp_f = 0,
			tbl_user_dateModified = NOW(),
			tbl_user_pinCode =  coalesce(md5(convert(unhex(de_064) using utf8)),tbl_user_pinCode)
			where tbl_user_id = de_053;
			*/
            
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'); 			
								
		ELSE	
		
			INSERT INTO tbl_device set 
			tbl_device_udid = de_057,
            tbl_device_gcm = de_122_012,
			tbl_device_nickName = de_048_006,
			tbl_status_id = 5801,
			tbl_devicetype_id = coalesce(de_127_088,5901),
			tbl_consumer_nmcId = de_053;
			
            /*
			Update tbl_user set 
			tbl_user_userTemp_f = 0,
			tbl_user_dateModified = NOW(),
			tbl_user_pinCode =  coalesce(md5(convert(unhex(de_064) using utf8)),tbl_user_pinCode)
			where tbl_user_id = de_053;
			*/

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved'); 

		END IF;

	ELSE 

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','2056'),('44','Duplicated Nickname'); 	
		
	END IF;


	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	
		
	SELECT GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
    
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SavePayWithNMCId020400309` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SavePayWithNMCId020400309`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;  
	
	DECLARE de_127_092 VARCHAR(5) DEFAULT NULL; 
	DECLARE de_127_093 VARCHAR(5) DEFAULT NULL; 
	
	DECLARE USER_ID_AUX VARCHAR(5) DEFAULT NULL;  
	DECLARE OWNER_AUX VARCHAR(5) DEFAULT NULL;  
	DECLARE RANDOM_AUX VARCHAR(5) DEFAULT NULL;  
	
	DECLARE PAYNMCAUX VARCHAR(40) DEFAULT NULL;  
	

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

	
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = (select right(de_053,11));
	
	
	SET USER_ID_AUX = (select right(de_053,5));
	SET de_127_092  = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.92');
	SET de_127_093  = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '127.93');
	SET OWNER_AUX	= (SELECT tbl_owner_id FROM dbuser.tbl_user WHERE tbl_user_id =de_053 );
	SET RANDOM_AUX	= (SELECT SUBSTRING( RAND(),3,2));
	SET PAYNMCAUX	=  CONCAT(de_127_092,USER_ID_AUX,de_127_093,OWNER_AUX,RANDOM_AUX);
	
	update dbuser.tbl_user set tbl_user_pay_nmcId=MD5(PAYNMCAUX) where tbl_user_id=de_053;

	
		
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"127.61":"',PAYNMCAUX,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SavePushedAddressMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SavePushedAddressMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	DECLARE de_300_068 VARCHAR(3000) DEFAULT NULL; 
	DECLARE de_53 VARCHAR(45) DEFAULT NULL; 
	DECLARE de_114_115 VARCHAR(45) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE ADDRESSTYPE_AUX VARCHAR(45) DEFAULT NULL;
	
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	

	set flag_validation = False;
	IF flag_validation = FALSE THEN




		set de_300_068 =  (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '300.68');
		SET de_114_115 = common_schema.get_option( de_300_068, "114.115" );
		
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		
		SET ADDRESSTYPE_AUX =(SELECT tbl_addresstype_id FROM tbl_address where tbl_address_id = de_114_115 and tbl_address_nmcId = de_53);
		
		UPDATE tbl_address SET 
		tbl_address_flag = 0
		where tbl_address_nmcId = de_53
		AND tbl_addresstype_id = ADDRESSTYPE_AUX;
		
		
		UPDATE tbl_address SET 
		tbl_address_flag = 1
		where tbl_address_id = de_114_115;
		
	
		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SaveUserKeys020300285` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SaveUserKeys020300285`(IN MSG_IN VARCHAR(20000))
BEGIN




	
	DECLARE DE_053 VARCHAR(20) DEFAULT 0; 			
	DECLARE DS_UK 	TEXT DEFAULT NULL;				
	
	
	DECLARE DE_127_022 VARCHAR(45) DEFAULT NULL;	
	DECLARE DE_120_032 INT(11) DEFAULT NULL;		
	DECLARE DE_123_043 VARCHAR(45) DEFAULT NULL;	
	
	DECLARE CLASS_ID 	VARCHAR(5) DEFAULT NULL;	
	DECLARE OWNER_ID 	VARCHAR(3) DEFAULT NULL;	
	
	
	DECLARE CADENA_TYPE_ID 		TEXT DEFAULT NULL;		
	DECLARE CADENA_KEY 			TEXT DEFAULT NULL;		
	DECLARE CADENA_CLIENT_NAME 	TEXT DEFAULT NULL;		
	




	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;





	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	set de_053 = 	(select right(de_053,11));
	SET CLASS_ID =  (SELECT tbl_user_class FROM dbuser.tbl_user WHERE tbl_user_id =de_053 );
	SET CLASS_ID =  (select right(CLASS_ID,1));
	SET OWNER_ID =  (SELECT tbl_owner_id FROM dbuser.tbl_user WHERE tbl_user_id =de_053 );
	
	SELECT DATA INTO DS_UK FROM TBL_MESSAGE1 WHERE CODE = "UK";
	SET DS_UK = (SELECT CONVERT(unhex(DS_UK) USING utf8 ));

	SET DS_UK = REPLACE(DS_UK,'{"1','{"_1');
	SET DS_UK = REPLACE(DS_UK,',"1',',"_1');
	SET DS_UK = REPLACE(DS_UK,'{"4','{"_4');
	SET DS_UK = REPLACE(DS_UK,',"4',',"_4');
 
	SET CADENA_TYPE_ID   	= (SELECT common_schema.extract_json_value_nmc(concat('{"_DS_UK":',DS_UK,'}'),'//_120.32'));
	SET CADENA_KEY 			= (SELECT common_schema.extract_json_value_nmc(concat('{"_DS_UK":',DS_UK,'}'),'//_127.22'));
	SET CADENA_CLIENT_NAME	= (SELECT common_schema.extract_json_value_nmc(concat('{"_DS_UK":',DS_UK,'}'),'//_123.43'));
	



			
	if CLASS_ID = '0' then
	
		
		while (LENGTH(CADENA_TYPE_ID)>0) DO

			SET DE_120_032 = (SELECT SUBSTR(CADENA_TYPE_ID,1,LOCATE('|',CADENA_TYPE_ID)-1));
			SET CADENA_TYPE_ID = (SELECT SUBSTR(CADENA_TYPE_ID,LOCATE('|',CADENA_TYPE_ID)+1));

			SET DE_127_022 = (SELECT SUBSTR(CADENA_KEY,1,LOCATE('|',CADENA_KEY)-1));
			SET CADENA_KEY = (SELECT SUBSTR(CADENA_KEY,LOCATE('|',CADENA_KEY)+1));
			
			SET DE_123_043 = (SELECT SUBSTR(CADENA_CLIENT_NAME,1,LOCATE('|',CADENA_CLIENT_NAME)-1));
			SET CADENA_CLIENT_NAME = (SELECT SUBSTR(CADENA_CLIENT_NAME,LOCATE('|',CADENA_CLIENT_NAME)+1));
						
			IF (SELECT client_key.client_key_id from  nmc_control.client_key 
										where client_key.client_name = trim(DE_123_043) 
										and client_key.type = trim(DE_120_032) 
										and client_key.user_id =de_053 limit 1) is null then
				
				insert into nmc_control.client_key set
				client_key.key       		= trim(DE_127_022),
				client_key.client_name 		= trim(DE_123_043),
				client_key.activation_date  = NOW(),
				client_key.owner 			= OWNER_ID,
				client_key.type    			= trim(DE_120_032),
				client_key.user_id 			=de_053	;
			END IF;
		end while ; 

	end if;
	 
 
	select GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"}')) as JSON;	
	

	DROP TABLE TBL_MESSAGE1; 
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchFaqMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchFaqMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	






	SELECT 
        GROUP_CONCAT(     
			CONCAT('{"121.194":"', A.tbl_help_faq_id ,'"'),
			CONCAT(',"114.45":"',if(A.tbl_help_faq_question is null,'', A.tbl_help_faq_question) ,'"'),
			CONCAT(',"114.44":"',if(A.tbl_help_faq_answer is null,'',A.tbl_help_faq_question ),'"}')	
        ) as JSON

	from tbl_help_faq as A
		
	where 
	(		
			UPPER(A.tbl_help_faq_question) like CONCAT("%",UPPER(de_114_127),"%")
		or 	UPPER(A.tbl_help_faq_answer) like CONCAT("%",UPPER(de_114_127),"%")
	)

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchFavoriteMerchant010400094` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchFavoriteMerchant010400094`(PARAM VARCHAR(4000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;   
	DECLARE FIN       BIGINT	   DEFAULT 0;   

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;        

	DECLARE de_114_127  VARCHAR(255) DEFAULT 0;		
	DECLARE de_127_010  VARCHAR(3) DEFAULT 0;		

	DECLARE JSON TEXT DEFAULT NULL;	





	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET  group_concat_max_len = 1000000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1);

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_053 = (select right(de_053,11));
	
	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	SET de_127_010 = (select DATA from TBL_MESSAGE1 where CODE = '127.10');





	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;





	if (length(de_114_127) > 0) then 

		set JSON = (select
		GROUP_CONCAT(
			CONCAT('{"127.56":"',COALESCE(GetNMCID(B.tbl_user_id),''),'"'),
			CONCAT(',"114.70":"', COALESCE(B.tbl_user_companyName,''),'"'),
			CONCAT(',"121.140":"', COALESCE(C.tbl_merchantfav_date,''),'"'),
			CONCAT(',"CU":[',dbitems.getNMCCategoryUserMobile(B.tbl_user_id),']'),
			CONCAT(',"121.170":"', COALESCE(A.tbl_merchant_logoimage,''),'"'),
			CONCAT(',"114.121":"', COALESCE(dbitems.getNMCItemCounterByUser(B.tbl_user_id),'0'),'"'),
			CONCAT(',"127.66":"', COALESCE(B.tbl_user_information,''),'"}')
		)  

		from tbl_user as B 
		left join tbl_merchant as A on A.tbl_user_id = B.tbl_user_id 
		left join tbl_merchantfav as C on A.tbl_merchant_nmcId = C.tbl_merchant_nmcId 
		where C.tbl_consumer_nmcId = de_053

		and 
		(		UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
			or  UPPER(B.tbl_user_information) like CONCAT("%",UPPER(de_114_127),"%")
		) 
		order by C.tbl_merchantfav_date DESC
		limit INI,FIN);

		if JSON is null or '' then 
			SET JSON = '';
			select JSON;
		else 
			SELECT JSON;
		end if;
	
	else

		set JSON = (select
		GROUP_CONCAT(
			CONCAT('{"127.56":"',COALESCE(GetNMCID(B.tbl_user_id),''),'"'),
			CONCAT(',"114.70":"', COALESCE(B.tbl_user_companyName,''),'"'),
			CONCAT(',"121.140":"', COALESCE(C.tbl_merchantfav_date,''),'"'),
			CONCAT(',"CU":[',dbitems.getNMCCategoryUserMobile(B.tbl_user_id),']'),
			CONCAT(',"121.170":"', COALESCE(A.tbl_merchant_logoimage,''),'"'),
			CONCAT(',"114.121":"', COALESCE(dbitems.getNMCItemCounterByUser(B.tbl_user_id),'0'),'"'),
			CONCAT(',"127.66":"', COALESCE(B.tbl_user_information,''),'"}')
		)  

		from tbl_user as B 
		left join tbl_merchant as A on A.tbl_user_id = B.tbl_user_id 
		left join tbl_merchantfav as C on A.tbl_merchant_nmcId = C.tbl_merchant_nmcId 
		where C.tbl_consumer_nmcId = de_053
		order by C.tbl_merchantfav_date DESC
		limit INI,FIN);

		if JSON is null or '' then 
			SET JSON = '';
			select JSON;
		else 
			SELECT JSON;
		end if;

	end if;

	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchFavoriteMerchantCounter010400186` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchFavoriteMerchantCounter010400186`(PARAM VARCHAR(4000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;   
	DECLARE FIN       BIGINT	   DEFAULT 0;   

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;        
	DECLARE de_114_127  VARCHAR(255) DEFAULT 0;		






	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET  group_concat_max_len = 1000000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1);

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	set de_053 = (select right(de_053,11));	
	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');






	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;





	if (length(de_114_127) > 0) then 

		select CONCAT('{"114.121":"',count(B.tbl_user_id ),'"}')
		from tbl_user as B, tbl_merchantfav as C 
		where B.tbl_user_id = C.tbl_merchant_nmcId 
		and C.tbl_consumer_nmcId = de_053
		and 
		(		UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
			or  UPPER(B.tbl_user_information) like CONCAT("%",UPPER(de_114_127),"%")
		) 
		order by C.tbl_merchantfav_date DESC
		limit INI,FIN;
		
	else

		select CONCAT('{"114.121":"',count(B.tbl_user_id),'"}')
		from tbl_user as B, tbl_merchantfav as C 
		where B.tbl_user_id  = C.tbl_merchant_nmcId 
		and C.tbl_consumer_nmcId = de_053
		order by C.tbl_merchantfav_date DESC
		limit INI,FIN;

	end if;
		


	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchGuideMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchGuideMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	






	SELECT 
        GROUP_CONCAT(    
			CONCAT('{"121.194":"', A.tbl_help_guide_id ,'"'),
			CONCAT(',"120.83":"',if(A.tbl_help_guide_title is null,'', A.tbl_help_guide_title) ,'"'),
			CONCAT(',"120.157":"',if(A.tbl_help_guide_description is null,'',A.tbl_help_guide_description ),'"}')	
        ) as JSON

	from tbl_help_guide as A
		
	where 
	(		
			UPPER(A.tbl_help_guide_title) like CONCAT("%",UPPER(de_114_127),"%")
		or 	UPPER(A.tbl_help_guide_description) like CONCAT("%",UPPER(de_114_127),"%")
	)

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchMerchant010400223` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchMerchant010400223`(PARAM VARCHAR(4000))
BEGIN 














	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;   
	DECLARE FIN       BIGINT	   DEFAULT 0;   

	DECLARE de_114_127  VARCHAR(255) DEFAULT 0;		
	DECLARE de_127_010  VARCHAR(3) DEFAULT 0;		





	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET  group_concat_max_len = 1000000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1);

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	SET de_127_010 = (select DATA from TBL_MESSAGE1 where CODE = '127.10');





	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;





	if (length(de_114_127) > 0) then 

		if de_127_010 != '001' then

			select 
			GROUP_CONCAT(
				CONCAT('{"53":"', GetNMCID(W.tbl_user_id),'"'),
				CONCAT(',"114.70":"', COALESCE(W.tbl_user_companyName,''),'"'),
				CONCAT(',"121.170":"', COALESCE(W.tbl_merchant_logoimage,''),'"'), 
				CONCAT(',"127.66":"', COALESCE(W.tbl_user_information,''),'"'), 
				CONCAT(',"114.11":"', COALESCE(W.tbl_gender_type,''),'"'),
				CONCAT(',"CA":[',dbitems.getNMCCategoryUserMobile(W.tbl_user_id),']'),
				CONCAT(',"AD":[',dbuser.getNMCAddressByUser(W.tbl_user_id),']'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(W.tbl_user_id),']}')
			)  as JSON
			
			from 
			
				(select B.tbl_user_id, 
				B.tbl_user_companyName, 
				A.tbl_merchant_logoimage, 
				B.tbl_user_information, 
				B.tbl_gender_type
				from tbl_merchant as A, tbl_user as B
				where A.tbl_user_id = B.tbl_user_id
				and B.tbl_owner_id = de_127_010
				and 
				(		UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_information) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
				) 
				limit INI,FIN ) as W;

		else

			select 
			GROUP_CONCAT(
				CONCAT('{"53":"', GetNMCID(W.tbl_user_id),'"'),
				CONCAT(',"114.70":"', COALESCE(W.tbl_user_companyName,''),'"'),
				CONCAT(',"121.170":"', COALESCE(W.tbl_merchant_logoimage,''),'"'), 
				CONCAT(',"127.66":"', COALESCE(W.tbl_user_information,''),'"'), 
				CONCAT(',"114.11":"', COALESCE(W.tbl_gender_type,''),'"'),
				CONCAT(',"CA":[',dbitems.getNMCCategoryUserMobile(W.tbl_user_id),']'),
				CONCAT(',"AD":[',dbuser.getNMCAddressByUser(W.tbl_user_id),']'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(W.tbl_user_id),']}')
			)  as JSON
			
			from
			
				(select B.tbl_user_id, 
				B.tbl_user_companyName, 
				A.tbl_merchant_logoimage, 
				B.tbl_user_information, 
				B.tbl_gender_type		
				from tbl_merchant as A, tbl_user as B
				where A.tbl_user_id = B.tbl_user_id
				and 
				(		UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_information) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
				) 
				limit INI,FIN ) as W;

		end if;

	else

		if de_127_010 != '001' then

			select 
			GROUP_CONCAT(
				CONCAT('{"53":"', GetNMCID(W.tbl_user_id),'"'),
				CONCAT(',"114.70":"', COALESCE(W.tbl_user_companyName,''),'"'),
				CONCAT(',"121.170":"', COALESCE(W.tbl_merchant_logoimage,''),'"'), 
				CONCAT(',"127.66":"', COALESCE(W.tbl_user_information,''),'"'), 
				CONCAT(',"114.11":"', COALESCE(W.tbl_gender_type,''),'"'), 
				CONCAT(',"CA":[',dbitems.getNMCCategoryUserMobile(W.tbl_user_id),']'),
				CONCAT(',"AD":[',dbuser.getNMCAddressByUser(W.tbl_user_id),']'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(W.tbl_user_id),']}')
			)  as JSON
			
			from
			
				(select B.tbl_user_id, 
				B.tbl_user_companyName, 
				A.tbl_merchant_logoimage, 
				B.tbl_user_information, 
				B.tbl_gender_type	
			
				from tbl_merchant as A, tbl_user as B
				where A.tbl_user_id = B.tbl_user_id
				and B.tbl_owner_id = de_127_010
				limit INI,FIN ) as W;

		else
 
			select 
			GROUP_CONCAT(
				CONCAT('{"53":"', GetNMCID(W.tbl_user_id),'"'),
				CONCAT(',"114.70":"', COALESCE(W.tbl_user_companyName,''),'"'),
				CONCAT(',"121.170":"', COALESCE(W.tbl_merchant_logoimage,''),'"'), 
				CONCAT(',"127.66":"', COALESCE(W.tbl_user_information,''),'"'), 
				CONCAT(',"114.11":"', COALESCE(W.tbl_gender_type,''),'"'), 
				CONCAT(',"CA":[',dbitems.getNMCCategoryUserMobile(W.tbl_user_id),']'),
				CONCAT(',"AD":[',dbuser.getNMCAddressByUser(W.tbl_user_id),']'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(W.tbl_user_id),']}')
			)  as JSON
			
			from
			
				(select B.tbl_user_id, 
				B.tbl_user_companyName, 
				A.tbl_merchant_logoimage, 
				B.tbl_user_information, 
				B.tbl_gender_type	
			
				from tbl_merchant as A, tbl_user as B
				where A.tbl_user_id = B.tbl_user_id
				limit INI,FIN ) as W;

		end if;

	end if;
		


	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchMerchantByCategoryMobile010400645` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SearchMerchantByCategoryMobile010400645`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: GetMerchantByCategoryMobile010400645
-- Method: 010400645
-- Version: 1.0
-- Last modified: 2017-10-19
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;   -- START LIMIT
	DECLARE FIN       BIGINT	   DEFAULT 0;   -- END LIMIT

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;        -- 53 User Id
	DECLARE de_114_127  VARCHAR(255) DEFAULT 0;		-- 114.127 Search

-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET  group_concat_max_len = 1000000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1);

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	
	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	
-- -------------		
-- Limits     --
-- -------------

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;

-- ---------------		
-- Query of DB  --
-- ---------------

	if (length(de_114_127) > 0) then 

		select 
		GROUP_CONCAT(
			CONCAT('{"114.93":"',COALESCE(W.tbl_category_id,''),'"'), 
			-- CONCAT(',"120.45":"',COALESCE(if (W.tbl_category_name='root',W.tbl_subcategory_name,CONCAT(W.tbl_category_name,' - ',W.tbl_subcategory_name)),''),'"'),
			CONCAT(',"120.45":"',COALESCE(if (W.tbl_category_level<=2, W.tbl_subcategory_name,CONCAT(W.tbl_category_name,' - ',W.tbl_subcategory_name)),''),'"'), 
            CONCAT(',"120.83":"',COALESCE(dbitems.GetCategoryNameLVL1(W.tbl_category_id),''),'"'), 
            CONCAT(',"120.44":"', COALESCE(W.tbl_category_level,''),'"'), 
			CONCAT(',"122.21":"', COALESCE(W.tbl_category_parentId,''),'"'), 			
			CONCAT(',"114.121":"', COALESCE(dbuser.searchNMCMerchantCounterByCategory(W.tbl_category_id,de_114_127),'0'),'"'), 
			CONCAT(',"ME":[', COALESCE(dbuser.searchNMCMerchantByCategory(W.tbl_category_id,de_053,de_114_127),''),']}')
		)  as JSON
	
		from 
		
			(
            select
			A.tbl_category_id,
			A.tbl_category_level,
			A.tbl_category_parentId,
			D.tbl_categorydescription_name as tbl_category_name,
            B.tbl_categorydescription_name as tbl_subcategory_name

			from dbitems.tbl_category as A 
			left join dbitems.tbl_categorydescription as B on A.tbl_category_id = B.tbl_category_id 
			left join dbitems.tbl_category as C on A.tbl_category_parentId = C.tbl_category_id 
			left join dbitems.tbl_categorydescription as D on C.tbl_category_id = D.tbl_category_id 
			where B.tbl_language_id = 1 
			and A.tbl_category_active = 1 
			and dbuser.searchNMCMerchantCounterByCategory(A.tbl_category_id,de_114_127) > 0
			and length(D.tbl_categorydescription_name)>0
            order by D.tbl_category_id, B.tbl_categorydescription_name ASC
			limit INI,FIN ) as W
            order by W.tbl_category_id, W.tbl_subcategory_name ASC
            ;

	else

		select 
		GROUP_CONCAT(
			CONCAT('{"114.93":"',COALESCE(W.tbl_category_id,''),'"'), 
			-- CONCAT(',"120.45":"',COALESCE(if (W.tbl_category_name='root',W.tbl_subcategory_name,CONCAT(W.tbl_category_name,' - ',W.tbl_subcategory_name)),''),'"'), 
			CONCAT(',"120.45":"',COALESCE(if (W.tbl_category_level<=2, W.tbl_subcategory_name,CONCAT(W.tbl_category_name,' - ',W.tbl_subcategory_name)),''),'"'), 
            CONCAT(',"120.83":"',COALESCE(dbitems.GetCategoryNameLVL1(W.tbl_category_id),''),'"'), 
            CONCAT(',"120.44":"', COALESCE(W.tbl_category_level,''),'"'), 
			CONCAT(',"122.21":"', COALESCE(W.tbl_category_parentId,''),'"'), 
			CONCAT(',"114.121":"', COALESCE(dbuser.getNMCMerchantCounterByCategory(W.tbl_category_id),'0'),'"'), 
			CONCAT(',"ME":[', COALESCE(dbuser.getNMCMerchantByCategory(W.tbl_category_id,de_053),''),']}')
		)  as JSON
	
		from 
		
			(
            select
			A.tbl_category_id,
			A.tbl_category_level,
			A.tbl_category_parentId,
			D.tbl_categorydescription_name as tbl_category_name,
            B.tbl_categorydescription_name as tbl_subcategory_name

			from dbitems.tbl_category as A 
			left join dbitems.tbl_categorydescription as B on A.tbl_category_id = B.tbl_category_id 
			left join dbitems.tbl_category as C on A.tbl_category_parentId = C.tbl_category_id 
			left join dbitems.tbl_categorydescription as D on C.tbl_category_id = D.tbl_category_id 
			where B.tbl_language_id = 1 
			and A.tbl_category_active = 1 
			and dbuser.getNMCMerchantCounterByCategory(A.tbl_category_id) > 0
			and length(D.tbl_categorydescription_name)>0
            order by D.tbl_category_id, B.tbl_categorydescription_name ASC
			limit INI,FIN ) as W
            order by W.tbl_category_id, W.tbl_subcategory_name ASC
            ;

	end if;
		
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchMerchantNear010400239` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchMerchantNear010400239`(PARAM VARCHAR(4000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_114_127  VARCHAR(255) DEFAULT 0;		
	DECLARE de_127_010  VARCHAR(3) DEFAULT 0;		
	DECLARE de_120_038 VARCHAR(20) DEFAULT 0; 
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0; 
	SET  group_concat_max_len = 1000000;




	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	SET de_127_010 = (select DATA from TBL_MESSAGE1 where CODE = '127.10');
	SET de_120_038 = (select DATA from TBL_MESSAGE1 where CODE = '120.38'); 
	SET de_120_039 = (select DATA from TBL_MESSAGE1 where CODE = '120.39'); 





	IF (length(de_114_127) > 0) then 

		if de_127_010 != '001' then

				select 
				GROUP_CONCAT(
					CONCAT('{"53":"', GetNMCID(B.tbl_user_id),'"'),
					CONCAT(',"114.70":"', COALESCE(B.tbl_user_companyName,''),'"'),
					CONCAT(',"121.170":"', COALESCE(A.tbl_merchant_logoimage,''),'"'), 
					CONCAT(',"127.66":"', COALESCE(B.tbl_user_information,''),'"'), 
					CONCAT(',"114.11":"', COALESCE(B.tbl_gender_type,''),'"'),
					CONCAT(',"47.8":"',COALESCE(Y.distance,''),'"'),
					CONCAT(',"CA":[',dbitems.getNMCCategoryUser(B.tbl_user_id),']'),
					CONCAT(',"LO":',dbuser.getNMCLocation(Y.LocationID),''),
					CONCAT(',"AD":[',dbuser.getNMCAddressByUser(B.tbl_user_id),']'),
					CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(B.tbl_user_id),']}')
				)  as JSON
				
				from tbl_merchant as A, 
				tbl_user as B,
				(select W.UserId,W.distance,W.LocationID from(
										select A.tbl_user_id as UserId,
											C.tbl_location_id as LocationID,
											(0.621371192 * (6371 * acos( cos( radians(de_120_038) ) * cos( radians(C.tbl_location_latitude) ) * cos( radians(C.tbl_location_longitude) - radians(de_120_039) ) + sin( radians(de_120_038) ) * sin( radians(C.tbl_location_latitude) ) ))) distance
											from dbuser.tbl_merchant as A, 
											dbuser.tbl_user as B,
											dbuser.tbl_location as C
											
											where  A.tbl_user_id = B.tbl_user_id
											and C.tbl_location_userId = A.tbl_user_id
											group by A.tbl_user_id
										)as W
										where W.distance < 5) as Y
		
				where A.tbl_user_id = B.tbl_user_id
				and B.tbl_owner_id = de_127_010
				and A.tbl_user_id = Y.UserId
				and 
				(		UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_information) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
					or  UPPER(B.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
				);

		else

				select 
			GROUP_CONCAT(
				CONCAT('{"53":"', GetNMCID(B.tbl_user_id),'"'),
				CONCAT(',"114.70":"', COALESCE(B.tbl_user_companyName,''),'"'),
				CONCAT(',"121.170":"', COALESCE(A.tbl_merchant_logoimage,''),'"'), 
				CONCAT(',"127.66":"', COALESCE(B.tbl_user_information,''),'"'), 
				CONCAT(',"114.11":"', COALESCE(B.tbl_gender_type,''),'"'),
				CONCAT(',"47.8":"',COALESCE(Y.distance,''),'"'),
				CONCAT(',"CA":[',dbitems.getNMCCategoryUser(B.tbl_user_id),']'),
				CONCAT(',"LO":',dbuser.getNMCLocation(Y.LocationID),''),
				CONCAT(',"AD":[',dbuser.getNMCAddressByUser(B.tbl_user_id),']'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(B.tbl_user_id),']}')
			)  as JSON
			
			from tbl_merchant as A, 
			tbl_user as B,
			(select W.UserId,W.distance,W.LocationID from(
									select A.tbl_user_id as UserId,
										C.tbl_location_id as LocationID,
										(0.621371192 * (6371 * acos( cos( radians(de_120_038) ) * cos( radians(C.tbl_location_latitude) ) * cos( radians(C.tbl_location_longitude) - radians(de_120_039) ) + sin( radians(de_120_038) ) * sin( radians(C.tbl_location_latitude) ) ))) distance
										from dbuser.tbl_merchant as A, 
										dbuser.tbl_user as B,
										dbuser.tbl_location as C
										
										where  A.tbl_user_id = B.tbl_user_id
										and C.tbl_location_userId = A.tbl_user_id
										group by A.tbl_user_id
									)as W
									where W.distance < 5) as Y
	
			where A.tbl_user_id = B.tbl_user_id
			and B.tbl_owner_id 
			and A.tbl_user_id = Y.UserId
			and 
			(		UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_information) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
			);

		end if;

	ELSE
		
		if de_127_010 != '001' then
			select 
			GROUP_CONCAT(
				CONCAT('{"53":"', GetNMCID(B.tbl_user_id),'"'),
				CONCAT(',"114.70":"', COALESCE(B.tbl_user_companyName,''),'"'),
				CONCAT(',"121.170":"', COALESCE(A.tbl_merchant_logoimage,''),'"'), 
				CONCAT(',"127.66":"', COALESCE(B.tbl_user_information,''),'"'), 
				CONCAT(',"114.11":"', COALESCE(B.tbl_gender_type,''),'"'),
				CONCAT(',"47.8":"',COALESCE(Y.distance,''),'"'),
				CONCAT(',"CA":[',dbitems.getNMCCategoryUser(B.tbl_user_id),']'),
				CONCAT(',"LO":',dbuser.getNMCLocation(Y.LocationID),''),
				CONCAT(',"AD":[',dbuser.getNMCAddressByUser(B.tbl_user_id),']'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(B.tbl_user_id),']}')
			)  as JSON
			
			from tbl_merchant as A, 
			tbl_user as B,
			(select W.UserId,W.distance,W.LocationID from(
									select A.tbl_user_id as UserId,
										C.tbl_location_id as LocationID,
										(0.621371192 * (6371 * acos( cos( radians(de_120_038) ) * cos( radians(C.tbl_location_latitude) ) * cos( radians(C.tbl_location_longitude) - radians(de_120_039) ) + sin( radians(de_120_038) ) * sin( radians(C.tbl_location_latitude) ) ))) distance
										from dbuser.tbl_merchant as A, 
										dbuser.tbl_user as B,
										dbuser.tbl_location as C
										
										where  A.tbl_user_id = B.tbl_user_id
										and C.tbl_location_userId = A.tbl_user_id
										group by A.tbl_user_id
									)as W
									where W.distance < 5) as Y
	
			where A.tbl_user_id = B.tbl_user_id
			and B.tbl_owner_id = de_127_010
			and A.tbl_user_id = Y.UserId
			
			;

		else

			select 
			GROUP_CONCAT(
				CONCAT('{"53":"', GetNMCID(B.tbl_user_id),'"'),
				CONCAT(',"114.70":"', COALESCE(B.tbl_user_companyName,''),'"'),
				CONCAT(',"121.170":"', COALESCE(A.tbl_merchant_logoimage,''),'"'), 
				CONCAT(',"127.66":"', COALESCE(B.tbl_user_information,''),'"'), 
				CONCAT(',"114.11":"', COALESCE(B.tbl_gender_type,''),'"'),
				CONCAT(',"47.8":"',COALESCE(Y.distance,''),'"'),
				CONCAT(',"CA":[',dbitems.getNMCCategoryUser(B.tbl_user_id),']'),
				CONCAT(',"LO":',dbuser.getNMCLocation(Y.LocationID),''),
				CONCAT(',"AD":[',dbuser.getNMCAddressByUser(B.tbl_user_id),']'),
				CONCAT(',"PH":[',dbuser.getNMCPhoneByUser(B.tbl_user_id),']}')
			)  as JSON
			
			from tbl_merchant as A, 
			tbl_user as B,
			(select W.UserId,W.distance,W.LocationID from(
									select A.tbl_user_id as UserId,
										C.tbl_location_id as LocationID,
										(0.621371192 * (6371 * acos( cos( radians(de_120_038) ) * cos( radians(C.tbl_location_latitude) ) * cos( radians(C.tbl_location_longitude) - radians(de_120_039) ) + sin( radians(de_120_038) ) * sin( radians(C.tbl_location_latitude) ) ))) distance
										from dbuser.tbl_merchant as A, 
										dbuser.tbl_user as B,
										dbuser.tbl_location as C
										
										where  A.tbl_user_id = B.tbl_user_id
										and C.tbl_location_userId = A.tbl_user_id
										group by A.tbl_user_id
									)as W
									where W.distance < 5) as Y
	
			where A.tbl_user_id = B.tbl_user_id
			and B.tbl_owner_id 
			and A.tbl_user_id = Y.UserId
			
			;

		end if;

	END IF;
		
 

	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchMerchantsByLocationMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchMerchantsByLocationMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_120_038 VARCHAR(20) DEFAULT 0; 
	DECLARE de_120_039 VARCHAR(20) DEFAULT 0; 
	
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');


	SET de_120_038 = (select DATA from TBL_MESSAGE1 where CODE = '120.38'); 
	SET de_120_039 = (select DATA from TBL_MESSAGE1 where CODE = '120.39'); 
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
		GROUP_CONCAT(           
			CONCAT('{"114.179":"', W.tbl_merchant_nmcId,'"'),
			CONCAT(',"114.70":"', if (W.tbl_user_companyName is null,'', W.tbl_user_companyName),'"'),
			CONCAT(',"121.170":"', if (W.tbl_merchant_logoimage is null,'', W.tbl_merchant_logoimage),'"}')
		) as JSON
			
	FROM

		(select A.tbl_merchant_nmcId, 
			if (B.tbl_user_companyName is null,'', B.tbl_user_companyName) tbl_user_companyName,
			if (A.tbl_merchant_logoimage is null,'', A.tbl_merchant_logoimage) tbl_merchant_logoimage,
			min(0.621371192 * (6371 * acos( cos( radians(de_120_038) ) * cos( radians(C.tbl_location_latitude) ) * cos( radians(C.tbl_location_longitude) - radians(de_120_039) ) + sin( radians(de_120_038) ) * sin( radians(C.tbl_location_latitude) ) ))) distance
		from tbl_merchant as A,
			 tbl_user as B,
			 tbl_location as C
		where A.tbl_user_id = B.tbl_user_id
		and A.tbl_merchant_nmcId = C.tbl_location_userId
		group by A.tbl_merchant_nmcId 
		
		) as W

	WHERE W.distance < 2
	ORDER BY W.distance
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchMerchantsMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchMerchantsMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_127 VARCHAR(255) DEFAULT NULL;   

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');


	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



 
	IF (length(de_114_127) > 0) then

		SELECT 
			GROUP_CONCAT(           
				CONCAT('{"114.179":"', A.tbl_merchant_nmcId,'"'),
				CONCAT(',"114.70":"', if (B.tbl_user_companyName is null,'', B.tbl_user_companyName),'"'),
				CONCAT(',"121.170":"', if (A.tbl_merchant_logoimage is null,'', A.tbl_merchant_logoimage),'"}')
			) as JSON
		
		from tbl_merchant as A,
			 tbl_user as B
		where A.tbl_user_id = B.tbl_user_id
		and 
			(		UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
			)
		LIMIT INI,FIN;

	ELSE

		SELECT 
			GROUP_CONCAT(           
				CONCAT('{"114.179":"', A.tbl_merchant_nmcId,'"'),
				CONCAT(',"114.70":"', if (B.tbl_user_companyName is null,'', B.tbl_user_companyName),'"'),
				CONCAT(',"121.170":"', if (A.tbl_merchant_logoimage is null,'', A.tbl_merchant_logoimage),'"}')
			) as JSON
		
		from tbl_merchant as A,
			 tbl_user as B
		where A.tbl_user_id = B.tbl_user_id
		LIMIT INI,FIN;

	END IF;


    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchNMCContactFormTicketNoteMessage010400265` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SearchNMCContactFormTicketNoteMessage010400265`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: SearchNMCContactFormTicketNoteMessage010400265 
-- Method: 010400265
-- Version: 1.0
-- Last modified: 2014--04
-- --------------------------------------------------------
 
-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_053	    VARCHAR(20) DEFAULT 0; 		    -- 53 Sender
	DECLARE de_114_179	VARCHAR(20) DEFAULT 0; 		    -- 114.179 Receiver
	DECLARE de_123_031	VARCHAR(20) DEFAULT 0; 		    -- 123.31 Assigned
	
	DECLARE de_114_009  VARCHAR(5) DEFAULT NULL;		-- 114.127 Flag 
	DECLARE de_122_114  INT(11) DEFAULT 0;				-- 122.114 Help Ticket Id 
	DECLARE de_114_150  INT(11) DEFAULT 0;				-- 122.114 Parent Id 
	DECLARE de_120_016  INT(11) DEFAULT 0;				-- 122.114 Help Ticket Type
	DECLARE de_114_143  INT(11) DEFAULT 0;				-- 122.114 Status 
	DECLARE de_121_075  INT(11) DEFAULT 0;				-- 121.75 Invoice Id 
	DECLARE de_114_144  INT(11) DEFAULT 0;				-- 114.144 Product Id 

	DECLARE de_114_127  VARCHAR(255) DEFAULT NULL; 		-- 114.127 Search
	DECLARE JSON TEXT;
	
	DECLARE INI       BIGINT       DEFAULT 1;   -- START LIMIT
	DECLARE FIN       BIGINT        DEFAULT 0;   -- END LIMIT
	
-- -'------------------
-- Declare auxiliary --
-- -------------------- 

	SET  group_concat_max_len = 1000000;
	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	SET de_053 = (select right(de_053,11)) ;
	SET de_114_179 = (select DATA from TBL_MESSAGE1 where CODE = '114.179');
	SET de_114_179 = (select right(de_114_179,11)) ;
	SET de_123_031 = (select DATA from TBL_MESSAGE1 where CODE = '123.31');
	SET de_123_031 = (select right(de_123_031,11)) ;

	
	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	SET de_114_009 = (select DATA from TBL_MESSAGE1 where CODE = '114.9');
	SET de_122_114 = (select DATA from TBL_MESSAGE1 where CODE = '122.114');
	SET de_114_150 = (select DATA from TBL_MESSAGE1 where CODE = '114.150');
	SET de_120_016 = (select DATA from TBL_MESSAGE1 where CODE = '120.16');
	SET de_114_143 = (select DATA from TBL_MESSAGE1 where CODE = '114.143');
	SET de_121_075 = (select DATA from TBL_MESSAGE1 where CODE = '121.75');
	SET de_114_144 = (select DATA from TBL_MESSAGE1 where CODE = '114.144');
	

-- -------------		
-- Limits     --
-- -------------

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;	
	
-- ---------------		
-- Query of DB  --
-- ---------------

SET JSON=(
	select 
		GROUP_CONCAT(
			CONCAT('{"122.114":"',W.id,'"'),
			CONCAT(',"122.128":"',coalesce(W.tbl_help_ticket_subject,''),'"'),
			CONCAT(',"114.143":"',coalesce(W.tbl_help_ticket_status,''),'"'),
			CONCAT(',"53":"',coalesce((select dbuser.getnmcid(W.tbl_help_ticket_sender)),''),'"'),
			CONCAT(',"114.179":"',coalesce((select dbuser.getnmcid(W.tbl_help_ticket_receiver)),''),'"'),
			CONCAT(',"123.31":"',coalesce((select dbuser.getnmcid(W.tbl_help_ticket_assigned)),''),'"'),
			CONCAT(',"114.53":"',coalesce(dbuser.getNMCUserName((select right(W.tbl_help_ticket_assigned,11))),''),'"'),
			CONCAT(',"122.181":"',coalesce(dbuser.getNMCUserName((select right(W.tbl_help_ticket_sender,11))),''),'"'),
			CONCAT(',"114.150":"',coalesce(W.tbl_parent_id,0),'"'),
			CONCAT(',"114.138":"',coalesce(W.tbl_help_ticket_date,''),'"'),
			CONCAT(',"114.139":"',coalesce(dbuser.getHelpTicketLastDate(W.id),''),'"'),
			CONCAT(',"120.16":"',coalesce(W.tbl_help_ticket_type,''),'"'), 
			CONCAT(',"120.157":"',coalesce(hex(W.tbl_help_ticket_content),''),'"'),
			CONCAT(',"121.75":"',coalesce(W.tbl_invoice_id,''),'"'),
			CONCAT(',"121.170":"',coalesce(W.tbl_merchant_logoimage_a,W.tbl_merchant_logoimage_b,''),'"'), 
			CONCAT(',"114.144":"',coalesce(W.tbl_product_id,''),'"}')
		)  as JSON

	from 
	
	(select 
	tbl_help_ticket.id,
	tbl_help_ticket.tbl_help_ticket_subject,
	tbl_help_ticket.tbl_help_ticket_status,
	tbl_help_ticket.tbl_help_ticket_sender,
	tbl_help_ticket.tbl_help_ticket_receiver,
	tbl_help_ticket.tbl_help_ticket_assigned,
	tbl_help_ticket.tbl_parent_id,
	tbl_help_ticket.tbl_help_ticket_date,
	tbl_help_ticket.tbl_help_ticket_type,
	tbl_help_ticket.tbl_help_ticket_content,
	tbl_help_ticket.tbl_invoice_id,
    tbl_help_ticket.tbl_product_id,
	A.tbl_merchant_logoimage as tbl_merchant_logoimage_a,
    B.tbl_merchant_logoimage as tbl_merchant_logoimage_b,
	tbl_help_ticket.tbl_item_id_share
	from dbuser.tbl_help_ticket 
	left join dbuser.tbl_merchant as A on tbl_help_ticket.tbl_help_ticket_sender = A.tbl_user_id
	left join dbuser.tbl_merchant as B on tbl_help_ticket.tbl_help_ticket_receiver = A.tbl_user_id
    
	where 
	
	if(de_114_009 ='true', tbl_help_ticket.id = tbl_help_ticket.tbl_parent_id, tbl_help_ticket.id = tbl_help_ticket.id)

	and if(length(de_114_127)>0 ,
	(       UPPER(tbl_help_ticket.tbl_help_ticket_subject) like CONCAT("%",UPPER(de_114_127),"%")
		or  UPPER(tbl_help_ticket.tbl_help_ticket_content) like CONCAT("%",UPPER(de_114_127),"%")
	) , tbl_help_ticket.id)

	and if(length(de_122_114)>0 , 
			tbl_help_ticket.id = de_122_114,
			tbl_help_ticket.id)

	and if(length(de_114_150)>0 , 
			tbl_help_ticket.tbl_parent_id = de_114_150,
			tbl_help_ticket.id)

	and if(length(de_120_016)>0 , 
			tbl_help_ticket.tbl_help_ticket_type = de_120_016,
			tbl_help_ticket.id)

	and if(length(de_114_143)>0 , 
			tbl_help_ticket.tbl_help_ticket_status = de_114_143,
			tbl_help_ticket.id)

	and if(length(de_053)>0 , 
			tbl_help_ticket.tbl_help_ticket_sender = de_053,
			tbl_help_ticket.id)

	and if(length(de_114_179)>0 , 
			tbl_help_ticket.tbl_help_ticket_receiver = de_114_179,
			tbl_help_ticket.id)

	and if(length(de_123_031)>0 , 
			tbl_help_ticket.tbl_help_ticket_assigned = de_123_031,
			tbl_help_ticket.id)
	 
	and if(length(de_121_075)>0 , 
			tbl_help_ticket.tbl_invoice_id = de_121_075,
			tbl_help_ticket.id)
	
	and if(length(de_114_144)>0 , 
			tbl_help_ticket.tbl_product_id = de_114_144,
			tbl_help_ticket.id)

	limit INI,FIN) as W);
    

IF JSON is NULL THEN
	SET JSON = '{}';
END IF;

SELECT JSON;

	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchProfileLeadByUser010400673` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SearchProfileLeadByUser010400673`(PARAM VARCHAR(20000))
BEGIN 
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_053 VARCHAR(50) DEFAULT NULL; 
	DECLARE de_114_127 VARCHAR(255) DEFAULT NULL;		
    DECLARE de_114_093 INT(11) DEFAULT 0;  
    DECLARE de_127_060  VARCHAR(45) DEFAULT NULL;	-- 127.60 Extra-param (ORDER BY)
	
    DECLARE de_COUNT  VARCHAR(5) DEFAULT 0;			-- COUNT flag
    
-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DECLARE COUNT_AUX  INTEGER(11) DEFAULT NULL;	
	DECLARE JSON TEXT DEFAULT NULL;
    
-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- -----------------	
-- Set variables --
-- -----------------

	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
    
    SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
    SET de_114_093 = (select DATA from TBL_MESSAGE1 where CODE = '114.93');
    
    SET de_127_060 = (select DATA from TBL_MESSAGE1 where CODE = '127.60');
	
    SET de_COUNT = (select DATA from TBL_MESSAGE1 where CODE = 'COUNT');

    
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
    
-- ---------------		
-- Query of DB --
-- ---------------

	if (length(de_114_127) > 0) then 
    
				set COUNT_AUX = (
            
					select  count(A.tbl_user_id)
					from tbl_user as A 
					left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
					
					where A.tbl_user_entity = 25 
					and if(length(de_053)>0,B.tbl_user_reseller_id = de_053,A.tbl_user_id)
					and (if(length(de_114_093)>0, de_114_093 in (select D.tbl_category_parentId from dbuser.tbl_merchantbusinesscategory as C,dbitems.tbl_category as D where A.tbl_user_id = C.tbl_merchant_nmcId  and C.tbl_businesscategory_id = D.tbl_category_id),A.tbl_user_id)		  
						or if(length(de_114_093)>0, de_114_093 in (select C.tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory as C where A.tbl_user_id = C.tbl_merchant_nmcId),A.tbl_user_id))
                    and 
					(		UPPER(A.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
						or  UPPER(A.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
						or  UPPER(A.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
						or  UPPER(A.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
					) 
					
				);
    
		
    else
    

					set COUNT_AUX = (
            
						select  count(A.tbl_user_id)
						from tbl_user as A 
						left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
						
						where A.tbl_user_entity = 25 
						and if(length(de_053)>0,B.tbl_user_reseller_id = de_053,A.tbl_user_id)
						and (if(length(de_114_093)>0, de_114_093 in (select D.tbl_category_parentId from dbuser.tbl_merchantbusinesscategory as C,dbitems.tbl_category as D where A.tbl_user_id = C.tbl_merchant_nmcId  and C.tbl_businesscategory_id = D.tbl_category_id),A.tbl_user_id)		  
							or if(length(de_114_093)>0, de_114_093 in (select C.tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory as C where A.tbl_user_id = C.tbl_merchant_nmcId),A.tbl_user_id))
                    
					);
    
		           
	end if;




CASE de_127_060 
  
WHEN '114.138-ASC' THEN

	if (length(de_114_127) > 0) then 

            
				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"53":"',     COALESCE(dbuser.getNMCID(W.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(W.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', COALESCE(hex(W.tbl_user_companyName),''),'"'),
						CONCAT(',"123.71":"', COALESCE(W.tbl_merchant_taxIdNumber ,''),'"'),
						CONCAT(',"114.7":"',  COALESCE(W.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(W.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(W.tbl_user_last,''),'"'),
						CONCAT(',"114.4":"',  COALESCE(W.tbl_user_middle,''),'"'),
						CONCAT(',"114.91":"', COALESCE(W.tbl_user_title,''),'"'),
                        CONCAT(',"114.138":"', COALESCE(W.tbl_user_dateAdded,''),'"'),
                        CONCAT(',"114.139":"', COALESCE(W.tbl_user_dateModified,''),'"'),
                        CONCAT(',"127.41":"', COALESCE(COUNT_AUX,'0'),'"'),
                        CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryLeadUser(W.tbl_user_id),''),']}')
                        
						)as JSON
					   
						from 
                        (select  A.tbl_user_id,
                        A.tbl_company_id,
                        A.tbl_user_companyName,
                        B.tbl_merchant_taxIdNumber,
                        A.tbl_user_email,
                        A.tbl_user_first,
                        A.tbl_user_last,
                        A.tbl_user_middle,
                        A.tbl_user_title,
                        A.tbl_user_dateAdded,
						A.tbl_user_dateModified
                        from tbl_user as A 
                        left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
						
						where A.tbl_user_entity = 25 
                        and if(length(de_053)>0,B.tbl_user_reseller_id = de_053,A.tbl_user_id)
                        and (if(length(de_114_093)>0, de_114_093 in (select D.tbl_category_parentId from dbuser.tbl_merchantbusinesscategory as C,dbitems.tbl_category as D where A.tbl_user_id = C.tbl_merchant_nmcId  and C.tbl_businesscategory_id = D.tbl_category_id),A.tbl_user_id)		  
							or if(length(de_114_093)>0, de_114_093 in (select C.tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory as C where A.tbl_user_id = C.tbl_merchant_nmcId),A.tbl_user_id))
                    
                        and 
						(		UPPER(A.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
							or  UPPER(A.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
							or  UPPER(A.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
							or  UPPER(A.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
						) 
                        order by A.tbl_user_dateAdded ASC
						LIMIT INI,FIN) as W;
    
    else
    
				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"53":"',     COALESCE(dbuser.getNMCID(W.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(W.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', COALESCE(hex(W.tbl_user_companyName),''),'"'),
						CONCAT(',"123.71":"', COALESCE(W.tbl_merchant_taxIdNumber ,''),'"'),
						CONCAT(',"114.7":"',  COALESCE(W.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(W.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(W.tbl_user_last,''),'"'),
						CONCAT(',"114.4":"',  COALESCE(W.tbl_user_middle,''),'"'),
						CONCAT(',"114.91":"', COALESCE(W.tbl_user_title,''),'"'),
                        CONCAT(',"114.138":"', COALESCE(W.tbl_user_dateAdded,''),'"'),
                        CONCAT(',"114.139":"', COALESCE(W.tbl_user_dateModified,''),'"'),
                        CONCAT(',"127.41":"', COALESCE(COUNT_AUX,'0'),'"'),
                        CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryLeadUser(W.tbl_user_id),''),']}')
                        
						)as JSON
					   
						from 
                        (select  A.tbl_user_id,
                        A.tbl_company_id,
                        A.tbl_user_companyName,
                        B.tbl_merchant_taxIdNumber,
                        A.tbl_user_email,
                        A.tbl_user_first,
                        A.tbl_user_last,
                        A.tbl_user_middle,
                        A.tbl_user_title,
                        A.tbl_user_dateAdded,
						A.tbl_user_dateModified
                        from tbl_user as A 
						left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
						
						where A.tbl_user_entity = 25
                        and if(length(de_053)>0,B.tbl_user_reseller_id = de_053,A.tbl_user_id)
						and (if(length(de_114_093)>0, de_114_093 in (select D.tbl_category_parentId from dbuser.tbl_merchantbusinesscategory as C,dbitems.tbl_category as D where A.tbl_user_id = C.tbl_merchant_nmcId  and C.tbl_businesscategory_id = D.tbl_category_id),A.tbl_user_id)		  
							or if(length(de_114_093)>0, de_114_093 in (select C.tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory as C where A.tbl_user_id = C.tbl_merchant_nmcId),A.tbl_user_id))
                    
                        order by A.tbl_user_dateAdded ASC
						LIMIT INI,FIN) as W;
                        
	end if;




WHEN '114.138-DESC' THEN

	if (length(de_114_127) > 0) then 

            
				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"53":"',     COALESCE(dbuser.getNMCID(W.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(W.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', COALESCE(hex(W.tbl_user_companyName),''),'"'),
						CONCAT(',"123.71":"', COALESCE(W.tbl_merchant_taxIdNumber ,''),'"'),
						CONCAT(',"114.7":"',  COALESCE(W.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(W.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(W.tbl_user_last,''),'"'),
						CONCAT(',"114.4":"',  COALESCE(W.tbl_user_middle,''),'"'),
						CONCAT(',"114.91":"', COALESCE(W.tbl_user_title,''),'"'),
                        CONCAT(',"114.138":"', COALESCE(W.tbl_user_dateAdded,''),'"'),
                        CONCAT(',"114.139":"', COALESCE(W.tbl_user_dateModified,''),'"'),
                        CONCAT(',"127.41":"', COALESCE(COUNT_AUX,'0'),'"'),
                        CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryLeadUser(W.tbl_user_id),''),']}')
                        
						)as JSON
					   
						from 
                        (select  A.tbl_user_id,
                        A.tbl_company_id,
                        A.tbl_user_companyName,
                        B.tbl_merchant_taxIdNumber,
                        A.tbl_user_email,
                        A.tbl_user_first,
                        A.tbl_user_last,
                        A.tbl_user_middle,
                        A.tbl_user_title,
                        A.tbl_user_dateAdded,
						A.tbl_user_dateModified
                        from tbl_user as A 
                        left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
						
						where A.tbl_user_entity = 25 
                        and if(length(de_053)>0,B.tbl_user_reseller_id = de_053,A.tbl_user_id)
                        and (if(length(de_114_093)>0, de_114_093 in (select D.tbl_category_parentId from dbuser.tbl_merchantbusinesscategory as C,dbitems.tbl_category as D where A.tbl_user_id = C.tbl_merchant_nmcId  and C.tbl_businesscategory_id = D.tbl_category_id),A.tbl_user_id)		  
							or if(length(de_114_093)>0, de_114_093 in (select C.tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory as C where A.tbl_user_id = C.tbl_merchant_nmcId),A.tbl_user_id))
                    
                        and 
						(		UPPER(A.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
							or  UPPER(A.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
							or  UPPER(A.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
							or  UPPER(A.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
						) 
                        order by A.tbl_user_dateAdded DESC
						LIMIT INI,FIN) as W;
    
    else
    
				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"53":"',     COALESCE(dbuser.getNMCID(W.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(W.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', COALESCE(hex(W.tbl_user_companyName),''),'"'),
						CONCAT(',"123.71":"', COALESCE(W.tbl_merchant_taxIdNumber ,''),'"'),
						CONCAT(',"114.7":"',  COALESCE(W.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(W.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(W.tbl_user_last,''),'"'),
						CONCAT(',"114.4":"',  COALESCE(W.tbl_user_middle,''),'"'),
						CONCAT(',"114.91":"', COALESCE(W.tbl_user_title,''),'"'),
                        CONCAT(',"114.138":"', COALESCE(W.tbl_user_dateAdded,''),'"'),
                        CONCAT(',"114.139":"', COALESCE(W.tbl_user_dateModified,''),'"'),
                        CONCAT(',"127.41":"', COALESCE(COUNT_AUX,'0'),'"'),
                        CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryLeadUser(W.tbl_user_id),''),']}')
                        
						)as JSON
					   
						from 
                        (select  A.tbl_user_id,
                        A.tbl_company_id,
                        A.tbl_user_companyName,
                        B.tbl_merchant_taxIdNumber,
                        A.tbl_user_email,
                        A.tbl_user_first,
                        A.tbl_user_last,
                        A.tbl_user_middle,
                        A.tbl_user_title,
                        A.tbl_user_dateAdded,
						A.tbl_user_dateModified
                        from tbl_user as A 
						left join tbl_merchant as B on A.tbl_user_id = B.tbl_user_id
						
						where A.tbl_user_entity = 25
                        and if(length(de_053)>0,B.tbl_user_reseller_id = de_053,A.tbl_user_id)
						and (if(length(de_114_093)>0, de_114_093 in (select D.tbl_category_parentId from dbuser.tbl_merchantbusinesscategory as C,dbitems.tbl_category as D where A.tbl_user_id = C.tbl_merchant_nmcId  and C.tbl_businesscategory_id = D.tbl_category_id),A.tbl_user_id)		  
							or if(length(de_114_093)>0, de_114_093 in (select C.tbl_businesscategory_id from dbuser.tbl_merchantbusinesscategory as C where A.tbl_user_id = C.tbl_merchant_nmcId),A.tbl_user_id))
                    
                        order by A.tbl_user_dateAdded DESC
						LIMIT INI,FIN) as W;
                        
	end if;
    
 END CASE;   
    
    
	DROP TABLE TBL_MESSAGE1;
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchStoreDetailsMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchStoreDetailsMobile`(PARAM VARCHAR(20000))
BEGIN 











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_122_119 INT(11) 		DEFAULT NULL;
	DECLARE de_114_127 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_053 	   INT(18) 		DEFAULT NULL;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET  group_concat_max_len = 1000000;
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');


	SET de_122_119 = (select DATA from TBL_MESSAGE1 where CODE = '122.119');
	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



select 
	GROUP_CONCAT(
              	CONCAT('{"121.170":"',coalesce(P.tbl_product_image,''),'"'),
				CONCAT(',"47.33":"',coalesce(P.tbl_product_name,''),'"'),
				CONCAT(',"122.158":"',P.tbl_product_salediscount,'"'),
				CONCAT(',"120.157":"',coalesce(P.tbl_product_description,''),'"'),
				CONCAT(',"114.112":"',P.tbl_producttype_id,'"'),
				CONCAT(',"114.144":"',P.tbl_product_id,'"'),
				CONCAT(',"114.9":"',coalesce(P.tbl_product_barcode,''),'"'),
				CONCAT(',"121.108":"',P.tbl_barcodetype_id,'"'),
				CONCAT(',"120.103":"',if(PF.tbl_product_id is null,0,1),'"}')
			  ) as JSON

	FROM tbl_location L, 
		 dbitems.tbl_productlocation PL, 
		 dbitems.tbl_product P left join dbitems.tbl_productfav PF on P.tbl_product_id = PF.tbl_product_id and  PF. tbl_productfav_nmcid = de_053
	where L.tbl_location_id = PL.tbl_location_id
	and PL.tbl_product_id = P.tbl_product_id
	and P.tbl_producttype_id > 0
	and P.tbl_productstatus_id = 1001
	and length(P.tbl_product_saleprice)>0
	and L.tbl_location_id = de_122_119
	and	(		
				UPPER(P.tbl_product_name) like CONCAT("%",UPPER(de_114_127),"%")
			or 	UPPER(P.tbl_product_description) like CONCAT("%",UPPER(de_114_127),"%")
			or 	UPPER(P.tbl_product_salediscount) like CONCAT("%",UPPER(de_114_127),"%")
	)
	
	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchTutorialMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchTutorialMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
        GROUP_CONCAT(    
			CONCAT('{"121.194":"', A.tbl_help_tutorial_steps_step_id ,'"'),
			CONCAT(',"120.83":"',if(A.tbl_help_tutorial_steps_step_title is null,'', A.tbl_help_tutorial_steps_step_title) ,'"'),
			CONCAT(',"120.157":"',if(A.tbl_help_tutorial_steps_step_description is null,'',A.tbl_help_tutorial_steps_step_description ),'"}')	
        ) as JSON

	from tbl_help_tutorial_steps as A
		
	where 
	(		
			UPPER(A.tbl_help_tutorial_steps_step_title) like CONCAT("%",UPPER(de_114_127),"%")
		or 	UPPER(A.tbl_help_tutorial_steps_step_description) like CONCAT("%",UPPER(de_114_127),"%")
	)

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchUsersPendingByReseller010400402` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SearchUsersPendingByReseller010400402`(PARAM VARCHAR(4000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: SearchUsersPendingByReseller010400402
-- Method: 010400402
-- Version: 1.0
-- Last modified: 2015-04-08
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       BIGINT       DEFAULT 1;   -- START LIMIT
	DECLARE FIN       BIGINT	   DEFAULT 0;   -- END LIMIT

	DECLARE de_053 VARCHAR(20) DEFAULT NULL;        -- 53 User Id
	DECLARE de_114_127  VARCHAR(255) DEFAULT 0;		-- 114.127 Search

-- --------------------
-- Declare auxiliary --
-- -------------------- 

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

-- -----------------	
-- Set variables  --
-- -----------------

	SET  group_concat_max_len = 1000000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1);

	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	SET de_053 = (select right(de_053,11));
	
	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');

-- -------------		
-- Limits     --
-- -------------

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2' limit 1);
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3' limit 1) - INI;
	ELSE
		set FIN = 999999999;
	END IF;

-- ---------------		
-- Query of DB  --
-- ---------------

	if (length(de_114_127) > 0) then 

	
		select 
		GROUP_CONCAT(
			CONCAT('{"53":"', COALESCE(GetNMCId(W.tbl_user_id),''),'"'), 
			CONCAT(',"114.7":"', COALESCE(W.tbl_user_email,''),'"'), 
			CONCAT(',"114.3":"', COALESCE(W.tbl_user_first,''),'"'), 
			CONCAT(',"114.5":"', COALESCE(W.tbl_user_last,''),'"'), 
			CONCAT(',"114.70":"', COALESCE(W.tbl_user_companyName,''),'"'), 
			CONCAT(',"114.138":"', COALESCE(W.tbl_user_dateAdded,''),'"'), 
            
            CONCAT(',"114.91":"', COALESCE(W.tbl_user_title,''),'"'),
            CONCAT(',"123.71":"', COALESCE(W.tbl_merchant_taxIdNumber ,''),'"'),
            CONCAT(',"114.121":"',COALESCE(W.tbl_merchant_multiple_locations_quantity,'0'),'"'),
			CONCAT(',"117.17":"', COALESCE(W.tbl_merchant_location_use,'0'),'"'),
			CONCAT(',"117.18":"', COALESCE(W.tbl_merchant_dongles_quantity,'0'),'"'),
			-- CONCAT(',"117.20":"', COALESCE(W.tbl_merchant_basic_subs ,'0'),'"'),
			CONCAT(',"117.21":"', COALESCE(W.tbl_merchant_standard_subs,'0'),'"'),
            CONCAT(',"117.22":"', COALESCE(W.tbl_merchant_deluxe_subs,'0'),'"'),
			
			CONCAT(',"AD":{',dbuser.getNMCAddress(W.tbl_address_id),'}'), 
			CONCAT(',"PH":[',dbuser.getNMCPhone(W.tbl_phone_id),']}')
		)  as JSON
	
		from 
		
			(select B.tbl_user_id,
			B.tbl_user_email,
			B.tbl_user_first,
			B.tbl_user_last,
			B.tbl_user_companyName,
			B.tbl_user_dateAdded,
            B.tbl_user_title,
            A.tbl_merchant_taxIdNumber ,
            A.tbl_merchant_multiple_locations_quantity,
			A.tbl_merchant_location_use,
			A.tbl_merchant_dongles_quantity,
			A.tbl_merchant_basic_subs,
			A.tbl_merchant_standard_subs,
            A.tbl_merchant_deluxe_subs,
			
			(select C.tbl_address_id from tbl_merchant as A, tbl_address as C where A.tbl_merchant_nmcId = B.tbl_user_id and A.tbl_merchant_nmcId = C.tbl_address_nmcId limit 1) as tbl_address_id,
			(select D.tbl_phone_id from tbl_merchant as A, tbl_phone as D where A.tbl_merchant_nmcId = B.tbl_user_id and A.tbl_merchant_nmcId = D.tbl_phone_nmcId and D.tbl_phonetype_id = 4001 limit 1) as tbl_phone_id
			from dbuser.tbl_merchant as A, dbuser.tbl_user as B 
			where A.tbl_user_reseller_id = de_053 
			and A.tbl_merchant_nmcId = B.tbl_user_id 
			and B.tbl_user_entity = 20 
			and B.tbl_userstatus_id = 35
			and 
			(		UPPER(B.tbl_user_email) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_first) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_last) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_companyName) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER(B.tbl_user_dateAdded) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER((select C.tbl_address_first from tbl_merchant as A, tbl_address as C where A.tbl_merchant_nmcId = B.tbl_user_id and A.tbl_merchant_nmcId = C.tbl_address_nmcId limit 1)) like CONCAT("%",UPPER(de_114_127),"%")
				or  UPPER((select C.tbl_address_second from tbl_merchant as A, tbl_address as C where A.tbl_merchant_nmcId = B.tbl_user_id and A.tbl_merchant_nmcId = C.tbl_address_nmcId limit 1)) like CONCAT("%",UPPER(de_114_127),"%")
			) 
			limit INI,FIN ) as W;

	else

		select 
		GROUP_CONCAT(
			CONCAT('{"53":"', COALESCE(GetNMCId(W.tbl_user_id),''),'"'), 
			CONCAT(',"114.7":"', COALESCE(W.tbl_user_email,''),'"'), 
			CONCAT(',"114.3":"', COALESCE(W.tbl_user_first,''),'"'), 
			CONCAT(',"114.5":"', COALESCE(W.tbl_user_last,''),'"'), 
			CONCAT(',"114.70":"', COALESCE(W.tbl_user_companyName,''),'"'), 
			CONCAT(',"114.138":"', COALESCE(W.tbl_user_dateAdded,''),'"'), 
            
            CONCAT(',"114.91":"', COALESCE(W.tbl_user_title,''),'"'),
            CONCAT(',"123.71":"', COALESCE(W.tbl_merchant_taxIdNumber ,''),'"'),
            CONCAT(',"114.121":"',COALESCE(W.tbl_merchant_multiple_locations_quantity,'0'),'"'),
			CONCAT(',"117.17":"', COALESCE(W.tbl_merchant_location_use,'0'),'"'),
			CONCAT(',"117.18":"', COALESCE(W.tbl_merchant_dongles_quantity,'0'),'"'),
			-- CONCAT(',"117.20":"', COALESCE(W.tbl_merchant_basic_subs ,'0'),'"'),
			CONCAT(',"117.21":"', COALESCE(W.tbl_merchant_standard_subs,'0'),'"'),
            CONCAT(',"117.22":"', COALESCE(W.tbl_merchant_deluxe_subs,'0'),'"'),
			
			CONCAT(',"AD":{',dbuser.getNMCAddress(W.tbl_address_id),'}'), 
			CONCAT(',"PH":[',dbuser.getNMCPhone(W.tbl_phone_id),']}')
		)  as JSON
	
		from 
		
			(select B.tbl_user_id,
			B.tbl_user_email,
			B.tbl_user_first,
			B.tbl_user_last,
			B.tbl_user_companyName,
			B.tbl_user_dateAdded,
            
			B.tbl_user_title,
            A.tbl_merchant_taxIdNumber ,
            A.tbl_merchant_multiple_locations_quantity,
			A.tbl_merchant_location_use,
			A.tbl_merchant_dongles_quantity,
			A.tbl_merchant_basic_subs,
			A.tbl_merchant_standard_subs,
            A.tbl_merchant_deluxe_subs,
			
			(select C.tbl_address_id from tbl_merchant as A, tbl_address as C where A.tbl_merchant_nmcId = B.tbl_user_id and A.tbl_merchant_nmcId = C.tbl_address_nmcId limit 1) as tbl_address_id,
			(select D.tbl_phone_id from tbl_merchant as A, tbl_phone as D where A.tbl_merchant_nmcId = B.tbl_user_id and A.tbl_merchant_nmcId = D.tbl_phone_nmcId and D.tbl_phonetype_id = 4001 limit 1) as tbl_phone_id
			from dbuser.tbl_merchant as A, dbuser.tbl_user as B 
			where A.tbl_user_reseller_id = de_053 
			and A.tbl_merchant_nmcId = B.tbl_user_id 
			and B.tbl_user_entity = 20 
			and B.tbl_userstatus_id = 35
			
			limit INI,FIN ) as W;

	end if;
		


	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SearchVideoMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `SearchVideoMobile`(PARAM VARCHAR(20000))
BEGIN 













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_114_127 VARCHAR(11) DEFAULT 0; 
	
	SET  group_concat_max_len = 1000000;
	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_127 = (select DATA from TBL_MESSAGE1 where CODE = '114.127');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	




	SELECT 
        GROUP_CONCAT(    
			CONCAT('{"121.194":"', A.tbl_help_video_id ,'"'),
			CONCAT(',"120.83":"',if(A.tbl_help_video_title is null,'', A.tbl_help_video_title) ,'"'),
			CONCAT(',"120.157":"',if(A.tbl_help_video_url is null,'',A.tbl_help_video_url ),'"}')	
        ) as JSON

	from tbl_help_video as A
		
	where 
	(		
			UPPER(A.tbl_help_video_title) like CONCAT("%",UPPER(de_114_127),"%")
		or 	UPPER(A.tbl_help_video_url) like CONCAT("%",UPPER(de_114_127),"%")
	)

	LIMIT INI,FIN;

    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `SendNMCContact030300192` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `SendNMCContact030300192`(IN MSG_IN VARCHAR(20000))
BEGIN
	
	DECLARE de_053 VARCHAR(20) DEFAULT 0; 			
	DECLARE de_053_11 INT(11) DEFAULT 0;            
	DECLARE de_114_179 VARCHAR(20) DEFAULT NULL;	    
	DECLARE de_122_128 VARCHAR(300) DEFAULT NULL;	
	DECLARE de_120_157 VARCHAR(2048) DEFAULT NULL;	
	DECLARE de_120_016 INT(11) DEFAULT NULL;		
	DECLARE de_114_150 INT(11) DEFAULT NULL;		
	DECLARE de_121_075 INT(11) DEFAULT NULL;		
	DECLARE de_114_144 INT(11) DEFAULT NULL;		
    DECLARE de_123_021 INT(11) DEFAULT NULL;		
	DECLARE de_114_093 INT(11) DEFAULT NULL;		
	



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE HELP_TICKET_AUX INTEGER(11) DEFAULT NULL; 
	DECLARE OWNER_AUX VARCHAR(4) DEFAULT '0001';
	DECLARE OWNER_TYPE VARCHAR(1) DEFAULT '0'; 
	DECLARE OWNER_ID INT DEFAULT 1;
	DECLARE USER_ID_AUX VARCHAR(20) DEFAULT NULL; 
    DECLARE PARENT_AUX INT(11) DEFAULT 0;
    DECLARE ACTUAL_PARENT INT(11) DEFAULT 0;




	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		
	SET	de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	
	SET	de_114_179 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.179');
	set de_114_179 = (select right(de_114_179,11));
	SET OWNER_AUX = (select LEFT(de_053,4));
	SET OWNER_TYPE = (SELECT SUBSTRING(OWNER_AUX,1,1));
	SET OWNER_ID = (SELECT SUBSTRING(OWNER_AUX,2,3));
	set de_053_11 = (select right(de_053,11));
	
	IF (OWNER_TYPE  = 0) THEN 
	    SET USER_ID_AUX = (SELECT dbuser.getNMCID(1));
	ELSE
		SET USER_ID_AUX = (select dbuser.getNMCID(tbl_user_id) from tbl_user where tbl_owner_id = OWNER_ID and tbl_user_entity=60 and (SELECT right (tbl_user_class,1))='0' LIMIT 1);
	END IF ;
	
	
	
	set USER_ID_AUX = (select right(USER_ID_AUX,11));
	SET	de_122_128 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.128');
	SET	de_120_157 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.157');
	set de_120_157 = convert(unhex(de_120_157) USING utf8);
	SET	de_120_016 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '120.16');
	SET	de_114_150 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.150');
	SET	de_121_075 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '121.75');
	SET	de_114_144 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.144');
    SET	de_123_021 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '123.21');
	SET	de_114_093 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.93');
	

	

	if length(de_114_150)>0 then
    
		update tbl_help_ticket set
        tbl_help_ticket_replied_f = 1
        where id = de_114_150;
    
    end if;

	

	 CASE de_120_016
		
	 WHEN 91 THEN 
	
			IF(SELECT USER_ID_AUX) IS NULL THEN

				SELECT 
				GROUP_CONCAT(CONCAT('{"39":"',2062,'"'),CONCAT(',"44":"','There is not Admin','"}')) AS JSON;
			ELSE
				insert into tbl_help_ticket set
					tbl_help_ticket_sender = de_053_11, 
					tbl_help_ticket_receiver = USER_ID_AUX,
					tbl_help_ticket_status = 1501,
					tbl_help_ticket_type = de_120_016,
					tbl_help_ticket_date = NOW(),
					tbl_help_ticket_subject = de_122_128,
					tbl_help_ticket_content = de_120_157,
					tbl_parent_id= coalesce(de_114_150,0),
					tbl_invoice_id= coalesce(de_121_075, null),
                    tbl_product_id= coalesce(de_114_144, null),
                    tbl_playlist_id= coalesce(de_123_021, null),
					tbl_help_ticket_read_flag = 0,
                    tbl_help_ticket_replied_f = 0,
					tbl_help_ticket_assigned = USER_ID_AUX;
                    

				SET PARENT_AUX = (SELECT LAST_INSERT_ID());
				SET ACTUAL_PARENT = (SELECT tbl_parent_id FROM tbl_help_ticket WHERE id=PARENT_AUX);
				IF (ACTUAL_PARENT = 0) THEN
					update tbl_help_ticket set tbl_parent_id = PARENT_AUX WHERE id=PARENT_AUX;
				END IF;
			
				
				
				
				SELECT 
				GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"122.114":"',PARENT_AUX,'"}')) AS JSON;
	
			END IF;

	  WHEN 92 THEN 
			IF(SELECT de_114_179) IS NULL THEN

				SELECT GROUP_CONCAT(CONCAT('{"39":"',2063,'"'),CONCAT(',"44":"','Missing Receiver','"}')) AS JSON;
			ELSE
				
						insert into tbl_help_ticket set
						tbl_help_ticket_sender = de_053_11, 
						tbl_help_ticket_receiver = de_114_179,
						tbl_help_ticket_status = 1501,
						tbl_help_ticket_type = de_120_016,
						tbl_help_ticket_date = NOW(),
						tbl_help_ticket_subject = de_122_128,
						tbl_help_ticket_content =  de_120_157,
						tbl_parent_id= coalesce(de_114_150,0),
						tbl_invoice_id= coalesce(de_121_075, null),
                        tbl_product_id= coalesce(de_114_144, null),
                        tbl_playlist_id= coalesce(de_123_021, null),
						tbl_help_ticket_read_flag = 0,
                        tbl_help_ticket_replied_f = 0,
						tbl_help_ticket_assigned = de_114_179;

					SET PARENT_AUX = (SELECT LAST_INSERT_ID());
					SET ACTUAL_PARENT = (SELECT tbl_parent_id FROM tbl_help_ticket WHERE id=PARENT_AUX);
					IF (ACTUAL_PARENT = 0) THEN
						update tbl_help_ticket set tbl_parent_id = PARENT_AUX WHERE id=PARENT_AUX;
					END IF;
				
					
					
					
					SELECT 
					GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"122.114":"',PARENT_AUX,'"}')) AS JSON;
				
			END IF;
	
	WHEN 93 THEN 
	
			IF(SELECT USER_ID_AUX) IS NULL THEN

				SELECT 
				GROUP_CONCAT(CONCAT('{"39":"',2062,'"'),CONCAT(',"44":"','There is not Admin','"}')) AS JSON;
			ELSE
				insert into tbl_help_ticket set
					tbl_help_ticket_sender = de_053_11, 
					tbl_help_ticket_receiver = USER_ID_AUX,
					tbl_help_ticket_status = 1501,
					tbl_help_ticket_type = de_120_016,
					tbl_help_ticket_date = NOW(),
					tbl_help_ticket_subject = de_122_128,
					tbl_help_ticket_content =  de_120_157,
					tbl_parent_id= coalesce(de_114_150,0),
                    tbl_product_id= coalesce(de_114_144, null),
                    tbl_playlist_id= coalesce(de_123_021, null),
					tbl_help_ticket_read_flag = 0,
                    tbl_help_ticket_replied_f = 0,
					tbl_help_ticket_assigned = USER_ID_AUX;

				SET PARENT_AUX = (SELECT LAST_INSERT_ID());
				SET ACTUAL_PARENT = (SELECT tbl_parent_id FROM tbl_help_ticket WHERE id=PARENT_AUX);
				IF (ACTUAL_PARENT = 0) THEN
					update tbl_help_ticket set tbl_parent_id = PARENT_AUX WHERE id=PARENT_AUX;
				END IF;
			
				
				
				
				SELECT 
				GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"122.114":"',PARENT_AUX,'"}')) AS JSON;
	
			END IF;
	 
	WHEN 94 then 
			
			insert into tbl_help_ticket set
						tbl_help_ticket_sender = de_053_11, 
						tbl_help_ticket_receiver = de_053_11,
						tbl_help_ticket_status = 1501,
						tbl_help_ticket_type = de_120_016,
						tbl_help_ticket_date = NOW(),
						tbl_help_ticket_subject = de_122_128,
						tbl_help_ticket_content =  de_120_157,
						tbl_parent_id= coalesce(de_114_150,0),
						tbl_invoice_id= coalesce(de_121_075, null),
                        tbl_product_id= coalesce(de_114_144, null),
                        tbl_playlist_id= coalesce(de_123_021, null),
						tbl_help_ticket_read_flag = 0,
                        tbl_help_ticket_replied_f = 0,
						tbl_help_ticket_assigned = de_053_11;

					SET PARENT_AUX = (SELECT LAST_INSERT_ID());
					SET ACTUAL_PARENT = (SELECT tbl_parent_id FROM tbl_help_ticket WHERE id=PARENT_AUX);
					IF (ACTUAL_PARENT = 0) THEN
						update tbl_help_ticket set tbl_parent_id = PARENT_AUX WHERE id=PARENT_AUX;
					END IF;
				
					
					
					
					SELECT 
					GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"122.114":"',PARENT_AUX,'"}')) AS JSON;
	
	WHEN 95 THEN 
	
			IF(SELECT de_114_179) IS NULL THEN

				SELECT GROUP_CONCAT(CONCAT('{"39":"',2063,'"'),CONCAT(',"44":"','Missing Receiver','"}')) AS JSON;
			ELSE
				if (SELECT de_114_144) IS NULL THEN
					SELECT GROUP_CONCAT(CONCAT('{"39":"',2016,'"'),CONCAT(',"44":"','Invalid  Item Id','"}')) AS JSON;
			
				else
					insert into tbl_help_ticket set
						tbl_help_ticket_sender = de_053_11, 
						tbl_help_ticket_receiver = de_114_179,
						tbl_help_ticket_status = 1501,
						tbl_help_ticket_type = de_120_016,
						tbl_help_ticket_date = NOW(),
						tbl_help_ticket_subject = de_122_128,
						tbl_help_ticket_content =  de_120_157,
						tbl_parent_id= coalesce(de_114_150,0),
						tbl_product_id= coalesce(de_114_144, null),
                        tbl_playlist_id= coalesce(de_123_021, null),
						tbl_help_ticket_read_flag = 0,
                        tbl_help_ticket_replied_f = 0,
						tbl_item_id_share = de_114_144,
						tbl_help_ticket_assigned = USER_ID_AUX;

					SET PARENT_AUX = (SELECT LAST_INSERT_ID());
					SET ACTUAL_PARENT = (SELECT tbl_parent_id FROM tbl_help_ticket WHERE id=PARENT_AUX);
					IF (ACTUAL_PARENT = 0) THEN
						update tbl_help_ticket set tbl_parent_id = PARENT_AUX WHERE id=PARENT_AUX;
					END IF;
				
					
					
					
					SELECT 
					GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"122.114":"',PARENT_AUX,'"}')) AS JSON;
				end if;
			END IF;
			
	WHEN 96 THEN 
			IF(SELECT de_114_179) IS NULL THEN

				SELECT GROUP_CONCAT(CONCAT('{"39":"',2063,'"'),CONCAT(',"44":"','Missing Receiver','"}')) AS JSON;
			ELSE
				
						insert into tbl_help_ticket set
						tbl_help_ticket_sender = de_053_11, 
						tbl_help_ticket_receiver = de_114_179,
						tbl_help_ticket_status = 1501,
						tbl_help_ticket_type = de_120_016,
						tbl_help_ticket_date = NOW(),
						tbl_help_ticket_subject = de_122_128,
						tbl_help_ticket_content =  de_120_157,
						tbl_parent_id= coalesce(de_114_150,0),
						tbl_product_id= coalesce(de_114_144, null),
                        tbl_playlist_id= coalesce(de_123_021, null),
						tbl_help_ticket_read_flag = 0,
                        tbl_help_ticket_replied_f = 0,
						tbl_help_ticket_assigned = de_114_179;

					SET PARENT_AUX = (SELECT LAST_INSERT_ID());
					SET ACTUAL_PARENT = (SELECT tbl_parent_id FROM tbl_help_ticket WHERE id=PARENT_AUX);
					IF (ACTUAL_PARENT = 0) THEN
						update tbl_help_ticket set tbl_parent_id = PARENT_AUX WHERE id=PARENT_AUX;
					END IF;
				
					
					
					
					SELECT 
					GROUP_CONCAT(CONCAT('{"39":"','0000','"'),CONCAT(',"44":"','Transaction Approved','"'),CONCAT(',"122.114":"',PARENT_AUX,'"}')) AS JSON;
				
			END IF;

	 WHEN 97 THEN 
	
			IF(SELECT USER_ID_AUX) IS NULL THEN

				SELECT 
				GROUP_CONCAT(CONCAT('{"39":"',2062,'"'),CONCAT(',"44":"','There is not Admin','"}')) AS JSON;
			ELSE
				insert into tbl_help_ticket set
					tbl_help_ticket_sender = de_053_11, 
					tbl_help_ticket_receiver = USER_ID_AUX,
					tbl_help_ticket_status = 1501,
					tbl_help_ticket_type = de_120_016,
					tbl_help_ticket_date = NOW(),
					tbl_help_ticket_subject = de_122_128,
					tbl_help_ticket_content = de_120_157,
					tbl_parent_id= coalesce(de_114_150,0),
					tbl_invoice_id= coalesce(de_121_075, null),
                    tbl_product_id= coalesce(de_114_144, null),
                    tbl_playlist_id= coalesce(de_123_021, null),
					tbl_help_ticket_read_flag = 0,
                    tbl_help_ticket_replied_f = 0,
					tbl_help_ticket_category_abuse = de_114_093,
					tbl_help_ticket_assigned = USER_ID_AUX;

				SET PARENT_AUX = (SELECT LAST_INSERT_ID());
				SET ACTUAL_PARENT = (SELECT tbl_parent_id FROM tbl_help_ticket WHERE id=PARENT_AUX);
				IF (ACTUAL_PARENT = 0) THEN
					update tbl_help_ticket set tbl_parent_id = PARENT_AUX WHERE id=PARENT_AUX;
				END IF;
			
				
				
				
				SELECT 
				GROUP_CONCAT(CONCAT('{"39":"','0000','"'),
							CONCAT(',"44":"','Transaction Approved','"'),
							CONCAT(',"114.7":"',coalesce((select tbl_user_email from dbuser.tbl_user where tbl_user_id = de_053_11),''),'"'),
							CONCAT(',"114.3":"',coalesce((select tbl_user_first from dbuser.tbl_user where tbl_user_id = de_053_11),''),'"'),
							CONCAT(',"114.5":"',coalesce((select tbl_user_last from dbuser.tbl_user where tbl_user_id = de_053_11),''),'"'),
							CONCAT(',"120.45":"',coalesce((select tbl_categoriesforabuse_name FROM dbtransaction.tbl_categoriesforabuse where tbl_categoriesforabuse_id =de_114_093),''),'"'),


							CONCAT(',"122.114":"',PARENT_AUX,'"}')) AS JSON;
	
			END IF;

	ELSE
		SELECT GROUP_CONCAT(CONCAT('{"39":"','2060','"'),CONCAT(',"44":"','Invalid Request','"}')) AS JSON;
	END CASE;

	

	
	

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `setMobileKey` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `setMobileKey`(IN DEVICEID VARCHAR(250), IN NEXT_KEY VARCHAR(45))
BEGIN

IF (SELECT mobile_id from mobile_key where device_id=DEVICEID) IS NULL THEN
	INSERT INTO mobile_key SET
       mobile_key.device_id=DEVICEID,
       `mobile_key`.`key` = NEXT_KEY,
       mobile_key.date = NOW();
ELSE
	UPDATE mobile_key SET
       `mobile_key`.`key` = NEXT_KEY,
       mobile_key.date = NOW()
    WHERE mobile_key.device_id=DEVICEID;

END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `TermuseMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `TermuseMobile`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  
	
	DECLARE de_053      INT(18)       DEFAULT 0;  

	

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;

	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');
	
	SET de_053 = (select DATA from TBL_MESSAGE1 where CODE = '53');
	



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	





	select
		GROUP_CONCAT(
			CONCAT('{"121.194":"',tbl_help_terms_id,'"'),
			CONCAT(',"120.157":"',tbl_help_terms_description,'"}') ) as JSON
	from tbl_help_terms

		
	LIMIT INI,FIN;
    
    DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `testJose` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `testJose`(IN MSG_IN VARCHAR(20000))
BEGIN
	SELECT CONCAT("hola ", "Jose");
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `testJose1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `testJose1`(IN MSG_IN VARCHAR(20000))
BEGIN
SELECT "JOSE RESPONSE 2";
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `UpdateCreditCardsOrderMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `UpdateCreditCardsOrderMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_122_105 INT(18) DEFAULT NULL; 
	DECLARE de_114_121 VARCHAR(45) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		
		SET de_122_105 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.105');
		SET de_114_121 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.121');
	
		
		
	
		

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `UpdateNMCContactHelpicketSystemNotice020400377` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `UpdateNMCContactHelpicketSystemNotice020400377`(IN MSG_IN VARCHAR(20000))
BEGIN
-- -------------------------	
-- Declare Data Elements --
-- -------------------------
	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_122_114 VARCHAR(20) DEFAULT NULL; -- Help Ticket Id 
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; -- User Id

-- --------------------
-- Declare auxiliary --
-- --------------------	
  
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	
	
	SET de_122_114 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '122.114');
	SET de_053 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '53');
	
	SET de_053 = (select right(de_053,11)) ;
-- -----------------	
-- Set variables --
-- -----------------

	update dbuser.tbl_help_ticket set
	tbl_help_ticket_read_date =  NOW(),
	tbl_help_ticke_read_by_user = de_053,
    tbl_help_ticket_read_flag = 1
	where tbl_help_ticket.id = de_122_114;
		 
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `UpdateNotifyDongles020400553` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`localhost` PROCEDURE `UpdateNotifyDongles020400553`(IN MSG_IN VARCHAR(20000))
BEGIN
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_117_31 VARCHAR(45) DEFAULT NULL; -- Help Ticket Id 

-- --------------------
-- Declare auxiliary --
-- --------------------	
  
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- ---------------
-- Validations --
-- ---------------	
	
	SET de_117_31 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '117.31');
-- -----------------	
-- Set variables --
-- -----------------

	update nmc_control.version_update set
	version_publish_date =  NOW()
	where version_dongle_name = de_117_31;
		 
	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');
		
	SET RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);
		
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `UpdateZipcodesLocation` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `UpdateZipcodesLocation`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- -------------------------------------------------------
-- Autor: Juan David Zapata 
-- Procedure: UpdateZipcodesLocation
-- Method: 
-- Version: 1.0
-- Last modified: 2015-12-01 
-- -------------------------------------------------------


-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE de_ZIP TEXT DEFAULT NULL;
    DECLARE de_ADDRESS TEXT DEFAULT NULL;
    
	DECLARE CADENA_ZIP TEXT DEFAULT NULL;
	DECLARE CADENA_ADDRESS TEXT DEFAULT NULL;
    
	DECLARE ZIPCODE_AUX VARCHAR(45) DEFAULT NULL;
    DECLARE ADDRESS_AUX VARCHAR(45) DEFAULT NULL;
	DECLARE LOCATION_AUX VARCHAR(45) DEFAULT NULL;
    
	DECLARE LATITUDE_AUX VARCHAR(45) DEFAULT NULL;
    DECLARE LONGITUDE_AUX VARCHAR(45) DEFAULT NULL;
    
-- --------------------
-- Declare auxiliary --
-- --------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;	

-- ---------------
-- Validations  --
-- ---------------

	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables  --
-- -----------------

    set de_ADDRESS = (select GROUP_CONCAT(CONCAT('',A.tbl_address_id,'|'))
					  from dbuser.tbl_address as A, tbl_locationaddress as B, tbl_location as C
                      where A.tbl_address_id = B.tbl_address_id
                      and B.tbl_location_id = C.tbl_location_id
                      and (C.tbl_location_latitude = '' or C.tbl_location_latitude = ' ')
					 );

    set CADENA_ADDRESS = REPLACE(de_ADDRESS,'|,','|');	
    
-- ---------------		
-- Query of DB  --
-- ---------------

	WHILE (LENGTH(CADENA_ADDRESS)>0) DO

		SET ADDRESS_AUX = TRIM((SELECT SUBSTR(CADENA_ADDRESS,1,LOCATE('|',CADENA_ADDRESS)-1)));
		SET CADENA_ADDRESS = (SELECT SUBSTR(CADENA_ADDRESS,LOCATE('|',CADENA_ADDRESS)+1));

		SET ZIPCODE_AUX = (select tbl_zipcode_id from tbl_address where tbl_address_id = ADDRESS_AUX);

		SET LATITUDE_AUX = (select latitude from tbl_zipcode where tbl_zipcode_id = ZIPCODE_AUX);
		SET LONGITUDE_AUX = (select longitude from tbl_zipcode where tbl_zipcode_id = ZIPCODE_AUX);
        
        SET LOCATION_AUX = (select tbl_location_id from tbl_locationaddress where tbl_address_id = ADDRESS_AUX LIMIT 1);
        
        -- select CONCAT(LOCATION_AUX, ' - ' , ADDRESS_AUX, ' - ' , ZIPCODE_AUX, ' - (' , LATITUDE_AUX, '-' , LONGITUDE_AUX, ')') as info;
        
        update tbl_location set 
		tbl_location_latitude = COALESCE(LATITUDE_AUX,''),
		tbl_location_longitude= COALESCE(LONGITUDE_AUX,'')
		where tbl_location_id = LOCATION_AUX;
        
	END WHILE;
	

	insert into TBL_MESSAGE1 (CODE,DATA)
	values('39','0000'),('44','Transaction Approved');

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;	

	DROP TABLE TBL_MESSAGE1;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateAnswersByConsumerIdMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateAnswersByConsumerIdMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 INT(18) DEFAULT NULL; 
	
	DECLARE de_122_008 INT(11) DEFAULT NULL; 
	DECLARE de_122_009 INT(11) DEFAULT NULL; 
	DECLARE de_122_010 INT(11) DEFAULT NULL; 
	DECLARE de_114_064 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_114_045 VARCHAR(100) DEFAULT NULL; 
	DECLARE de_114_068 VARCHAR(100) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
		
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	
		SET de_122_008 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.8');
		SET de_122_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.9');
		SET de_122_010 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '122.10');
		SET de_114_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.64');
		SET de_114_045 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.45');
		SET de_114_068 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.68');
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




	
		if (select tbl_securityquestionsanswer_answer from tbl_securityquestionsanswer where tbl_securityquestionsanswer_answer = de_114_064 and tbl_securityquestions_id = de_122_008) is not null then 
		
			if (select tbl_securityquestionsanswer_answer from tbl_securityquestionsanswer where tbl_securityquestionsanswer_answer = de_114_045 and tbl_securityquestions_id = de_122_009) is not null then 
			
				if (select tbl_securityquestionsanswer_answer from tbl_securityquestionsanswer where tbl_securityquestionsanswer_answer = de_114_068 and tbl_securityquestions_id = de_122_010) is not null then 
		
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Transaction Approved');
					
				else
				
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','1015'),('44','Invalid Answers');
					
				end if;
			
			else 

				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1015'),('44','Invalid Answers');
				
			end if;
				
		else
		
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid Answers');
			
		end if;


	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);


	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateEmailMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateEmailMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_73 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
	
	
	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




	
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007) is null then 
		
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1014'),('44','Account Not Found'),('122.73','0');
			
		else 
		
			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_status_f = 0) is not null then 
		
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','3000'),('44','Account Expired'),('122.73','2');
				
			else 

				if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_userTemp_f = 1 ) is not null then 

					insert into TBL_MESSAGE (CODE,DATA)
					values('39','2013'),('44','Temporal User'),('122.73','1');
					
				else

					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Transaction Approved'),('122.73','3'); 

				end if;
			end if;
		end if;

		

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_122_73 = (select DATA from TBL_MESSAGE where CODE = 122.73);
	
	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.73":"',RESULT_122_73,'"')) AS JSON;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateEmailMobile010400009` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateEmailMobile010400009`(IN MSG_IN VARCHAR(20000))
BEGIN

	















	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;



	DECLARE de_39 VARCHAR(4) DEFAULT NULL;

	DECLARE de_44 VARCHAR(25) DEFAULT NULL;

	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	




	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_122_73 VARCHAR(45) DEFAULT NULL;

	




	

	
	DECLARE exit HANDLER FOR 1292 

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1050

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1064

	BEGIN

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1264

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

	

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	

	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);

	

	IF flag_validation = FALSE THEN






	

	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');

	

	
	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;






	

		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007) is null then 
		

			insert into TBL_MESSAGE (CODE,DATA)

			values('39','1014'),('44','Account Not Found'),('122.73','0');

			

		else 

		

			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_status_f = 0) is not null then 
		

				insert into TBL_MESSAGE (CODE,DATA)

				values('39','3000'),('44','Account Expired'),('122.73','2');

				

			else 



				if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_userTemp_f = 1 ) is not null then 


					insert into TBL_MESSAGE (CODE,DATA)

					values('39','2013'),('44','Temporal User'),('122.73','1');

					

				else



					insert into TBL_MESSAGE (CODE,DATA)

					values('39','0000'),('44','Transaction Approved'),('122.73','3'); 


				end if;

			end if;

		end if;



		



	ELSE

	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		

		
		INSERT INTO TBL_MESSAGE(CODE, DATA)

		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	

	END IF;

	

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);

	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	set RESULT_122_73 = (select DATA from TBL_MESSAGE where CODE = 122.73);

	

	select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.73":"',RESULT_122_73,'"')) AS JSON;

	

	DROP TABLE TBL_MESSAGE;

 

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateEmailMobile050400009` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateEmailMobile050400009`(IN MSG_IN VARCHAR(20000))
BEGIN
	













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	






	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_73 VARCHAR(45) DEFAULT NULL;
	





	
	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	




	
	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
	
	




	
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007) is null then  
		
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1014'),('44','Account Not Found'),('122.73','0');
			
		else 
		
			if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_status_f = 0) is not null then  
		
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','3000'),('44','Account Expired'),('122.73','2');
				
			else 

				if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_userTemp_f = 1 ) is not null then 

					insert into TBL_MESSAGE (CODE,DATA)
					values('39','2013'),('44','Temporal User'),('122.73','1');
					
				else

					insert into TBL_MESSAGE (CODE,DATA)
					values('39','0000'),('44','Transaction Approved'),('122.73','3'); 

				end if;
			end if;
		end if;

	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_122_73 = (select DATA from TBL_MESSAGE where CODE = 122.73);
	
	select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.73":"',RESULT_122_73,'"}')) AS JSON;
	
	 
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateFields` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateFields`(	OUT FLAG BOOLEAN, 
																IN PARAM_IN_OUT VARCHAR(4000),
																OUT D_IN_18 VARCHAR(140),
																OUT D_IN_44 VARCHAR(25),
																OUT D_IN_39 VARCHAR(4))
BEGIN

	
	
	
	DECLARE CODE_ VARCHAR(7) DEFAULT NULL;
	DECLARE DATA_ VARCHAR(999) DEFAULT NULL;
	DECLARE num_rows INT DEFAULT 0;
	DECLARE DE_18 VARCHAR(140) DEFAULT NULL;
	DECLARE err_code_field VARCHAR(3) DEFAULT NULL;
	DECLARE err_code_sub_field VARCHAR(3) DEFAULT NULL;
	DECLARE length_data_ INT(4) DEFAULT 0;
	DECLARE type_ ENUM('F','V') DEFAULT NULL;
	DECLARE lenght_ INT(4) DEFAULT 0;
	DECLARE format_ ENUM('A','N','AN','ANS','B') DEFAULT NULL;
	DECLARE counter_rows INT(4) DEFAULT 0;
	DECLARE counter_rows_temp INT(4) DEFAULT 0;
  
	
	DECLARE FIELDS CURSOR FOR SELECT CODE_TEMP,DATA_TEMP FROM TBL_TEMP;
	
		

    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_TEMP(CODE_TEMP VARCHAR(7)NOT NULL, DATA_TEMP VARCHAR(4000)NULL);
	
		
    
    SET @QRY = CONCAT('INSERT INTO TBL_TEMP (CODE_TEMP, DATA_TEMP) VALUES ',PARAM_IN_OUT);
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
    
	
	OPEN FIELDS;
	select FOUND_ROWS() into num_rows;
	
	
	loop_: LOOP
		
		IF counter_rows = num_rows THEN
			LEAVE loop_;
		END IF;
		
		
		FETCH FIELDS INTO CODE_, DATA_;
		
		IF CODE_ = NULL THEN
			LEAVE loop_;
		END IF;
		
		
		SELECT MTI_type,MTI_lenght,MTI_format INTO type_,lenght_,format_ FROM tbl_data_elements WHERE MTI = CODE_;
		
		
		SET length_data_ = LENGTH(DATA_);
		
		
		IF length_data_ =0 THEN
			
			SET DE_18 = '000001';
			SET D_IN_44 = 'Invalid Length';
      LEAVE loop_;
		END IF;
		
		
		CASE type_
			WHEN 'F' THEN
			
				
				IF lenght_ <> length_data_ THEN 
					SET DE_18 = '000002';
					SET D_IN_44 = 'Invalid Length';
          LEAVE loop_;
				END IF;
			
			WHEN 'V' THEN
			
				IF lenght_ < length_data_ THEN 
					
					SET DE_18 = '000002';
					SET D_IN_44 = 'Invalid Length';
					LEAVE loop_;
				END IF;
				
			WHEN 'D' THEN
			
				
				IF lenght_ <> length_data_ THEN 
					SET DE_18 = '000002';
					SET D_IN_44 = 'Invalid Length';
					LEAVE loop_;
				END IF;

		END CASE;
		
		
		case format_
			WHEN 'N' THEN
			
				IF (SELECT DATA_ REGEXP '^[[:digit:]]+(\\.[[:digit:]]+)?$' = 0) THEN
					SET DE_18 = '000003';
					SET D_IN_44 = 'Invalid Value';
					LEAVE loop_;
				END IF;
			
			WHEN 'A' THEN
			
				IF (SELECT DATA_ REGEXP '^[[:alnum:]]+$' = 0) THEN
					SET DE_18 = '000003';
					SET D_IN_44 = 'Invalid Value';
					LEAVE loop_;
				END IF;
			
			WHEN 'AN' THEN
			
				IF (SELECT DATA_ REGEXP '^[[:alnum:]]|[[:space:]]+$' = 0) THEN
					SET DE_18 = '000003';
					SET D_IN_44 = 'Invalid Value';
					LEAVE loop_;
				END IF;
			
			WHEN 'B' THEN
			
				IF (SELECT DATA_ REGEXP '^[0-9a-fA-F]+$' = 0) THEN
					SET DE_18 = '000003';
					SET D_IN_44 = 'Invalid Value';
					LEAVE loop_;
				END IF;
			
			WHEN 'ANS' THEN
			
				IF (SELECT DATA_ REGEXP '^[[:alnum:]]|[[:space:]]|[[:punct:]]+$' = 0) THEN
					SET DE_18 = '000003';
					LEAVE loop_;
				END IF;
			
		END CASE;
		
		SET counter_rows = counter_rows + 1;
		SET CODE_ = NULL;
		

	END LOOP loop_;
	
	CLOSE FIELDS;
	
	
	IF LENGTH(DE_18) <> 0 THEN
		
		IF (INSTR(CODE_, '.')) = 0 THEN
			
			SET err_code_sub_field = '0';
			SET err_code_field = CODE_;
			
		ELSE
		
			SET err_code_sub_field = SUBSTR(CODE_,INSTR(CODE_, '.')+1);
			SET err_code_field = SUBSTR(CODE_,1,INSTR(CODE_, '.')-1);
		
		END IF;
		
		SET D_IN_18 = CONCAT(DE_18,LPAD(err_code_field,3,'0'),LPAD(err_code_sub_field,3,'0'));
		SET FLAG = TRUE;
		SET D_IN_39 = '1015';
	ELSE
		SET FLAG = FALSE;
		
	END IF;
	
	
	DROP TABLE TBL_TEMP;
	
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateLocationByQRCode050400338` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateLocationByQRCode050400338`(IN MSG_IN VARCHAR(20000))
BEGIN




	DECLARE de_114_104 VARCHAR(300) DEFAULT NULL; 
	





	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE LOCATION_AUX INT(11) DEFAULT NULL;
	DECLARE TIP_AUX VARCHAR(11) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET de_114_104 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.104');

	SET LOCATION_AUX = (select substring(de_114_104,-13,11));





	if ValidateNMCLocationSchedule(LOCATION_AUX) = 'true' then 
	
		set TIP_AUX = (select A.tbl_user_accept_tips from tbl_user as A, tbl_location as B where B.tbl_location_id = LOCATION_AUX and A.tbl_user_id = B.tbl_location_userId);

		if TIP_AUX = 1 then
			set TIP_AUX = 'true';
		else
			set TIP_AUX = 'false';
		end if;

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		
	else 

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','1015'),('44','Invalid Request');
		
	end if;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"114.9":"',TIP_AUX,'"}')) as JSON;	
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	end if;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePasscodeMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePasscodeMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	
-- --------------------------------------------------------
-- Autor: Juan David Zapata
-- Procedure: ValidatePasscodeMobile
-- Method: PASSCODE
-- Version: 1.0
-- last modified: 2013-11-19
-- --------------------------------------------------------
	
-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 INTEGER(18) DEFAULT NULL; 
	DECLARE de_064 VARCHAR(4) DEFAULT NULL; 
	DECLARE de_114_123 VARCHAR(2) DEFAULT NULL; 
	
-- --------------------
-- Declare auxiliary --
-- --------------------
	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	
	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;
	
-- ---------------
-- Validations  --
-- ---------------
	
	-- exception for format
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	-- abort if the temporalt table exist
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	-- EXCEPTION FOR SQL SYNTAXIS
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	-- EXCEPTION lenght
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	--            TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN

-- -----------------	
-- Set variables  --
-- -----------------
	
	
	SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
	set de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	
	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

-- ---------------		
-- Query of DB  --
-- ---------------
			
			
		
				if (select tbl_user_id from tbl_user where tbl_user_id = de_053 and tbl_user_pinCode = de_064) is null then 	-- Invalid Pincode
					
					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is null then 		-- First try
					
						insert into tbl_block_account set
						tbl_user_id = de_053,
						tbl_block_account_numtry = 1,
						tbl_block_account_datelasttry = NOW();
						
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
					else 
						SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
						SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);
						SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

						if (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) < 3 then 		-- Second and third try
						
						

							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		-- Validate - 30 minutes between tries

								set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) +1;
								
								
								SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
								
								update tbl_block_account set 
								tbl_block_account_numtry = PINCODECONT_AUX,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
								
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);
								
							else 
							
								update tbl_block_account set 
								tbl_block_account_numtry = 1,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
							end if ;
							
						else
						
							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		-- Phone Locked - Validate 30 minutes
						
								set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) - (NOW()-INTERVAL 30 MINUTE);
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
				
							else
							
								update tbl_block_account set 
								tbl_block_account_numtry = 1,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
							end if ;
							
						end if;
				
					end if;
					
				else
					
					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is not null then
					
						if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053 and tbl_block_account_numtry < 3) is not null then -- Valid Pincode - Clean data from tbl_block_account if exists
					
							delete from tbl_block_account where tbl_user_id = de_053;
							
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','0000'),('44','Transaction Approved');
							
						else 
							
							SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
							SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);
							SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

							if (LASTTRY_AUX > NOW_30_AUX) then
							
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
								
							else 
							
								delete from tbl_block_account where tbl_user_id = de_053;
							
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','0000'),('44','Transaction Approved');
								
							end if;

						end if;
					
					else 
					
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','0000'),('44','Transaction Approved');
					
					end if;
		
				end if;
	
			
	ELSE
	
		-- remove 24 - 25 - 101 - 53 - 52
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74);
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129);
	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=4) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"'))AS JSON;

	end if;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePasscodeMobile010400007` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePasscodeMobile010400007`(IN MSG_IN VARCHAR(20000))
BEGIN

	








	 






	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;

	DECLARE de_44 VARCHAR(25) DEFAULT NULL;

	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE flag_validation BOOLEAN DEFAULT FALSE;

	

	DECLARE de_053 INTEGER(18) DEFAULT NULL; 

	DECLARE de_064 VARCHAR(4) DEFAULT NULL; 

	DECLARE de_114_123 VARCHAR(2) DEFAULT NULL; 

	




	

	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;

	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;

	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;

	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;

	

	



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;

	




	

	
	DECLARE exit HANDLER FOR 1292 

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1050

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1064

	BEGIN

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1264

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

	

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	

	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);

	

	IF flag_validation = FALSE THEN






	

	

	SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');

	set de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');

	

	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;






			

			

		

				if (select tbl_user_id from tbl_user where tbl_user_id = de_053 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is null then 	
					

					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is null then 		
					

						insert into tbl_block_account set

						tbl_user_id = de_053,

						tbl_block_account_numtry = 1,

						tbl_block_account_datelasttry = NOW();

						

						insert into TBL_MESSAGE (CODE,DATA)

						values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');

						

					else 

						SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);

						SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);

						SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);



						if (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) < 3 then 		
						

						



							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		


								set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) +1;

								SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

								

								update tbl_block_account set 

								tbl_block_account_numtry = PINCODECONT_AUX,

								tbl_block_account_datelasttry = NOW()

								where tbl_user_id = de_053;

								

								insert into TBL_MESSAGE (CODE,DATA)

								values('39','1825'),('44','Invalid Pincode'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);

								

							else 

							

								update tbl_block_account set 

								tbl_block_account_numtry = 1,

								tbl_block_account_datelasttry = NOW()

								where tbl_user_id = de_053;

						

								insert into TBL_MESSAGE (CODE,DATA)

								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');

						

							end if ;

							

						else

						

							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		
						

								set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) - (NOW()-INTERVAL 30 MINUTE);

						

								insert into TBL_MESSAGE (CODE,DATA)

								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);

				

							else

							

								update tbl_block_account set 

								tbl_block_account_numtry = 1,

								tbl_block_account_datelasttry = NOW()

								where tbl_user_id = de_053;

						

								insert into TBL_MESSAGE (CODE,DATA)

								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');

						

							end if ;

							

						end if;

				

					end if;

					

				else

					

					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is not null then

					

						if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053 and tbl_block_account_numtry < 3) is not null then 
					

							delete from tbl_block_account where tbl_user_id = de_053;

							

							insert into TBL_MESSAGE (CODE,DATA)

							values('39','0000'),('44','Transaction Approved');

							

						else 

							

							SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);

							SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);

							SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);



							if (LASTTRY_AUX > NOW_30_AUX) then

							

								insert into TBL_MESSAGE (CODE,DATA)

								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);

								

							else 

							

								delete from tbl_block_account where tbl_user_id = de_053;

							

								insert into TBL_MESSAGE (CODE,DATA)

								values('39','0000'),('44','Transaction Approved');

								

							end if;



						end if;

					

					else 

					

						insert into TBL_MESSAGE (CODE,DATA)

						values('39','0000'),('44','Transaction Approved');

					

					end if;

		

				end if;

	

			

	ELSE

	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		

		
		INSERT INTO TBL_MESSAGE(CODE, DATA)

		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	

	END IF;



	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);

	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74);

	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129);

	

	if ((select count(*) from TBL_MESSAGE)=2) then

	

		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;

		

	elseif ((select count(*) from TBL_MESSAGE)=4) then

	

		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"}'))AS JSON;



	end if;



	DROP TABLE TBL_MESSAGE;

 

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePasscodeMobile050300007` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePasscodeMobile050300007`(IN MSG_IN VARCHAR(20000))
BEGIN
	







	




	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_053 VARCHAR(20) DEFAULT NULL; 
	DECLARE de_064 VARCHAR(8) DEFAULT NULL; 
	DECLARE de_057 VARCHAR(75) DEFAULT NULL;	    




	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DEVICE_INI_AUX VARCHAR(40) DEFAULT NULL;
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;
	



	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	
	set de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
	set de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57'); 
	set de_053 = (select right(de_053,11));
	SET DEVICE_INI_AUX = (SELECT tbl_status_id FROM tbl_device  where tbl_device_udid = de_057 limit 1);
	
	
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			
		

	IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_id = de_053 ) = 34 then 
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','3001'),('44','Account Not Valid'); 	 
	
	ELSE
		
		CASE DEVICE_INI_AUX 
		when 5803 then		

			
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1827'),('44','Blocked Device'); 
				
		when 5802 then		

			
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1827'),('44','Blocked Device'); 
				
		

		else 
		
		
		
		
		
		
				if (select tbl_user_id from tbl_user where tbl_user_id = de_053 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is null then 	
					
					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is null then 		
					
						insert into tbl_block_account set
						tbl_user_id = de_053,
						tbl_block_account_numtry = 1,
						tbl_block_account_datelasttry = NOW();
						
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
					else 
						SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
						SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);
						SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

						if (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) < 3 then 		
						
						

							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		

								set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) +1;
								SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
								
								update tbl_block_account set 
								tbl_block_account_numtry = PINCODECONT_AUX,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
								
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);
								
							else 
							
								update tbl_block_account set 
								tbl_block_account_numtry = 1,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
							end if ;
							
						else
						
							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		
						
								set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) - (NOW()-INTERVAL 30 MINUTE);
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
				
							else
							
								update tbl_block_account set 
								tbl_block_account_numtry = 1,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
							end if ;
							
						end if;
				
					end if;
					
				else
					
					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is not null then
					
						if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053 and tbl_block_account_numtry < 3) is not null then 
					
							delete from tbl_block_account where tbl_user_id = de_053;
							
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','0000'),('44','Transaction Approved');
							
						else 
							
							SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
							SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);
							SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

							if (LASTTRY_AUX > NOW_30_AUX) then
							
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
								
							else 
							
								delete from tbl_block_account where tbl_user_id = de_053;
							
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','0000'),('44','Transaction Approved');
								
							end if;

						end if;
					
					else 
					
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','0000'),('44','Transaction Approved');
					
					end if;
		
				end if;
		end case;
	
	end if;
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74);
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129);
	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=4) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"}'))AS JSON;

	end if;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePasscodeMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePasscodeMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	







	




	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_053 INTEGER(18) DEFAULT NULL; 
	DECLARE de_064 VARCHAR(4) DEFAULT NULL; 
	DECLARE de_114_123 VARCHAR(2) DEFAULT NULL; 
	




	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	
	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
	
	SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
	set de_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
	
	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




			
			
		
				if (select tbl_user_id from tbl_user where tbl_user_id = de_053 and tbl_user_pinCode = md5(de_064)) is null then 	
					
					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is null then 		
					
						insert into tbl_block_account set
						tbl_user_id = de_053,
						tbl_block_account_numtry = 1,
						tbl_block_account_datelasttry = NOW();
						
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
					else 
						SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
						SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);
						SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

						if (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) < 3 then 		
						
						

							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		

								set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = de_053) +1;
								SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
								
								update tbl_block_account set 
								tbl_block_account_numtry = PINCODECONT_AUX,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
								
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);
								
							else 
							
								update tbl_block_account set 
								tbl_block_account_numtry = 1,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
							end if ;
							
						else
						
							if (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) > (NOW()-INTERVAL 30 MINUTE) then 		
						
								set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053) - (NOW()-INTERVAL 30 MINUTE);
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
				
							else
							
								update tbl_block_account set 
								tbl_block_account_numtry = 1,
								tbl_block_account_datelasttry = NOW()
								where tbl_user_id = de_053;
						
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Pincode'),('122.74','1'),('121.129','30');
						
							end if ;
							
						end if;
				
					end if;
					
				else
					
					if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053) is not null then
					
						if (select tbl_user_id from tbl_block_account where tbl_user_id = de_053 and tbl_block_account_numtry < 3) is not null then 
					
							delete from tbl_block_account where tbl_user_id = de_053;
							
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','0000'),('44','Transaction Approved');
							
						else 
							
							SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
							SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = de_053);
							SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

							if (LASTTRY_AUX > NOW_30_AUX) then
							
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
								
							else 
							
								delete from tbl_block_account where tbl_user_id = de_053;
							
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','0000'),('44','Transaction Approved');
								
							end if;

						end if;
					
					else 
					
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','0000'),('44','Transaction Approved');
					
					end if;
		
				end if;
	
			
	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74);
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129);
	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) AS JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=4) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"'))AS JSON;

	end if;

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePasswordPincodeMobile050400678` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `ValidatePasswordPincodeMobile050400678`(IN MSG_IN VARCHAR(20000))
BEGIN

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_53 VARCHAR(20) DEFAULT NULL;      
    DECLARE de_052 VARCHAR(50) DEFAULT NULL; 	
	DECLARE de_064 INTEGER(8) DEFAULT NULL;       


	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	



	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;



		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_53 = (select right(de_53,11));
	
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52');
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
		



	
	if (select tbl_user_email from tbl_user where tbl_user_id = de_53 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is not null then 
		
        if (select tbl_user_email from tbl_user where tbl_user_id = de_53 and tbl_user_password = md5(CONVERT(unhex(de_052) USING utf8 ))) is not null then
        
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
            
		else
        
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1015'),('44','Invalid Password');
        
        end if;
		
	else 
    
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','1825'),('44','Invalid Pincode');
		
	end if;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCID(de_53)),'"}')) as JSON;
	
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	end if;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePincodeAdmin050400259` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePincodeAdmin050400259`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE de_53 VARCHAR(20) DEFAULT NULL;             
	
	
	DECLARE de_064 INTEGER(8) DEFAULT NULL;       



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	



	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




		
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
		SET de_53 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '53');
		set de_53 = (select right(de_53,11));
	




	
	if (select tbl_user_email from tbl_user where tbl_user_id = de_53 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is not null then 
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		
	else 
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','1825'),('44','Invalid Pincode');
		
	end if;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCID(de_53)),'"}')) as JSON;
	
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	end if;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePincodeMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePincodeMobile`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_064 INTEGER(4) DEFAULT NULL;       
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
	
	IF flag_validation = FALSE THEN




	
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




	
		set RESULT_53 = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = de_064);
		
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = de_064) is not null then 
		
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
			
		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1825'),('44','Invalid Pincode');
			
		end if;


	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	END IF;
	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	if (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = de_064) is not null then
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"')) as JSON;
	
	else
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	end if;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePincodeMobile050400136` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePincodeMobile050400136`(IN MSG_IN VARCHAR(20000))
BEGIN



	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_064 INTEGER(8) DEFAULT NULL;       



	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	



	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;




		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
	




	if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is not null then 
	
		insert into TBL_MESSAGE (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');
		
	else 

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','1825'),('44','Invalid Pincode');
		
	end if;

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 )));

	if (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is not null then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',(select dbuser.GetNMCID(RESULT_53)),'"}')) as JSON;
	
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	end if;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidatePincodeMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidatePincodeMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN
	












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_064 INTEGER(8) DEFAULT NULL;       
	



	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	



	
	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	




	
		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_064 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '64');
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;




	
		set RESULT_53 = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 )));
		
		if (select tbl_user_email from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is not null then 
		
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','0000'),('44','Transaction Approved');
			
		else 

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1825'),('44','Invalid Pincode');
			
		end if;


	
	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	if (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_pinCode = md5(CONVERT(unhex(de_064) USING utf8 ))) is not null then
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"')) as JSON;
	
	else
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
	end if;
	
	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateTemporalPasswordForgot020400280` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateTemporalPasswordForgot020400280`(IN MSG_IN VARCHAR(20000))
BEGIN
	











	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL;   
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; 		





	DECLARE USER_ID INT(11) DEFAULT NULL;

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;





	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '114.7');
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE1 WHERE CODE = '52');
	
	SET USER_ID = (select tbl_user_id from tbl_user where tbl_user_email = de_114_007 limit 1);

	
	DELETE FROM TBL_MESSAGE1 WHERE CODE IN (	'24','25') OR CODE>44;





	if (select tbl_user_id from tbl_user where tbl_user_id = USER_ID and tbl_userstatus_id = 39 and tbl_user_password = md5(convert(unhex(de_052) using utf8))) is not null then

		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','0000'),('44','Transaction Approved');

	else

		insert into TBL_MESSAGE1 (CODE,DATA)
		values('39','1825'),('44','Invalid Password');

	end if;
	
	
	
	

	set RESULT_39 = (select DATA from TBL_MESSAGE1 where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE1 where CODE = 44);

	if RESULT_39 = '0000' then
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',GetNMCId(USER_ID),'"}')) as JSON;	
	else
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
	end if;

	DROP TABLE TBL_MESSAGE1;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateTemporalUserPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateTemporalUserPortal`(IN MSG_IN VARCHAR(20000))
BEGIN












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
		
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;	
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL; 		





	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE USER_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE PASSWORD_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE USER_ACTIVE_AUX VARCHAR(40) DEFAULT NULL;
	
	DECLARE USERID_AUX VARCHAR(40) DEFAULT NULL;
	




	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
		
	IF flag_validation = FALSE THEN




		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52'); 
		
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		



		SET USERID_AUX = (select tbl_user_id FROM tbl_user where tbl_user_email = de_114_007);
		
		SET USER_TEMPORAL_AUX = (select tbl_user_userTemp_f FROM tbl_user where tbl_user_email = de_114_007);
		SET PASSWORD_TEMPORAL_AUX = (select tbl_user_passwordTemp_f FROM tbl_user where tbl_user_email = de_114_007);
		SET USER_ACTIVE_AUX = (select tbl_user_status_f FROM tbl_user where tbl_user_email = de_114_007);
		
		
		
	
		IF (SELECT tbl_user_email FROM tbl_user WHERE  tbl_user_email = de_114_007) IS NOT NULL THEN 
		
					
						IF (SELECT tbl_user_email FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_052) USING utf8 ))) IS NOT NULL THEN 
							
							
							case  USER_ACTIVE_AUX 
							when 1 then 						
						
									case USER_TEMPORAL_AUX
									when 1 then  				
										
											case PASSWORD_TEMPORAL_AUX
											when 1 then			
											
												
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','2013'),('44','Temporal User Forgot Password'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 	
												
											when 0 then			
													
												
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','2014'),('44','Database Manipulation'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 	
											end case;
											
									when 0 then					
											case PASSWORD_TEMPORAL_AUX
											when 1 then			
											
												
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','2015'),('44','Non Temporal User Forgot Password'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 	
												
											when 0 then 		
													
												
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','0000'),('44','Transaction Approved'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 	
											end case;
											
									end case;
										
								
							when 0 then 
								
									
									insert into TBL_MESSAGE (CODE,DATA)
									values('39','1824'),('44','Invalid Costumer'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
							end case;
						
						else
							
							
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','1825'),('44','Invalid Password'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
						end if;
					
			
		ELSE 
			
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1014'),('44','Account Not Found'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 	
					
		END IF;

			

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	
	
	END IF;
	
	
	SET RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	SET RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
		
	
	
	SELECT 
     GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) AS JSON;
	
	

	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserCRM050400674` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `ValidateUserCRM050400674`(PARAM VARCHAR(20000))
BEGIN 
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_52 VARCHAR(50) DEFAULT NULL; 
	
-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- -----------------	
-- Set variables --
-- -----------------

	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_007 = (select DATA from TBL_MESSAGE1 where CODE = '114.7');
	SET de_52 = (select DATA from TBL_MESSAGE1 where CODE = '52');

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
-- ---------------		
-- Query of DB --
-- ---------------


	IF(SELECT tbl_user_id FROM tbl_user WHERE tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) IS NULL THEN
		SELECT 
			GROUP_CONCAT(   
				CONCAT('{"39":"','1014','"'),CONCAT(',"44":"','Invalid Password','"}') )as JSON;
	ELSE

		IF (SELECT tbl_user_id FROM  tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8)) and tbl_user_entity not in (10) limit 1) IS NOT NULL THEN
			
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) = 34 then -- if the user is blocked
			
				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;
				
			ELSEIF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) = 35 then -- Pending

				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','2066','"'),CONCAT(',"44":"','The Account is Pending for Approval','"}') )as JSON;

			ELSEIF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) = 38 then -- Deleted

				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;

			ELSEIF (SELECT tbl_user_entity from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) in (20,25) then -- Consumer or Merhcant

				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;

			ELSE
            
				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"39":"','0000','"'),
						CONCAT(',"44":"','Transaction Approved','"'),
						CONCAT(',"53":"',     COALESCE(dbuser.getNMCID(A.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(A.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', if(A.tbl_user_companyName  is null or A.tbl_user_companyName = '',if(A.tbl_user_class in('2A1','3A1'),(select tbl_user_companyName from tbl_user where tbl_user_id = A.tbl_user_parentId),''),A.tbl_user_companyName ),'"'),
						CONCAT(',"123.71":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),(select C.tbl_reseller_taxNumber from dbuser.tbl_reseller as C where C.tbl_user_id = A.tbl_user_id)),''),'"'),
						CONCAT(',"114.7":"',  COALESCE(A.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(A.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(A.tbl_user_last,''),'"'),
						CONCAT(',"114.91":"', COALESCE(A.tbl_user_title,''),'"'),
                        CONCAT(',"AD":[',     COALESCE(dbuser.getNMCAddressByUser(A.tbl_user_id),''),']'),
						CONCAT(',"LO":[',     COALESCE(dbuser.getNMCLocationByUser(A.tbl_user_id),''),']'),
						CONCAT(',"PH":[',     COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']'),
						CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryUser(A.tbl_user_id),''),']'),
						CONCAT(',"AC":{',     COALESCE(dbcards.getNMCCardByUser(A.tbl_user_id),''),'}'),
                        CONCAT(',"PE":[',     COALESCE(dbuser.getNMCPermissionByUser(A.tbl_user_id),''),']'),
                        CONCAT(',"DL":[',     COALESCE(dbuser.getNMCDesignatedLocationsByUser(A.tbl_user_id),''),']'),
						CONCAT(',"114.4":"',  COALESCE(A.tbl_user_middle,''),'"'),
						CONCAT(',"127.10":"', COALESCE(A.tbl_owner_id,''),'"'),
						CONCAT(',"127.66":"', COALESCE(A.tbl_user_information,''),'"'),
						CONCAT(',"114.11":"', COALESCE(A.tbl_gender_type,''),'"'),
						CONCAT(',"127.70":"', COALESCE(A.tbl_company_type,''),'"'),
						CONCAT(',"127.71":"', COALESCE(A.tbl_company_type_other,''),'"'),
						CONCAT(',"122.94":"', COALESCE(A.tbl_user_language,'EN'),'"'),
						CONCAT(',"122.91":"', COALESCE(A.tbl_user_position,''),'"'),
						CONCAT(',"122.92":"', COALESCE(A.tbl_user_department,''),'"'),
						CONCAT(',"114.143":"',COALESCE(A.tbl_userstatus_id,''),'"'),
						CONCAT(',"117.26":"', COALESCE(A.tbl_agent_type_id,''),'"'),
						CONCAT(',"123.34":"', COALESCE(if (A.tbl_user_class in ('2A1','2B1','2C1'),(select B.tbl_user_crc from tbl_user as B where B.tbl_user_id = A.tbl_user_parentId),A.tbl_user_crc),''),'"'),
                        CONCAT(',"114.121":"',COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.17":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.18":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.20":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.21":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
                        CONCAT(',"114.9":"',  (select if ((select A.tbl_user_userTemp_f from tbl_user as A where A.tbl_user_email = de_114_007 and A.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) limit 1) = 1,'true','false')),'"'),
					    
                        CONCAT(',"122.46":"', COALESCE(if((select tbl_permission_ad_create_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        CONCAT(',"122.47":"', COALESCE(if((select tbl_permission_ad_publish_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        
                        CONCAT(',"119.16":"', COALESCE(hex(A.tbl_user_policy),''),'"'),
                        CONCAT(',"120.157":"',COALESCE((SELECT W.tbl_reseller_comments FROM dbuser.tbl_reseller as W where W.tbl_user_id =A.tbl_user_id ),'' ),'"}')
						
						)as JSON
					   
						from tbl_user as A
						where A.tbl_user_email = de_114_007
						and A.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) 
                        and tbl_user_entity not in (10)
						LIMIT INI,FIN;
                        
			END IF;
		ELSE	
        
			SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','1825','"'),CONCAT(',"44":"','Invalid Password','"}') )as JSON;
                
		END IF;
	END IF;		
	
	DROP TABLE TBL_MESSAGE1;
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserKey050400054` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateUserKey050400054`(IN MSG_IN VARCHAR(20000))
BEGIN





	DECLARE de_120_004 VARCHAR(45) DEFAULT NULL;  
	DECLARE de_120_053 VARCHAR(255) DEFAULT NULL; 
	DECLARE de_114_009 VARCHAR(5) DEFAULT NULL;  




	DECLARE MERCHANT_AUX INT(11) DEFAULT NULL;
	DECLARE COMPANYNAME_AUX VARCHAR(45) DEFAULT NULL;
	DECLARE LOGOIMAGE_AUX VARCHAR(45) DEFAULT NULL;
	DECLARE PHONENUMBER_AUX VARCHAR(20) DEFAULT NULL;
	DECLARE OWNER_AUX VARCHAR(11) DEFAULT NULL;

	DECLARE STATUS_AUX VARCHAR(11) DEFAULT NULL;

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	




	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;





		SET de_120_004 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.4');
		SET de_120_053 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '120.53');
		SET de_114_009 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.9');

		DELETE FROM TBL_MESSAGE WHERE CODE IN ( '24','25') OR CODE>44;





		if length(de_114_009)>0 then

			if de_114_009 = 'true' then

				update tbl_user_key set 
				tbl_user_key_status = 1
				where tbl_user_key_tocken = de_120_004;	

			end if;
		end if;

		if (select tbl_user_key_status from tbl_user_key where tbl_user_key_tocken = de_120_004) = 1 then

			set STATUS_AUX = 'true';
		else

			set STATUS_AUX = 'false';
		end if;

		if (select tbl_user_key_url from tbl_user_key where tbl_user_key_tocken = de_120_004 ) is null or (select tbl_user_key_url from tbl_user_key where tbl_user_key_tocken = de_120_004 ) = 'null' then

			update tbl_user_key set 
			tbl_user_key_url = de_120_053
			where tbl_user_key_tocken = de_120_004;

			insert into TBL_MESSAGE (CODE,DATA)
			values('39','1'),('44','Transaction Approved');

		else 

			if (select tbl_user_key_url from tbl_user_key where tbl_user_key_tocken = de_120_004 and tbl_user_key_url = de_120_053) is not null then

				set MERCHANT_AUX = (select tbl_user_nmcId from tbl_user_key where tbl_user_key_tocken = de_120_004 and tbl_user_key_url = de_120_053 limit 1);
				set COMPANYNAME_AUX = (select A.tbl_user_companyName from dbuser.tbl_user as A, dbuser.tbl_merchant as B where B.tbl_merchant_nmcId = MERCHANT_AUX and A.tbl_user_id = B.tbl_user_id);
				set LOGOIMAGE_AUX = (select tbl_merchant_logoimage from dbuser.tbl_merchant where tbl_merchant_nmcId = MERCHANT_AUX limit 1);
				set PHONENUMBER_AUX = (select tbl_phone_phoneNumber from dbuser.tbl_phone where tbl_phone_nmcId = MERCHANT_AUX limit 1);
				set OWNER_AUX = (select A.tbl_owner_id from dbuser.tbl_user as A, dbuser.tbl_merchant as B where B.tbl_merchant_nmcId = MERCHANT_AUX and A.tbl_user_id = B.tbl_user_id);

				insert into TBL_MESSAGE (CODE,DATA)
				values('39','2'),('44','Transaction Approved');

			else 

				insert into TBL_MESSAGE (CODE,DATA)
				values('39','3'),('44','Transaction Approved');

			end if;

		end if;

		set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
		set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

		if RESULT_39 = '2' then
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),
							CONCAT(',"44":"',RESULT_44,'"'),
							CONCAT(',"53":"',(select dbuser.GetNMCID(MERCHANT_AUX)),'"'),
							CONCAT(',"120.53":"',de_120_053,'"'),
							CONCAT(',"114.70":"',COMPANYNAME_AUX,'"'),
							CONCAT(',"121.77":"',LOGOIMAGE_AUX,'"'),
							CONCAT(',"48.28":"',PHONENUMBER_AUX,'"'),
							CONCAT(',"127.10":"',OWNER_AUX,'"'),
							CONCAT(',"114.9":"',STATUS_AUX,'"}')
							) as JSON;
		else 
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;	
		end if;


	DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserMobile` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateUserMobile`(IN MSG_IN VARCHAR(20000))
BEGIN

-- --------------------------------------------------------
-- Autor: Luis Gerardo Porras
-- Procedure: ValidateUserMobile
-- Method: VALIDATION
-- Version: 1.0
-- last modified: 2013-12-23
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
		
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;	
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 	--  Email
	DECLARE de_052 VARCHAR(16) DEFAULT NULL; 		--  password
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;	    --  Device Id
	
-- --------------------
-- Declare auxiliary --
-- --------------------
	
	
	DECLARE PASSWORD_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE USERID_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE DEVICE_INI_AUX VARCHAR(40) DEFAULT NULL;
	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL; 
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;
	
	
	
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_72 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_123 VARCHAR(45) DEFAULT NULL;
-- ---------------
-- Validations --
-- ---------------	

	-- exception for format
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	-- abort if the temporalt table exist
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	-- EXCEPTION FOR SQL SYNTAXIS
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	-- EXCEPTION lenght
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	--            TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
		
	IF flag_validation = FALSE THEN
-- -----------------	
-- Set variables --
-- -----------------		

		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52'); 
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57'); 
		
		-- remove 24 - 25 - 101 - 53 - 52
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
-- ---------------		
-- Query of DB --
-- ---------------
		SET USERID_AUX = (select tbl_user_id FROM tbl_user where tbl_user_email = de_114_007);
		SET PASSWORD_TEMPORAL_AUX = (select tbl_user_passwordTemp_f FROM tbl_user where tbl_user_email = de_114_007);
		
		SET DEVICE_INI_AUX = (SELECT tbl_status_id FROM tbl_device  where tbl_device_udid = de_057 limit 1);
				
			CASE DEVICE_INI_AUX 
				when 3 then		-- the device is lost/blocked
	
					-- INSERT VALUES OF RESPONSE
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1827'),('44','Blocked Device'); -- blocked device (lost/reported)
						
				when 2 then		-- the device is lost/blocked
	
					-- INSERT VALUES OF RESPONSE
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1827'),('44','Blocked Device'); -- blocked device (lost/reported)	
						
				

				else -- active device or not registered
		
					IF (SELECT tbl_user_email FROM tbl_user WHERE  tbl_user_email = de_114_007) IS NULL THEN -- If the email exists
		
							-- INSERT VALUES OF RESPONSE
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','1014'),('44','Account Not Found'); 	-- Wrong email 
						
					ELSE
		
						IF(SELECT tbl_userType_id from tbl_user  WHERE  tbl_user_email = de_114_007) != 1 then  -- usertype validation
						
						
								-- INSERT VALUES OF RESPONSE
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','1824'),('44','Invalid consumer'); 	 -- not a consumer
		
						ELSE
		
		
							IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 ) = 34 then -- if the user is blocked
			
								-- INSERT VALUES OF RESPONSE
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','3001'),('44','Account Not Valid'); 	 -- blocked user
							
							ELSE
		
								IF (SELECT tbl_user_email FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_password = CONVERT(unhex(de_052) USING utf8 )) is null then -- if email and password not exists
		
								
									IF (select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX) is null then 		-- if theres no tries yet
					
										insert into tbl_block_account set
										tbl_user_id = USERID_AUX,
										tbl_block_account_numtry = 1,
										tbl_block_account_datelasttry = NOW();
										
											-- INSERT VALUES OF RESPONSE
										insert into TBL_MESSAGE (CODE,DATA)
										values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30'); -- first try
		
									ELSE
										
										SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
										SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
										SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

										IF (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) < 3 then 	
		
											IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		

												set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) +1;
												
												
												SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
												
												update tbl_block_account set 
												tbl_block_account_numtry = PINCODECONT_AUX,
												tbl_block_account_datelasttry = NOW()
												where tbl_user_id = USERID_AUX;
												
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1825'),('44','Invalid Password'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);
											
											ELSE 
											
												update tbl_block_account set 
												tbl_block_account_numtry = 1,
												tbl_block_account_datelasttry = NOW()
												where tbl_user_id = USERID_AUX;
										
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
										
											END IF;
		
										ELSE
						
											IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		
										
												set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) - (NOW()-INTERVAL 30 MINUTE);
										
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
								
											ELSE
											
												update tbl_block_account set 
												tbl_block_account_numtry = 1,
												tbl_block_account_datelasttry = NOW()
												where tbl_user_id = USERID_AUX;
										
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
										
											END IF;
											
										END IF;
									END IF;
								ELSE -- THE EMAIL and passwords are correct
										
										
									IF(select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX and tbl_block_account_numtry < 3) is null then -- if the user has 3 TRIES (or more)
					
									
										SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
										SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
										SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

										IF (LASTTRY_AUX > NOW_30_AUX) then -- if time since last try is less than 30 mins
										
											insert into TBL_MESSAGE (CODE,DATA)
											values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
											
										ELSE
										
											delete from tbl_block_account where tbl_user_id = USERID_AUX;

									
											case PASSWORD_TEMPORAL_AUX
												when 1 then			-- Password is temporal
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	-- Temporal Password and no assigned device
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  -- Temporal Password and assigned device
													end if;
													
												when 0 then			-- Password no temporal
														
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	-- Registered Password and no assigned device
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); -- Registered Password and assigned device	
													end if;
											end case;
										
										END IF;
									
									ELSE
										
										delete from tbl_block_account where tbl_user_id = USERID_AUX;
										
										
											case PASSWORD_TEMPORAL_AUX
												when 1 then			-- Password is temporal
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	-- Temporal Password and no assigned device
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  -- Temporal Password and assigned device
													end if;
													
												when 0 then			-- Password no temporal
														
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	-- Registered Password and no assigned device
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); -- Registered Password and assigned device	
													end if;
											end case;
												
									end if;
								end if;
							end if;
						end if;
					end if;				
			end case;						
		

				

	ELSE
	
		-- remove 24 - 25 - 101 - 53 - 52
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		-- INSERT VALUES OF RESPONSE
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	
	
	END IF;
	
-- ----------------		
-- JSon Response --
-- ----------------

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);
	set RESULT_122_72 = (select DATA from TBL_MESSAGE where CODE = 122.72); -- email validation
	set RESULT_114_123 = (select DATA from TBL_MESSAGE where CODE = 114.123); -- usertype
	
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74); -- tries
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129); -- time left

	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=5) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"'),CONCAT(',"122.72":"',RESULT_122_72,'"'),CONCAT(',"114.123":"',RESULT_114_123,'"')) as JSON;

	elseif ((select count(*) from TBL_MESSAGE)=4) then	
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"'))AS JSON;
		
	end if;



	/*
	SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
	DROP TABLE TBL_MESSAGE;
	*/
		DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserMobile010400010` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateUserMobile010400010`(IN MSG_IN VARCHAR(20000))
BEGIN

















	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

		

	DECLARE de_39 VARCHAR(4) DEFAULT NULL;

	DECLARE de_44 VARCHAR(25) DEFAULT NULL;

	DECLARE de_18 VARCHAR(140) DEFAULT NULL;

	DECLARE flag_validation BOOLEAN DEFAULT FALSE;	

	

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL; 		
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;	    
	




	

	

	DECLARE PASSWORD_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;

	DECLARE USERID_AUX VARCHAR(40) DEFAULT NULL;

	DECLARE DEVICE_INI_AUX VARCHAR(40) DEFAULT NULL;

	

	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;

	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;

	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;

	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;

	

	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL; 

	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;

	

	

	

	

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_122_72 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_114_123 VARCHAR(45) DEFAULT NULL;






	
	DECLARE exit HANDLER FOR 1292 

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1050

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1064

	BEGIN

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
	DECLARE EXIT HANDLER FOR 1264

	BEGIN

		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;

		

		
		insert into TBL_MESSAGE (CODE,DATA)

		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 

		

		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE

         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),

         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'

         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);

		DROP TABLE TBL_MESSAGE;

	END;

	

	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);

	

	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));

	

    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));

    PREPARE stmt FROM @QRY;

    EXECUTE stmt;

    DEALLOCATE PREPARE stmt;

	

	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);

		

	IF flag_validation = FALSE THEN






		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');

		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52'); 

		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57'); 

		

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		




		SET USERID_AUX = (select tbl_user_id FROM tbl_user where tbl_user_email = de_114_007);

		SET PASSWORD_TEMPORAL_AUX = (select tbl_user_passwordTemp_f FROM tbl_user where tbl_user_email = de_114_007);

		

		SET DEVICE_INI_AUX = (SELECT tbl_status_id FROM tbl_device  where tbl_device_udid = de_057 limit 1);

				

			CASE DEVICE_INI_AUX 

				when 3 then		
	

					
						insert into TBL_MESSAGE (CODE,DATA)

						values('39','1827'),('44','Blocked Device'); 
						

				when 2 then		
	

					
						insert into TBL_MESSAGE (CODE,DATA)

						values('39','1827'),('44','Blocked Device'); 
						

				



				else 
		

					IF (SELECT tbl_user_email FROM tbl_user WHERE  tbl_user_email = de_114_007) IS NULL THEN 
		

							
							insert into TBL_MESSAGE (CODE,DATA)

							values('39','1014'),('44','Account Not Found'); 	
						

					ELSE

		

						IF(SELECT tbl_userType_id from tbl_user  WHERE  tbl_user_email = de_114_007) != 1 then  
						

						

								
							insert into TBL_MESSAGE (CODE,DATA)

							values('39','1824'),('44','Invalid consumer'); 	 
		

						ELSE

		

		

							IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 ) = 34 then 
			

								
								insert into TBL_MESSAGE (CODE,DATA)

								values('39','3001'),('44','Account Not Valid'); 	 
							

							ELSE

		

								IF (SELECT tbl_user_email FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_052) USING utf8 ))) is null then 
		

								

									IF (select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX) is null then 		
					

										insert into tbl_block_account set

										tbl_user_id = USERID_AUX,

										tbl_block_account_numtry = 1,

										tbl_block_account_datelasttry = NOW();

										

											
										insert into TBL_MESSAGE (CODE,DATA)

										values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30'); 
		

									ELSE

										

										SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);

										SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);

										SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);



										IF (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) < 3 then 	

		

											IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		



												set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) +1;

												

												

												SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

												

												update tbl_block_account set 

												tbl_block_account_numtry = PINCODECONT_AUX,

												tbl_block_account_datelasttry = NOW()

												where tbl_user_id = USERID_AUX;

												

												insert into TBL_MESSAGE (CODE,DATA)

												values('39','1825'),('44','Invalid Password'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);

											

											ELSE 

											

												update tbl_block_account set 

												tbl_block_account_numtry = 1,

												tbl_block_account_datelasttry = NOW()

												where tbl_user_id = USERID_AUX;

										

												insert into TBL_MESSAGE (CODE,DATA)

												values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');

										

											END IF;

		

										ELSE

						

											IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		

										

												set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) - (NOW()-INTERVAL 30 MINUTE);

										

												insert into TBL_MESSAGE (CODE,DATA)

												values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);

								

											ELSE

											

												update tbl_block_account set 

												tbl_block_account_numtry = 1,

												tbl_block_account_datelasttry = NOW()

												where tbl_user_id = USERID_AUX;

										

												insert into TBL_MESSAGE (CODE,DATA)

												values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');

										

											END IF;

											

										END IF;

									END IF;

								ELSE 
										

										

									IF(select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX and tbl_block_account_numtry < 3) is null then 
					

									

										SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);

										SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);

										SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);



										IF (LASTTRY_AUX > NOW_30_AUX) then 
										

											insert into TBL_MESSAGE (CODE,DATA)

											values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);

											

										ELSE

										

											delete from tbl_block_account where tbl_user_id = USERID_AUX;



									

											case PASSWORD_TEMPORAL_AUX

												when 1 then			
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN

													

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  
													end if;

													

												when 0 then			
														

													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN

													

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 
													end if;

											end case;

										

										END IF;

									

									ELSE

										

										delete from tbl_block_account where tbl_user_id = USERID_AUX;

										

										

											case PASSWORD_TEMPORAL_AUX

												when 1 then			
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN

													

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  
													end if;

													

												when 0 then			
														

													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN

													

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else

														insert into TBL_MESSAGE (CODE,DATA)

														values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 
													end if;

											end case;

												

									end if;

								end if;

							end if;

						end if;

					end if;				

			end case;						

		



				



	ELSE

	

		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

		

		
		INSERT INTO TBL_MESSAGE(CODE, DATA)

		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));

	

	

	

	END IF;

	






	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);

	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);

	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);

	set RESULT_122_72 = (select DATA from TBL_MESSAGE where CODE = 122.72); 
	set RESULT_114_123 = (select DATA from TBL_MESSAGE where CODE = 114.123); 
	

	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74); 
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129); 


	

	if ((select count(*) from TBL_MESSAGE)=2) then

	

		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;

		

	elseif ((select count(*) from TBL_MESSAGE)=5) then

	

		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"'),CONCAT(',"122.72":"',RESULT_122_72,'"'),CONCAT(',"114.123":"',RESULT_114_123,'"')) as JSON;



	elseif ((select count(*) from TBL_MESSAGE)=4) then	

	

		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"'))AS JSON;

		

	end if;







	

		DROP TABLE TBL_MESSAGE;

 

 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserMobile050300010` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `ValidateUserMobile050300010`(IN MSG_IN VARCHAR(20000))
BEGIN
 
-- --------------------------------------------------------
-- Autor: Luis Gerardo Porras
-- Procedure: ValidateUserMobile050300010
-- Method: 050300010
-- Version: 1.0
-- last modified: 2014-03-06
-- --------------------------------------------------------
 
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
		
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 	--  Email
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; 		--  password
	DECLARE de_057 VARCHAR(75) DEFAULT NULL;	    --  Device Id
	DECLARE de_121_006 INT(11)  DEFAULT 0; 			--  HAS PIN
	
-- --------------------
-- Declare auxiliary --
-- --------------------
	
	
	DECLARE USER_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE USERID_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE DEVICE_INI_AUX VARCHAR(40) DEFAULT NULL;
	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL; 
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;
	
	
	
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_72 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_123 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_55 VARCHAR(45) DEFAULT NULL;
-- ---------------
-- Validations --
-- ---------------	

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	--            TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
-- -----------------	
-- Set variables --
-- -----------------		

		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52'); 
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57'); 
		
		-- remove 24 - 25 - 101 - 53 - 52
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
-- ---------------		
-- Query of DB --
-- ---------------
	

		SET USERID_AUX = (select tbl_user_id FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_entity = 10 limit 1);
		
		
		if length((select tbl_user_pinCode from tbl_user where tbl_user_id = USERID_AUX)) = 32 then
			set de_121_006 = 1;
		else
			set de_121_006 = 0;
		end if;
		
		
		
		SET USER_TEMPORAL_AUX = (select tbl_user_userTemp_f FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_entity = 10 limit 1);
		
		SET DEVICE_INI_AUX = (SELECT tbl_status_id FROM tbl_device  where tbl_device_udid = de_057 limit 1);

		
		CASE DEVICE_INI_AUX 
			when 5803 then		-- the device is lost/blocked

				-- INSERT VALUES OF RESPONSE
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','1827'),('44','Blocked Device'); -- blocked device (lost/reported)
					
			when 5802 then		-- the device is lost/blocked

				-- INSERT VALUES OF RESPONSE
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','1827'),('44','Blocked Device'); -- blocked device (lost/reported)	
					
			

			else -- active device or not registered
	
				IF (SELECT tbl_user_email FROM tbl_user WHERE  tbl_user_email = de_114_007 and tbl_user_entity = 10 limit 1) IS NULL THEN -- If the email exists
	
						-- INSERT VALUES OF RESPONSE
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1014'),('44','Account Not Found'); 	-- Wrong email 
					
				ELSE
					IF(SELECT tbl_user_entity FROM dbuser.tbl_user where tbl_user_email = de_114_007 and tbl_user_entity = 10 limit 1) >21 then
						
								-- INSERT VALUES OF RESPONSE
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','3001'),('44','Account Not Valid'); 	 -- USER IS NOT  a consumer or merchant
					
					
					ELSE
						
						IF (USER_TEMPORAL_AUX IS NOT NULL) THEN
							IF (USER_TEMPORAL_AUX = 0) THEN
			
								IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity = 10 limit 1) = 34 then -- if the user is blocked
				
									-- INSERT VALUES OF RESPONSE
									insert into TBL_MESSAGE (CODE,DATA)
									values('39','3001'),('44','Account Not Valid'); 	 -- blocked user
								
								ELSE
			
									IF (SELECT tbl_user_email FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_052) USING utf8 )) and tbl_user_entity = 10 limit 1) is null then -- if email and password not exists
			
									
										IF (select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX) is null then 		-- if theres no tries yet
						
											insert into tbl_block_account set
											tbl_user_id = USERID_AUX,
											tbl_block_account_numtry = 1,
											tbl_block_account_datelasttry = NOW();
											
												-- INSERT VALUES OF RESPONSE
											insert into TBL_MESSAGE (CODE,DATA)
											values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30'); -- first try
			
										ELSE
											
											SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
											SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
											SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

											IF (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) < 3 then 	
			
												IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		

													set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) +1;
													
													
													SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
													
													update tbl_block_account set 
													tbl_block_account_numtry = PINCODECONT_AUX,
													tbl_block_account_datelasttry = NOW()
													where tbl_user_id = USERID_AUX;
													
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','1825'),('44','Invalid Password'),('122.74',coalesce(PINCODECONT_AUX,0)),('121.129',coalesce(DELAYTIME_AUX,30));
											
												ELSE 
												
													update tbl_block_account set 
													tbl_block_account_numtry = 1,
													tbl_block_account_datelasttry = NOW()
													where tbl_user_id = USERID_AUX;
											
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
											
												END IF;
			
											ELSE
							
												IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		
											
													set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) - (NOW()-INTERVAL 30 MINUTE);
											
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
									
												ELSE
												
													update tbl_block_account set 
													tbl_block_account_numtry = 1,
													tbl_block_account_datelasttry = NOW()
													where tbl_user_id = USERID_AUX;
											
													insert into TBL_MESSAGE (CODE,DATA)
													values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
											
												END IF;
												
											END IF;
										END IF;
									ELSE -- THE EMAIL and passwords are correct
											
											
										IF(select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX and tbl_block_account_numtry < 3) is null then -- if the user has 3 TRIES (or more)
						
										
											SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
											SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
											SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

											IF (LASTTRY_AUX > NOW_30_AUX) then -- if time since last try is less than 30 mins
											
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
												
											ELSE
											
												delete from tbl_block_account where tbl_user_id = USERID_AUX;

														-- IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
														
															-- insert into TBL_MESSAGE (CODE,DATA)
															-- values('39','1819'),('44','Invalid terminal'),('114.123','usertype'),('122.74','3'),('53',USERID_AUX); 	-- Registered Password and no assigned device
														-- else
															insert into TBL_MESSAGE (CODE,DATA)
															values('39','0000'),('44','Transaction Approved'),('114.123','usertype'),('122.74','3'),('53',USERID_AUX); -- Registered Password and assigned device	
														-- end if;
											END IF;
										
										ELSE
											
											delete from tbl_block_account where tbl_user_id = USERID_AUX;
											
															
														-- IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
														
															-- insert into TBL_MESSAGE (CODE,DATA)
															-- values('39','1819'),('44','Invalid terminal'),('122.74','3'),('53',USERID_AUX); 	-- Registered Password and no assigned device
														-- else
															insert into TBL_MESSAGE (CODE,DATA)
															values('39','0000'),('44','Transaction Approved'),('122.74','3'),('53',USERID_AUX); -- Registered Password and assigned device	
														-- end if;
													
										end if;
									end if;
								end if;
							

							ELSE
								-- INSERT VALUES OF RESPONSE
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1824'),('44','Invalid User'); 	 -- Temporal user
							END IF;		
						ELSE
							-- INSERT VALUES OF RESPONSE
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','1824'),('44','Invalid User'); 	 -- Temporal user
						END IF;
					END IF;
				END IF;
			end case;						
           

        

				

	
	
-- ----------------		
-- JSon Response --
-- ----------------

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);
	set RESULT_122_72 = (select DATA from TBL_MESSAGE where CODE = 122.72); -- email validation
	set RESULT_55 = (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =USERID_AUX ) ; -- usertype
	
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74); -- tries
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129); -- time left

	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=5) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',coalesce((select dbuser.getNMCID(RESULT_53)),''),'"'),CONCAT(',"122.74":"',coalesce(RESULT_122_74,''),'"'),CONCAT(',"121.6":"',coalesce(de_121_006,''),'"'),CONCAT(',"55":"',coalesce(RESULT_55,''),'"}')) as JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=4) then	
		if RESULT_53 is not null then
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',coalesce(RESULT_122_74,''),'"'),CONCAT(',"53":"',coalesce((select dbuser.getNMCID(RESULT_53)),''),'"}'))AS JSON;
		else
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',coalesce(RESULT_122_74,''),'"'),CONCAT(',"121.129":"',coalesce(RESULT_121_129,''),'"}'))AS JSON;
		end if;
	end if;

	/* 
	SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
	DROP TABLE TBL_MESSAGE;
	*/
		DROP TEMPORARY TABLE if exists TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserMobile050400326` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateUserMobile050400326`(IN MSG_IN VARCHAR(20000))
BEGIN
 
-- --------------------------------------------------------
-- Autor: Luis Gerardo Porras
-- Procedure: ValidateUserMobile050300010
-- Method: 050300010
-- Version: 1.0
-- last modified: 2014-03-06
-- --------------------------------------------------------
 
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 	--  Email
	DECLARE de_052 VARCHAR(50) DEFAULT NULL; 		--  password
	DECLARE de_121_006 INT(11)  DEFAULT 0; 			--  HAS PIN
	
-- --------------------
-- Declare auxiliary --
-- --------------------
	
	DECLARE USER_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE USERID_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE DEVICE_INI_AUX VARCHAR(40) DEFAULT NULL;
	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL; 
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;

	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_72 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_123 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_55 VARCHAR(45) DEFAULT NULL;
	
-- ---------------
-- Validations --
-- ---------------	

	DROP TEMPORARY TABLE if exists TBL_MESSAGE;
	
	--            TABLE  TEMPORARY OF IN    --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	
-- -----------------	
-- Set variables  --
-- -----------------		

	SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
	SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52'); 
	
	-- remove 24 - 25 - 101 - 53 - 52
	DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;

-- ---------------		
-- Query of DB  --
-- ---------------

	SET USERID_AUX = (select tbl_user_id FROM tbl_user where tbl_user_email = de_114_007);

	if length((select tbl_user_pinCode from tbl_user where tbl_user_id = USERID_AUX)) = 32 then
		set de_121_006 = 1;
	else
		set de_121_006 = 0;
	end if;

	
	SET USER_TEMPORAL_AUX = (select tbl_user_userTemp_f FROM tbl_user where tbl_user_email = de_114_007);

	
	
	
	IF (SELECT tbl_user_email FROM tbl_user WHERE  tbl_user_email = de_114_007) IS NULL THEN -- If the email exists

		insert into TBL_MESSAGE (CODE,DATA)
		values('39','1014'),('44','Account Not Found'); 	-- Wrong email 
		
	ELSE
		
		IF(SELECT tbl_user_entity FROM dbuser.tbl_user where tbl_user_email = de_114_007 ) >21 then
						
			-- INSERT VALUES OF RESPONSE
			insert into TBL_MESSAGE (CODE,DATA)
			values('39','3001'),('44','Account Not Valid'); 	 -- USER IS NOT  a consumer or merchant
					
		
		ELSE
		
			IF (USER_TEMPORAL_AUX IS NOT NULL) THEN
				
				IF (USER_TEMPORAL_AUX = 0) THEN

					IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 ) = 34 then -- if the user is blocked

						insert into TBL_MESSAGE (CODE,DATA)
						values('39','3001'),('44','Account Not Valid'); 	 -- blocked user
					
					ELSE

						IF (SELECT tbl_user_email FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_052) USING utf8 ))) is null then -- if email and password not exists

						
							IF (select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX) is null then 		-- if theres no tries yet
			
								insert into tbl_block_account set
								tbl_user_id = USERID_AUX,
								tbl_block_account_numtry = 1,
								tbl_block_account_datelasttry = NOW();
								
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30'); -- first try

							ELSE
								
								SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
								SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
								SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

								IF (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) < 3 then 	

									IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		

										set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) +1;

										SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
										
										update tbl_block_account set 
										tbl_block_account_numtry = PINCODECONT_AUX,
										tbl_block_account_datelasttry = NOW()
										where tbl_user_id = USERID_AUX;
										
										insert into TBL_MESSAGE (CODE,DATA)
										values('39','1825'),('44','Invalid Password'),('122.74',coalesce(PINCODECONT_AUX,0)),('121.129',coalesce(DELAYTIME_AUX,30));
								
									ELSE 
									
										update tbl_block_account set 
										tbl_block_account_numtry = 1,
										tbl_block_account_datelasttry = NOW()
										where tbl_user_id = USERID_AUX;
								
										insert into TBL_MESSAGE (CODE,DATA)
										values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
								
									END IF;

								ELSE
				
									IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		
								
										set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) - (NOW()-INTERVAL 30 MINUTE);
								
										insert into TBL_MESSAGE (CODE,DATA)
										values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
						
									ELSE
									 
										update tbl_block_account set 
										tbl_block_account_numtry = 1,
										tbl_block_account_datelasttry = NOW()
										where tbl_user_id = USERID_AUX;
								
										insert into TBL_MESSAGE (CODE,DATA)
										values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
								
									END IF;
									
								END IF;
							END IF;
						ELSE -- THE EMAIL and passwords are correct
								
								
							IF(select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX and tbl_block_account_numtry < 3) is null then -- if the user has 3 TRIES (or more)
			
							
								SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
								SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
								SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

								IF (LASTTRY_AUX > NOW_30_AUX) then -- if time since last try is less than 30 mins
								
									insert into TBL_MESSAGE (CODE,DATA)
									values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
									
								ELSE
									
									delete from tbl_block_account where tbl_user_id = USERID_AUX;

									insert into TBL_MESSAGE (CODE,DATA)
									values('39','0000'),('44','Transaction Approved'),('114.123','usertype'),('122.74','3'),('53',USERID_AUX); -- Registered Password and assigned device	
														
								END IF;
							
							ELSE
									
								delete from tbl_block_account where tbl_user_id = USERID_AUX;

								insert into TBL_MESSAGE (CODE,DATA)
								values('39','0000'),('44','Transaction Approved'),('122.74','3'),('53',USERID_AUX); -- Registered Password and assigned device	
														

							end if;
						end if;
					end if;
				

				ELSE
					-- INSERT VALUES OF RESPONSE
					insert into TBL_MESSAGE (CODE,DATA)
					values('39','1824'),('44','Invalid User'); 	 -- Temporal user
				END IF;		
			ELSE
				-- INSERT VALUES OF RESPONSE
				insert into TBL_MESSAGE (CODE,DATA)
				values('39','1824'),('44','Invalid User'); 	 -- Temporal user
			END IF;
		END IF;
	END IF;

		
		
-- ----------------		
-- JSon Response --
-- ----------------

	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);
	set RESULT_122_72 = (select DATA from TBL_MESSAGE where CODE = 122.72); -- email validation
	set RESULT_55 = (SELECT tbl_user_entity FROM dbuser.tbl_user WHERE tbl_user_id =USERID_AUX ) ; -- usertype
	
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74); -- tries
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129); -- time left

	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"}')) as JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=5) then
	
		select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',coalesce((select dbuser.getNMCID(RESULT_53)),''),'"'),CONCAT(',"122.74":"',coalesce(RESULT_122_74,''),'"'),CONCAT(',"121.6":"',coalesce(de_121_006,''),'"'),CONCAT(',"55":"',coalesce(RESULT_55,''),'"}')) as JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=4) then	
		if RESULT_53 is not null then
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',coalesce(RESULT_122_74,''),'"'),CONCAT(',"53":"',coalesce((select dbuser.getNMCID(RESULT_53)),''),'"}'))AS JSON;
		else
			select GROUP_CONCAT(CONCAT('{"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',coalesce(RESULT_122_74,''),'"'),CONCAT(',"121.129":"',coalesce(RESULT_121_129,''),'"}'))AS JSON;
		end if;
	end if;
 
	/*
	SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
	DROP TABLE TBL_MESSAGE;
	*/
		DROP TEMPORARY TABLE if exists TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserMobile_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateUserMobile_1`(IN MSG_IN VARCHAR(20000))
BEGIN













	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;
		
	DECLARE de_39 VARCHAR(4) DEFAULT NULL;
	DECLARE de_44 VARCHAR(25) DEFAULT NULL;
	DECLARE de_18 VARCHAR(140) DEFAULT NULL;
	DECLARE flag_validation BOOLEAN DEFAULT FALSE;	
	
	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 	
	DECLARE de_052 VARCHAR(16) DEFAULT NULL; 		
	DECLARE de_057 VARCHAR(50) DEFAULT NULL;	    
	



	
	
	DECLARE PASSWORD_TEMPORAL_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE USERID_AUX VARCHAR(40) DEFAULT NULL;
	DECLARE DEVICE_INI_AUX VARCHAR(40) DEFAULT NULL;
	
	DECLARE PINCODECONT_AUX INTEGER(11) DEFAULT NULL;
	DECLARE LASTTRY_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE DELAYTIME_AUX VARCHAR(300) DEFAULT NULL;
	DECLARE NOW_30_AUX VARCHAR(300) DEFAULT NULL;
	
	DECLARE RESULT_122_74 VARCHAR(45) DEFAULT NULL; 
	DECLARE RESULT_121_129 VARCHAR(45) DEFAULT NULL;
	
	
	
	
	DECLARE RESULT_39 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_44 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_53 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_122_72 VARCHAR(45) DEFAULT NULL;
	DECLARE RESULT_114_123 VARCHAR(45) DEFAULT NULL;




	
	DECLARE exit HANDLER FOR 1292 
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','0003'),('44','Invalid Value'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1050
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000005'),('39','0005'),('44','Table Message Already Exist'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1064
	BEGIN
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000003'),('39','1015'),('44','Invalid Format Input'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
	DECLARE EXIT HANDLER FOR 1264
	BEGIN
		delete from TBL_MESSAGE  where CODE IN (	'24','25') OR CODE>44;
		
		
		insert into TBL_MESSAGE (CODE,DATA)
		values('18','000002'),('39','0005'),('44','Invalid Lenght'),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s')); 
		
		SELECT * FROM TBL_MESSAGE ORDER BY CAST((SELECT CASE WHEN LOCATE('.', CODE) = 0 THEN CODE
         ELSE CAST(MID(CODE,1, LOCATE('.', CODE) - 1) AS UNSIGNED) END) AS UNSIGNED),
         CAST((SELECT CASE WHEN CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) = CODE THEN '0'
         ELSE CAST(MID(CODE,LOCATE('.', CODE) + 1) AS UNSIGNED) END) AS UNSIGNED);
		DROP TABLE TBL_MESSAGE;
	END;
	
	
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE(CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
	
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM MSG_IN));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
	CALL ValidateFields(flag_validation,CONVERT(unhex(UNHEXPARAM) USING UTF8),de_18,de_44,de_39);
		
	IF flag_validation = FALSE THEN




		SET de_114_007 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '114.7');
		SET de_052 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '52'); 
		SET de_057 = (SELECT DATA FROM TBL_MESSAGE WHERE CODE = '57'); 
		
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		



		SET USERID_AUX = (select tbl_user_id FROM tbl_user where tbl_user_email = de_114_007);
		SET PASSWORD_TEMPORAL_AUX = (select tbl_user_passwordTemp_f FROM tbl_user where tbl_user_email = de_114_007);
		
		SET DEVICE_INI_AUX = (SELECT tbl_status_id FROM tbl_device  where tbl_device_udid = de_057 limit 1);
				
			CASE DEVICE_INI_AUX 
				when 3 then		
	
					
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1827'),('44','Blocked Device'); 
						
				when 2 then		
	
					
						insert into TBL_MESSAGE (CODE,DATA)
						values('39','1827'),('44','Blocked Device'); 
						
				

				else 
		
					IF (SELECT tbl_user_email FROM tbl_user WHERE  tbl_user_email = de_114_007) IS NULL THEN 
		
							
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','1014'),('44','Account Not Found'); 	
						
					ELSE
		
						IF(SELECT tbl_userType_id from tbl_user  WHERE  tbl_user_email = de_114_007) != 1 then  
						
						
								
							insert into TBL_MESSAGE (CODE,DATA)
							values('39','1824'),('44','Invalid consumer'); 	 
		
						ELSE
		
		
							IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 ) = 34 then 
			
								
								insert into TBL_MESSAGE (CODE,DATA)
								values('39','3001'),('44','Account Not Valid'); 	 
							
							ELSE
		
								IF (SELECT tbl_user_email FROM tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_052) USING utf8 ))) is null then 
		
								
									IF (select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX) is null then 		
					
										insert into tbl_block_account set
										tbl_user_id = USERID_AUX,
										tbl_block_account_numtry = 1,
										tbl_block_account_datelasttry = NOW();
										
											
										insert into TBL_MESSAGE (CODE,DATA)
										values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30'); 
		
									ELSE
										
										SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
										SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
										SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

										IF (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) < 3 then 	
		
											IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		

												set PINCODECONT_AUX = (select tbl_block_account_numtry from tbl_block_account where tbl_user_id = USERID_AUX) +1;
												
												
												SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);
												
												update tbl_block_account set 
												tbl_block_account_numtry = PINCODECONT_AUX,
												tbl_block_account_datelasttry = NOW()
												where tbl_user_id = USERID_AUX;
												
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1825'),('44','Invalid Password'),('122.74',PINCODECONT_AUX),('121.129',DELAYTIME_AUX);
											
											ELSE 
											
												update tbl_block_account set 
												tbl_block_account_numtry = 1,
												tbl_block_account_datelasttry = NOW()
												where tbl_user_id = USERID_AUX;
										
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
										
											END IF;
		
										ELSE
						
											IF (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) > (NOW()-INTERVAL 30 MINUTE) then 		
										
												set LASTTRY_AUX = (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX) - (NOW()-INTERVAL 30 MINUTE);
										
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
								
											ELSE
											
												update tbl_block_account set 
												tbl_block_account_numtry = 1,
												tbl_block_account_datelasttry = NOW()
												where tbl_user_id = USERID_AUX;
										
												insert into TBL_MESSAGE (CODE,DATA)
												values('39','1825'),('44','Invalid Password'),('122.74','1'),('121.129','30');
										
											END IF;
											
										END IF;
									END IF;
								ELSE 
										
										
									IF(select tbl_user_id from tbl_block_account where tbl_user_id = USERID_AUX and tbl_block_account_numtry < 3) is null then 
					
									
										SET NOW_30_AUX = (select NOW()-INTERVAL 30 MINUTE);
										SET LASTTRY_AUX =  (select tbl_block_account_datelasttry from tbl_block_account where tbl_user_id = USERID_AUX);
										SET DELAYTIME_AUX = (select TIMESTAMPDIFF(MINUTE,NOW_30_AUX,LASTTRY_AUX) AS minutes);

										IF (LASTTRY_AUX > NOW_30_AUX) then 
										
											insert into TBL_MESSAGE (CODE,DATA)
											values('39','1828'),('44','Phone Locked'),('122.74','3'),('121.129',DELAYTIME_AUX);
											
										ELSE
										
											delete from tbl_block_account where tbl_user_id = USERID_AUX;

									
											case PASSWORD_TEMPORAL_AUX
												when 1 then			
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  
													end if;
													
												when 0 then			
														
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 
													end if;
											end case;
										
										END IF;
									
									ELSE
										
										delete from tbl_block_account where tbl_user_id = USERID_AUX;
										
										
											case PASSWORD_TEMPORAL_AUX
												when 1 then			
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2019'),('44','Temporal Password and no assigned device'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','2015'),('44','User must change password'),('122.72','3'),('114.123','01'),('53',USERID_AUX);  
													end if;
													
												when 0 then			
														
													IF(SELECT tbl_device_id from tbl_device where tbl_device_udid = de_057 and tbl_consumer_nmcid =USERID_AUX limit 1) IS NULL THEN
													
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','1819'),('44','Invalid terminal'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 	
													else
														insert into TBL_MESSAGE (CODE,DATA)
														values('39','0000'),('44','Transaction Approved'),('122.72','3'),('114.123','01'),('53',USERID_AUX); 
													end if;
											end case;
												
									end if;
								end if;
							end if;
						end if;
					end if;				
			end case;						
		

				

	ELSE
	
		
		DELETE FROM TBL_MESSAGE WHERE CODE IN (	'24','25') OR CODE>44;
		
		
		INSERT INTO TBL_MESSAGE(CODE, DATA)
		VALUES ('39',de_39),('44',de_44),('18',de_18),('11', DATE_FORMAT(NOW(),'%y%m%d%h%i%s'));
	
	
	
	END IF;
	




	set RESULT_39 = (select DATA from TBL_MESSAGE where CODE = 39);
	set RESULT_44 = (select DATA from TBL_MESSAGE where CODE = 44);
	set RESULT_53 = (select DATA from TBL_MESSAGE where CODE = 53);
	set RESULT_122_72 = (select DATA from TBL_MESSAGE where CODE = 122.72); 
	set RESULT_114_123 = (select DATA from TBL_MESSAGE where CODE = 114.123); 
	
	set RESULT_122_74 = (select DATA from TBL_MESSAGE where CODE = 122.74); 
	set RESULT_121_129 = (select DATA from TBL_MESSAGE where CODE = 121.129); 

	
	if ((select count(*) from TBL_MESSAGE)=2) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"')) as JSON;
		
	elseif ((select count(*) from TBL_MESSAGE)=5) then
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"53":"',RESULT_53,'"'),CONCAT(',"122.72":"',RESULT_122_72,'"'),CONCAT(',"114.123":"',RESULT_114_123,'"')) as JSON;

	elseif ((select count(*) from TBL_MESSAGE)=4) then	
	
		select GROUP_CONCAT(CONCAT('"39":"',RESULT_39,'"'),CONCAT(',"44":"',RESULT_44,'"'),CONCAT(',"122.74":"',RESULT_122_74,'"'),CONCAT(',"121.129":"',RESULT_121_129,'"'))AS JSON;
		
	end if;
   
		DROP TABLE TBL_MESSAGE;
 
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserPortal` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateUserPortal`(PARAM VARCHAR(20000))
BEGIN 

-- --------------------------------------------------------
-- Autor: Luis Gerardo Porras
-- Procedure: ValidateUserPortal
-- Version: 1.0
-- last modified: 2013-11-13
-- --------------------------------------------------------

-- -------------------------	
-- Declare Data Elements  --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  -- START LIMIT
	DECLARE FIN       INT(11)       DEFAULT 0;  -- END LIMIT

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; -- Email
	DECLARE de_52 VARCHAR(20) DEFAULT NULL; -- Password
	DECLARE LIST_PHONE_AUX VARCHAR(15000) DEFAULT NULL; 
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 
	DECLARE LIST_PHONE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 
	
--            TABLE  TEMPORARY OF IN OUT       --
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    --  METHOD FOR STORING MESSAGE DATA IN TEMPORARY TABLE
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	
-- -----------------	
-- Set variables  --
-- -----------------
	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_007 = (select DATA from TBL_MESSAGE1 where CODE = '114.7');
	SET de_52 = (select DATA from TBL_MESSAGE1 where CODE = '52');
-- ---------------		
-- Page limits  --
-- ---------------
	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	
-- ---------------		
-- Query of DB  --
-- ---------------
	
	SET USER_TYPE_AUX = (SELECT tbl_userType_id FROM  tbl_user where tbl_user_email = de_114_007 and tbl_user_password = CONVERT(unhex(de_52) USING utf8 ) );
	
	IF USER_TYPE_AUX IS NOT NULL THEN
			SET LIST_PHONE_EMPTY_AUX = (SELECT  CONCAT(',"300.28":[]') AS JSON);
			
			
				CASE USER_TYPE_AUX
					
					WHEN 1 THEN -- Consumer
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 ) LIMIT 1)  IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;			
						
						ELSE
										
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )) ;
						END IF;
				
					WHEN 2 THEN	-- Merchant
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 ) LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
							
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )) ;
						END IF;
				
					WHEN 3 THEN	-- Reseller
				
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )) ;
						END IF;
					
					WHEN 4  THEN				-- Admin
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )) ;
						END IF;
					
					WHEN 5 THEN				-- super Admin
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = CONVERT(unhex(de_52) USING utf8 )) ;
						END IF;

					END CASE;						
					
			
			SELECT 
				  GROUP_CONCAT(   
						CONCAT('{"114.179":"',tbl_user_id,'"'),
						CONCAT(',"114.123":"',tbl_userType_id,'"'),
						CONCAT(',"114.9":"',tbl_user_userTemp_f,'"'),
						CONCAT(',"114.70":"',if(tbl_user_companyName  is null,'',tbl_user_companyName ),'"'),
						CONCAT(',"114.3":"',if(tbl_user_first  is null,'',tbl_user_first ),'"'),
						CONCAT(',"114.5":"',if(tbl_user_last  is null,'',tbl_user_last ),'"'),
						CONCAT(LIST_PHONE_AUX),
						CONCAT(',"114.7":"',if(tbl_user_email  is null,'',tbl_user_email ),'"'),
						-- CONCAT(',"47.17":"',if(tbl_zipcode_id  is null,'',tbl_zipcode_id ),'"'),
						CONCAT(',"114.91":"',if(tbl_user_title  is null,'',tbl_user_title ),'"}')
				  )as JSON
		   
			from tbl_user 
			where tbl_user_email = de_114_007
			and tbl_user_password = CONVERT(unhex(de_52) USING utf8 ) 
			LIMIT INI,FIN;

	ELSE		
		
		SELECT 
				  GROUP_CONCAT(   
						CONCAT('{"39":"','1825','"'),CONCAT(',"44":"','Invalid Password','"}') )as JSON;
			
	END IF;
			
	-- ELIMINATION OF TEMPORARY TABLE
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserPortal050400121` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `ValidateUserPortal050400121`(PARAM VARCHAR(20000))
BEGIN 
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_52 VARCHAR(50) DEFAULT NULL; 
	
-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- -----------------	
-- Set variables --
-- -----------------

	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_007 = (select DATA from TBL_MESSAGE1 where CODE = '114.7');
	SET de_52 = (select DATA from TBL_MESSAGE1 where CODE = '52');

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
-- ---------------		
-- Query of DB --
-- ---------------


	IF(SELECT tbl_user_id FROM tbl_user WHERE tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) IS NULL THEN
		SELECT 
			GROUP_CONCAT(   
				CONCAT('{"39":"','1014','"'),CONCAT(',"44":"','Invalid Email','"}') )as JSON;
	ELSE

		IF (SELECT tbl_user_id FROM  tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8)) and tbl_user_entity not in (10) limit 1) IS NOT NULL THEN
			
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) = 34 then -- if the user is blocked
			
				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;
				
			ELSEIF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity in (30,60) and tbl_user_userTemp_f = 0 limit 1) = 35 then -- Pending

				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;

			ELSEIF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity not in (10) limit 1) = 38 then -- Deleted

				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;

			

			ELSE

			
				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"39":"','0000','"'),
						CONCAT(',"44":"','Transaction Approved','"'),
						CONCAT(',"53":"',     COALESCE(dbuser.getNMCID(A.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(A.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', hex(if(A.tbl_user_companyName  is null or A.tbl_user_companyName = '',if(A.tbl_user_class in('2A1','3A1'),(select tbl_user_companyName from tbl_user where tbl_user_id = A.tbl_user_parentId),''),A.tbl_user_companyName )),'"'),
						CONCAT(',"123.71":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),(select C.tbl_reseller_taxNumber from dbuser.tbl_reseller as C where C.tbl_user_id = A.tbl_user_id)),''),'"'),
						CONCAT(',"114.7":"',  COALESCE(A.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(A.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(A.tbl_user_last,''),'"'),
						CONCAT(',"114.91":"', COALESCE(A.tbl_user_title,''),'"'),
                        CONCAT(',"AD":[',     COALESCE(dbuser.getNMCAddressByUser(A.tbl_user_id),''),']'),
						CONCAT(',"LO":[',     COALESCE(dbuser.getNMCLocationByUser(A.tbl_user_id),''),']'),
						CONCAT(',"PH":[',     COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']'),
						CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryUser(A.tbl_user_id),''),']'),
						CONCAT(',"AC":{',     COALESCE(dbcards.getNMCCardByUser(A.tbl_user_id),''),'}'),
                        CONCAT(',"PE":[',     COALESCE(dbuser.getNMCPermissionByUser(A.tbl_user_id),''),']'),
                        CONCAT(',"DL":[',     COALESCE(dbuser.getNMCDesignatedLocationsByUser(A.tbl_user_id),''),']'),
						CONCAT(',"114.4":"',  COALESCE(A.tbl_user_middle,''),'"'),
						CONCAT(',"127.10":"', COALESCE(A.tbl_owner_id,''),'"'),
						CONCAT(',"127.66":"', COALESCE(hex(A.tbl_user_information),''),'"'),
						CONCAT(',"114.11":"', COALESCE(A.tbl_gender_type,''),'"'),
						CONCAT(',"127.70":"', COALESCE(A.tbl_company_type,''),'"'),
						CONCAT(',"127.71":"', COALESCE(A.tbl_company_type_other,''),'"'),
						CONCAT(',"122.94":"', COALESCE(A.tbl_user_language,'EN'),'"'),
						CONCAT(',"122.91":"', COALESCE(A.tbl_user_position,''),'"'),
						CONCAT(',"122.92":"', COALESCE(A.tbl_user_department,''),'"'),
						CONCAT(',"114.143":"',COALESCE(A.tbl_userstatus_id,''),'"'),
						CONCAT(',"117.26":"', COALESCE(A.tbl_agent_type_id,''),'"'),
                        CONCAT(',"122.46":"',COALESCE(if((select tbl_permission_ad_create_f from dbuser.tbl_permission_ad where tbl_user_id = A.tbl_user_id limit 1)=1,'true','false'),'false'),'"'), 
                        CONCAT(',"122.47":"',COALESCE(if((select tbl_permission_ad_publish_f from dbuser.tbl_permission_ad where tbl_user_id = A.tbl_user_id limit 1) = 1,'true','false'),'false'),'"'),
						CONCAT(',"123.34":"', COALESCE(if (A.tbl_user_class in ('2A1','2B1','2C1'),(select B.tbl_user_crc from tbl_user as B where B.tbl_user_id = A.tbl_user_parentId),A.tbl_user_crc),''),'"'),
                        CONCAT(',"114.121":"',COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.17":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.18":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.20":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.21":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
                        CONCAT(',"114.9":"',  (select if ((select A.tbl_user_userTemp_f from tbl_user as A where A.tbl_user_email = de_114_007 and A.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) and A.tbl_user_entity not in (10) limit 1) = 1,'true','false')),'"'),
					    CONCAT(',"122.20":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),if((select B.tbl_merchant_sellApitapWebsite_f from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id)=1,'true','false'),if((select B.tbl_merchant_sellApitapWebsite_f from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)=1,'true','false')),'false'),'false'),'"'),
                        CONCAT(',"122.46":"', COALESCE(if((select tbl_permission_ad_create_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        CONCAT(',"122.47":"', COALESCE(if((select tbl_permission_ad_publish_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        CONCAT(',"114.47":"', COALESCE((select tbl_location_id from dbuser.tbl_location where tbl_location_userId = A.tbl_user_id and (UPPER(tbl_location_storeName) like CONCAT("%",UPPER('https'),"%") or UPPER(tbl_location_storeName) like CONCAT("%",UPPER('http'),"%") or UPPER(tbl_location_storeName) like CONCAT("%",UPPER('www'),"%")) limit 1),''),'"'),
                        CONCAT(',"119.16":"', COALESCE(hex(A.tbl_user_policy),''),'"'),
                        CONCAT(',"120.157":"',COALESCE((SELECT W.tbl_reseller_comments FROM dbuser.tbl_reseller as W where W.tbl_user_id =A.tbl_user_id ),'' ),'"}')
						
						)as JSON
					   
						from tbl_user as A
						where A.tbl_user_email = de_114_007
						and A.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) 
                        and A.tbl_user_entity not in (10)
						LIMIT INI,FIN;
                        
			END IF;
		ELSE	
        
			SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','1825','"'),CONCAT(',"44":"','Invalid Password','"}') )as JSON;
                
		END IF;
	END IF;		
	
	DROP TABLE TBL_MESSAGE1;
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserPortal_1` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmcserver`@`localhost` PROCEDURE `ValidateUserPortal_1`(PARAM VARCHAR(20000))
BEGIN 












	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_52 VARCHAR(20) DEFAULT NULL; 
	DECLARE LIST_PHONE_AUX VARCHAR(15000) DEFAULT NULL; 
	DECLARE USER_TYPE_AUX VARCHAR(20) DEFAULT 0; 
	DECLARE LIST_PHONE_EMPTY_AUX VARCHAR(300) DEFAULT NULL; 
	
	DROP TEMPORARY TABLE IF EXISTS TBL_MESSAGE1;


    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
	



	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_007 = (select DATA from TBL_MESSAGE1 where CODE = '114.7');
	SET de_52 = (select DATA from TBL_MESSAGE1 where CODE = '52');



	
	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
	



	
	SET USER_TYPE_AUX = (SELECT tbl_userType_id FROM  tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) );

	IF USER_TYPE_AUX IS NOT NULL THEN
			SET LIST_PHONE_EMPTY_AUX = (SELECT  CONCAT(',"300.28":[]') AS JSON);
			
			
				CASE USER_TYPE_AUX
					
					WHEN 1 THEN 
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) LIMIT 1)  IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;			
						
						ELSE
										
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_consumer as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_consumer_nmcId
													and C.tbl_consumer_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))) ;
						END IF;
				
					WHEN 2 THEN	
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
							
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_merchant as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_merchant_nmcId
													and C.tbl_merchant_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))) ;
						END IF;
				
					WHEN 3 THEN	
				
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_reseller as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_reseller_nmcId
													and C.tbl_reseller_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))) ;
						END IF;
					
					WHEN 4  THEN				
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))) ;
						END IF;
					
					WHEN 5 THEN				
						
						IF (SELECT A.tbl_phone_nmcId FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))LIMIT 1) IS NULL THEN
												
							SET	LIST_PHONE_AUX = LIST_PHONE_EMPTY_AUX;	
						
						ELSE
						
							SET LIST_PHONE_AUX =(SELECT  CONCAT(',"300.28":[',GROUP_CONCAT(
												CONCAT('{"122.88":"',if(A.tbl_phone_id  is null,'',A.tbl_phone_id),'"'),
												CONCAT(',"48.28":"',if(A.tbl_phone_phoneNumber  is null,'',A.tbl_phone_phoneNumber ),'"'),
												CONCAT(',"121.167":"',if(A.tbl_phone_extension  is null,'',A.tbl_phone_extension ),'"'),
												CONCAT(',"121.62":"',if(A.tbl_phonetype_id  is null,'',A.tbl_phonetype_id ),'"'),
												CONCAT(',"114.179":"',if(A.tbl_phone_nmcId  is null,'',A.tbl_phone_nmcId ),'"}')
													),"]") AS JSON FROM tbl_phone as A, tbl_user as B, tbl_admin as C
													where B.tbl_user_email = de_114_007
													and B.tbl_user_id = C.tbl_admin_nmcId
													and C.tbl_admin_nmcId = A.tbl_phone_nmcId
													and B.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))) ;
						END IF;

					END CASE;						
					
			
			SELECT 
				  GROUP_CONCAT(  
						CONCAT('"39":"','0000','"'),
						CONCAT(',"44":"','Transaction Approved','"'),
						CONCAT(',"299":{"114.179":"',tbl_user_id,'"'),
						CONCAT(',"114.123":"',tbl_userType_id,'"'),
						CONCAT(',"114.9":"',(select if ((select tbl_user_userTemp_f from tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 ))) = 1,'true','false')),'"'),
						CONCAT(',"114.70":"',if(tbl_user_companyName  is null,'',tbl_user_companyName ),'"'),
						CONCAT(',"114.3":"',if(tbl_user_first  is null,'',tbl_user_first ),'"'),
						CONCAT(',"114.5":"',if(tbl_user_last  is null,'',tbl_user_last ),'"'),
						CONCAT(LIST_PHONE_AUX),
						CONCAT(',"114.7":"',if(tbl_user_email  is null,'',tbl_user_email ),'"'),
						CONCAT(',"127.10":"',if(tbl_owner_id  is null,'',tbl_owner_id ),'"'),
						
						CONCAT(',"114.91":"',if(tbl_user_title  is null,'',tbl_user_title ),'"}')
				  )as JSON
		   
			from tbl_user 
			where tbl_user_email = de_114_007
			and tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) 
			LIMIT INI,FIN;

	ELSE		
		
		SELECT 
				  GROUP_CONCAT(   
						CONCAT('"39":"','1825','"'),CONCAT(',"44":"','Invalid Password','"') )as JSON;
			
	END IF;
			
	
	DROP TABLE TBL_MESSAGE1;
  
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `ValidateUserWebsite050400700` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`nmc`@`%` PROCEDURE `ValidateUserWebsite050400700`(PARAM VARCHAR(20000))
BEGIN 
-- -------------------------	
-- Declare Data Elements --
-- -------------------------

	DECLARE UNHEXPARAM VARCHAR(20000) DEFAULT NULL;

	DECLARE INI       INT(11)       DEFAULT 1;  
	DECLARE FIN       INT(11)       DEFAULT 0;  

	DECLARE de_114_007 VARCHAR(300) DEFAULT NULL; 
	DECLARE de_52 VARCHAR(50) DEFAULT NULL; 
	
-- ---------------
-- Validations --
-- ---------------

	DROP TEMPORARY TABLE if exists TBL_MESSAGE1;
    CREATE TEMPORARY TABLE IF NOT EXISTS TBL_MESSAGE1 (CODE VARCHAR(7)NOT NULL, DATA VARCHAR(4000)NULL);
    
	SET UNHEXPARAM = (SELECT TRIM(BOTH '"' FROM PARAM));
	
    
    SET @QRY = CONCAT('INSERT INTO TBL_MESSAGE1 (CODE, DATA) VALUES ',CONVERT(unhex(UNHEXPARAM) USING UTF8));
    PREPARE stmt FROM @QRY;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
-- -----------------	
-- Set variables --
-- -----------------

	SET group_concat_max_len=150000;
	SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3');

	SET de_114_007 = (select DATA from TBL_MESSAGE1 where CODE = '114.7');
	SET de_52 = (select DATA from TBL_MESSAGE1 where CODE = '52');

	IF (length(INI) > 0) then 
		SET INI = (select DATA from TBL_MESSAGE1 where CODE = '120.2');
	ELSE
		set INI = 0;
	END IF;
		
	IF (length(FIN) > 0) then 
		SET FIN = (select DATA from TBL_MESSAGE1 where CODE = '120.3') - INI;
	ELSE
		set FIN = 999999999;
	END IF;
-- ---------------		
-- Query of DB --
-- ---------------


	IF(SELECT tbl_user_id FROM tbl_user WHERE tbl_user_email = de_114_007 and tbl_user_entity in (10) limit 1) IS NULL THEN
		SELECT 
			GROUP_CONCAT(   
				CONCAT('{"39":"','1014','"'),CONCAT(',"44":"','Invalid Email','"}') )as JSON;
	ELSE

		IF (SELECT tbl_user_id FROM  tbl_user where tbl_user_email = de_114_007 and tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8)) and tbl_user_entity in (10) limit 1) IS NOT NULL THEN
			
			IF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity in (10) limit 1) = 34 then -- if the user is blocked
			
				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;
				
			ELSEIF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity in (30,60) and tbl_user_userTemp_f = 0 limit 1) = 35 then -- Pending

				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;

			ELSEIF (SELECT tbl_userstatus_id from tbl_user where tbl_user_email = de_114_007 and tbl_user_entity in (10) limit 1) = 38 then -- Deleted

				SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','3001','"'),CONCAT(',"44":"','Account Not Valid','"}') )as JSON;

			

			ELSE

			
				SELECT 
					GROUP_CONCAT(  
						CONCAT('{"39":"','0000','"'),
						CONCAT(',"44":"','Transaction Approved','"'),
						CONCAT(',"53":"',     COALESCE(dbuser.getNMCID(A.tbl_user_id),''),'"'),
                        CONCAT(',"114.1":"',  COALESCE(A.tbl_company_id,''),'"'),
						CONCAT(',"114.70":"', hex(if(A.tbl_user_companyName  is null or A.tbl_user_companyName = '',if(A.tbl_user_class in('2A1','3A1'),(select tbl_user_companyName from tbl_user where tbl_user_id = A.tbl_user_parentId),''),A.tbl_user_companyName )),'"'),
						CONCAT(',"123.71":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_taxIdNumber from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),(select C.tbl_reseller_taxNumber from dbuser.tbl_reseller as C where C.tbl_user_id = A.tbl_user_id)),''),'"'),
						CONCAT(',"114.7":"',  COALESCE(A.tbl_user_email,''),'"'),
						CONCAT(',"114.3":"',  COALESCE(A.tbl_user_first,''),'"'),
						CONCAT(',"114.5":"',  COALESCE(A.tbl_user_last,''),'"'),
						CONCAT(',"114.91":"', COALESCE(A.tbl_user_title,''),'"'),
                        CONCAT(',"AD":[',     COALESCE(dbuser.getNMCAddressByUser(A.tbl_user_id),''),']'),
						CONCAT(',"LO":[',     COALESCE(dbuser.getNMCLocationByUser(A.tbl_user_id),''),']'),
						CONCAT(',"PH":[',     COALESCE(dbuser.getNMCPhoneByUser(A.tbl_user_id),''),']'),
						CONCAT(',"CU":[',     COALESCE(dbitems.getNMCCategoryUser(A.tbl_user_id),''),']'),
						CONCAT(',"AC":{',     COALESCE(dbcards.getNMCCardByUser(A.tbl_user_id),''),'}'),
                        CONCAT(',"PE":[',     COALESCE(dbuser.getNMCPermissionByUser(A.tbl_user_id),''),']'),
                        CONCAT(',"DL":[',     COALESCE(dbuser.getNMCDesignatedLocationsByUser(A.tbl_user_id),''),']'),
						CONCAT(',"114.4":"',  COALESCE(A.tbl_user_middle,''),'"'),
						CONCAT(',"127.10":"', COALESCE(A.tbl_owner_id,''),'"'),
						CONCAT(',"127.66":"', COALESCE(hex(A.tbl_user_information),''),'"'),
						CONCAT(',"114.11":"', COALESCE(A.tbl_gender_type,''),'"'),
						CONCAT(',"127.70":"', COALESCE(A.tbl_company_type,''),'"'),
						CONCAT(',"127.71":"', COALESCE(A.tbl_company_type_other,''),'"'),
						CONCAT(',"122.94":"', COALESCE(A.tbl_user_language,'EN'),'"'),
						CONCAT(',"122.91":"', COALESCE(A.tbl_user_position,''),'"'),
						CONCAT(',"122.92":"', COALESCE(A.tbl_user_department,''),'"'),
						CONCAT(',"114.143":"',COALESCE(A.tbl_userstatus_id,''),'"'),
						CONCAT(',"117.26":"', COALESCE(A.tbl_agent_type_id,''),'"'),
                        CONCAT(',"122.46":"',COALESCE(if((select tbl_permission_ad_create_f from dbuser.tbl_permission_ad where tbl_user_id = A.tbl_user_id limit 1)=1,'true','false'),'false'),'"'), 
                        CONCAT(',"122.47":"',COALESCE(if((select tbl_permission_ad_publish_f from dbuser.tbl_permission_ad where tbl_user_id = A.tbl_user_id limit 1) = 1,'true','false'),'false'),'"'),
						CONCAT(',"123.34":"', COALESCE(if (A.tbl_user_class in ('2A1','2B1','2C1'),(select B.tbl_user_crc from tbl_user as B where B.tbl_user_id = A.tbl_user_parentId),A.tbl_user_crc),''),'"'),
                        CONCAT(',"114.121":"',COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_multiple_locations_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.17":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_location_use from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.18":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_dongles_quantity from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.20":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_standard_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
						CONCAT(',"117.21":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id),(select B.tbl_merchant_deluxe_subs from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)),'0'),''),'"'),
                        CONCAT(',"114.9":"',  (select if ((select A.tbl_user_userTemp_f from tbl_user as A where A.tbl_user_email = de_114_007 and A.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) and A.tbl_user_entity in (10) limit 1) = 1,'true','false')),'"'),
					    CONCAT(',"122.20":"', COALESCE(if (A.tbl_user_entity = 20, if (A.tbl_user_class in ('2A0','2B0','2C0'),if((select B.tbl_merchant_sellApitapWebsite_f from dbuser.tbl_merchant as B where A.tbl_user_id = B.tbl_user_id)=1,'true','false'),if((select B.tbl_merchant_sellApitapWebsite_f from dbuser.tbl_merchant as B where A.tbl_user_parentId = B.tbl_user_id)=1,'true','false')),'false'),'false'),'"'),
                        CONCAT(',"122.46":"', COALESCE(if((select tbl_permission_ad_create_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        CONCAT(',"122.47":"', COALESCE(if((select tbl_permission_ad_publish_f from tbl_permission_ad where tbl_user_id = A.tbl_user_id)=1,'true','false'),'false'),'"'),
                        CONCAT(',"114.47":"', COALESCE((select tbl_location_id from dbuser.tbl_location where tbl_location_userId = A.tbl_user_id and (UPPER(tbl_location_storeName) like CONCAT("%",UPPER('https'),"%") or UPPER(tbl_location_storeName) like CONCAT("%",UPPER('http'),"%") or UPPER(tbl_location_storeName) like CONCAT("%",UPPER('www'),"%")) limit 1),''),'"'),
                        CONCAT(',"119.16":"', COALESCE(hex(A.tbl_user_policy),''),'"'),
                        CONCAT(',"120.157":"',COALESCE((SELECT W.tbl_reseller_comments FROM dbuser.tbl_reseller as W where W.tbl_user_id =A.tbl_user_id ),'' ),'"}')
						
						)as JSON
					   
						from tbl_user as A
						where A.tbl_user_email = de_114_007
						and A.tbl_user_password = md5(CONVERT(unhex(de_52) USING utf8 )) 
                        and A.tbl_user_entity in (10)
						LIMIT INI,FIN;
                        
			END IF;
		ELSE	
        
			SELECT 
				GROUP_CONCAT(   
				CONCAT('{"39":"','1825','"'),CONCAT(',"44":"','Invalid Password','"}') )as JSON;
                
		END IF;
	END IF;		
	
	DROP TABLE TBL_MESSAGE1;
 END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2026-01-09 14:32:04
