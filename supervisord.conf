[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[unix_http_server]
file=/var/run/supervisor.sock

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:ollama]
command=ollama serve
autostart=true
autorestart=true
priority=10
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisor/ollama.log
stderr_logfile=/var/log/supervisor/ollama_err.log
environment=OLLAMA_MODELS="/workspace/ollama-models",NVIDIA_VISIBLE_DEVICES="all",OLLAMA_HOST="0.0.0.0:11434"

[program:mysql]
command=/usr/sbin/mysqld --user=mysql --datadir=/workspace/mysql-data
autostart=true
autorestart=true
priority=10
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisor/mysql.log
stderr_logfile=/var/log/supervisor/mysql_err.log

[program:voice-agent]
command=uvicorn src.api.server:app --host 0.0.0.0 --port 8000
directory=/app
autostart=false
autorestart=true
priority=30
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisor/voice-agent.log
stderr_logfile=/var/log/supervisor/voice-agent_err.log
environment=MYSQL_HOST="127.0.0.1",MYSQL_PORT="3306",OLLAMA_HOST="http://localhost:11434",PYTHONPATH="/app",XDG_CACHE_HOME="/workspace"
